<html lang="en">
<head>
<meta charset="UTF-8">
<title>elaws-openapi-proxy example usage by langchain on browser</title>
<script>

// GitHub repository: https://github.com/yamachig/elaws-openapi-proxy

const init = async (options) => {

    const executor = await lib.createAgentExecutor({
        llmOptions: {
            modelName: "gpt-4-0613",
            temperature: 0,
            verbose: true,
            ...options,
        }
    });

    window.executor = executor;

};

window.init = init;
console.log(`\
# How to use

1. run the following code to initialize.

    init({ openAIApiKey: "sk-*******************************" })

2. run the following code to run the LLM agent executor.

    executor.run("デジタル庁設置法（令和三年法律第三十六号）第一条の内容を教えてください。").then(console.log)
`);

</script>
<script defer>!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.lib=t():e.lib=t()}(self,(()=>(()=>{var e={9669:(e,t,r)=>{e.exports=r(1609)},5448:(e,t,r)=>{"use strict";var n=r(4867),a=r(6026),i=r(4372),s=r(5327),o=r(4097),l=r(4109),c=r(7985),u=r(5061),d=r(7874),p=r(5263);e.exports=function(e){return new Promise((function(t,r){var h,m=e.data,f=e.headers,g=e.responseType;function b(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}n.isFormData(m)&&delete f["Content-Type"];var y=new XMLHttpRequest;if(e.auth){var v=e.auth.username||"",w=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";f.Authorization="Basic "+btoa(v+":"+w)}var _=o(e.baseURL,e.url);function P(){if(y){var n="getAllResponseHeaders"in y?l(y.getAllResponseHeaders()):null,i={data:g&&"text"!==g&&"json"!==g?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:n,config:e,request:y};a((function(e){t(e),b()}),(function(e){r(e),b()}),i),y=null}}if(y.open(e.method.toUpperCase(),s(_,e.params,e.paramsSerializer),!0),y.timeout=e.timeout,"onloadend"in y?y.onloadend=P:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(P)},y.onabort=function(){y&&(r(u("Request aborted",e,"ECONNABORTED",y)),y=null)},y.onerror=function(){r(u("Network Error",e,null,y)),y=null},y.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||d;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(u(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},n.isStandardBrowserEnv()){var O=(e.withCredentials||c(_))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;O&&(f[e.xsrfHeaderName]=O)}"setRequestHeader"in y&&n.forEach(f,(function(e,t){void 0===m&&"content-type"===t.toLowerCase()?delete f[t]:y.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(y.withCredentials=!!e.withCredentials),g&&"json"!==g&&(y.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&y.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(e){y&&(r(!e||e&&e.type?new p("canceled"):e),y.abort(),y=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),m||(m=null),y.send(m)}))}},1609:(e,t,r)=>{"use strict";var n=r(4867),a=r(1849),i=r(321),s=r(7185),o=function e(t){var r=new i(t),o=a(i.prototype.request,r);return n.extend(o,i.prototype,r),n.extend(o,r),o.create=function(r){return e(s(t,r))},o}(r(5546));o.Axios=i,o.Cancel=r(5263),o.CancelToken=r(4972),o.isCancel=r(6502),o.VERSION=r(7288).version,o.all=function(e){return Promise.all(e)},o.spread=r(8713),o.isAxiosError=r(6268),e.exports=o,e.exports.default=o},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,r)=>{"use strict";var n=r(5263);function a(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}a.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},a.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},a.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},a.source=function(){var e;return{token:new a((function(t){e=t})),cancel:e}},e.exports=a},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,r)=>{"use strict";var n=r(4867),a=r(5327),i=r(782),s=r(3572),o=r(7185),l=r(4875),c=l.validators;function u(e){this.defaults=e,this.interceptors={request:new i,response:new i}}u.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=o(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&l.assertOptions(r,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var n=[],a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var i,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!a){var d=[s,void 0];for(Array.prototype.unshift.apply(d,n),d=d.concat(u),i=Promise.resolve(t);d.length;)i=i.then(d.shift(),d.shift());return i}for(var p=t;n.length;){var h=n.shift(),m=n.shift();try{p=h(p)}catch(e){m(e);break}}try{i=s(p)}catch(e){return Promise.reject(e)}for(;u.length;)i=i.then(u.shift(),u.shift());return i},u.prototype.getUri=function(e){return e=o(this.defaults,e),a(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,r){return this.request(o(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,r,n){return this.request(o(n||{},{method:e,url:t,data:r}))}})),e.exports=u},782:(e,t,r)=>{"use strict";var n=r(4867);function a(){this.handlers=[]}a.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=a},4097:(e,t,r)=>{"use strict";var n=r(1793),a=r(7303);e.exports=function(e,t){return e&&!n(t)?a(e,t):t}},5061:(e,t,r)=>{"use strict";var n=r(481);e.exports=function(e,t,r,a,i){var s=new Error(e);return n(s,t,r,a,i)}},3572:(e,t,r)=>{"use strict";var n=r(4867),a=r(8527),i=r(6502),s=r(5546),o=r(5263);function l(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new o("canceled")}e.exports=function(e){return l(e),e.headers=e.headers||{},e.data=a.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return l(e),t.data=a.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(l(e),t&&t.response&&(t.response.data=a.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,r,n,a){return e.config=t,r&&(e.code=r),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7185:(e,t,r)=>{"use strict";var n=r(4867);e.exports=function(e,t){t=t||{};var r={};function a(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function i(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(e[r],t[r])}function s(e){if(!n.isUndefined(t[e]))return a(void 0,t[e])}function o(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(void 0,t[r])}function l(r){return r in t?a(e[r],t[r]):r in e?a(void 0,e[r]):void 0}var c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,a=t(e);n.isUndefined(a)&&t!==l||(r[e]=a)})),r}},6026:(e,t,r)=>{"use strict";var n=r(5061);e.exports=function(e,t,r){var a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},8527:(e,t,r)=>{"use strict";var n=r(4867),a=r(5546);e.exports=function(e,t,r){var i=this||a;return n.forEach(r,(function(r){e=r.call(i,e,t)})),e}},5546:(e,t,r)=>{"use strict";var n=r(4867),a=r(6016),i=r(481),s=r(7874),o={"Content-Type":"application/x-www-form-urlencoded"};function l(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,u={transitional:s,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=r(5448)),c),transformRequest:[function(e,t){return a(t,"Accept"),a(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(l(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(l(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||u.transitional,r=t&&t.silentJSONParsing,a=t&&t.forcedJSONParsing,s=!r&&"json"===this.responseType;if(s||a&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(s){if("SyntaxError"===e.name)throw i(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){u.headers[e]=n.merge(o)})),e.exports=u},7874:e=>{"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:e=>{e.exports={version:"0.26.1"}},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},5327:(e,t,r)=>{"use strict";var n=r(4867);function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(n.isURLSearchParams(t))i=t.toString();else{var s=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),s.push(a(t)+"="+a(e))})))})),i=s.join("&")}if(i){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,r)=>{"use strict";var n=r(4867);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,a,i,s){var o=[];o.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),n.isString(a)&&o.push("path="+a),n.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},6268:(e,t,r)=>{"use strict";var n=r(4867);e.exports=function(e){return n.isObject(e)&&!0===e.isAxiosError}},7985:(e,t,r)=>{"use strict";var n=r(4867);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function a(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=a(window.location.href),function(t){var r=n.isString(t)?a(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},6016:(e,t,r)=>{"use strict";var n=r(4867);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},4109:(e,t,r)=>{"use strict";var n=r(4867),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,i,s={};return e?(n.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t){if(s[t]&&a.indexOf(t)>=0)return;s[t]="set-cookie"===t?(s[t]?s[t]:[]).concat([r]):s[t]?s[t]+", "+r:r}})),s):s}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4875:(e,t,r)=>{"use strict";var n=r(7288).version,a={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){a[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var i={};a.transitional=function(e,t,r){function a(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,s){if(!1===e)throw new Error(a(n," has been removed"+(t?" in "+t:"")));return t&&!i[n]&&(i[n]=!0,console.warn(a(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,s)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),a=n.length;a-- >0;){var i=n[a],s=t[i];if(s){var o=e[i],l=void 0===o||s(o,i,e);if(!0!==l)throw new TypeError("option "+i+" must be "+l)}else if(!0!==r)throw Error("Unknown option "+i)}},validators:a}},4867:(e,t,r)=>{"use strict";var n=r(1849),a=Object.prototype.toString;function i(e){return Array.isArray(e)}function s(e){return void 0===e}function o(e){return"[object ArrayBuffer]"===a.call(e)}function l(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==a.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===a.call(e)}function d(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}e.exports={isArray:i,isArrayBuffer:o,isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===a.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&o(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:l,isPlainObject:c,isUndefined:s,isDate:function(e){return"[object Date]"===a.call(e)},isFile:function(e){return"[object File]"===a.call(e)},isBlob:function(e){return"[object Blob]"===a.call(e)},isFunction:u,isStream:function(e){return l(e)&&u(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===a.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:d,merge:function e(){var t={};function r(r,n){c(t[n])&&c(r)?t[n]=e(t[n],r):c(r)?t[n]=e({},r):i(r)?t[n]=r.slice():t[n]=r}for(var n=0,a=arguments.length;n<a;n++)d(arguments[n],r);return t},extend:function(e,t,r){return d(t,(function(t,a){e[a]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=o(e),s=i[0],l=i[1],c=new a(function(e,t,r){return 3*(t+r)/4-r}(0,s,l)),u=0,d=l>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===l&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],s=16383,o=0,c=n-a;o<c;o+=s)i.push(l(e,o,o+s>c?c:o+s));return 1===a?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=i[s],n[i.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,n){for(var a,i,s=[],o=t;o<n;o+=3)a=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(i=a)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},3204:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,a=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=new RegExp("^"+i.source),o=new RegExp(i.source+a.source,"gu"),l=new RegExp("\\d+"+a.source,"gu"),c=(e,a)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(a={pascalCase:!1,preserveConsecutiveUppercase:!1,...a},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const i=!1===a.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(a.locale),c=!1===a.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(a.locale);return 1===e.length?a.pascalCase?c(e):i(e):(e!==i(e)&&(e=((e,n,a)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];i&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&r.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=n(c)===c&&a(c)!==c,o=s,s=a(c)===c&&n(c)!==c)}return e})(e,i,c)),e=e.replace(s,""),e=a.preserveConsecutiveUppercase?((e,t)=>(n.lastIndex=0,e.replace(n,(e=>t(e)))))(e,i):i(e),a.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},2466:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new a(n,i||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,a=[];if(0===this._eventsCount)return a;for(n in e=this._events)t.call(e,n)&&a.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var a=0,i=n.length,s=new Array(i);a<i;a++)s[a]=n[a].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,a,i,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,a),!0;case 5:return u.fn.call(u.context,t,n,a,i),!0;case 6:return u.fn.call(u.context,t,n,a,i,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var p,h=u.length;for(c=0;c<h;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,a);break;default:if(!l)for(p=1,l=new Array(d-1);p<d;p++)l[p-1]=arguments[p];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,a){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||a&&!o.once||n&&o.context!==n||s(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||a&&!o[l].once||n&&o[l].context!==n)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},3320:(e,t,r)=>{"use strict";var n=r(7990),a=r(3150);function i(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}e.exports.Type=r(1364),e.exports.Schema=r(7657),e.exports.FAILSAFE_SCHEMA=r(4795),e.exports.JSON_SCHEMA=r(5966),e.exports.CORE_SCHEMA=r(9471),e.exports.DEFAULT_SCHEMA=r(6601),e.exports.load=n.load,e.exports.loadAll=n.loadAll,e.exports.dump=a.dump,e.exports.YAMLException=r(8425),e.exports.types={binary:r(3531),float:r(5215),map:r(945),null:r(151),pairs:r(6879),set:r(4982),timestamp:r(2156),bool:r(8771),int:r(1518),merge:r(7452),omap:r(1605),seq:r(6451),str:r(48)},e.exports.safeLoad=i("safeLoad","load"),e.exports.safeLoadAll=i("safeLoadAll","loadAll"),e.exports.safeDump=i("safeDump","dump")},8347:e=>{"use strict";function t(e){return null==e}e.exports.isNothing=t,e.exports.isObject=function(e){return"object"==typeof e&&null!==e},e.exports.toArray=function(e){return Array.isArray(e)?e:t(e)?[]:[e]},e.exports.repeat=function(e,t){var r,n="";for(r=0;r<t;r+=1)n+=e;return n},e.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},e.exports.extend=function(e,t){var r,n,a,i;if(t)for(r=0,n=(i=Object.keys(t)).length;r<n;r+=1)e[a=i[r]]=t[a];return e}},3150:(e,t,r)=>{"use strict";var n=r(8347),a=r(8425),i=r(6601),s=Object.prototype.toString,o=Object.prototype.hasOwnProperty,l=65279,c=9,u=10,d=13,p=32,h=33,m=34,f=35,g=37,b=38,y=39,v=42,w=44,_=45,P=58,O=61,T=62,A=63,x=64,j=91,E=93,S=96,C=123,I=124,k=125,M={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},N=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],L=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function R(e){var t,r,i;if(t=e.toString(16).toUpperCase(),e<=255)r="x",i=2;else if(e<=65535)r="u",i=4;else{if(!(e<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");r="U",i=8}return"\\"+r+n.repeat("0",i-t.length)+t}var $=2;function D(e){this.schema=e.schema||i,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=n.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var r,n,a,i,s,l,c;if(null===t)return{};for(r={},a=0,i=(n=Object.keys(t)).length;a<i;a+=1)s=n[a],l=String(t[s]),"!!"===s.slice(0,2)&&(s="tag:yaml.org,2002:"+s.slice(2)),(c=e.compiledTypeMap.fallback[s])&&o.call(c.styleAliases,l)&&(l=c.styleAliases[l]),r[s]=l;return r}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?$:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function F(e,t){for(var r,a=n.repeat(" ",t),i=0,s=-1,o="",l=e.length;i<l;)-1===(s=e.indexOf("\n",i))?(r=e.slice(i),i=l):(r=e.slice(i,s+1),i=s+1),r.length&&"\n"!==r&&(o+=a),o+=r;return o}function U(e,t){return"\n"+n.repeat(" ",e.indent*t)}function V(e){return e===p||e===c}function K(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==l||65536<=e&&e<=1114111}function z(e){return K(e)&&e!==l&&e!==d&&e!==u}function Z(e,t,r){var n=z(e),a=n&&!V(e);return(r?n:n&&e!==w&&e!==j&&e!==E&&e!==C&&e!==k)&&e!==f&&!(t===P&&!a)||z(t)&&!V(t)&&e===f||t===P&&a}function B(e,t){var r,n=e.charCodeAt(t);return n>=55296&&n<=56319&&t+1<e.length&&(r=e.charCodeAt(t+1))>=56320&&r<=57343?1024*(n-55296)+r-56320+65536:n}function q(e){return/^\n* /.test(e)}var H=1,J=2,W=3,G=4,Y=5;function X(e,t,r,n,i){e.dump=function(){if(0===t.length)return e.quotingType===$?'""':"''";if(!e.noCompatMode&&(-1!==N.indexOf(t)||L.test(t)))return e.quotingType===$?'"'+t+'"':"'"+t+"'";var s=e.indent*Math.max(1,r),o=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-s),c=n||e.flowLevel>-1&&r>=e.flowLevel;switch(function(e,t,r,n,a,i,s,o){var c,d,p=0,M=null,N=!1,L=!1,R=-1!==n,D=-1,F=K(d=B(e,0))&&d!==l&&!V(d)&&d!==_&&d!==A&&d!==P&&d!==w&&d!==j&&d!==E&&d!==C&&d!==k&&d!==f&&d!==b&&d!==v&&d!==h&&d!==I&&d!==O&&d!==T&&d!==y&&d!==m&&d!==g&&d!==x&&d!==S&&function(e){return!V(e)&&e!==P}(B(e,e.length-1));if(t||s)for(c=0;c<e.length;p>=65536?c+=2:c++){if(!K(p=B(e,c)))return Y;F=F&&Z(p,M,o),M=p}else{for(c=0;c<e.length;p>=65536?c+=2:c++){if((p=B(e,c))===u)N=!0,R&&(L=L||c-D-1>n&&" "!==e[D+1],D=c);else if(!K(p))return Y;F=F&&Z(p,M,o),M=p}L=L||R&&c-D-1>n&&" "!==e[D+1]}return N||L?r>9&&q(e)?Y:s?i===$?Y:J:L?G:W:!F||s||a(e)?i===$?Y:J:H}(t,c,e.indent,o,(function(t){return function(e,t){var r,n;for(r=0,n=e.implicitTypes.length;r<n;r+=1)if(e.implicitTypes[r].resolve(t))return!0;return!1}(e,t)}),e.quotingType,e.forceQuotes&&!n,i)){case H:return t;case J:return"'"+t.replace(/'/g,"''")+"'";case W:return"|"+Q(t,e.indent)+ee(F(t,s));case G:return">"+Q(t,e.indent)+ee(F(function(e,t){for(var r,n,a,i=/(\n+)([^\n]*)/g,s=(a=-1!==(a=e.indexOf("\n"))?a:e.length,i.lastIndex=a,te(e.slice(0,a),t)),o="\n"===e[0]||" "===e[0];n=i.exec(e);){var l=n[1],c=n[2];r=" "===c[0],s+=l+(o||r||""===c?"":"\n")+te(c,t),o=r}return s}(t,o),s));case Y:return'"'+function(e){for(var t,r="",n=0,a=0;a<e.length;n>=65536?a+=2:a++)n=B(e,a),!(t=M[n])&&K(n)?(r+=e[a],n>=65536&&(r+=e[a+1])):r+=t||R(n);return r}(t)+'"';default:throw new a("impossible error: invalid scalar style")}}()}function Q(e,t){var r=q(e)?String(t):"",n="\n"===e[e.length-1];return r+(!n||"\n"!==e[e.length-2]&&"\n"!==e?n?"":"-":"+")+"\n"}function ee(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function te(e,t){if(""===e||" "===e[0])return e;for(var r,n,a=/ [^ ]/g,i=0,s=0,o=0,l="";r=a.exec(e);)(o=r.index)-i>t&&(n=s>i?s:o,l+="\n"+e.slice(i,n),i=n+1),s=o;return l+="\n",e.length-i>t&&s>i?l+=e.slice(i,s)+"\n"+e.slice(s+1):l+=e.slice(i),l.slice(1)}function re(e,t,r,n){var a,i,s,o="",l=e.tag;for(a=0,i=r.length;a<i;a+=1)s=r[a],e.replacer&&(s=e.replacer.call(r,String(a),s)),(ae(e,t+1,s,!0,!0,!1,!0)||void 0===s&&ae(e,t+1,null,!0,!0,!1,!0))&&(n&&""===o||(o+=U(e,t)),e.dump&&u===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=l,e.dump=o||"[]"}function ne(e,t,r){var n,i,l,c,u,d;for(l=0,c=(i=r?e.explicitTypes:e.implicitTypes).length;l<c;l+=1)if(((u=i[l]).instanceOf||u.predicate)&&(!u.instanceOf||"object"==typeof t&&t instanceof u.instanceOf)&&(!u.predicate||u.predicate(t))){if(r?u.multi&&u.representName?e.tag=u.representName(t):e.tag=u.tag:e.tag="?",u.represent){if(d=e.styleMap[u.tag]||u.defaultStyle,"[object Function]"===s.call(u.represent))n=u.represent(t,d);else{if(!o.call(u.represent,d))throw new a("!<"+u.tag+'> tag resolver accepts not "'+d+'" style');n=u.represent[d](t,d)}e.dump=n}return!0}return!1}function ae(e,t,r,n,i,o,l){e.tag=null,e.dump=r,ne(e,r,!1)||ne(e,r,!0);var c,d=s.call(e.dump),p=n;n&&(n=e.flowLevel<0||e.flowLevel>t);var h,m,f="[object Object]"===d||"[object Array]"===d;if(f&&(m=-1!==(h=e.duplicates.indexOf(r))),(null!==e.tag&&"?"!==e.tag||m||2!==e.indent&&t>0)&&(i=!1),m&&e.usedDuplicates[h])e.dump="*ref_"+h;else{if(f&&m&&!e.usedDuplicates[h]&&(e.usedDuplicates[h]=!0),"[object Object]"===d)n&&0!==Object.keys(e.dump).length?(function(e,t,r,n){var i,s,o,l,c,d,p="",h=e.tag,m=Object.keys(r);if(!0===e.sortKeys)m.sort();else if("function"==typeof e.sortKeys)m.sort(e.sortKeys);else if(e.sortKeys)throw new a("sortKeys must be a boolean or a function");for(i=0,s=m.length;i<s;i+=1)d="",n&&""===p||(d+=U(e,t)),l=r[o=m[i]],e.replacer&&(l=e.replacer.call(r,o,l)),ae(e,t+1,o,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&u===e.dump.charCodeAt(0)?d+="?":d+="? "),d+=e.dump,c&&(d+=U(e,t)),ae(e,t+1,l,!0,c)&&(e.dump&&u===e.dump.charCodeAt(0)?d+=":":d+=": ",p+=d+=e.dump));e.tag=h,e.dump=p||"{}"}(e,t,e.dump,i),m&&(e.dump="&ref_"+h+e.dump)):(function(e,t,r){var n,a,i,s,o,l="",c=e.tag,u=Object.keys(r);for(n=0,a=u.length;n<a;n+=1)o="",""!==l&&(o+=", "),e.condenseFlow&&(o+='"'),s=r[i=u[n]],e.replacer&&(s=e.replacer.call(r,i,s)),ae(e,t,i,!1,!1)&&(e.dump.length>1024&&(o+="? "),o+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),ae(e,t,s,!1,!1)&&(l+=o+=e.dump));e.tag=c,e.dump="{"+l+"}"}(e,t,e.dump),m&&(e.dump="&ref_"+h+" "+e.dump));else if("[object Array]"===d)n&&0!==e.dump.length?(e.noArrayIndent&&!l&&t>0?re(e,t-1,e.dump,i):re(e,t,e.dump,i),m&&(e.dump="&ref_"+h+e.dump)):(function(e,t,r){var n,a,i,s="",o=e.tag;for(n=0,a=r.length;n<a;n+=1)i=r[n],e.replacer&&(i=e.replacer.call(r,String(n),i)),(ae(e,t,i,!1,!1)||void 0===i&&ae(e,t,null,!1,!1))&&(""!==s&&(s+=","+(e.condenseFlow?"":" ")),s+=e.dump);e.tag=o,e.dump="["+s+"]"}(e,t,e.dump),m&&(e.dump="&ref_"+h+" "+e.dump));else{if("[object String]"!==d){if("[object Undefined]"===d)return!1;if(e.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+d)}"?"!==e.tag&&X(e,e.dump,t,o,p)}null!==e.tag&&"?"!==e.tag&&(c=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),c="!"===e.tag[0]?"!"+c:"tag:yaml.org,2002:"===c.slice(0,18)?"!!"+c.slice(18):"!<"+c+">",e.dump=c+" "+e.dump)}return!0}function ie(e,t){var r,n,a=[],i=[];for(se(e,a,i),r=0,n=i.length;r<n;r+=1)t.duplicates.push(a[i[r]]);t.usedDuplicates=new Array(n)}function se(e,t,r){var n,a,i;if(null!==e&&"object"==typeof e)if(-1!==(a=t.indexOf(e)))-1===r.indexOf(a)&&r.push(a);else if(t.push(e),Array.isArray(e))for(a=0,i=e.length;a<i;a+=1)se(e[a],t,r);else for(a=0,i=(n=Object.keys(e)).length;a<i;a+=1)se(e[n[a]],t,r)}e.exports.dump=function(e,t){var r=new D(t=t||{});r.noRefs||ie(e,r);var n=e;return r.replacer&&(n=r.replacer.call({"":n},"",n)),ae(r,0,n,!0,!0)?r.dump+"\n":""}},8425:e=>{"use strict";function t(e,t){var r="",n=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(r+="\n\n"+e.mark.snippet),n+" "+r):n}function r(e,r){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=r,this.message=t(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.toString=function(e){return this.name+": "+t(this,e)},e.exports=r},7990:(e,t,r)=>{"use strict";var n=r(8347),a=r(8425),i=r(192),s=r(6601),o=Object.prototype.hasOwnProperty,l=1,c=2,u=3,d=4,p=1,h=2,m=3,f=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,g=/[\x85\u2028\u2029]/,b=/[,\[\]\{\}]/,y=/^(?:!|!!|![a-z\-]+!)$/i,v=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function w(e){return Object.prototype.toString.call(e)}function _(e){return 10===e||13===e}function P(e){return 9===e||32===e}function O(e){return 9===e||32===e||10===e||13===e}function T(e){return 44===e||91===e||93===e||123===e||125===e}function A(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function x(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?" ":76===e?"\u2028":80===e?"\u2029":""}function j(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var E=new Array(256),S=new Array(256),C=0;C<256;C++)E[C]=x(C)?1:0,S[C]=x(C);function I(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||s,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function k(e,t){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=i(r),new a(t,r)}function M(e,t){throw k(e,t)}function N(e,t){e.onWarning&&e.onWarning.call(null,k(e,t))}var L={YAML:function(e,t,r){var n,a,i;null!==e.version&&M(e,"duplication of %YAML directive"),1!==r.length&&M(e,"YAML directive accepts exactly one argument"),null===(n=/^([0-9]+)\.([0-9]+)$/.exec(r[0]))&&M(e,"ill-formed argument of the YAML directive"),a=parseInt(n[1],10),i=parseInt(n[2],10),1!==a&&M(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=i<2,1!==i&&2!==i&&N(e,"unsupported YAML version of the document")},TAG:function(e,t,r){var n,a;2!==r.length&&M(e,"TAG directive accepts exactly two arguments"),n=r[0],a=r[1],y.test(n)||M(e,"ill-formed tag handle (first argument) of the TAG directive"),o.call(e.tagMap,n)&&M(e,'there is a previously declared suffix for "'+n+'" tag handle'),v.test(a)||M(e,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(t){M(e,"tag prefix is malformed: "+a)}e.tagMap[n]=a}};function R(e,t,r,n){var a,i,s,o;if(t<r){if(o=e.input.slice(t,r),n)for(a=0,i=o.length;a<i;a+=1)9===(s=o.charCodeAt(a))||32<=s&&s<=1114111||M(e,"expected valid JSON character");else f.test(o)&&M(e,"the stream contains non-printable characters");e.result+=o}}function $(e,t,r,a){var i,s,l,c;for(n.isObject(r)||M(e,"cannot merge mappings; the provided source object is unacceptable"),l=0,c=(i=Object.keys(r)).length;l<c;l+=1)s=i[l],o.call(t,s)||(t[s]=r[s],a[s]=!0)}function D(e,t,r,n,a,i,s,l,c){var u,d;if(Array.isArray(a))for(u=0,d=(a=Array.prototype.slice.call(a)).length;u<d;u+=1)Array.isArray(a[u])&&M(e,"nested arrays are not supported inside keys"),"object"==typeof a&&"[object Object]"===w(a[u])&&(a[u]="[object Object]");if("object"==typeof a&&"[object Object]"===w(a)&&(a="[object Object]"),a=String(a),null===t&&(t={}),"tag:yaml.org,2002:merge"===n)if(Array.isArray(i))for(u=0,d=i.length;u<d;u+=1)$(e,t,i[u],r);else $(e,t,i,r);else e.json||o.call(r,a)||!o.call(t,a)||(e.line=s||e.line,e.lineStart=l||e.lineStart,e.position=c||e.position,M(e,"duplicated mapping key")),"__proto__"===a?Object.defineProperty(t,a,{configurable:!0,enumerable:!0,writable:!0,value:i}):t[a]=i,delete r[a];return t}function F(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):M(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function U(e,t,r){for(var n=0,a=e.input.charCodeAt(e.position);0!==a;){for(;P(a);)9===a&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),a=e.input.charCodeAt(++e.position);if(t&&35===a)do{a=e.input.charCodeAt(++e.position)}while(10!==a&&13!==a&&0!==a);if(!_(a))break;for(F(e),a=e.input.charCodeAt(e.position),n++,e.lineIndent=0;32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position)}return-1!==r&&0!==n&&e.lineIndent<r&&N(e,"deficient indentation"),n}function V(e){var t,r=e.position;return!(45!==(t=e.input.charCodeAt(r))&&46!==t||t!==e.input.charCodeAt(r+1)||t!==e.input.charCodeAt(r+2)||(r+=3,0!==(t=e.input.charCodeAt(r))&&!O(t)))}function K(e,t){1===t?e.result+=" ":t>1&&(e.result+=n.repeat("\n",t-1))}function z(e,t){var r,n,a=e.tag,i=e.anchor,s=[],o=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=s),n=e.input.charCodeAt(e.position);0!==n&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,M(e,"tab characters must not be used in indentation")),45===n)&&O(e.input.charCodeAt(e.position+1));)if(o=!0,e.position++,U(e,!0,-1)&&e.lineIndent<=t)s.push(null),n=e.input.charCodeAt(e.position);else if(r=e.line,q(e,t,u,!1,!0),s.push(e.result),U(e,!0,-1),n=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>t)&&0!==n)M(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!o&&(e.tag=a,e.anchor=i,e.kind="sequence",e.result=s,!0)}function Z(e){var t,r,n,a,i=!1,s=!1;if(33!==(a=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&M(e,"duplication of a tag property"),60===(a=e.input.charCodeAt(++e.position))?(i=!0,a=e.input.charCodeAt(++e.position)):33===a?(s=!0,r="!!",a=e.input.charCodeAt(++e.position)):r="!",t=e.position,i){do{a=e.input.charCodeAt(++e.position)}while(0!==a&&62!==a);e.position<e.length?(n=e.input.slice(t,e.position),a=e.input.charCodeAt(++e.position)):M(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==a&&!O(a);)33===a&&(s?M(e,"tag suffix cannot contain exclamation marks"):(r=e.input.slice(t-1,e.position+1),y.test(r)||M(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),a=e.input.charCodeAt(++e.position);n=e.input.slice(t,e.position),b.test(n)&&M(e,"tag suffix cannot contain flow indicator characters")}n&&!v.test(n)&&M(e,"tag name cannot contain such characters: "+n);try{n=decodeURIComponent(n)}catch(t){M(e,"tag name is malformed: "+n)}return i?e.tag=n:o.call(e.tagMap,r)?e.tag=e.tagMap[r]+n:"!"===r?e.tag="!"+n:"!!"===r?e.tag="tag:yaml.org,2002:"+n:M(e,'undeclared tag handle "'+r+'"'),!0}function B(e){var t,r;if(38!==(r=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&M(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!O(r)&&!T(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&M(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function q(e,t,r,a,i){var s,f,g,b,y,v,w,x,C,I=1,k=!1,N=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,s=f=g=d===r||u===r,a&&U(e,!0,-1)&&(k=!0,e.lineIndent>t?I=1:e.lineIndent===t?I=0:e.lineIndent<t&&(I=-1)),1===I)for(;Z(e)||B(e);)U(e,!0,-1)?(k=!0,g=s,e.lineIndent>t?I=1:e.lineIndent===t?I=0:e.lineIndent<t&&(I=-1)):g=!1;if(g&&(g=k||i),1!==I&&d!==r||(x=l===r||c===r?t:t+1,C=e.position-e.lineStart,1===I?g&&(z(e,C)||function(e,t,r){var n,a,i,s,o,l,u,p=e.tag,h=e.anchor,m={},f=Object.create(null),g=null,b=null,y=null,v=!1,w=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=m),u=e.input.charCodeAt(e.position);0!==u;){if(v||-1===e.firstTabInLine||(e.position=e.firstTabInLine,M(e,"tab characters must not be used in indentation")),n=e.input.charCodeAt(e.position+1),i=e.line,63!==u&&58!==u||!O(n)){if(s=e.line,o=e.lineStart,l=e.position,!q(e,r,c,!1,!0))break;if(e.line===i){for(u=e.input.charCodeAt(e.position);P(u);)u=e.input.charCodeAt(++e.position);if(58===u)O(u=e.input.charCodeAt(++e.position))||M(e,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(D(e,m,f,g,b,null,s,o,l),g=b=y=null),w=!0,v=!1,a=!1,g=e.tag,b=e.result;else{if(!w)return e.tag=p,e.anchor=h,!0;M(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!w)return e.tag=p,e.anchor=h,!0;M(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(v&&(D(e,m,f,g,b,null,s,o,l),g=b=y=null),w=!0,v=!0,a=!0):v?(v=!1,a=!0):M(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,u=n;if((e.line===i||e.lineIndent>t)&&(v&&(s=e.line,o=e.lineStart,l=e.position),q(e,t,d,!0,a)&&(v?b=e.result:y=e.result),v||(D(e,m,f,g,b,y,s,o,l),g=b=y=null),U(e,!0,-1),u=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>t)&&0!==u)M(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return v&&D(e,m,f,g,b,null,s,o,l),w&&(e.tag=p,e.anchor=h,e.kind="mapping",e.result=m),w}(e,C,x))||function(e,t){var r,n,a,i,s,o,c,u,d,p,h,m,f=!0,g=e.tag,b=e.anchor,y=Object.create(null);if(91===(m=e.input.charCodeAt(e.position)))s=93,u=!1,i=[];else{if(123!==m)return!1;s=125,u=!0,i={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),m=e.input.charCodeAt(++e.position);0!==m;){if(U(e,!0,t),(m=e.input.charCodeAt(e.position))===s)return e.position++,e.tag=g,e.anchor=b,e.kind=u?"mapping":"sequence",e.result=i,!0;f?44===m&&M(e,"expected the node content, but found ','"):M(e,"missed comma between flow collection entries"),h=null,o=c=!1,63===m&&O(e.input.charCodeAt(e.position+1))&&(o=c=!0,e.position++,U(e,!0,t)),r=e.line,n=e.lineStart,a=e.position,q(e,t,l,!1,!0),p=e.tag,d=e.result,U(e,!0,t),m=e.input.charCodeAt(e.position),!c&&e.line!==r||58!==m||(o=!0,m=e.input.charCodeAt(++e.position),U(e,!0,t),q(e,t,l,!1,!0),h=e.result),u?D(e,i,y,p,d,h,r,n,a):o?i.push(D(e,null,y,p,d,h,r,n,a)):i.push(d),U(e,!0,t),44===(m=e.input.charCodeAt(e.position))?(f=!0,m=e.input.charCodeAt(++e.position)):f=!1}M(e,"unexpected end of the stream within a flow collection")}(e,x)?N=!0:(f&&function(e,t){var r,a,i,s,o,l=p,c=!1,u=!1,d=t,f=0,g=!1;if(124===(s=e.input.charCodeAt(e.position)))a=!1;else{if(62!==s)return!1;a=!0}for(e.kind="scalar",e.result="";0!==s;)if(43===(s=e.input.charCodeAt(++e.position))||45===s)p===l?l=43===s?m:h:M(e,"repeat of a chomping mode identifier");else{if(!((i=48<=(o=s)&&o<=57?o-48:-1)>=0))break;0===i?M(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?M(e,"repeat of an indentation width identifier"):(d=t+i-1,u=!0)}if(P(s)){do{s=e.input.charCodeAt(++e.position)}while(P(s));if(35===s)do{s=e.input.charCodeAt(++e.position)}while(!_(s)&&0!==s)}for(;0!==s;){for(F(e),e.lineIndent=0,s=e.input.charCodeAt(e.position);(!u||e.lineIndent<d)&&32===s;)e.lineIndent++,s=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>d&&(d=e.lineIndent),_(s))f++;else{if(e.lineIndent<d){l===m?e.result+=n.repeat("\n",c?1+f:f):l===p&&c&&(e.result+="\n");break}for(a?P(s)?(g=!0,e.result+=n.repeat("\n",c?1+f:f)):g?(g=!1,e.result+=n.repeat("\n",f+1)):0===f?c&&(e.result+=" "):e.result+=n.repeat("\n",f):e.result+=n.repeat("\n",c?1+f:f),c=!0,u=!0,f=0,r=e.position;!_(s)&&0!==s;)s=e.input.charCodeAt(++e.position);R(e,r,e.position,!1)}}return!0}(e,x)||function(e,t){var r,n,a;if(39!==(r=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=a=e.position;0!==(r=e.input.charCodeAt(e.position));)if(39===r){if(R(e,n,e.position,!0),39!==(r=e.input.charCodeAt(++e.position)))return!0;n=e.position,e.position++,a=e.position}else _(r)?(R(e,n,a,!0),K(e,U(e,!1,t)),n=a=e.position):e.position===e.lineStart&&V(e)?M(e,"unexpected end of the document within a single quoted scalar"):(e.position++,a=e.position);M(e,"unexpected end of the stream within a single quoted scalar")}(e,x)||function(e,t){var r,n,a,i,s,o,l;if(34!==(o=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=n=e.position;0!==(o=e.input.charCodeAt(e.position));){if(34===o)return R(e,r,e.position,!0),e.position++,!0;if(92===o){if(R(e,r,e.position,!0),_(o=e.input.charCodeAt(++e.position)))U(e,!1,t);else if(o<256&&E[o])e.result+=S[o],e.position++;else if((s=120===(l=o)?2:117===l?4:85===l?8:0)>0){for(a=s,i=0;a>0;a--)(s=A(o=e.input.charCodeAt(++e.position)))>=0?i=(i<<4)+s:M(e,"expected hexadecimal character");e.result+=j(i),e.position++}else M(e,"unknown escape sequence");r=n=e.position}else _(o)?(R(e,r,n,!0),K(e,U(e,!1,t)),r=n=e.position):e.position===e.lineStart&&V(e)?M(e,"unexpected end of the document within a double quoted scalar"):(e.position++,n=e.position)}M(e,"unexpected end of the stream within a double quoted scalar")}(e,x)?N=!0:function(e){var t,r,n;if(42!==(n=e.input.charCodeAt(e.position)))return!1;for(n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!O(n)&&!T(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&M(e,"name of an alias node must contain at least one character"),r=e.input.slice(t,e.position),o.call(e.anchorMap,r)||M(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],U(e,!0,-1),!0}(e)?(N=!0,null===e.tag&&null===e.anchor||M(e,"alias node should not have any properties")):function(e,t,r){var n,a,i,s,o,l,c,u,d=e.kind,p=e.result;if(O(u=e.input.charCodeAt(e.position))||T(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(O(n=e.input.charCodeAt(e.position+1))||r&&T(n)))return!1;for(e.kind="scalar",e.result="",a=i=e.position,s=!1;0!==u;){if(58===u){if(O(n=e.input.charCodeAt(e.position+1))||r&&T(n))break}else if(35===u){if(O(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&V(e)||r&&T(u))break;if(_(u)){if(o=e.line,l=e.lineStart,c=e.lineIndent,U(e,!1,-1),e.lineIndent>=t){s=!0,u=e.input.charCodeAt(e.position);continue}e.position=i,e.line=o,e.lineStart=l,e.lineIndent=c;break}}s&&(R(e,a,i,!1),K(e,e.line-o),a=i=e.position,s=!1),P(u)||(i=e.position+1),u=e.input.charCodeAt(++e.position)}return R(e,a,i,!1),!!e.result||(e.kind=d,e.result=p,!1)}(e,x,l===r)&&(N=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===I&&(N=g&&z(e,C))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&M(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),b=0,y=e.implicitTypes.length;b<y;b+=1)if((w=e.implicitTypes[b]).resolve(e.result)){e.result=w.construct(e.result),e.tag=w.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(o.call(e.typeMap[e.kind||"fallback"],e.tag))w=e.typeMap[e.kind||"fallback"][e.tag];else for(w=null,b=0,y=(v=e.typeMap.multi[e.kind||"fallback"]).length;b<y;b+=1)if(e.tag.slice(0,v[b].tag.length)===v[b].tag){w=v[b];break}w||M(e,"unknown tag !<"+e.tag+">"),null!==e.result&&w.kind!==e.kind&&M(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+w.kind+'", not "'+e.kind+'"'),w.resolve(e.result,e.tag)?(e.result=w.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):M(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||N}function H(e){var t,r,n,a,i=e.position,s=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(a=e.input.charCodeAt(e.position))&&(U(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==a));){for(s=!0,a=e.input.charCodeAt(++e.position),t=e.position;0!==a&&!O(a);)a=e.input.charCodeAt(++e.position);for(n=[],(r=e.input.slice(t,e.position)).length<1&&M(e,"directive name must not be less than one character in length");0!==a;){for(;P(a);)a=e.input.charCodeAt(++e.position);if(35===a){do{a=e.input.charCodeAt(++e.position)}while(0!==a&&!_(a));break}if(_(a))break;for(t=e.position;0!==a&&!O(a);)a=e.input.charCodeAt(++e.position);n.push(e.input.slice(t,e.position))}0!==a&&F(e),o.call(L,r)?L[r](e,r,n):N(e,'unknown document directive "'+r+'"')}U(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,U(e,!0,-1)):s&&M(e,"directives end mark is expected"),q(e,e.lineIndent-1,d,!1,!0),U(e,!0,-1),e.checkLineBreaks&&g.test(e.input.slice(i,e.position))&&N(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&V(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,U(e,!0,-1)):e.position<e.length-1&&M(e,"end of the stream or a document separator is expected")}function J(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var r=new I(e,t),n=e.indexOf("\0");for(-1!==n&&(r.position=n,M(r,"null byte is not allowed in input")),r.input+="\0";32===r.input.charCodeAt(r.position);)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)H(r);return r.documents}e.exports.loadAll=function(e,t,r){null!==t&&"object"==typeof t&&void 0===r&&(r=t,t=null);var n=J(e,r);if("function"!=typeof t)return n;for(var a=0,i=n.length;a<i;a+=1)t(n[a])},e.exports.load=function(e,t){var r=J(e,t);if(0!==r.length){if(1===r.length)return r[0];throw new a("expected a single document in the stream, but found more")}}},7657:(e,t,r)=>{"use strict";var n=r(8425),a=r(1364);function i(e,t){var r=[];return e[t].forEach((function(e){var t=r.length;r.forEach((function(r,n){r.tag===e.tag&&r.kind===e.kind&&r.multi===e.multi&&(t=n)})),r[t]=e})),r}function s(e){return this.extend(e)}s.prototype.extend=function(e){var t=[],r=[];if(e instanceof a)r.push(e);else if(Array.isArray(e))r=r.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new n("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof a))throw new n("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new n("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new n("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),r.forEach((function(e){if(!(e instanceof a))throw new n("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var o=Object.create(s.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(r),o.compiledImplicit=i(o,"implicit"),o.compiledExplicit=i(o,"explicit"),o.compiledTypeMap=function(){var e,t,r={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function n(e){e.multi?(r.multi[e.kind].push(e),r.multi.fallback.push(e)):r[e.kind][e.tag]=r.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(n);return r}(o.compiledImplicit,o.compiledExplicit),o},e.exports=s},9471:(e,t,r)=>{"use strict";e.exports=r(5966)},6601:(e,t,r)=>{"use strict";e.exports=r(9471).extend({implicit:[r(2156),r(7452)],explicit:[r(3531),r(1605),r(6879),r(4982)]})},4795:(e,t,r)=>{"use strict";var n=r(7657);e.exports=new n({explicit:[r(48),r(6451),r(945)]})},5966:(e,t,r)=>{"use strict";e.exports=r(4795).extend({implicit:[r(151),r(8771),r(1518),r(5215)]})},192:(e,t,r)=>{"use strict";var n=r(8347);function a(e,t,r,n,a){var i="",s="",o=Math.floor(a/2)-1;return n-t>o&&(t=n-o+(i=" ... ").length),r-n>o&&(r=n+o-(s=" ...").length),{str:i+e.slice(t,r).replace(/\t/g,"→")+s,pos:n-t+i.length}}function i(e,t){return n.repeat(" ",t-e.length)+e}e.exports=function(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var r,s=/\r?\n|\r|\0/g,o=[0],l=[],c=-1;r=s.exec(e.buffer);)l.push(r.index),o.push(r.index+r[0].length),e.position<=r.index&&c<0&&(c=o.length-2);c<0&&(c=o.length-1);var u,d,p="",h=Math.min(e.line+t.linesAfter,l.length).toString().length,m=t.maxLength-(t.indent+h+3);for(u=1;u<=t.linesBefore&&!(c-u<0);u++)d=a(e.buffer,o[c-u],l[c-u],e.position-(o[c]-o[c-u]),m),p=n.repeat(" ",t.indent)+i((e.line-u+1).toString(),h)+" | "+d.str+"\n"+p;for(d=a(e.buffer,o[c],l[c],e.position,m),p+=n.repeat(" ",t.indent)+i((e.line+1).toString(),h)+" | "+d.str+"\n",p+=n.repeat("-",t.indent+h+3+d.pos)+"^\n",u=1;u<=t.linesAfter&&!(c+u>=l.length);u++)d=a(e.buffer,o[c+u],l[c+u],e.position-(o[c]-o[c+u]),m),p+=n.repeat(" ",t.indent)+i((e.line+u+1).toString(),h)+" | "+d.str+"\n";return p.replace(/\n$/,"")}},1364:(e,t,r)=>{"use strict";var n=r(8425),a=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],i=["scalar","sequence","mapping"];e.exports=function(e,t){var r,s;if(t=t||{},Object.keys(t).forEach((function(t){if(-1===a.indexOf(t))throw new n('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=(r=t.styleAliases||null,s={},null!==r&&Object.keys(r).forEach((function(e){r[e].forEach((function(t){s[String(t)]=e}))})),s),-1===i.indexOf(this.kind))throw new n('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}},3531:(e,t,r)=>{"use strict";var n=r(1364),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new n("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,r,n=0,i=e.length,s=a;for(r=0;r<i;r++)if(!((t=s.indexOf(e.charAt(r)))>64)){if(t<0)return!1;n+=6}return n%8==0},construct:function(e){var t,r,n=e.replace(/[\r\n=]/g,""),i=n.length,s=a,o=0,l=[];for(t=0;t<i;t++)t%4==0&&t&&(l.push(o>>16&255),l.push(o>>8&255),l.push(255&o)),o=o<<6|s.indexOf(n.charAt(t));return 0==(r=i%4*6)?(l.push(o>>16&255),l.push(o>>8&255),l.push(255&o)):18===r?(l.push(o>>10&255),l.push(o>>2&255)):12===r&&l.push(o>>4&255),new Uint8Array(l)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,r,n="",i=0,s=e.length,o=a;for(t=0;t<s;t++)t%3==0&&t&&(n+=o[i>>18&63],n+=o[i>>12&63],n+=o[i>>6&63],n+=o[63&i]),i=(i<<8)+e[t];return 0==(r=s%3)?(n+=o[i>>18&63],n+=o[i>>12&63],n+=o[i>>6&63],n+=o[63&i]):2===r?(n+=o[i>>10&63],n+=o[i>>4&63],n+=o[i<<2&63],n+=o[64]):1===r&&(n+=o[i>>2&63],n+=o[i<<4&63],n+=o[64],n+=o[64]),n}})},8771:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},5215:(e,t,r)=>{"use strict";var n=r(8347),a=r(1364),i=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),s=/^[-+]?[0-9]+e/;e.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!i.test(e)||"_"===e[e.length-1])},construct:function(e){var t,r;return r="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:r*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||n.isNegativeZero(e))},represent:function(e,t){var r;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(n.isNegativeZero(e))return"-0.0";return r=e.toString(10),s.test(r)?r.replace("e",".e"):r},defaultStyle:"lowercase"})},1518:(e,t,r)=>{"use strict";var n=r(8347),a=r(1364);function i(e){return 48<=e&&e<=55}function s(e){return 48<=e&&e<=57}e.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,r,n=e.length,a=0,o=!1;if(!n)return!1;if("-"!==(t=e[a])&&"+"!==t||(t=e[++a]),"0"===t){if(a+1===n)return!0;if("b"===(t=e[++a])){for(a++;a<n;a++)if("_"!==(t=e[a])){if("0"!==t&&"1"!==t)return!1;o=!0}return o&&"_"!==t}if("x"===t){for(a++;a<n;a++)if("_"!==(t=e[a])){if(!(48<=(r=e.charCodeAt(a))&&r<=57||65<=r&&r<=70||97<=r&&r<=102))return!1;o=!0}return o&&"_"!==t}if("o"===t){for(a++;a<n;a++)if("_"!==(t=e[a])){if(!i(e.charCodeAt(a)))return!1;o=!0}return o&&"_"!==t}}if("_"===t)return!1;for(;a<n;a++)if("_"!==(t=e[a])){if(!s(e.charCodeAt(a)))return!1;o=!0}return!(!o||"_"===t)},construct:function(e){var t,r=e,n=1;if(-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(t=r[0])&&"+"!==t||("-"===t&&(n=-1),t=(r=r.slice(1))[0]),"0"===r)return 0;if("0"===t){if("b"===r[1])return n*parseInt(r.slice(2),2);if("x"===r[1])return n*parseInt(r.slice(2),16);if("o"===r[1])return n*parseInt(r.slice(2),8)}return n*parseInt(r,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!n.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},945:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},7452:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}})},151:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"})},1605:(e,t,r)=>{"use strict";var n=r(1364),a=Object.prototype.hasOwnProperty,i=Object.prototype.toString;e.exports=new n("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,r,n,s,o,l=[],c=e;for(t=0,r=c.length;t<r;t+=1){if(n=c[t],o=!1,"[object Object]"!==i.call(n))return!1;for(s in n)if(a.call(n,s)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==l.indexOf(s))return!1;l.push(s)}return!0},construct:function(e){return null!==e?e:[]}})},6879:(e,t,r)=>{"use strict";var n=r(1364),a=Object.prototype.toString;e.exports=new n("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,r,n,i,s,o=e;for(s=new Array(o.length),t=0,r=o.length;t<r;t+=1){if(n=o[t],"[object Object]"!==a.call(n))return!1;if(1!==(i=Object.keys(n)).length)return!1;s[t]=[i[0],n[i[0]]]}return!0},construct:function(e){if(null===e)return[];var t,r,n,a,i,s=e;for(i=new Array(s.length),t=0,r=s.length;t<r;t+=1)n=s[t],a=Object.keys(n),i[t]=[a[0],n[a[0]]];return i}})},6451:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},4982:(e,t,r)=>{"use strict";var n=r(1364),a=Object.prototype.hasOwnProperty;e.exports=new n("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,r=e;for(t in r)if(a.call(r,t)&&null!==r[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})},48:(e,t,r)=>{"use strict";var n=r(1364);e.exports=new n("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},2156:(e,t,r)=>{"use strict";var n=r(1364),a=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),i=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");e.exports=new n("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==a.exec(e)||null!==i.exec(e))},construct:function(e){var t,r,n,s,o,l,c,u,d=0,p=null;if(null===(t=a.exec(e))&&(t=i.exec(e)),null===t)throw new Error("Date resolve error");if(r=+t[1],n=+t[2]-1,s=+t[3],!t[4])return new Date(Date.UTC(r,n,s));if(o=+t[4],l=+t[5],c=+t[6],t[7]){for(d=t[7].slice(0,3);d.length<3;)d+="0";d=+d}return t[9]&&(p=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(p=-p)),u=new Date(Date.UTC(r,n,s,o,l,c,d)),p&&u.setTime(u.getTime()-p),u},instanceOf:Date,represent:function(e){return e.toISOString()}})},9038:(e,t)=>{var r=/~/,n=/~[01]/g;function a(e){switch(e){case"~1":return"/";case"~0":return"~"}throw new Error("Invalid tilde escape: "+e)}function i(e){return r.test(e)?e.replace(n,a):e}function s(e){if("string"==typeof e){if(""===(e=e.split("/"))[0])return e;throw new Error("Invalid JSON pointer.")}if(Array.isArray(e)){for(const t of e)if("string"!=typeof t&&"number"!=typeof t)throw new Error("Invalid JSON pointer. Must be of type string or number.");return e}throw new Error("Invalid JSON pointer.")}function o(e,t){if("object"!=typeof e)throw new Error("Invalid input object.");var r=(t=s(t)).length;if(1===r)return e;for(var n=1;n<r;){if(e=e[i(t[n++])],r===n)return e;if("object"!=typeof e||null===e)return}}function l(e,t,r){if("object"!=typeof e)throw new Error("Invalid input object.");if(0===(t=s(t)).length)throw new Error("Invalid JSON pointer for set.");return function(e,t,r){for(var n,a,s=1,o=t.length;s<o;){if("constructor"===t[s]||"prototype"===t[s]||"__proto__"===t[s])return e;if(n=i(t[s++]),a=o>s,void 0===e[n]&&(Array.isArray(e)&&"-"===n&&(n=e.length),a&&(""!==t[s]&&t[s]<1/0||"-"===t[s]?e[n]=[]:e[n]={})),!a)break;e=e[n]}var l=e[n];return void 0===r?delete e[n]:e[n]=r,l}(e,t,r)}t.get=o,t.set=l,t.compile=function(e){var t=s(e);return{get:function(e){return o(e,t)},set:function(e,r){return l(e,t,r)}}}},4880:(e,t,r)=>{"use strict";e=r.nmd(e);const n=(e=0)=>t=>`[${38+e};5;${t}m`,a=(e=0)=>(t,r,n)=>`[${38+e};2;${t};${r};${n}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,n]of Object.entries(t)){for(const[r,a]of Object.entries(n))t[r]={open:`[${a[0]}m`,close:`[${a[1]}m`},n[r]=t[r],e.set(a[0],a[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=n(),t.color.ansi16m=a(),t.bgColor.ansi256=n(10),t.bgColor.ansi16m=a(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},4793:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIApi=t.OpenAIApiFactory=t.OpenAIApiFp=t.OpenAIApiAxiosParamCreator=t.CreateImageRequestResponseFormatEnum=t.CreateImageRequestSizeEnum=t.ChatCompletionResponseMessageRoleEnum=t.ChatCompletionRequestMessageRoleEnum=void 0;const a=r(9669),i=r(3597),s=r(5198);t.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},t.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},t.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},t.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},t.OpenAIApiAxiosParamCreator=function(e){return{cancelFineTune:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("cancelFineTune","fineTuneId",t);const n="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"POST"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),createAnswer:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createAnswer","createAnswerRequest",t);const n=new URL("/answers",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createChatCompletion:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createChatCompletion","createChatCompletionRequest",t);const n=new URL("/chat/completions",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createClassification:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createClassification","createClassificationRequest",t);const n=new URL("/classifications",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createCompletion:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createCompletion","createCompletionRequest",t);const n=new URL("/completions",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createEdit:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createEdit","createEditRequest",t);const n=new URL("/edits",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createEmbedding:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createEmbedding","createEmbeddingRequest",t);const n=new URL("/embeddings",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createFile:(t,r,a={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createFile","file",t),i.assertParamExists("createFile","purpose",r);const n=new URL("/files",i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"POST"},s),a),l={},c=new(e&&e.formDataCtor||FormData);void 0!==t&&c.append("file",t),void 0!==r&&c.append("purpose",r),l["Content-Type"]="multipart/form-data",i.setSearchParams(n,{});let u=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign(Object.assign({},l),c.getHeaders()),u),a.headers),o.data=c,{url:i.toPathString(n),options:o}})),createFineTune:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createFineTune","createFineTuneRequest",t);const n=new URL("/fine-tunes",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createImage:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createImage","createImageRequest",t);const n=new URL("/images/generations",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createImageEdit:(t,r,a,s,o,l,c,u={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createImageEdit","image",t),i.assertParamExists("createImageEdit","prompt",r);const n=new URL("/images/edits",i.DUMMY_BASE_URL);let d;e&&(d=e.baseOptions);const p=Object.assign(Object.assign({method:"POST"},d),u),h={},m=new(e&&e.formDataCtor||FormData);void 0!==t&&m.append("image",t),void 0!==a&&m.append("mask",a),void 0!==r&&m.append("prompt",r),void 0!==s&&m.append("n",s),void 0!==o&&m.append("size",o),void 0!==l&&m.append("response_format",l),void 0!==c&&m.append("user",c),h["Content-Type"]="multipart/form-data",i.setSearchParams(n,{});let f=d&&d.headers?d.headers:{};return p.headers=Object.assign(Object.assign(Object.assign(Object.assign({},h),m.getHeaders()),f),u.headers),p.data=m,{url:i.toPathString(n),options:p}})),createImageVariation:(t,r,a,s,o,l={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createImageVariation","image",t);const n=new URL("/images/variations",i.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),l),d={},p=new(e&&e.formDataCtor||FormData);void 0!==t&&p.append("image",t),void 0!==r&&p.append("n",r),void 0!==a&&p.append("size",a),void 0!==s&&p.append("response_format",s),void 0!==o&&p.append("user",o),d["Content-Type"]="multipart/form-data",i.setSearchParams(n,{});let h=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign(Object.assign({},d),p.getHeaders()),h),l.headers),u.data=p,{url:i.toPathString(n),options:u}})),createModeration:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createModeration","createModerationRequest",t);const n=new URL("/moderations",i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),r),o={"Content-Type":"application/json"};i.setSearchParams(n,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},o),l),r.headers),s.data=i.serializeDataIfNeeded(t,s,e),{url:i.toPathString(n),options:s}})),createSearch:(t,r,a={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createSearch","engineId",t),i.assertParamExists("createSearch","createSearchRequest",r);const n="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(t))),s=new URL(n,i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const l=Object.assign(Object.assign({method:"POST"},o),a),c={"Content-Type":"application/json"};i.setSearchParams(s,{});let u=o&&o.headers?o.headers:{};return l.headers=Object.assign(Object.assign(Object.assign({},c),u),a.headers),l.data=i.serializeDataIfNeeded(r,l,e),{url:i.toPathString(s),options:l}})),createTranscription:(t,r,a,s,o,l,c={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createTranscription","file",t),i.assertParamExists("createTranscription","model",r);const n=new URL("/audio/transcriptions",i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const d=Object.assign(Object.assign({method:"POST"},u),c),p={},h=new(e&&e.formDataCtor||FormData);void 0!==t&&h.append("file",t),void 0!==r&&h.append("model",r),void 0!==a&&h.append("prompt",a),void 0!==s&&h.append("response_format",s),void 0!==o&&h.append("temperature",o),void 0!==l&&h.append("language",l),p["Content-Type"]="multipart/form-data",i.setSearchParams(n,{});let m=u&&u.headers?u.headers:{};return d.headers=Object.assign(Object.assign(Object.assign(Object.assign({},p),h.getHeaders()),m),c.headers),d.data=h,{url:i.toPathString(n),options:d}})),createTranslation:(t,r,a,s,o,l={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("createTranslation","file",t),i.assertParamExists("createTranslation","model",r);const n=new URL("/audio/translations",i.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),l),d={},p=new(e&&e.formDataCtor||FormData);void 0!==t&&p.append("file",t),void 0!==r&&p.append("model",r),void 0!==a&&p.append("prompt",a),void 0!==s&&p.append("response_format",s),void 0!==o&&p.append("temperature",o),d["Content-Type"]="multipart/form-data",i.setSearchParams(n,{});let h=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign(Object.assign({},d),p.getHeaders()),h),l.headers),u.data=p,{url:i.toPathString(n),options:u}})),deleteFile:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("deleteFile","fileId",t);const n="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"DELETE"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),deleteModel:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("deleteModel","model",t);const n="/models/{model}".replace("{model}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"DELETE"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),downloadFile:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("downloadFile","fileId",t);const n="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),listEngines:(t={})=>n(this,void 0,void 0,(function*(){const r=new URL("/engines",i.DUMMY_BASE_URL);let n;e&&(n=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},n),t);i.setSearchParams(r,{});let s=n&&n.headers?n.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),t.headers),{url:i.toPathString(r),options:a}})),listFiles:(t={})=>n(this,void 0,void 0,(function*(){const r=new URL("/files",i.DUMMY_BASE_URL);let n;e&&(n=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},n),t);i.setSearchParams(r,{});let s=n&&n.headers?n.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),t.headers),{url:i.toPathString(r),options:a}})),listFineTuneEvents:(t,r,a={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("listFineTuneEvents","fineTuneId",t);const n="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(t))),s=new URL(n,i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const l=Object.assign(Object.assign({method:"GET"},o),a),c={};void 0!==r&&(c.stream=r),i.setSearchParams(s,c);let u=o&&o.headers?o.headers:{};return l.headers=Object.assign(Object.assign(Object.assign({},{}),u),a.headers),{url:i.toPathString(s),options:l}})),listFineTunes:(t={})=>n(this,void 0,void 0,(function*(){const r=new URL("/fine-tunes",i.DUMMY_BASE_URL);let n;e&&(n=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},n),t);i.setSearchParams(r,{});let s=n&&n.headers?n.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),t.headers),{url:i.toPathString(r),options:a}})),listModels:(t={})=>n(this,void 0,void 0,(function*(){const r=new URL("/models",i.DUMMY_BASE_URL);let n;e&&(n=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},n),t);i.setSearchParams(r,{});let s=n&&n.headers?n.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),t.headers),{url:i.toPathString(r),options:a}})),retrieveEngine:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("retrieveEngine","engineId",t);const n="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),retrieveFile:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("retrieveFile","fileId",t);const n="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),retrieveFineTune:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("retrieveFineTune","fineTuneId",t);const n="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}})),retrieveModel:(t,r={})=>n(this,void 0,void 0,(function*(){i.assertParamExists("retrieveModel","model",t);const n="/models/{model}".replace("{model}",encodeURIComponent(String(t))),a=new URL(n,i.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},s),r);i.setSearchParams(a,{});let l=s&&s.headers?s.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),l),r.headers),{url:i.toPathString(a),options:o}}))}},t.OpenAIApiFp=function(e){const r=t.OpenAIApiAxiosParamCreator(e);return{cancelFineTune(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.cancelFineTune(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createAnswer(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createAnswer(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createChatCompletion(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createChatCompletion(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createClassification(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createClassification(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createCompletion(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createCompletion(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createEdit(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createEdit(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createEmbedding(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createEmbedding(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createFile(t,o,l){return n(this,void 0,void 0,(function*(){const n=yield r.createFile(t,o,l);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createFineTune(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createFineTune(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createImage(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createImage(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createImageEdit(t,o,l,c,u,d,p,h){return n(this,void 0,void 0,(function*(){const n=yield r.createImageEdit(t,o,l,c,u,d,p,h);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createImageVariation(t,o,l,c,u,d){return n(this,void 0,void 0,(function*(){const n=yield r.createImageVariation(t,o,l,c,u,d);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createModeration(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.createModeration(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createSearch(t,o,l){return n(this,void 0,void 0,(function*(){const n=yield r.createSearch(t,o,l);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createTranscription(t,o,l,c,u,d,p){return n(this,void 0,void 0,(function*(){const n=yield r.createTranscription(t,o,l,c,u,d,p);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},createTranslation(t,o,l,c,u,d){return n(this,void 0,void 0,(function*(){const n=yield r.createTranslation(t,o,l,c,u,d);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},deleteFile(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.deleteFile(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},deleteModel(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.deleteModel(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},downloadFile(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.downloadFile(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},listEngines(t){return n(this,void 0,void 0,(function*(){const n=yield r.listEngines(t);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},listFiles(t){return n(this,void 0,void 0,(function*(){const n=yield r.listFiles(t);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},listFineTuneEvents(t,o,l){return n(this,void 0,void 0,(function*(){const n=yield r.listFineTuneEvents(t,o,l);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},listFineTunes(t){return n(this,void 0,void 0,(function*(){const n=yield r.listFineTunes(t);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},listModels(t){return n(this,void 0,void 0,(function*(){const n=yield r.listModels(t);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},retrieveEngine(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.retrieveEngine(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},retrieveFile(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.retrieveFile(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},retrieveFineTune(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.retrieveFineTune(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))},retrieveModel(t,o){return n(this,void 0,void 0,(function*(){const n=yield r.retrieveModel(t,o);return i.createRequestFunction(n,a.default,s.BASE_PATH,e)}))}}},t.OpenAIApiFactory=function(e,r,n){const a=t.OpenAIApiFp(e);return{cancelFineTune:(e,t)=>a.cancelFineTune(e,t).then((e=>e(n,r))),createAnswer:(e,t)=>a.createAnswer(e,t).then((e=>e(n,r))),createChatCompletion:(e,t)=>a.createChatCompletion(e,t).then((e=>e(n,r))),createClassification:(e,t)=>a.createClassification(e,t).then((e=>e(n,r))),createCompletion:(e,t)=>a.createCompletion(e,t).then((e=>e(n,r))),createEdit:(e,t)=>a.createEdit(e,t).then((e=>e(n,r))),createEmbedding:(e,t)=>a.createEmbedding(e,t).then((e=>e(n,r))),createFile:(e,t,i)=>a.createFile(e,t,i).then((e=>e(n,r))),createFineTune:(e,t)=>a.createFineTune(e,t).then((e=>e(n,r))),createImage:(e,t)=>a.createImage(e,t).then((e=>e(n,r))),createImageEdit:(e,t,i,s,o,l,c,u)=>a.createImageEdit(e,t,i,s,o,l,c,u).then((e=>e(n,r))),createImageVariation:(e,t,i,s,o,l)=>a.createImageVariation(e,t,i,s,o,l).then((e=>e(n,r))),createModeration:(e,t)=>a.createModeration(e,t).then((e=>e(n,r))),createSearch:(e,t,i)=>a.createSearch(e,t,i).then((e=>e(n,r))),createTranscription:(e,t,i,s,o,l,c)=>a.createTranscription(e,t,i,s,o,l,c).then((e=>e(n,r))),createTranslation:(e,t,i,s,o,l)=>a.createTranslation(e,t,i,s,o,l).then((e=>e(n,r))),deleteFile:(e,t)=>a.deleteFile(e,t).then((e=>e(n,r))),deleteModel:(e,t)=>a.deleteModel(e,t).then((e=>e(n,r))),downloadFile:(e,t)=>a.downloadFile(e,t).then((e=>e(n,r))),listEngines:e=>a.listEngines(e).then((e=>e(n,r))),listFiles:e=>a.listFiles(e).then((e=>e(n,r))),listFineTuneEvents:(e,t,i)=>a.listFineTuneEvents(e,t,i).then((e=>e(n,r))),listFineTunes:e=>a.listFineTunes(e).then((e=>e(n,r))),listModels:e=>a.listModels(e).then((e=>e(n,r))),retrieveEngine:(e,t)=>a.retrieveEngine(e,t).then((e=>e(n,r))),retrieveFile:(e,t)=>a.retrieveFile(e,t).then((e=>e(n,r))),retrieveFineTune:(e,t)=>a.retrieveFineTune(e,t).then((e=>e(n,r))),retrieveModel:(e,t)=>a.retrieveModel(e,t).then((e=>e(n,r)))}};class o extends s.BaseAPI{cancelFineTune(e,r){return t.OpenAIApiFp(this.configuration).cancelFineTune(e,r).then((e=>e(this.axios,this.basePath)))}createAnswer(e,r){return t.OpenAIApiFp(this.configuration).createAnswer(e,r).then((e=>e(this.axios,this.basePath)))}createChatCompletion(e,r){return t.OpenAIApiFp(this.configuration).createChatCompletion(e,r).then((e=>e(this.axios,this.basePath)))}createClassification(e,r){return t.OpenAIApiFp(this.configuration).createClassification(e,r).then((e=>e(this.axios,this.basePath)))}createCompletion(e,r){return t.OpenAIApiFp(this.configuration).createCompletion(e,r).then((e=>e(this.axios,this.basePath)))}createEdit(e,r){return t.OpenAIApiFp(this.configuration).createEdit(e,r).then((e=>e(this.axios,this.basePath)))}createEmbedding(e,r){return t.OpenAIApiFp(this.configuration).createEmbedding(e,r).then((e=>e(this.axios,this.basePath)))}createFile(e,r,n){return t.OpenAIApiFp(this.configuration).createFile(e,r,n).then((e=>e(this.axios,this.basePath)))}createFineTune(e,r){return t.OpenAIApiFp(this.configuration).createFineTune(e,r).then((e=>e(this.axios,this.basePath)))}createImage(e,r){return t.OpenAIApiFp(this.configuration).createImage(e,r).then((e=>e(this.axios,this.basePath)))}createImageEdit(e,r,n,a,i,s,o,l){return t.OpenAIApiFp(this.configuration).createImageEdit(e,r,n,a,i,s,o,l).then((e=>e(this.axios,this.basePath)))}createImageVariation(e,r,n,a,i,s){return t.OpenAIApiFp(this.configuration).createImageVariation(e,r,n,a,i,s).then((e=>e(this.axios,this.basePath)))}createModeration(e,r){return t.OpenAIApiFp(this.configuration).createModeration(e,r).then((e=>e(this.axios,this.basePath)))}createSearch(e,r,n){return t.OpenAIApiFp(this.configuration).createSearch(e,r,n).then((e=>e(this.axios,this.basePath)))}createTranscription(e,r,n,a,i,s,o){return t.OpenAIApiFp(this.configuration).createTranscription(e,r,n,a,i,s,o).then((e=>e(this.axios,this.basePath)))}createTranslation(e,r,n,a,i,s){return t.OpenAIApiFp(this.configuration).createTranslation(e,r,n,a,i,s).then((e=>e(this.axios,this.basePath)))}deleteFile(e,r){return t.OpenAIApiFp(this.configuration).deleteFile(e,r).then((e=>e(this.axios,this.basePath)))}deleteModel(e,r){return t.OpenAIApiFp(this.configuration).deleteModel(e,r).then((e=>e(this.axios,this.basePath)))}downloadFile(e,r){return t.OpenAIApiFp(this.configuration).downloadFile(e,r).then((e=>e(this.axios,this.basePath)))}listEngines(e){return t.OpenAIApiFp(this.configuration).listEngines(e).then((e=>e(this.axios,this.basePath)))}listFiles(e){return t.OpenAIApiFp(this.configuration).listFiles(e).then((e=>e(this.axios,this.basePath)))}listFineTuneEvents(e,r,n){return t.OpenAIApiFp(this.configuration).listFineTuneEvents(e,r,n).then((e=>e(this.axios,this.basePath)))}listFineTunes(e){return t.OpenAIApiFp(this.configuration).listFineTunes(e).then((e=>e(this.axios,this.basePath)))}listModels(e){return t.OpenAIApiFp(this.configuration).listModels(e).then((e=>e(this.axios,this.basePath)))}retrieveEngine(e,r){return t.OpenAIApiFp(this.configuration).retrieveEngine(e,r).then((e=>e(this.axios,this.basePath)))}retrieveFile(e,r){return t.OpenAIApiFp(this.configuration).retrieveFile(e,r).then((e=>e(this.axios,this.basePath)))}retrieveFineTune(e,r){return t.OpenAIApiFp(this.configuration).retrieveFineTune(e,r).then((e=>e(this.axios,this.basePath)))}retrieveModel(e,r){return t.OpenAIApiFp(this.configuration).retrieveModel(e,r).then((e=>e(this.axios,this.basePath)))}}t.OpenAIApi=o},5198:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequiredError=t.BaseAPI=t.COLLECTION_FORMATS=t.BASE_PATH=void 0;const n=r(9669);t.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),t.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"},t.BaseAPI=class{constructor(e,r=t.BASE_PATH,a=n.default){this.basePath=r,this.axios=a,e&&(this.configuration=e,this.basePath=e.basePath||this.basePath)}};class a extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}t.RequiredError=a},3597:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestFunction=t.toPathString=t.serializeDataIfNeeded=t.setSearchParams=t.setOAuthToObject=t.setBearerAuthToObject=t.setBasicAuthToObject=t.setApiKeyToObject=t.assertParamExists=t.DUMMY_BASE_URL=void 0;const a=r(5198);function i(e,t,r=""){null!=t&&("object"==typeof t?Array.isArray(t)?t.forEach((t=>i(e,t,r))):Object.keys(t).forEach((n=>i(e,t[n],`${r}${""!==r?".":""}${n}`))):e.has(r)?e.append(r,t):e.set(r,t))}t.DUMMY_BASE_URL="https://example.com",t.assertParamExists=function(e,t,r){if(null==r)throw new a.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},t.setApiKeyToObject=function(e,t,r){return n(this,void 0,void 0,(function*(){if(r&&r.apiKey){const n="function"==typeof r.apiKey?yield r.apiKey(t):yield r.apiKey;e[t]=n}}))},t.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},t.setBearerAuthToObject=function(e,t){return n(this,void 0,void 0,(function*(){if(t&&t.accessToken){const r="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+r}}))},t.setOAuthToObject=function(e,t,r,a){return n(this,void 0,void 0,(function*(){if(a&&a.accessToken){const n="function"==typeof a.accessToken?yield a.accessToken(t,r):yield a.accessToken;e.Authorization="Bearer "+n}}))},t.setSearchParams=function(e,...t){const r=new URLSearchParams(e.search);i(r,t),e.search=r.toString()},t.serializeDataIfNeeded=function(e,t,r){const n="string"!=typeof e;return(n&&r&&r.isJsonMime?r.isJsonMime(t.headers["Content-Type"]):n)?JSON.stringify(void 0!==e?e:{}):e||""},t.toPathString=function(e){return e.pathname+e.search+e.hash},t.createRequestFunction=function(e,t,r,n){return(a=t,i=r)=>{const s=Object.assign(Object.assign({},e.options),{url:((null==n?void 0:n.basePath)||i)+e.url});return a.request(s)}}},6577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;const n=r(2811);t.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${n.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=r(4549))}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}}},6485:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(4793),t),a(r(6577),t)},4549:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},7345:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},5860:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6729),a=r(8147),i=r(6506),s=()=>{},o=new a.TimeoutError;t.default=class extends n{constructor(e){var t,r,n,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,n)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(o)}));r(await i)}catch(e){n(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},7489:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,a=e.length;for(;a>0;){const i=a/2|0;let s=n+i;r(e[s],t)<=0?(n=++s,a-=i+1):a=i}return n}},6506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7489);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const a=n.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(a,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},2693:(e,t,r)=>{"use strict";const n=r(9353),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=n.operation(t);o.attempt((async n=>{try{r(await e(n))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof i)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(l=e.message,!a.includes(l)))o.stop(),s(e);else{((e,t,r)=>{const n=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n})(e,n,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var l}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=i},8147:(e,t,r)=>{"use strict";const n=r(7345);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,r)=>new Promise(((i,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const o=setTimeout((()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}const n=r instanceof Error?r:new a("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(n)}),t);n(e.then(i,s),(()=>{clearTimeout(o)}))}));e.exports=i,e.exports.default=i,e.exports.TimeoutError=a},9353:(e,t,r)=>{e.exports=r(1846)},1846:(e,t,r)=>{var n=r(1960);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],a=0;a<t.retries;a++)n.push(this.createTimeout(a,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(a,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var a in n=[],e)"function"==typeof e[a]&&n.push(a);for(var i=0;i<n.length;i++){var s=n[i],o=e[s];e[s]=function(n){var a=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),s.apply(this,arguments))})),a.attempt((function(){n.apply(e,i)}))}.bind(e,o),e[s].options=r}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var a=this._errors[n],i=a.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=a,r=s)}return t}},2749:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createAgentExecutor=void 0;const a=n(r(7737)),i=r(7742),s=r(6274),o=r(5834),l=r(2518),c=r(5787),u=r(8706),d=r(6815),p=r(974),h=r(8754);t.createAgentExecutor=async e=>{var t,r,n,m,f,g,b,y,v,w;const _={GetArticles:(new i.ArticlesService).get,GetLawData:(new s.LawDataService).get,GetLawLists:(new o.LawListsService).get,GetUpdateLawLists:(new l.UpdateLawListsService).get},P=null!==(r=null===(t=(await(0,c.createOpenAPIChain)(a.default,{llm:null})).chains[0].llmKwargs)||void 0===t?void 0:t.functions)&&void 0!==r?r:[],O=[],T=[];for(const e of P){const{params:t,path_params:r}=null===(n=e.parameters)||void 0===n?void 0:n.properties,a={type:"object",properties:Object.assign(Object.assign({},null==t?void 0:t.properties),null==r?void 0:r.properties),required:[...null!==(m=null==t?void 0:t.required)&&void 0!==m?m:[],...null!==(f=null==r?void 0:r.required)&&void 0!==f?f:[]]};O.push({name:e.name,description:e.description,parameters:a});const i=_[e.name];T.push(new d.DynamicStructuredTool({name:e.name,description:null!==(g=e.description)&&void 0!==g?g:"",func:async e=>{const t=await i(e);return JSON.stringify(t)},schema:h.z.object(Object.fromEntries(Object.keys(a.properties).map((e=>[e,h.z.any()]))))}))}const A=new u.ChatOpenAI(Object.assign(Object.assign({},e.llmOptions),{modelKwargs:Object.assign(Object.assign({},null===(b=e.llmOptions)||void 0===b?void 0:b.modelKwargs),{functions:[...null!==(w=null===(v=null===(y=e.llmOptions)||void 0===y?void 0:y.modelKwargs)||void 0===v?void 0:v.functions)&&void 0!==w?w:[],...O]})}));return console.log({functions:O}),(0,p.initializeAgentExecutorWithOptions)(T,A,{agentType:"openai-functions",verbose:!0,agentArgs:{prefix:"You are a helpful and careful AI assistant designed to answer questions about Japanese laws using the given functions. Keep in mind that the exact text content such as words and characters matter for laws. Do not make up an answer."}})}},7429:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return l.default}});var n=p(r(3990)),a=p(r(8237)),i=p(r(5355)),s=p(r(3764)),o=p(r(6314)),l=p(r(8464)),c=p(r(6435)),u=p(r(4008)),d=p(r(8222));function p(e){return e&&e.__esModule?e:{default:e}}},4163:(e,t)=>{"use strict";function r(e){return 14+(e+64>>>9<<4)+1}function n(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e,t,r,a,i,s){return n((o=n(n(t,e),n(a,s)))<<(l=i)|o>>>32-l,r);var o,l}function i(e,t,r,n,i,s,o){return a(t&r|~t&n,e,t,i,s,o)}function s(e,t,r,n,i,s,o){return a(t&n|r&~n,e,t,i,s,o)}function o(e,t,r,n,i,s,o){return a(t^r^n,e,t,i,s,o)}function l(e,t,r,n,i,s,o){return a(r^(t|~n),e,t,i,s,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){const t=[],r=32*e.length,n="0123456789abcdef";for(let a=0;a<r;a+=8){const r=e[a>>5]>>>a%32&255,i=parseInt(n.charAt(r>>>4&15)+n.charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;let a=1732584193,c=-271733879,u=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const r=a,p=c,h=u,m=d;a=i(a,c,u,d,e[t],7,-680876936),d=i(d,a,c,u,e[t+1],12,-389564586),u=i(u,d,a,c,e[t+2],17,606105819),c=i(c,u,d,a,e[t+3],22,-1044525330),a=i(a,c,u,d,e[t+4],7,-176418897),d=i(d,a,c,u,e[t+5],12,1200080426),u=i(u,d,a,c,e[t+6],17,-1473231341),c=i(c,u,d,a,e[t+7],22,-45705983),a=i(a,c,u,d,e[t+8],7,1770035416),d=i(d,a,c,u,e[t+9],12,-1958414417),u=i(u,d,a,c,e[t+10],17,-42063),c=i(c,u,d,a,e[t+11],22,-1990404162),a=i(a,c,u,d,e[t+12],7,1804603682),d=i(d,a,c,u,e[t+13],12,-40341101),u=i(u,d,a,c,e[t+14],17,-1502002290),c=i(c,u,d,a,e[t+15],22,1236535329),a=s(a,c,u,d,e[t+1],5,-165796510),d=s(d,a,c,u,e[t+6],9,-1069501632),u=s(u,d,a,c,e[t+11],14,643717713),c=s(c,u,d,a,e[t],20,-373897302),a=s(a,c,u,d,e[t+5],5,-701558691),d=s(d,a,c,u,e[t+10],9,38016083),u=s(u,d,a,c,e[t+15],14,-660478335),c=s(c,u,d,a,e[t+4],20,-405537848),a=s(a,c,u,d,e[t+9],5,568446438),d=s(d,a,c,u,e[t+14],9,-1019803690),u=s(u,d,a,c,e[t+3],14,-187363961),c=s(c,u,d,a,e[t+8],20,1163531501),a=s(a,c,u,d,e[t+13],5,-1444681467),d=s(d,a,c,u,e[t+2],9,-51403784),u=s(u,d,a,c,e[t+7],14,1735328473),c=s(c,u,d,a,e[t+12],20,-1926607734),a=o(a,c,u,d,e[t+5],4,-378558),d=o(d,a,c,u,e[t+8],11,-2022574463),u=o(u,d,a,c,e[t+11],16,1839030562),c=o(c,u,d,a,e[t+14],23,-35309556),a=o(a,c,u,d,e[t+1],4,-1530992060),d=o(d,a,c,u,e[t+4],11,1272893353),u=o(u,d,a,c,e[t+7],16,-155497632),c=o(c,u,d,a,e[t+10],23,-1094730640),a=o(a,c,u,d,e[t+13],4,681279174),d=o(d,a,c,u,e[t],11,-358537222),u=o(u,d,a,c,e[t+3],16,-722521979),c=o(c,u,d,a,e[t+6],23,76029189),a=o(a,c,u,d,e[t+9],4,-640364487),d=o(d,a,c,u,e[t+12],11,-421815835),u=o(u,d,a,c,e[t+15],16,530742520),c=o(c,u,d,a,e[t+2],23,-995338651),a=l(a,c,u,d,e[t],6,-198630844),d=l(d,a,c,u,e[t+7],10,1126891415),u=l(u,d,a,c,e[t+14],15,-1416354905),c=l(c,u,d,a,e[t+5],21,-57434055),a=l(a,c,u,d,e[t+12],6,1700485571),d=l(d,a,c,u,e[t+3],10,-1894986606),u=l(u,d,a,c,e[t+10],15,-1051523),c=l(c,u,d,a,e[t+1],21,-2054922799),a=l(a,c,u,d,e[t+8],6,1873313359),d=l(d,a,c,u,e[t+15],10,-30611744),u=l(u,d,a,c,e[t+6],15,-1560198380),c=l(c,u,d,a,e[t+13],21,1309151649),a=l(a,c,u,d,e[t+4],6,-145523070),d=l(d,a,c,u,e[t+11],10,-1120210379),u=l(u,d,a,c,e[t+2],15,718787259),c=l(c,u,d,a,e[t+9],21,-343485551),a=n(a,r),c=n(c,p),u=n(u,h),d=n(d,m)}return[a,c,u,d]}(function(e){if(0===e.length)return[];const t=8*e.length,n=new Uint32Array(r(t));for(let r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}},4790:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=r},6314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},8222:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=r(6435))&&n.__esModule?n:{default:n};t.default=function(e){if(!(0,a.default)(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},3319:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)};const n=new Uint8Array(16)},3757:(e,t)=>{"use strict";function r(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function n(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,s=Math.ceil(i/16),o=new Array(s);for(let t=0;t<s;++t){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=e[64*t+4*n]<<24|e[64*t+4*n+1]<<16|e[64*t+4*n+2]<<8|e[64*t+4*n+3];o[t]=r}o[s-1][14]=8*(e.length-1)/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=o[e][t];for(let e=16;e<80;++e)i[e]=n(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=a[0],l=a[1],c=a[2],u=a[3],d=a[4];for(let e=0;e<80;++e){const a=Math.floor(e/20),o=n(s,5)+r(a,l,c,u)+d+t[a]+i[e]>>>0;d=u,u=c,c=n(l,30)>>>0,l=s,s=o}a[0]=a[0]+s>>>0,a[1]=a[1]+l>>>0,a[2]=a[2]+c>>>0,a[3]=a[3]+u>>>0,a[4]=a[4]+d>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]}},4008:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var n,a=(n=r(6435))&&n.__esModule?n:{default:n};const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function s(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}t.default=function(e,t=0){const r=s(e,t);if(!(0,a.default)(r))throw TypeError("Stringified UUID is invalid");return r}},3990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=r(3319))&&n.__esModule?n:{default:n},i=r(4008);let s,o,l=0,c=0;t.default=function(e,t,r){let n=t&&r||0;const u=t||new Array(16);let d=(e=e||{}).node||s,p=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==p){const t=e.random||(e.rng||a.default)();null==d&&(d=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==p&&(p=o=16383&(t[6]<<8|t[7]))}let h=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:c+1;const f=h-l+(m-c)/1e4;if(f<0&&void 0===e.clockseq&&(p=p+1&16383),(f<0||h>l)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=h,c=m,o=p,h+=122192928e5;const g=(1e4*(268435455&h)+m)%4294967296;u[n++]=g>>>24&255,u[n++]=g>>>16&255,u[n++]=g>>>8&255,u[n++]=255&g;const b=h/4294967296*1e4&268435455;u[n++]=b>>>8&255,u[n++]=255&b,u[n++]=b>>>24&15|16,u[n++]=b>>>16&255,u[n++]=p>>>8|128,u[n++]=255&p;for(let e=0;e<6;++e)u[n+e]=d[e];return t||(0,i.unsafeStringify)(u)}},8237:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(7925)),a=i(r(4163));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,n.default)("v3",48,a.default);t.default=s},7925:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,r){function n(e,n,s,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=(0,i.default)(n)),16!==(null===(l=n)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(n),c.set(e,n.length),c=r(c),c[6]=15&c[6]|t,c[8]=63&c[8]|128,s){o=o||0;for(let e=0;e<16;++e)s[o+e]=c[e];return s}return(0,a.unsafeStringify)(c)}try{n.name=e}catch(e){}return n.DNS=s,n.URL=o,n};var n,a=r(4008),i=(n=r(8222))&&n.__esModule?n:{default:n};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},5355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(4790)),a=s(r(3319)),i=r(4008);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){if(n.default.randomUUID&&!t&&!e)return n.default.randomUUID();const s=(e=e||{}).random||(e.rng||a.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return(0,i.unsafeStringify)(s)}},3764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(7925)),a=i(r(3757));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,n.default)("v5",80,a.default);t.default=s},6435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=r(58))&&n.__esModule?n:{default:n};t.default=function(e){return"string"==typeof e&&a.default.test(e)}},8464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=r(6435))&&n.__esModule?n:{default:n};t.default=function(e){if(!(0,a.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},8841:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const n=r(4357);Object.defineProperty(t,"zodToJsonSchema",{enumerable:!0,get:function(){return n.zodToJsonSchema}}),t.default=n.zodToJsonSchema},7181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=void 0,t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"},t.getDefaultOptions=e=>"string"==typeof e?Object.assign(Object.assign({},t.defaultOptions),{name:e}):Object.assign(Object.assign({},t.defaultOptions),e)},1908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRefs=void 0;const n=r(7181);t.getRefs=e=>{const t=(0,n.getDefaultOptions)(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return Object.assign(Object.assign({},t),{currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))})}},6519:(e,t)=>{"use strict";function r(e,t,r,n){(null==n?void 0:n.errorMessages)&&r&&(e.errorMessage=Object.assign(Object.assign({},e.errorMessage),{[t]:r}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setResponseValueAndErrors=t.addErrorMessage=void 0,t.addErrorMessage=r,t.setResponseValueAndErrors=function(e,t,n,a,i){e[t]=n,r(e,t,a,i)}},9959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDef=void 0;const n=r(8754),a=r(6840),i=r(2886),s=r(2722),o=r(5823),l=r(423),c=r(9444),u=r(4117),d=r(3245),p=r(4804),h=r(2105),m=r(2734),f=r(8392),g=r(8716),b=r(2295),y=r(2200),v=r(5907),w=r(993),_=r(8490),P=r(938),O=r(8289),T=r(1250),A=r(9033),x=r(3564),j=r(9226),E=r(9229),S=r(3133),C=r(9646),I=r(8e3),k=r(34);function M(e,t,r=!1){const n=t.seen.get(e);if(n&&!r){const e=N(n,t);if(void 0!==e)return e}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const i=R(e,e.typeName,t);return i&&$(e,t,i),a.jsonSchema=i,i}t.parseDef=M;const N=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:0===e.path.length?"":1===e.path.length?`${e.path[0]}/`:e.path.join("/")};case"relative":return{$ref:L(t.currentPath,e.path)};case"none":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):e.jsonSchema}},L=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},R=(e,t,r)=>{switch(t){case n.ZodFirstPartyTypeKind.ZodString:return(0,E.parseStringDef)(e,r);case n.ZodFirstPartyTypeKind.ZodNumber:return(0,_.parseNumberDef)(e,r);case n.ZodFirstPartyTypeKind.ZodObject:return(0,P.parseObjectDef)(e,r);case n.ZodFirstPartyTypeKind.ZodBigInt:return(0,s.parseBigintDef)(e,r);case n.ZodFirstPartyTypeKind.ZodBoolean:return(0,o.parseBooleanDef)();case n.ZodFirstPartyTypeKind.ZodDate:return(0,u.parseDateDef)(e,r);case n.ZodFirstPartyTypeKind.ZodUndefined:return(0,C.parseUndefinedDef)();case n.ZodFirstPartyTypeKind.ZodNull:return(0,v.parseNullDef)(r);case n.ZodFirstPartyTypeKind.ZodArray:return(0,i.parseArrayDef)(e,r);case n.ZodFirstPartyTypeKind.ZodUnion:case n.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,I.parseUnionDef)(e,r);case n.ZodFirstPartyTypeKind.ZodIntersection:return(0,m.parseIntersectionDef)(e,r);case n.ZodFirstPartyTypeKind.ZodTuple:return(0,S.parseTupleDef)(e,r);case n.ZodFirstPartyTypeKind.ZodRecord:return(0,x.parseRecordDef)(e,r);case n.ZodFirstPartyTypeKind.ZodLiteral:return(0,f.parseLiteralDef)(e,r);case n.ZodFirstPartyTypeKind.ZodEnum:return(0,h.parseEnumDef)(e);case n.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,b.parseNativeEnumDef)(e);case n.ZodFirstPartyTypeKind.ZodNullable:return(0,w.parseNullableDef)(e,r);case n.ZodFirstPartyTypeKind.ZodOptional:return(0,O.parseOptionalDef)(e,r);case n.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(e,r);case n.ZodFirstPartyTypeKind.ZodSet:return(0,j.parseSetDef)(e,r);case n.ZodFirstPartyTypeKind.ZodLazy:return M(e.getter()._def,r);case n.ZodFirstPartyTypeKind.ZodPromise:return(0,A.parsePromiseDef)(e,r);case n.ZodFirstPartyTypeKind.ZodNaN:case n.ZodFirstPartyTypeKind.ZodNever:return(0,y.parseNeverDef)();case n.ZodFirstPartyTypeKind.ZodEffects:return(0,p.parseEffectsDef)(e,r);case n.ZodFirstPartyTypeKind.ZodAny:return(0,a.parseAnyDef)();case n.ZodFirstPartyTypeKind.ZodUnknown:return(0,k.parseUnknownDef)();case n.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(e,r);case n.ZodFirstPartyTypeKind.ZodBranded:return(0,l.parseBrandedDef)(e,r);case n.ZodFirstPartyTypeKind.ZodCatch:return(0,c.parseCatchDef)(e,r);case n.ZodFirstPartyTypeKind.ZodPipeline:return(0,T.parsePipelineDef)(e,r);case n.ZodFirstPartyTypeKind.ZodFunction:case n.ZodFirstPartyTypeKind.ZodVoid:case n.ZodFirstPartyTypeKind.ZodSymbol:default:return}},$=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r)},6840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnyDef=void 0,t.parseAnyDef=function(){return{}}},2886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseArrayDef=void 0;const n=r(8754),a=r(6519),i=r(9959);t.parseArrayDef=function(e,t){var r,s;const o={type:"array"};return(null===(s=null===(r=e.type)||void 0===r?void 0:r._def)||void 0===s?void 0:s.typeName)!==n.ZodFirstPartyTypeKind.ZodAny&&(o.items=(0,i.parseDef)(e.type._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&(0,a.setResponseValueAndErrors)(o,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&(0,a.setResponseValueAndErrors)(o,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&((0,a.setResponseValueAndErrors)(o,"minItems",e.exactLength.value,e.exactLength.message,t),(0,a.setResponseValueAndErrors)(o,"maxItems",e.exactLength.value,e.exactLength.message,t)),o}},2722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBigintDef=void 0;const n=r(6519);t.parseBigintDef=function(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?(0,n.setResponseValueAndErrors)(r,"minimum",a.value,a.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),(0,n.setResponseValueAndErrors)(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?(0,n.setResponseValueAndErrors)(r,"maximum",a.value,a.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),(0,n.setResponseValueAndErrors)(r,"maximum",a.value,a.message,t));break;case"multipleOf":(0,n.setResponseValueAndErrors)(r,"multipleOf",a.value,a.message,t)}return r}},5823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBooleanDef=void 0,t.parseBooleanDef=function(){return{type:"boolean"}}},423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBrandedDef=void 0;const n=r(9959);t.parseBrandedDef=function(e,t){return(0,n.parseDef)(e.type._def,t)}},9444:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCatchDef=void 0;const n=r(9959);t.parseCatchDef=(e,t)=>(0,n.parseDef)(e.innerType._def,t)},4117:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateDef=void 0;const n=r(6519);t.parseDateDef=function(e,t){return"integer"==t.dateStrategy?a(e,t):{type:"string",format:"date-time"}};const a=(e,t)=>{const r={type:"integer",format:"unix-time"};for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target&&(0,n.setResponseValueAndErrors)(r,"minimum",a.value,a.message,t);break;case"max":"jsonSchema7"===t.target&&(0,n.setResponseValueAndErrors)(r,"maximum",a.value,a.message,t)}return r}},3245:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDefaultDef=void 0;const n=r(9959);t.parseDefaultDef=function(e,t){return Object.assign(Object.assign({},(0,n.parseDef)(e.innerType._def,t)),{default:e.defaultValue()})}},4804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEffectsDef=void 0;const n=r(9959);t.parseEffectsDef=function(e,t){return"input"===t.effectStrategy?(0,n.parseDef)(e.schema._def,t):{}}},2105:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEnumDef=void 0,t.parseEnumDef=function(e){return{type:"string",enum:e.values}}},2734:function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntersectionDef=void 0;const a=r(9959);t.parseIntersectionDef=function(e,t){const r=[(0,a.parseDef)(e.left._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]})),(0,a.parseDef)(e.right._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter((e=>!!e));let i="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const s=[];return r.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:r}=e;t=n(e,["additionalProperties"])}else i=void 0;s.push(t)}else s.push(...e.allOf),void 0===e.unevaluatedProperties&&(i=void 0);var t})),s.length?Object.assign({allOf:s},i):void 0}},8392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLiteralDef=void 0,t.parseLiteralDef=function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}},8716:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMapDef=void 0;const n=r(9959);t.parseMapDef=function(e,t){return{type:"array",maxItems:125,items:{type:"array",items:[(0,n.parseDef)(e.keyType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||{},(0,n.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||{}],minItems:2,maxItems:2}}}},2295:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNativeEnumDef=void 0,t.parseNativeEnumDef=function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),n=Array.from(new Set(r.map((e=>typeof e))));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:r}}},2200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNeverDef=void 0,t.parseNeverDef=function(){return{not:{}}}},5907:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullDef=void 0,t.parseNullDef=function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}},993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullableDef=void 0;const n=r(9959),a=r(8e3);t.parseNullableDef=function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:a.primitiveMappings[e.innerType._def.typeName],nullable:!0}:{type:[a.primitiveMappings[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const r=(0,n.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath]}));return r&&Object.assign(Object.assign({},r),{nullable:!0})}const r=(0,n.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return r&&{anyOf:[r,{type:"null"}]}}},8490:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNumberDef=void 0;const n=r(6519);t.parseNumberDef=function(e,t){const r={type:"number"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"int":r.type="integer",(0,n.addErrorMessage)(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?(0,n.setResponseValueAndErrors)(r,"minimum",a.value,a.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),(0,n.setResponseValueAndErrors)(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?(0,n.setResponseValueAndErrors)(r,"maximum",a.value,a.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),(0,n.setResponseValueAndErrors)(r,"maximum",a.value,a.message,t));break;case"multipleOf":(0,n.setResponseValueAndErrors)(r,"multipleOf",a.value,a.message,t)}return r}},938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseObjectDef=t.parseObjectDefX=void 0;const n=r(9959);t.parseObjectDefX=function(e,t){var r,a;Object.keys(e.shape()).reduce(((r,a)=>{let i=e.shape()[a];const s=i.isOptional();s||(i=Object.assign({},i._def.innerSchema));const o=(0,n.parseDef)(i._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]}));return void 0!==o&&(r.properties[a]=o,s||(r.required||(r.required=[]),r.required.push(a))),r}),{type:"object",properties:{},additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,n.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});const i=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce(((e,[r,a])=>{if(void 0===a||void 0===a._def)return e;const i=(0,n.parseDef)(a._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===i?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:i}),required:a.isOptional()?e.required:[...e.required,r]}}),{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(a=(0,n.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===a||a});return i.required.length||delete i.required,i},t.parseObjectDef=function(e,t){var r;const a=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce(((e,[r,a])=>{if(void 0===a||void 0===a._def)return e;const i=(0,n.parseDef)(a._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===i?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:i}),required:a.isOptional()?e.required:[...e.required,r]}}),{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,n.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});return a.required.length||delete a.required,a}},8289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptionalDef=void 0;const n=r(9959);t.parseOptionalDef=(e,t)=>{var r;if(t.currentPath.toString()===(null===(r=t.propertyPath)||void 0===r?void 0:r.toString()))return(0,n.parseDef)(e.innerType._def,t);const a=(0,n.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return a?{anyOf:[{not:{}},a]}:{}}},1250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePipelineDef=void 0;const n=r(9959);t.parsePipelineDef=(e,t)=>{if("input"===t.pipeStrategy)return(0,n.parseDef)(e.in._def,t);const r=(0,n.parseDef)(e.in._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]}));return{allOf:[r,(0,n.parseDef)(e.out._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf",r?"1":"0"]}))].filter((e=>void 0!==e))}}},9033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePromiseDef=void 0;const n=r(9959);t.parsePromiseDef=function(e,t){return(0,n.parseDef)(e.type._def,t)}},3564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRecordDef=void 0;const n=r(8754),a=r(9959),i=r(9229);t.parseRecordDef=function(e,t){var r,s,o,l,c;if("openApi3"===t.target&&(null===(r=e.keyType)||void 0===r?void 0:r._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((r,n)=>{var i;return Object.assign(Object.assign({},r),{[n]:null!==(i=(0,a.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",n]})))&&void 0!==i?i:{}})}),{}),additionalProperties:!1};const u={type:"object",additionalProperties:null!==(s=(0,a.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))&&void 0!==s?s:{}};if("openApi3"===t.target)return u;if((null===(o=e.keyType)||void 0===o?void 0:o._def.typeName)===n.ZodFirstPartyTypeKind.ZodString&&(null===(l=e.keyType._def.checks)||void 0===l?void 0:l.length)){const r=Object.entries((0,i.parseStringDef)(e.keyType._def,t)).reduce(((e,[t,r])=>"type"===t?e:Object.assign(Object.assign({},e),{[t]:r})),{});return Object.assign(Object.assign({},u),{propertyNames:r})}return(null===(c=e.keyType)||void 0===c?void 0:c._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum?Object.assign(Object.assign({},u),{propertyNames:{enum:e.keyType._def.values}}):u}},9226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSetDef=void 0;const n=r(6519),a=r(9959);t.parseSetDef=function(e,t){const r={type:"array",uniqueItems:!0,items:(0,a.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))};return e.minSize&&(0,n.setResponseValueAndErrors)(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&(0,n.setResponseValueAndErrors)(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}},9229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringDef=t.emojiPattern=t.ulidPattern=t.cuid2Pattern=t.cuidPattern=t.emailPattern=void 0;const n=r(6519);t.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',t.cuidPattern="^c[^\\s-]{8,}$",t.cuid2Pattern="^[a-z][a-z0-9]*$",t.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",t.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u",t.parseStringDef=function(e,r){const o={type:"string"};if(e.checks)for(const l of e.checks)switch(l.kind){case"min":(0,n.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,l.value):l.value,l.message,r);break;case"max":(0,n.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,l.value):l.value,l.message,r);break;case"email":switch(r.emailStrategy){case"format:email":i(o,"email",l.message,r);break;case"format:idn-email":i(o,"idn-email",l.message,r);break;case"pattern:zod":s(o,t.emailPattern,l.message,r)}break;case"url":i(o,"uri",l.message,r);break;case"uuid":i(o,"uuid",l.message,r);break;case"regex":s(o,l.regex.source,l.message,r);break;case"cuid":s(o,t.cuidPattern,l.message,r);break;case"cuid2":s(o,t.cuid2Pattern,l.message,r);break;case"startsWith":s(o,"^"+a(l.value),l.message,r);break;case"endsWith":s(o,a(l.value)+"$",l.message,r);break;case"datetime":i(o,"date-time",l.message,r);break;case"length":(0,n.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,l.value):l.value,l.message,r),(0,n.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,l.value):l.value,l.message,r);break;case"includes":s(o,a(l.value),l.message,r);break;case"ip":"v6"!==l.version&&i(o,"ipv4",l.message,r),"v4"!==l.version&&i(o,"ipv6",l.message,r);break;case"emoji":s(o,t.emojiPattern,l.message,r);break;case"ulid":s(o,t.ulidPattern,l.message,r)}return o};const a=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),i=(e,t,r,a)=>{var i;e.format||(null===(i=e.anyOf)||void 0===i?void 0:i.some((e=>e.format)))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push(Object.assign({format:e.format},e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}})),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push(Object.assign({format:t},r&&a.errorMessages&&{errorMessage:{format:r}}))):(0,n.setResponseValueAndErrors)(e,"format",t,r,a)},s=(e,t,r,a)=>{var i;e.pattern||(null===(i=e.allOf)||void 0===i?void 0:i.some((e=>e.pattern)))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push(Object.assign({pattern:e.pattern},e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}})),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push(Object.assign({pattern:t},r&&a.errorMessages&&{errorMessage:{pattern:r}}))):(0,n.setResponseValueAndErrors)(e,"pattern",t,r,a)}},3133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTupleDef=void 0;const n=r(9959);t.parseTupleDef=function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:(0,n.parseDef)(e.rest._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}},9646:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedDef=void 0,t.parseUndefinedDef=function(){return{not:{}}}},8e3:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;const n=r(9959);t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},t.parseUnionDef=function(e,r){if("openApi3"===r.target)return a(e,r);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in t.primitiveMappings&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,r)=>{const n=t.primitiveMappings[r._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return a(e,r)};const a=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf",`${r}`]})))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0}},34:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnknownDef=void 0,t.parseUnknownDef=function(){return{}}},4357:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const n=r(9959),a=r(1908);t.zodToJsonSchema=(e,t)=>{var r;const i=(0,a.getRefs)(t),s="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>{var a;return Object.assign(Object.assign({},e),{[t]:null!==(a=(0,n.parseDef)(r._def,Object.assign(Object.assign({},i),{currentPath:[...i.basePath,i.definitionPath,t]}),!0))&&void 0!==a?a:{}})}),{}):void 0,o="string"==typeof t?t:null==t?void 0:t.name,l=null!==(r=(0,n.parseDef)(e._def,void 0===o?i:Object.assign(Object.assign({},i),{currentPath:[...i.basePath,i.definitionPath,o]}),!1))&&void 0!==r?r:{},c=void 0===o?s?Object.assign(Object.assign({},l),{[i.definitionPath]:s}):l:{$ref:[..."relative"===i.$refStrategy?[]:i.basePath,i.definitionPath,o].join("/"),[i.definitionPath]:Object.assign(Object.assign({},s),{[o]:l})};return"jsonSchema7"===i.target?c.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===i.target&&(c.$schema="https://json-schema.org/draft/2019-09/schema#"),c}},8280:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;const n=r(9110);t.ZodIssueCode=n.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class a extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){const r=a.path[n];n===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=a,a.create=e=>new a(e)},6996:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;const a=n(r(9349));t.defaultErrorMap=a.default;let i=a.default;t.setErrorMap=function(e){i=e},t.getErrorMap=function(){return i}},6349:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(6996),t),a(r(3187),t),a(r(116),t),a(r(9110),t),a(r(5433),t),a(r(8280),t)},8762:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,(r=t.errorUtil||(t.errorUtil={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},r.toString=e=>"string"==typeof e?e:null==e?void 0:e.message},3187:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;const a=r(6996),i=n(r(9349));t.makeIssue=e=>{const{data:t,path:r,errorMaps:n,issueData:a}=e,i=[...r,...a.path||[]],s={...a,path:i};let o="";const l=n.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...a,path:i,message:a.message||o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){const n=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,(0,a.getErrorMap)(),i.default].filter((e=>!!e))});e.common.issues.push(n)};class s{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const a of r){if("aborted"===a.status)return t.INVALID;"dirty"===a.status&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return s.mergeObjectSync(e,r)}static mergeObjectSync(e,r){const n={};for(const a of r){const{key:r,value:i}=a;if("aborted"===r.status)return t.INVALID;if("aborted"===i.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===r.value||void 0===i.value&&!a.alwaysSet||(n[r.value]=i.value)}return{status:e.value,value:n}}}t.ParseStatus=s,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},116:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9110:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r=t.util||(t.util={})),(t.objectUtil||(t.objectUtil={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":return Array.isArray(e)?t.ZodParsedType.array:null===e?t.ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?t.ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?t.ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?t.ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?t.ZodParsedType.date:t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},8754:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t},s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;const o=i(r(6349));t.z=o,s(r(6349),t),t.default=o},9349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9110),a=r(8280);t.default=(e,t)=>{let r;switch(e.code){case a.ZodIssueCode.invalid_type:r=e.received===n.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case a.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,n.util.jsonStringifyReplacer)}`;break;case a.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${n.util.joinValues(e.keys,", ")}`;break;case a.ZodIssueCode.invalid_union:r="Invalid input";break;case a.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${n.util.joinValues(e.options)}`;break;case a.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${n.util.joinValues(e.options)}, received '${e.received}'`;break;case a.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case a.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case a.ZodIssueCode.invalid_date:r="Invalid date";break;case a.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:n.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case a.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case a.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case a.ZodIssueCode.custom:r="Invalid input";break;case a.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case a.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case a.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,n.util.assertNever(e)}return{message:r}}},5433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.date=t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=void 0;const n=r(6996),a=r(8762),i=r(3187),s=r(9110),o=r(8280);class l{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const c=(e,t)=>{if((0,i.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new o.ZodError(e.common.issues);return this._error=t,this._error}}};function u(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=n?n:t.defaultError}:{message:null!=r?r:t.defaultError},description:a}}class d{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return(0,s.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,s.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new i.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,s.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if((0,i.isAsync)(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,s.getParsedType)(e)},a=this._parseSync({data:e,path:n.path,parent:n});return c(n,a)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,s.getParsedType)(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await((0,i.isAsync)(n)?n:Promise.resolve(n));return c(r,a)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const a=e(t),i=()=>n.addIssue({code:o.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(i(),!1))):!!a||(i(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new X({schema:this,typeName:oe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Q.create(this,this._def)}nullable(){return ee.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return M.create(this,this._def)}promise(){return Y.create(this,this._def)}or(e){return R.create([this,e],this._def)}and(e){return U.create(this,e,this._def)}transform(e){return new X({...u(this._def),schema:this,typeName:oe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new te({...u(this._def),innerType:this,defaultValue:t,typeName:oe.ZodDefault})}brand(){return new ae({typeName:oe.ZodBranded,type:this,...u(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new re({...u(this._def),innerType:this,catchValue:t,typeName:oe.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ie.create(this,e)}readonly(){return se.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=d,t.Schema=d,t.ZodSchema=d;const p=/^c[^\s-]{8,}$/i,h=/^[a-z][a-z0-9]*$/,m=/[0-9A-HJKMNP-TV-Z]{26}/,f=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,g=/^([A-Z0-9_+-]+\.?)*[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,b=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,y=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,v=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class w extends d{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement((t=>e.test(t)),{validation:t,code:o.ZodIssueCode.invalid_string,...a.errorUtil.errToObj(r)}),this.nonempty=e=>this.min(1,a.errorUtil.errToObj(e)),this.trim=()=>new w({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new w({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new w({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==s.ZodParsedType.string){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.string,received:t.parsedType}),i.INVALID}const t=new i.ParseStatus;let r;for(const c of this._def.checks)if("min"===c.kind)e.data.length<c.value&&(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),t.dirty());else if("max"===c.kind)e.data.length>c.value&&(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),t.dirty());else if("length"===c.kind){const n=e.data.length>c.value,a=e.data.length<c.value;(n||a)&&(r=this._getOrReturnCtx(e,r),n?(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}):a&&(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}),t.dirty())}else if("email"===c.kind)g.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"email",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("emoji"===c.kind)b.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"emoji",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("uuid"===c.kind)f.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"uuid",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("cuid"===c.kind)p.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"cuid",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("cuid2"===c.kind)h.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"cuid2",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("ulid"===c.kind)m.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"ulid",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty());else if("url"===c.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"url",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty()}else"regex"===c.kind?(c.regex.lastIndex=0,c.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"regex",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty())):"trim"===c.kind?e.data=e.data.trim():"includes"===c.kind?e.data.includes(c.value,c.position)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{includes:c.value,position:c.position},message:c.message}),t.dirty()):"toLowerCase"===c.kind?e.data=e.data.toLowerCase():"toUpperCase"===c.kind?e.data=e.data.toUpperCase():"startsWith"===c.kind?e.data.startsWith(c.value)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{startsWith:c.value},message:c.message}),t.dirty()):"endsWith"===c.kind?e.data.endsWith(c.value)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{endsWith:c.value},message:c.message}),t.dirty()):"datetime"===c.kind?((l=c).precision?l.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${l.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${l.precision}}Z$`):0===l.precision?l.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):l.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:"datetime",message:c.message}),t.dirty()):"ip"===c.kind?(n=e.data,("v4"!==(a=c.version)&&a||!y.test(n))&&("v6"!==a&&a||!v.test(n))&&(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{validation:"ip",code:o.ZodIssueCode.invalid_string,message:c.message}),t.dirty())):s.util.assertNever(c);var n,a,l;return{status:t.value,value:e.data}}_addCheck(e){return new w({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...a.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...a.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...a.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...a.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...a.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...a.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...a.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...a.errorUtil.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...a.errorUtil.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...a.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...a.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...a.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...a.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...a.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...a.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...a.errorUtil.errToObj(t)})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function _(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}t.ZodString=w,w.create=e=>{var t;return new w({checks:[],typeName:oe.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class P extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==s.ZodParsedType.number){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.number,received:t.parsedType}),i.INVALID}let t;const r=new i.ParseStatus;for(const n of this._def.checks)"int"===n.kind?s.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==_(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.not_finite,message:n.message}),r.dirty()):s.util.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,a.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,a.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,a.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,a.errorUtil.toString(t))}setLimit(e,t,r,n){return new P({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:a.errorUtil.toString(n)}]})}_addCheck(e){return new P({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:a.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:a.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:a.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:a.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:a.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:a.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:a.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:a.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:a.errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&s.util.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=P,P.create=e=>new P({checks:[],typeName:oe.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class O extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==s.ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.bigint,received:t.parsedType}),i.INVALID}let t;const r=new i.ParseStatus;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):s.util.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,a.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,a.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,a.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,a.errorUtil.toString(t))}setLimit(e,t,r,n){return new O({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:a.errorUtil.toString(n)}]})}_addCheck(e){return new O({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:a.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:a.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:a.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:a.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:a.errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=O,O.create=e=>{var t;return new O({checks:[],typeName:oe.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class T extends d{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==s.ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.boolean,received:t.parsedType}),i.INVALID}return(0,i.OK)(e.data)}}t.ZodBoolean=T,T.create=e=>new T({typeName:oe.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class A extends d{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==s.ZodParsedType.date){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.date,received:t.parsedType}),i.INVALID}if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_date}),i.INVALID}const t=new i.ParseStatus;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):s.util.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new A({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:a.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:a.errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=A,A.create=e=>new A({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:oe.ZodDate,...u(e)});class x extends d{_parse(e){if(this._getType(e)!==s.ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.symbol,received:t.parsedType}),i.INVALID}return(0,i.OK)(e.data)}}t.ZodSymbol=x,x.create=e=>new x({typeName:oe.ZodSymbol,...u(e)});class j extends d{_parse(e){if(this._getType(e)!==s.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.undefined,received:t.parsedType}),i.INVALID}return(0,i.OK)(e.data)}}t.ZodUndefined=j,j.create=e=>new j({typeName:oe.ZodUndefined,...u(e)});class E extends d{_parse(e){if(this._getType(e)!==s.ZodParsedType.null){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.null,received:t.parsedType}),i.INVALID}return(0,i.OK)(e.data)}}t.ZodNull=E,E.create=e=>new E({typeName:oe.ZodNull,...u(e)});class S extends d{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,i.OK)(e.data)}}t.ZodAny=S,S.create=e=>new S({typeName:oe.ZodAny,...u(e)});class C extends d{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,i.OK)(e.data)}}t.ZodUnknown=C,C.create=e=>new C({typeName:oe.ZodUnknown,...u(e)});class I extends d{_parse(e){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.never,received:t.parsedType}),i.INVALID}}t.ZodNever=I,I.create=e=>new I({typeName:oe.ZodNever,...u(e)});class k extends d{_parse(e){if(this._getType(e)!==s.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.void,received:t.parsedType}),i.INVALID}return(0,i.OK)(e.data)}}t.ZodVoid=k,k.create=e=>new k({typeName:oe.ZodVoid,...u(e)});class M extends d{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==s.ZodParsedType.array)return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:t.parsedType}),i.INVALID;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(e||a)&&((0,i.addIssueToContext)(t,{code:e?o.ZodIssueCode.too_big:o.ZodIssueCode.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&((0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&((0,i.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new l(t,e,t.path,r))))).then((e=>i.ParseStatus.mergeArray(r,e)));const a=[...t.data].map(((e,r)=>n.type._parseSync(new l(t,e,t.path,r))));return i.ParseStatus.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new M({...this._def,minLength:{value:e,message:a.errorUtil.toString(t)}})}max(e,t){return new M({...this._def,maxLength:{value:e,message:a.errorUtil.toString(t)}})}length(e,t){return new M({...this._def,exactLength:{value:e,message:a.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function N(e){if(e instanceof L){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Q.create(N(n))}return new L({...e._def,shape:()=>t})}return e instanceof M?new M({...e._def,type:N(e.element)}):e instanceof Q?Q.create(N(e.unwrap())):e instanceof ee?ee.create(N(e.unwrap())):e instanceof V?V.create(e.items.map((e=>N(e)))):e}t.ZodArray=M,M.create=(e,t)=>new M({type:e,minLength:null,maxLength:null,exactLength:null,typeName:oe.ZodArray,...u(t)});class L extends d{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=s.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==s.ZodParsedType.object){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:t.parsedType}),i.INVALID}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:a}=this._getCached(),c=[];if(!(this._def.catchall instanceof I&&"strip"===this._def.unknownKeys))for(const e in r.data)a.includes(e)||c.push(e);const u=[];for(const e of a){const t=n[e],a=r.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new l(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof I){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of c)u.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)c.length>0&&((0,i.addIssueToContext)(r,{code:o.ZodIssueCode.unrecognized_keys,keys:c}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of c){const n=r.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new l(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of u){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>i.ParseStatus.mergeObjectSync(t,e))):i.ParseStatus.mergeObjectSync(t,u)}get shape(){return this._def.shape()}strict(e){return a.errorUtil.errToObj,new L({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,i,s,o;const l=null!==(s=null===(i=(n=this._def).errorMap)||void 0===i?void 0:i.call(n,t,r).message)&&void 0!==s?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=a.errorUtil.errToObj(e).message)&&void 0!==o?o:l}:{message:l}}}:{}})}strip(){return new L({...this._def,unknownKeys:"strip"})}passthrough(){return new L({...this._def,unknownKeys:"passthrough"})}extend(e){return new L({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new L({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:oe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new L({...this._def,catchall:e})}pick(e){const t={};return s.util.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new L({...this._def,shape:()=>t})}omit(e){const t={};return s.util.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new L({...this._def,shape:()=>t})}deepPartial(){return N(this)}partial(e){const t={};return s.util.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new L({...this._def,shape:()=>t})}required(e){const t={};return s.util.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Q;)e=e._def.innerType;t[r]=e}})),new L({...this._def,shape:()=>t})}keyof(){return J(s.util.objectKeys(this.shape))}}t.ZodObject=L,L.create=(e,t)=>new L({shape:()=>e,unknownKeys:"strip",catchall:I.create(),typeName:oe.ZodObject,...u(t)}),L.strictCreate=(e,t)=>new L({shape:()=>e,unknownKeys:"strict",catchall:I.create(),typeName:oe.ZodObject,...u(t)}),L.lazycreate=(e,t)=>new L({shape:e,unknownKeys:"strip",catchall:I.create(),typeName:oe.ZodObject,...u(t)});class R extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new o.ZodError(e.ctx.common.issues)));return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:r}),i.INVALID}));{let e;const n=[];for(const a of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=n.map((e=>new o.ZodError(e)));return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:a}),i.INVALID}}get options(){return this._def.options}}t.ZodUnion=R,R.create=(e,t)=>new R({options:e,typeName:oe.ZodUnion,...u(t)});const $=e=>e instanceof q?$(e.schema):e instanceof X?$(e.innerType()):e instanceof H?[e.value]:e instanceof W?e.options:e instanceof G?Object.keys(e.enum):e instanceof te?$(e._def.innerType):e instanceof j?[void 0]:e instanceof E?[null]:null;class D extends d{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==s.ZodParsedType.object)return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:t.parsedType}),i.INVALID;const r=this.discriminator,n=t.data[r],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):((0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),i.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=$(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of t){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,r)}}return new D({typeName:oe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...u(r)})}}function F(e,t){const r=(0,s.getParsedType)(e),n=(0,s.getParsedType)(t);if(e===t)return{valid:!0,data:e};if(r===s.ZodParsedType.object&&n===s.ZodParsedType.object){const r=s.util.objectKeys(t),n=s.util.objectKeys(e).filter((e=>-1!==r.indexOf(e))),a={...e,...t};for(const r of n){const n=F(e[r],t[r]);if(!n.valid)return{valid:!1};a[r]=n.data}return{valid:!0,data:a}}if(r===s.ZodParsedType.array&&n===s.ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const a=F(e[n],t[n]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}return r===s.ZodParsedType.date&&n===s.ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}t.ZodDiscriminatedUnion=D;class U extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if((0,i.isAborted)(e)||(0,i.isAborted)(n))return i.INVALID;const a=F(e.value,n.value);return a.valid?(((0,i.isDirty)(e)||(0,i.isDirty)(n))&&t.dirty(),{status:t.value,value:a.data}):((0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_intersection_types}),i.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=U,U.create=(e,t,r)=>new U({left:e,right:t,typeName:oe.ZodIntersection,...u(r)});class V extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==s.ZodParsedType.array)return(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:r.parsedType}),i.INVALID;if(r.data.length<this._def.items.length)return(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new l(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>i.ParseStatus.mergeArray(t,e))):i.ParseStatus.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new V({...this._def,rest:e})}}t.ZodTuple=V,V.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new V({items:e,typeName:oe.ZodTuple,rest:null,...u(t)})};class K extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==s.ZodParsedType.object)return(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:r.parsedType}),i.INVALID;const n=[],a=this._def.keyType,c=this._def.valueType;for(const e in r.data)n.push({key:a._parse(new l(r,e,r.path,e)),value:c._parse(new l(r,r.data[e],r.path,e))});return r.common.async?i.ParseStatus.mergeObjectAsync(t,n):i.ParseStatus.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new K(t instanceof d?{keyType:e,valueType:t,typeName:oe.ZodRecord,...u(r)}:{keyType:w.create(),valueType:e,typeName:oe.ZodRecord,...u(t)})}}t.ZodRecord=K;class z extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==s.ZodParsedType.map)return(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.map,received:r.parsedType}),i.INVALID;const n=this._def.keyType,a=this._def.valueType,c=[...r.data.entries()].map((([e,t],i)=>({key:n._parse(new l(r,e,r.path,[i,"key"])),value:a._parse(new l(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of c){const n=await r.key,a=await r.value;if("aborted"===n.status||"aborted"===a.status)return i.INVALID;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of c){const n=r.key,a=r.value;if("aborted"===n.status||"aborted"===a.status)return i.INVALID;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}}}t.ZodMap=z,z.create=(e,t,r)=>new z({valueType:t,keyType:e,typeName:oe.ZodMap,...u(r)});class Z extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==s.ZodParsedType.set)return(0,i.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.set,received:r.parsedType}),i.INVALID;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&((0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&((0,i.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function c(e){const r=new Set;for(const n of e){if("aborted"===n.status)return i.INVALID;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const u=[...r.data.values()].map(((e,t)=>a._parse(new l(r,e,r.path,t))));return r.common.async?Promise.all(u).then((e=>c(e))):c(u)}min(e,t){return new Z({...this._def,minSize:{value:e,message:a.errorUtil.toString(t)}})}max(e,t){return new Z({...this._def,maxSize:{value:e,message:a.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=Z,Z.create=(e,t)=>new Z({valueType:e,minSize:null,maxSize:null,typeName:oe.ZodSet,...u(t)});class B extends d{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==s.ZodParsedType.function)return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.function,received:t.parsedType}),i.INVALID;function r(e,r){return(0,i.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_arguments,argumentsError:r}})}function a(e,r){return(0,i.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_return_type,returnTypeError:r}})}const l={errorMap:t.common.contextualErrorMap},c=t.data;if(this._def.returns instanceof Y){const e=this;return(0,i.OK)((async function(...t){const n=new o.ZodError([]),i=await e._def.args.parseAsync(t,l).catch((e=>{throw n.addIssue(r(t,e)),n})),s=await Reflect.apply(c,this,i);return await e._def.returns._def.type.parseAsync(s,l).catch((e=>{throw n.addIssue(a(s,e)),n}))}))}{const e=this;return(0,i.OK)((function(...t){const n=e._def.args.safeParse(t,l);if(!n.success)throw new o.ZodError([r(t,n.error)]);const i=Reflect.apply(c,this,n.data),s=e._def.returns.safeParse(i,l);if(!s.success)throw new o.ZodError([a(i,s.error)]);return s.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new B({...this._def,args:V.create(e).rest(C.create())})}returns(e){return new B({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new B({args:e||V.create([]).rest(C.create()),returns:t||C.create(),typeName:oe.ZodFunction,...u(r)})}}t.ZodFunction=B;class q extends d{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=q,q.create=(e,t)=>new q({getter:e,typeName:oe.ZodLazy,...u(t)});class H extends d{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_literal,expected:this._def.value}),i.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function J(e,t){return new W({values:e,typeName:oe.ZodEnum,...u(t)})}t.ZodLiteral=H,H.create=(e,t)=>new H({value:e,typeName:oe.ZodLiteral,...u(t)});class W extends d{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,i.addIssueToContext)(t,{expected:s.util.joinValues(r),received:t.parsedType,code:o.ZodIssueCode.invalid_type}),i.INVALID}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,i.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_enum_value,options:r}),i.INVALID}return(0,i.OK)(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return W.create(e)}exclude(e){return W.create(this.options.filter((t=>!e.includes(t))))}}t.ZodEnum=W,W.create=J;class G extends d{_parse(e){const t=s.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==s.ZodParsedType.string&&r.parsedType!==s.ZodParsedType.number){const e=s.util.objectValues(t);return(0,i.addIssueToContext)(r,{expected:s.util.joinValues(e),received:r.parsedType,code:o.ZodIssueCode.invalid_type}),i.INVALID}if(-1===t.indexOf(e.data)){const e=s.util.objectValues(t);return(0,i.addIssueToContext)(r,{received:r.data,code:o.ZodIssueCode.invalid_enum_value,options:e}),i.INVALID}return(0,i.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=G,G.create=(e,t)=>new G({values:e,typeName:oe.ZodNativeEnum,...u(t)});class Y extends d{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==s.ZodParsedType.promise&&!1===t.common.async)return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.promise,received:t.parsedType}),i.INVALID;const r=t.parsedType===s.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,i.OK)(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}t.ZodPromise=Y,Y.create=(e,t)=>new Y({type:e,typeName:oe.ZodPromise,...u(t)});class X extends d{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===oe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{(0,i.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){const e=n.transform(r.data,a);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r}))):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?i.INVALID:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?i.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,i.isValid)(e))return e;const s=n.transform(e.value,a);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>(0,i.isValid)(e)?Promise.resolve(n.transform(e.value,a)).then((e=>({status:t.value,value:e}))):e))}s.util.assertNever(n)}}t.ZodEffects=X,t.ZodTransformer=X,X.create=(e,t,r)=>new X({schema:e,typeName:oe.ZodEffects,effect:t,...u(r)}),X.createWithPreprocess=(e,t,r)=>new X({schema:t,effect:{type:"preprocess",transform:e},typeName:oe.ZodEffects,...u(r)});class Q extends d{_parse(e){return this._getType(e)===s.ZodParsedType.undefined?(0,i.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=Q,Q.create=(e,t)=>new Q({innerType:e,typeName:oe.ZodOptional,...u(t)});class ee extends d{_parse(e){return this._getType(e)===s.ZodParsedType.null?(0,i.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=ee,ee.create=(e,t)=>new ee({innerType:e,typeName:oe.ZodNullable,...u(t)});class te extends d{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===s.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=te,te.create=(e,t)=>new te({innerType:e,typeName:oe.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...u(t)});class re extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,i.isAsync)(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=re,re.create=(e,t)=>new re({innerType:e,typeName:oe.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...u(t)});class ne extends d{_parse(e){if(this._getType(e)!==s.ZodParsedType.nan){const t=this._getOrReturnCtx(e);return(0,i.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:s.ZodParsedType.nan,received:t.parsedType}),i.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=ne,ne.create=e=>new ne({typeName:oe.ZodNaN,...u(e)}),t.BRAND=Symbol("zod_brand");class ae extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ae;class ie extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?i.INVALID:"dirty"===e.status?(t.dirty(),(0,i.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?i.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ie({in:e,out:t,typeName:oe.ZodPipeline})}}t.ZodPipeline=ie;class se extends d{_parse(e){const t=this._def.innerType._parse(e);return(0,i.isValid)(t)&&(t.value=Object.freeze(t.value)),t}}var oe;t.ZodReadonly=se,se.create=(e,t)=>new se({innerType:e,typeName:oe.ZodReadonly,...u(t)}),t.custom=(e,t={},r)=>e?S.create().superRefine(((n,a)=>{var i,s;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;a.addIssue({code:"custom",...l,fatal:o})}})):S.create(),t.late={object:L.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(oe=t.ZodFirstPartyTypeKind||(t.ZodFirstPartyTypeKind={})),t.instanceof=(e,r={message:`Input not instance of ${e.name}`})=>(0,t.custom)((t=>t instanceof e),r);const le=w.create;t.string=le;const ce=P.create;t.number=ce;const ue=ne.create;t.nan=ue;const de=O.create;t.bigint=de;const pe=T.create;t.boolean=pe;const he=A.create;t.date=he;const me=x.create;t.symbol=me;const fe=j.create;t.undefined=fe;const ge=E.create;t.null=ge;const be=S.create;t.any=be;const ye=C.create;t.unknown=ye;const ve=I.create;t.never=ve;const we=k.create;t.void=we;const _e=M.create;t.array=_e;const Pe=L.create;t.object=Pe;const Oe=L.strictCreate;t.strictObject=Oe;const Te=R.create;t.union=Te;const Ae=D.create;t.discriminatedUnion=Ae;const xe=U.create;t.intersection=xe;const je=V.create;t.tuple=je;const Ee=K.create;t.record=Ee;const Se=z.create;t.map=Se;const Ce=Z.create;t.set=Ce;const Ie=B.create;t.function=Ie;const ke=q.create;t.lazy=ke;const Me=H.create;t.literal=Me;const Ne=W.create;t.enum=Ne;const Le=G.create;t.nativeEnum=Le;const Re=Y.create;t.promise=Re;const $e=X.create;t.effect=$e,t.transformer=$e;const De=Q.create;t.optional=De;const Fe=ee.create;t.nullable=Fe;const Ue=X.createWithPreprocess;t.preprocess=Ue;const Ve=ie.create;t.pipeline=Ve,t.ostring=()=>le().optional(),t.onumber=()=>ce().optional(),t.oboolean=()=>pe().optional(),t.coerce={string:e=>w.create({...e,coerce:!0}),number:e=>P.create({...e,coerce:!0}),boolean:e=>T.create({...e,coerce:!0}),bigint:e=>O.create({...e,coerce:!0}),date:e=>A.create({...e,coerce:!0})},t.NEVER=i.INVALID},7742:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArticlesService=void 0;const n=r(984),a=r(2533),i=["DataRoot.ApplData.AppdxTableTitleLists.AppdxTableTitle"],s=new a.XMLParser({ignoreDeclaration:!0,numberParseOptions:{skipLike:/^[0-9]+/},isArray:(e,t)=>i.includes(t),stopNodes:["DataRoot.ApplData.LawContents"]});t.ArticlesService=class{async get(e){const t=new Date,r=`https://elaws.e-gov.go.jp/api/1/articles${Object.entries(e).filter((([e,t])=>void 0!==t&&"jsonel"!==e)).map((([e,t])=>`;${e}=${t}`)).join("")}`,a=await fetch(r);console.log(`ArticlesService.get: fetch("${r}")`);const i=await a.text(),o=new Date,l=s.parse(i);e.jsonel&&"ApplData"in l.DataRoot&&(l.DataRoot.ApplData.LawContents=(0,n.xmlToJsonEL)(l.DataRoot.ApplData.LawContents));const c=new Date;return console.log({requestMS:o.getTime()-t.getTime(),parseMS:c.getTime()-o.getTime()}),l.DataRoot}}},984:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xmlToJsonEL=void 0;const n=new(r(2533).XMLParser)({ignoreDeclaration:!0,numberParseOptions:{skipLike:/^[0-9]+/},preserveOrder:!0,ignoreAttributes:!1,attributeNamePrefix:""});t.xmlToJsonEL=e=>n.parse(`<root>${e}</root>`)[0].root.map(a);const a=e=>{if("string"==typeof e["#text"])return e["#text"];{const t={tag:"",attr:{},children:[]};e[":@"]&&Object.assign(t.attr,e[":@"]);for(const r of Object.keys(e).filter((e=>":@"!==e)))t.tag=r,t.children.push(...e[r].map(a));return t}}},6274:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LawDataService=void 0;const n=r(984),a=new(r(2533).XMLParser)({ignoreDeclaration:!0,numberParseOptions:{skipLike:/^[0-9]+/},stopNodes:["DataRoot.ApplData.LawFullText"]});t.LawDataService=class{async get(e){const t=new Date,r=`https://elaws.e-gov.go.jp/api/1/lawdata/${e.lawid_or_lawnum}`,i=await fetch(r);console.log(`LawDataService.get: fetch("${r}")`);const s=await i.text(),o=new Date,l=a.parse(s);e.jsonel&&"ApplData"in l.DataRoot&&(l.DataRoot.ApplData.LawFullText=(0,n.xmlToJsonEL)(l.DataRoot.ApplData.LawFullText));const c=new Date;return console.log({requestMS:o.getTime()-t.getTime(),parseMS:c.getTime()-o.getTime()}),l.DataRoot}}},5834:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LawListsService=void 0;const n=r(2533),a=["DataRoot.ApplData.LawNameListInfo"],i=new n.XMLParser({ignoreDeclaration:!0,numberParseOptions:{skipLike:/^[0-9]+/},isArray:(e,t)=>a.includes(t)});t.LawListsService=class{async get(e){const t=new Date,r=`https://elaws.e-gov.go.jp/api/1/lawlists/${e.type}`;console.log(`LawListService.get: fetch("${r}")`);const n=await fetch(r),a=await n.text(),s=new Date,o=i.parse(a),l=new Date;return console.log({requestMS:s.getTime()-t.getTime(),parseMS:l.getTime()-s.getTime()}),o.DataRoot}}},2518:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateLawListsService=void 0;const n=r(2533),a=["DataRoot.ApplData.LawNameListInfo"],i=new n.XMLParser({ignoreDeclaration:!0,numberParseOptions:{skipLike:/^[0-9]+/},isArray:(e,t)=>a.includes(t)});t.UpdateLawListsService=class{async get(e){const t=new Date,r=`https://elaws.e-gov.go.jp/api/1/updatelawlists/${e.date}`,n=await fetch(r);console.log(`UpdateLawListsService.get: fetch("${r}")`);const a=await n.text(),s=new Date,o=i.parse(a),l=new Date;return console.log({requestMS:s.getTime()-t.getTime(),parseMS:l.getTime()-s.getTime()}),o.DataRoot}}},2533:(e,t,r)=>{"use strict";const n=r(3278),a=r(168),i=r(1884);e.exports={XMLParser:a,XMLValidator:n,XMLBuilder:i}},6394:(e,t)=>{"use strict";const r=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+r+"]["+r+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+n+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,r){if(t){const n=Object.keys(t),a=n.length;for(let i=0;i<a;i++)e[n[i]]="strict"===r?[t[n[i]]]:t[n[i]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){return!(null==a.exec(e))},t.getAllMatches=function(e,t){const r=[];let n=t.exec(e);for(;n;){const a=[];a.startIndex=t.lastIndex-n[0].length;const i=n.length;for(let e=0;e<i;e++)a.push(n[e]);r.push(a),n=t.exec(e)}return r},t.nameRegexp=n},3278:(e,t,r)=>{"use strict";const n=r(6394),a={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function s(e,t){const r=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const n=e.substr(r,t-r);if(t>5&&"xml"===n)return m("InvalidXml","XML declaration allowed only at the start of the document.",g(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function o(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},a,t);const r=[];let l=!1,c=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let a=0;a<e.length;a++)if("<"===e[a]&&"?"===e[a+1]){if(a+=2,a=s(e,a),a.err)return a}else{if("<"!==e[a]){if(i(e[a]))continue;return m("InvalidChar","char '"+e[a]+"' is not expected.",g(e,a))}{let f=a;if(a++,"!"===e[a]){a=o(e,a);continue}{let b=!1;"/"===e[a]&&(b=!0,a++);let y="";for(;a<e.length&&">"!==e[a]&&" "!==e[a]&&"\t"!==e[a]&&"\n"!==e[a]&&"\r"!==e[a];a++)y+=e[a];if(y=y.trim(),"/"===y[y.length-1]&&(y=y.substring(0,y.length-1),a--),d=y,!n.isName(d)){let t;return t=0===y.trim().length?"Invalid space after '<'.":"Tag '"+y+"' is an invalid name.",m("InvalidTag",t,g(e,a))}const v=u(e,a);if(!1===v)return m("InvalidAttr","Attributes for '"+y+"' have open quote.",g(e,a));let w=v.value;if(a=v.index,"/"===w[w.length-1]){const r=a-w.length;w=w.substring(0,w.length-1);const n=p(w,t);if(!0!==n)return m(n.err.code,n.err.msg,g(e,r+n.err.line));l=!0}else if(b){if(!v.tagClosed)return m("InvalidTag","Closing tag '"+y+"' doesn't have proper closing.",g(e,a));if(w.trim().length>0)return m("InvalidTag","Closing tag '"+y+"' can't have attributes or invalid starting.",g(e,f));{const t=r.pop();if(y!==t.tagName){let r=g(e,t.tagStartPos);return m("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+r.line+", col "+r.col+") instead of closing tag '"+y+"'.",g(e,f))}0==r.length&&(c=!0)}}else{const n=p(w,t);if(!0!==n)return m(n.err.code,n.err.msg,g(e,a-w.length+n.err.line));if(!0===c)return m("InvalidXml","Multiple possible root nodes found.",g(e,a));-1!==t.unpairedTags.indexOf(y)||r.push({tagName:y,tagStartPos:f}),l=!0}for(a++;a<e.length;a++)if("<"===e[a]){if("!"===e[a+1]){a++,a=o(e,a);continue}if("?"!==e[a+1])break;if(a=s(e,++a),a.err)return a}else if("&"===e[a]){const t=h(e,a);if(-1==t)return m("InvalidChar","char '&' is not expected.",g(e,a));a=t}else if(!0===c&&!i(e[a]))return m("InvalidXml","Extra text at the end",g(e,a));"<"===e[a]&&a--}}}var d;return l?1==r.length?m("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",g(e,r[0].tagStartPos)):!(r.length>0)||m("InvalidXml","Invalid '"+JSON.stringify(r.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):m("InvalidXml","Start tag expected.",1)};const l='"',c="'";function u(e,t){let r="",n="",a=!1;for(;t<e.length;t++){if(e[t]===l||e[t]===c)""===n?n=e[t]:n!==e[t]||(n="");else if(">"===e[t]&&""===n){a=!0;break}r+=e[t]}return""===n&&{value:r,index:t,tagClosed:a}}const d=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function p(e,t){const r=n.getAllMatches(e,d),a={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return m("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",b(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return m("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",b(r[e]));if(void 0===r[e][3]&&!t.allowBooleanAttributes)return m("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",b(r[e]));const n=r[e][2];if(!f(n))return m("InvalidAttr","Attribute '"+n+"' is an invalid name.",b(r[e]));if(a.hasOwnProperty(n))return m("InvalidAttr","Attribute '"+n+"' is repeated.",b(r[e]));a[n]=1}return!0}function h(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function m(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function f(e){return n.isName(e)}function g(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function b(e){return e.startIndex+e[1].length}},1884:(e,t,r)=>{"use strict";const n=r(3736),a={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function i(e){this.options=Object.assign({},a,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=l),this.processTextOrObjNode=s,this.options.format?(this.indentate=o,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function s(e,t,r){const n=this.j2x(e,r+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}function o(e){return this.options.indentBy.repeat(e)}function l(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}i.prototype.build=function(e){return this.options.preserveOrder?n(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},i.prototype.j2x=function(e,t){let r="",n="";for(let a in e)if(void 0===e[a]);else if(null===e[a])"?"===a[0]?n+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(e[a]instanceof Date)n+=this.buildTextValNode(e[a],a,"",t);else if("object"!=typeof e[a]){const i=this.isAttribute(a);if(i)r+=this.buildAttrPairStr(i,""+e[a]);else if(a===this.options.textNodeName){let t=this.options.tagValueProcessor(a,""+e[a]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[a],a,"",t)}else if(Array.isArray(e[a])){const r=e[a].length;for(let i=0;i<r;i++){const r=e[a][i];void 0===r||(null===r?"?"===a[0]?n+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+a+"/"+this.tagEndChar:n+="object"==typeof r?this.processTextOrObjNode(r,a,t):this.buildTextValNode(r,a,"",t))}}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const t=Object.keys(e[a]),n=t.length;for(let i=0;i<n;i++)r+=this.buildAttrPairStr(t[i],""+e[a][t[i]])}else n+=this.processTextOrObjNode(e[a],a,t);return{attrStr:r,val:n}},i.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},i.prototype.buildObjectNode=function(e,t,r,n){if(""===e)return"?"===t[0]?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let a="</"+t+this.tagEndChar,i="";return"?"===t[0]&&(i="?",a=""),r&&-1===e.indexOf("<")?this.indentate(n)+"<"+t+r+i+">"+e+a:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===i.length?this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+a}},i.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},i.prototype.buildTextValNode=function(e,t,r,n){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(t,e);return a=this.replaceEntitiesValue(a),""===a?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+a+"</"+t+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e},e.exports=i},3736:e=>{function t(e,s,o,l){let c="",u=!1;for(let d=0;d<e.length;d++){const p=e[d],h=r(p);let m="";if(m=0===o.length?h:`${o}.${h}`,h===s.textNodeName){let e=p[h];a(m,s)||(e=s.tagValueProcessor(h,e),e=i(e,s)),u&&(c+=l),c+=e,u=!1;continue}if(h===s.cdataPropName){u&&(c+=l),c+=`<![CDATA[${p[h][0][s.textNodeName]}]]>`,u=!1;continue}if(h===s.commentPropName){c+=l+`\x3c!--${p[h][0][s.textNodeName]}--\x3e`,u=!0;continue}if("?"===h[0]){const e=n(p[":@"],s),t="?xml"===h?"":l;let r=p[h][0][s.textNodeName];r=0!==r.length?" "+r:"",c+=t+`<${h}${r}${e}?>`,u=!0;continue}let f=l;""!==f&&(f+=s.indentBy);const g=l+`<${h}${n(p[":@"],s)}`,b=t(p[h],s,m,f);-1!==s.unpairedTags.indexOf(h)?s.suppressUnpairedNode?c+=g+">":c+=g+"/>":b&&0!==b.length||!s.suppressEmptyNode?b&&b.endsWith(">")?c+=g+`>${b}${l}</${h}>`:(c+=g+">",b&&""!==l&&(b.includes("/>")||b.includes("</"))?c+=l+s.indentBy+b+l:c+=b,c+=`</${h}>`):c+=g+"/>",u=!0}return c}function r(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function n(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){let a=t.attributeValueProcessor(n,e[n]);a=i(a,t),!0===a&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${a}"`}return r}function a(e,t){let r=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function i(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}e.exports=function(e,r){let n="";return r.format&&r.indentBy.length>0&&(n="\n"),t(e,r,"",n)}},3574:e=>{function t(e,t){let r="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)r+=e[t];if(r=r.trim(),-1!==r.indexOf(" "))throw new Error("External entites are not supported");const n=e[t++];let a="";for(;t<e.length&&e[t]!==n;t++)a+=e[t];return[r,a,t]}function r(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function n(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function a(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function i(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function s(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}e.exports=function(e,o){const l={};if("O"!==e[o+3]||"C"!==e[o+4]||"T"!==e[o+5]||"Y"!==e[o+6]||"P"!==e[o+7]||"E"!==e[o+8])throw new Error("Invalid Tag instead of DOCTYPE");{o+=9;let c=1,u=!1,d=!1,p="";for(;o<e.length;o++)if("<"!==e[o]||d)if(">"===e[o]){if(d?"-"===e[o-1]&&"-"===e[o-2]&&(d=!1,c--):c--,0===c)break}else"["===e[o]?u=!0:p+=e[o];else{if(u&&n(e,o))o+=7,[entityName,val,o]=t(e,o+1),-1===val.indexOf("&")&&(l[entityName]={regx:RegExp(`&${entityName};`,"g"),val});else if(u&&a(e,o))o+=8;else if(u&&i(e,o))o+=8;else if(u&&s(e,o))o+=9;else{if(!r)throw new Error("Invalid DOCTYPE");d=!0}c++,p=""}if(0!==c)throw new Error("Unclosed DOCTYPE")}return{entities:l,i:o}}},2489:(e,t)=>{const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1};t.buildOptions=function(e){return Object.assign({},r,e)},t.defaultOptions=r},5521:(e,t,r)=>{"use strict";const n=r(6394),a=r(6667),i=r(3574),s=r(8628);function o(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function l(e,t,r,n,a,i,s){if(void 0!==e&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){s||(e=this.replaceEntitiesValue(e));const n=this.options.tagValueProcessor(t,e,r,a,i);return null==n?e:typeof n!=typeof e||n!==e?n:this.options.trimValues||e.trim()===e?v(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function c(e){if(this.options.removeNSPrefix){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,n.nameRegexp);const u=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function d(e,t){if(!this.options.ignoreAttributes&&"string"==typeof e){const r=n.getAllMatches(e,u),a=r.length,i={};for(let e=0;e<a;e++){const n=this.resolveNameSpace(r[e][1]);let a=r[e][4],s=this.options.attributeNamePrefix+n;if(n.length)if(this.options.transformAttributeName&&(s=this.options.transformAttributeName(s)),"__proto__"===s&&(s="#__proto__"),void 0!==a){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const e=this.options.attributeValueProcessor(n,a,t);i[s]=null==e?a:typeof e!=typeof a||e!==a?e:v(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[s]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const p=function(e){e=e.replace(/\r\n?/g,"\n");const t=new a("!xml");let r=t,n="",s="";for(let o=0;o<e.length;o++)if("<"===e[o])if("/"===e[o+1]){const t=g(e,">",o,"Closing Tag is not closed.");let a=e.substring(o+2,t).trim();if(this.options.removeNSPrefix){const e=a.indexOf(":");-1!==e&&(a=a.substr(e+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&(n=this.saveTextToParentTag(n,r,s)),s=s.substr(0,s.lastIndexOf(".")),r=this.tagsNodeStack.pop(),n="",o=t}else if("?"===e[o+1]){let t=b(e,o,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,s),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new a(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,s)),r.addChild(e)}o=t.closeIndex+1}else if("!--"===e.substr(o+1,3)){const t=g(e,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(o+4,t-2);n=this.saveTextToParentTag(n,r,s),r.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}o=t}else if("!D"===e.substr(o+1,2)){const t=i(e,o);this.docTypeEntities=t.entities,o=t.i}else if("!["===e.substr(o+1,2)){const t=g(e,"]]>",o,"CDATA is not closed.")-2,a=e.substring(o+9,t);if(n=this.saveTextToParentTag(n,r,s),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]);else{let e=this.parseTextData(a,r.tagname,s,!0,!1,!0);null==e&&(e=""),r.add(this.options.textNodeName,e)}o=t+2}else{let i=b(e,o,this.options.removeNSPrefix),l=i.tagName,c=i.tagExp,u=i.attrExpPresent,d=i.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),r&&n&&"!xml"!==r.tagname&&(n=this.saveTextToParentTag(n,r,s,!1)),l!==t.tagname&&(s+=s?"."+l:l);const p=r;if(p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(r=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,s,l)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)o=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(l))o=i.closeIndex;else{const r=this.readStopNodeData(e,l,d+1);if(!r)throw new Error(`Unexpected end of ${l}`);o=r.i,t=r.tagContent}const n=new a(l);l!==c&&u&&(n[":@"]=this.buildAttributesMap(c,s)),t&&(t=this.parseTextData(t,l,s,!0,u,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),n.add(this.options.textNodeName,t),r.addChild(n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===l[l.length-1]?(l=l.substr(0,l.length-1),c=l):c=c.substr(0,c.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const e=new a(l);l!==c&&u&&(e[":@"]=this.buildAttributesMap(c,s)),s=s.substr(0,s.lastIndexOf(".")),r.addChild(e)}else{const e=new a(l);this.tagsNodeStack.push(r),l!==c&&u&&(e[":@"]=this.buildAttributesMap(c,s)),r.addChild(e),r=e}n="",o=d}}else n+=e[o];return t.child},h=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function m(e,t,r,n){return e&&(void 0===n&&(n=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,r,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,n))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function f(e,t,r){const n="*."+r;for(const r in e){const a=e[r];if(n===a||t===a)return!0}return!1}function g(e,t,r,n){const a=e.indexOf(t,r);if(-1===a)throw new Error(n);return a+t.length-1}function b(e,t,r,n=">"){const a=function(e,t,r=">"){let n,a="";for(let i=t;i<e.length;i++){let t=e[i];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===r[0]){if(!r[1])return{data:a,index:i};if(e[i+1]===r[1])return{data:a,index:i}}else"\t"===t&&(t=" ");a+=t}}(e,t+1,n);if(!a)return;let i=a.data;const s=a.index,o=i.search(/\s/);let l=i,c=!0;if(-1!==o&&(l=i.substr(0,o).replace(/\s\s*$/,""),i=i.substr(o+1)),r){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==a.data.substr(e+1))}return{tagName:l,tagExp:i,closeIndex:s,attrExpPresent:c}}function y(e,t,r){const n=r;let a=1;for(;r<e.length;r++)if("<"===e[r])if("/"===e[r+1]){const i=g(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(a--,0===a))return{tagContent:e.substring(n,r),i};r=i}else if("?"===e[r+1])r=g(e,"?>",r+1,"StopNode is not closed.");else if("!--"===e.substr(r+1,3))r=g(e,"--\x3e",r+3,"StopNode is not closed.");else if("!["===e.substr(r+1,2))r=g(e,"]]>",r,"StopNode is not closed.")-2;else{const n=b(e,r,">");n&&((n&&n.tagName)===t&&"/"!==n.tagExp[n.tagExp.length-1]&&a++,r=n.closeIndex)}}function v(e,t,r){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&s(e,r)}return n.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=o,this.parseXml=p,this.parseTextData=l,this.resolveNameSpace=c,this.buildAttributesMap=d,this.isItStopNode=f,this.replaceEntitiesValue=h,this.readStopNodeData=y,this.saveTextToParentTag=m}}},168:(e,t,r)=>{const{buildOptions:n}=r(2489),a=r(5521),{prettify:i}=r(2880),s=r(3278);e.exports=class{constructor(e){this.externalEntities={},this.options=n(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const r=s.validate(e,t);if(!0!==r)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const r=new a(this.options);r.addExternalEntities(this.externalEntities);const n=r.parseXml(e);return this.options.preserveOrder||void 0===n?n:i(n,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},2880:(e,t)=>{"use strict";function r(e,t,s){let o;const l={};for(let c=0;c<e.length;c++){const u=e[c],d=n(u);let p="";if(p=void 0===s?d:s+"."+d,d===t.textNodeName)void 0===o?o=u[d]:o+=""+u[d];else{if(void 0===d)continue;if(u[d]){let e=r(u[d],t,p);const n=i(e,t);u[":@"]?a(e,u[":@"],p,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==l[d]&&l.hasOwnProperty(d)?(Array.isArray(l[d])||(l[d]=[l[d]]),l[d].push(e)):t.isArray(d,p,n)?l[d]=[e]:l[d]=e}}}return"string"==typeof o?o.length>0&&(l[t.textNodeName]=o):void 0!==o&&(l[t.textNodeName]=o),l}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function a(e,t,r,n){if(t){const a=Object.keys(t),i=a.length;for(let s=0;s<i;s++){const i=a[s];n.isArray(i,r+"."+i,!0,!0)?e[i]=[t[i]]:e[i]=t[i]}}}function i(e,t){const r=Object.keys(e).length;return!!(0===r||1===r&&e[t.textNodeName])}t.prettify=function(e,t){return r(e,t)}},6667:e=>{"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},8628:e=>{const t=/^[-+]?0x[a-fA-F0-9]+$/,r=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const n={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,a={}){if(a=Object.assign({},n,a),!e||"string"!=typeof e)return e;let i=e.trim();if(void 0!==a.skipLike&&a.skipLike.test(i))return e;if(a.hex&&t.test(i))return Number.parseInt(i,16);{const t=r.exec(i);if(t){const r=t[1],n=t[2];let o=(s=t[3])&&-1!==s.indexOf(".")?("."===(s=s.replace(/0+$/,""))?s="0":"."===s[0]?s="0"+s:"."===s[s.length-1]&&(s=s.substr(0,s.length-1)),s):s;const l=t[4]||t[6];if(!a.leadingZeros&&n.length>0&&r&&"."!==i[2])return e;if(!a.leadingZeros&&n.length>0&&!r&&"."!==i[1])return e;{const t=Number(i),s=""+t;return-1!==s.search(/[eE]/)||l?a.eNotation?t:e:-1!==i.indexOf(".")?"0"===s&&""===o||s===o||r&&s==="-"+o?t:e:n?o===s||r+o===s?t:e:i===s||i===r+s?t:e}}return e}var s}},7121:(e,t,r)=>{"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(9742)),i=Object.defineProperty;function s(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){const i=e.slice(r[a].start,r[a+1].end),s=t.get(i.join(","));null!=s&&(null==n||s<n[0])&&(n=[s,a])}if(null==n)break;{const e=n[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var o,l=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,n,...a]=t.split(" "),i=Number.parseInt(n,10);return a.forEach(((t,r)=>e[t]=i+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=a.default.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const n=new RegExp(this.patStr,"ug"),a=l.specialTokenRegex(Object.keys(this.specialTokens)),i=[],o=new Set("all"===t?Object.keys(this.specialTokens):t),c=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!o.has(e))):r);if(c.size>0){const t=l.specialTokenRegex([...c]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let u=0;for(;;){let t=null,r=u;for(;a.lastIndex=r,t=a.exec(e),null!=t&&!o.has(t[0]);)r=t.index+1;const l=t?.index??e.length;for(const t of e.substring(u,l).matchAll(n)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?i.push(...s(e,this.rankMap)):i.push(r)}if(null==t)break;let c=this.specialTokens[t[0]];i.push(c),u=t.index+t[0].length}return i}decode(e){const t=[];let r=0;for(let n=0;n<e.length;++n){const a=e[n],i=this.textMap.get(a)??this.inverseSpecialTokens[a];null!=i&&(t.push(i),r+=i.length)}const n=new Uint8Array(r);let a=0;for(const e of t)n.set(e,a),a+=e.length;return this.textDecoder.decode(n)}},c=l;((e,t,r)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(c,"symbol"!=typeof(o="specialTokenRegex")?o+"":o,(e=>new RegExp(e.map((e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|"),"g"))),t.Tiktoken=c,t.getEncodingNameForModel=function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}},974:(e,t,r)=>{e.exports=r(4056)},5787:(e,t,r)=>{e.exports=r(3357)},8706:(e,t,r)=>{e.exports=r(3484)},2128:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Agent=t.LLMSingleActionAgent=t.BaseMultiActionAgent=t.BaseSingleActionAgent=t.BaseAgent=void 0;const n=r(2053);class a extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class i extends n.Serializable{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw new Error("Not implemented")}returnStoppedResponse(e,t,r,n){if("force"===e)return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw new Error(`Invalid stopping method: ${e}`)}async prepareForOutput(e,t){return{}}}t.BaseAgent=i;class s extends i{_agentActionType(){return"single"}}t.BaseSingleActionAgent=s,t.BaseMultiActionAgent=class extends i{_agentActionType(){return"multi"}},t.LLMSingleActionAgent=class extends s{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents"]}),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stop=e.stop,this.llmChain=e.llmChain,this.outputParser=e.outputParser}get inputKeys(){return this.llmChain.inputKeys}async plan(e,t,r){const n=await this.llmChain.call({intermediate_steps:e,stop:this.stop,...t},r);return this.outputParser.parse(n[this.llmChain.outputKey],r)}},t.Agent=class extends s{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter((e=>"agent_scratchpad"!==e))}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this._allowedTools=e.allowedTools,this.outputParser=e.outputParser}static getDefaultOutputParser(e){throw new Error("Not implemented")}static createPrompt(e,t){throw new Error("Not implemented")}static fromLLMAndTools(e,t,r){throw new Error("Not implemented")}static validateTools(e){}_stop(){return[`\n${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}async constructScratchPad(e){return e.reduce(((e,{action:t,observation:r})=>e+[t.log,`${this.observationPrefix()}${r}`,this.llmPrefix()].join("\n")),"")}async _plan(e,t,r,n){const a=await this.constructScratchPad(e),i={...t,agent_scratchpad:r?`${a}${r}`:a};0!==this._stop().length&&(i.stop=this._stop());const s=await this.llmChain.predict(i,n);if(!this.outputParser)throw new Error("Output parser not set");return this.outputParser.parse(s,n)}plan(e,t,r){return this._plan(e,t,void 0,r)}async returnStoppedResponse(e,t,r,n){if("force"===e)return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if("generate"===e)try{const e=await this._plan(t,r,"\n\nI now need to return a final answer based on the previous steps:",n);return"returnValues"in e?e:{returnValues:{output:e.log},log:e.log}}catch(e){if(!(e instanceof a))throw e;return{returnValues:{output:e.output},log:e.output}}throw new Error(`Invalid stopping method: ${e}`)}static async deserialize(e){if("zero-shot-react-description"===e._type){const{ZeroShotAgent:t}=await Promise.resolve().then(r.bind(r,4363));return t.deserialize(e)}throw new Error("Unknown agent type")}}},715:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatAgent=void 0;const n=r(6448),a=r(9244),i=r(2128),s=r(7525),o=r(7148),l="{input}\n\n{agent_scratchpad}";class c extends i.Agent{constructor(e){const t=e?.outputParser??c.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}_agentType(){return"chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const t=e.find((e=>!e.description));if(t){const e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw new Error(e)}}static getDefaultOutputParser(e){return new s.ChatAgentOutputParser}async constructScratchPad(e){const t=await super.constructScratchPad(e);return t?`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):\n${t}`:t}static createPrompt(e,t){const{prefix:r=o.PREFIX,suffix:n=o.SUFFIX,humanMessageTemplate:i=l}=t??{},s=[r,e.map((e=>`${e.name}: ${e.description}`)).join("\n"),o.FORMAT_INSTRUCTIONS,n].join("\n\n"),c=[a.SystemMessagePromptTemplate.fromTemplate(s),a.HumanMessagePromptTemplate.fromTemplate(i)];return a.ChatPromptTemplate.fromPromptMessages(c)}static fromLLMAndTools(e,t,r){c.validateTools(t);const a=c.createPrompt(t,r),i=new n.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks??r?.callbackManager}),s=r?.outputParser??c.getDefaultOutputParser();return new c({llmChain:i,outputParser:s,allowedTools:t.map((e=>e.name))})}}t.ChatAgent=c},7525:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatAgentOutputParser=t.FINAL_ANSWER_ACTION=void 0;const n=r(4214),a=r(7148);t.FINAL_ANSWER_ACTION="Final Answer:";class i extends n.AgentActionOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}async parse(e){if(e.includes(t.FINAL_ANSWER_ACTION)||!e.includes('"action":')){const r=e.split(t.FINAL_ANSWER_ACTION);return{returnValues:{output:r[r.length-1].trim()},log:e}}const r=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();try{const t=JSON.parse(r.trim());return{tool:t.action,toolInput:t.action_input,log:e}}catch{throw new Error(`Unable to parse JSON response from chat agent.\n\n${e}`)}}getFormatInstructions(){return a.FORMAT_INSTRUCTIONS}}t.ChatAgentOutputParser=i},7148:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUFFIX=t.FORMAT_INSTRUCTIONS=t.PREFIX=void 0,t.PREFIX="Answer the following questions as best you can. You have access to the following tools:",t.FORMAT_INSTRUCTIONS='The way you use the tools is by specifying a json blob, denoted below by $JSON_BLOB\nSpecifically, this $JSON_BLOB should have a "action" key (with the name of the tool to use) and a "action_input" key (with the input to the tool going here). \nThe $JSON_BLOB should only contain a SINGLE action, do NOT return a list of multiple actions. Here is an example of a valid $JSON_BLOB:\n\n```\n{{\n  "action": "calculator",\n  "action_input": "1 + 2"\n}}\n```\n\nALWAYS use the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: \n```\n$JSON_BLOB\n```\nObservation: the result of the action\n... (this Thought/Action/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question',t.SUFFIX="Begin! Reminder to always use the exact characters `Final Answer` when responding."},140:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatConversationalAgent=void 0;const n=r(6448),a=r(9244),i=r(2888),s=r(4235),o=r(2128),l=r(1385),c=r(4462);class u extends o.Agent{constructor(e){const t=e.outputParser??u.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]})}_agentType(){return"chat-conversational-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const t=e.find((e=>!e.description));if(t){const e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw new Error(e)}}async constructScratchPad(e){const t=[];for(const r of e)t.push(new s.AIMessage(r.action.log)),t.push(new s.HumanMessage((0,i.renderTemplate)(c.TEMPLATE_TOOL_RESPONSE,"f-string",{observation:r.observation})));return t}static getDefaultOutputParser(e){return e?.llm?l.ChatConversationalAgentOutputParserWithRetries.fromLLM(e.llm,{toolNames:e.toolNames}):new l.ChatConversationalAgentOutputParserWithRetries({toolNames:e?.toolNames})}static createPrompt(e,t){const r=(t?.systemMessage??c.DEFAULT_PREFIX)+c.PREFIX_END,n=t?.humanMessage??c.DEFAULT_SUFFIX,s=e.map((e=>`${e.name}: ${e.description}`)).join("\n"),o=e.map((e=>e.name)),l=(t?.outputParser??u.getDefaultOutputParser({toolNames:o})).getFormatInstructions({toolNames:o}),d=(0,i.renderTemplate)(n,"f-string",{format_instructions:l,tools:s}),p=[a.SystemMessagePromptTemplate.fromTemplate(r),new a.MessagesPlaceholder("chat_history"),a.HumanMessagePromptTemplate.fromTemplate(d),new a.MessagesPlaceholder("agent_scratchpad")];return a.ChatPromptTemplate.fromPromptMessages(p)}static fromLLMAndTools(e,t,r){u.validateTools(t);const a=r?.outputParser??u.getDefaultOutputParser({llm:e,toolNames:t.map((e=>e.name))}),i=u.createPrompt(t,{...r,outputParser:a}),s=new n.LLMChain({prompt:i,llm:e,callbacks:r?.callbacks??r?.callbackManager});return new u({llmChain:s,outputParser:a,allowedTools:t.map((e=>e.name))})}}t.ChatConversationalAgent=u},1385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatConversationalAgentOutputParserWithRetries=t.ChatConversationalAgentOutputParser=void 0;const n=r(8711),a=r(2888),i=r(4214),s=r(4462),o=r(7546);class l extends i.AgentActionOutputParser{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){let t=e.trim();if(t.includes("```json"))t=t.split("```json")[1].trimStart();else if(t.includes("```")){const e=t.indexOf("```");t=t.slice(e+3).trimStart()}const r=t.lastIndexOf("```");-1!==r&&(t=t.slice(0,r).trimEnd());try{const r=JSON.parse(t),{action:n,action_input:a}=r;return"Final Answer"===n?{returnValues:{output:a},log:e}:{tool:n,toolInput:a,log:e}}catch(t){throw new n.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`)}}getFormatInstructions(){return(0,a.renderTemplate)(s.FORMAT_INSTRUCTIONS,"f-string",{tool_names:this.toolNames.join(", ")})}}t.ChatConversationalAgentOutputParser=l;class c extends i.AgentActionOutputParser{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=e?.baseParser??new l({toolNames:this.toolNames}),this.outputFixingParser=e?.outputFixingParser}getFormatInstructions(e){return e.raw?s.FORMAT_INSTRUCTIONS:(0,a.renderTemplate)(s.FORMAT_INSTRUCTIONS,"f-string",{tool_names:e.toolNames.join(", ")})}async parse(e){return void 0!==this.outputFixingParser?this.outputFixingParser.parse(e):this.baseParser.parse(e)}static fromLLM(e,t){const r=t.baseParser??new l({toolNames:t.toolNames??[]}),n=o.OutputFixingParser.fromLLM(e,r);return new c({baseParser:r,outputFixingParser:n,toolNames:t.toolNames})}}t.ChatConversationalAgentOutputParserWithRetries=c},4462:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMPLATE_TOOL_RESPONSE=t.DEFAULT_SUFFIX=t.FORMAT_INSTRUCTIONS=t.PREFIX_END=t.DEFAULT_PREFIX=void 0,t.DEFAULT_PREFIX="Assistant is a large language model trained by OpenAI.\n\nAssistant is designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, Assistant is able to generate human-like text based on the input it receives, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.\n\nAssistant is constantly learning and improving, and its capabilities are constantly evolving. It is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.\n\nOverall, Assistant is a powerful system that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether you need help with a specific question or just want to have a conversation about a particular topic, Assistant is here to assist.",t.PREFIX_END=" However, above all else, all responses must adhere to the format of RESPONSE FORMAT INSTRUCTIONS.",t.FORMAT_INSTRUCTIONS='RESPONSE FORMAT INSTRUCTIONS\n----------------------------\n\nOutput a JSON markdown code snippet containing a valid JSON object in one of two formats:\n\n**Option 1:**\nUse this if you want the human to use a tool.\nMarkdown code snippet formatted in the following schema:\n\n```json\n{{{{\n    "action": string, // The action to take. Must be one of [{tool_names}]\n    "action_input": string // The input to the action. May be a stringified object.\n}}}}\n```\n\n**Option #2:**\nUse this if you want to respond directly and conversationally to the human. Markdown code snippet formatted in the following schema:\n\n```json\n{{{{\n    "action": "Final Answer",\n    "action_input": string // You should put what you want to return to use here and make sure to use valid json newline characters.\n}}}}\n```\n\nFor both options, remember to always include the surrounding markdown code snippet delimiters (begin with "```json" and end with "```")!\n',t.DEFAULT_SUFFIX="TOOLS\n------\nAssistant can ask the user to use tools to look up information that may be helpful in answering the users original question. The tools the human can use are:\n\n{tools}\n\n{format_instructions}\n\nUSER'S INPUT\n--------------------\nHere is the user's input (remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else):\n\n{{input}}",t.TEMPLATE_TOOL_RESPONSE="TOOL RESPONSE:\n---------------------\n{observation}\n\nUSER'S INPUT\n--------------------\n\nOkay, so what is the response to my last comment? If using information obtained from the tools you must mention it explicitly without mentioning the tool names - I have forgotten all TOOL RESPONSES! Remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else."},3314:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentExecutor=void 0;const n=r(9717);class a extends n.BaseChain{get lc_namespace(){return["langchain","agents","executor"]}get inputKeys(){return this.agent.inputKeys}get outputKeys(){return this.agent.returnValues}constructor(e){if(super(e),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(this,"earlyStoppingMethod",{enumerable:!0,configurable:!0,writable:!0,value:"force"}),this.agent=e.agent,this.tools=e.tools,"multi"===this.agent._agentActionType())for(const e of this.tools)if(e.returnDirect)throw new Error(`Tool with return direct ${e.name} not supported for multi-action agent.`);this.returnIntermediateSteps=e.returnIntermediateSteps??this.returnIntermediateSteps,this.maxIterations=e.maxIterations??this.maxIterations,this.earlyStoppingMethod=e.earlyStoppingMethod??this.earlyStoppingMethod}static fromAgentAndTools(e){return new a(e)}shouldContinue(e){return void 0===this.maxIterations||e<this.maxIterations}async _call(e,t){const r=Object.fromEntries(this.tools.map((e=>[e.name.toLowerCase(),e]))),n=[];let a=0;const i=async e=>{const{returnValues:r}=e,a=await this.agent.prepareForOutput(r,n);return this.returnIntermediateSteps?{...r,intermediateSteps:n,...a}:(await(t?.handleAgentEnd(e)),{...r,...a})};for(;this.shouldContinue(a);){const s=await this.agent.plan(n,e,t?.getChild());if("returnValues"in s)return i(s);let o;o=Array.isArray(s)?s:[s];const l=await Promise.all(o.map((async e=>{await(t?.handleAgentAction(e));const n=r[e.tool?.toLowerCase()];return{action:e,observation:n?await n.call(e.toolInput,t?.getChild()):`${e.tool} is not a valid tool, try another one.`}})));n.push(...l);const c=n[n.length-1],u=r[c.action.tool?.toLowerCase()];if(u?.returnDirect)return i({returnValues:{[this.agent.returnValues[0]]:c.observation},log:""});a+=1}return i(await this.agent.returnStoppedResponse(this.earlyStoppingMethod,n,e))}_chainType(){return"agent_executor"}serialize(){throw new Error("Cannot serialize an AgentExecutor")}}t.AgentExecutor=a},7261:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeHelper=void 0;const n=r(6448);t.deserializeHelper=async(e,t,r,a,i)=>{if(r.load_from_llm_and_tools){if(!e)throw new Error("Loading from llm and tools, llm must be provided.");if(!t)throw new Error("Loading from llm and tools, tools must be provided.");return a(e,t,r)}if(!r.llm_chain)throw new Error("Loading from constructor, llm_chain must be provided.");const s=await n.LLMChain.deserialize(r.llm_chain);return i({...r,llmChain:s})}},4056:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIAgent=t.StructuredChatOutputParserWithRetries=t.StructuredChatOutputParser=t.StructuredChatAgent=t.AgentActionOutputParser=t.ZeroShotAgentOutputParser=t.ZeroShotAgent=t.initializeAgentExecutorWithOptions=t.initializeAgentExecutor=t.AgentExecutor=t.ChatConversationalAgentOutputParserWithRetries=t.ChatConversationalAgentOutputParser=t.ChatConversationalAgent=t.ChatAgentOutputParser=t.ChatAgent=t.Toolkit=t.createVectorStoreRouterAgent=t.createVectorStoreAgent=t.createOpenApiAgent=t.createJsonAgent=t.ZapierToolKit=t.VectorStoreToolkit=t.VectorStoreRouterToolkit=t.RequestsToolkit=t.OpenApiToolkit=t.JsonToolkit=t.LLMSingleActionAgent=t.BaseSingleActionAgent=t.Agent=void 0;var n=r(2128);Object.defineProperty(t,"Agent",{enumerable:!0,get:function(){return n.Agent}}),Object.defineProperty(t,"BaseSingleActionAgent",{enumerable:!0,get:function(){return n.BaseSingleActionAgent}}),Object.defineProperty(t,"LLMSingleActionAgent",{enumerable:!0,get:function(){return n.LLMSingleActionAgent}});var a=r(8042);Object.defineProperty(t,"JsonToolkit",{enumerable:!0,get:function(){return a.JsonToolkit}}),Object.defineProperty(t,"OpenApiToolkit",{enumerable:!0,get:function(){return a.OpenApiToolkit}}),Object.defineProperty(t,"RequestsToolkit",{enumerable:!0,get:function(){return a.RequestsToolkit}}),Object.defineProperty(t,"VectorStoreRouterToolkit",{enumerable:!0,get:function(){return a.VectorStoreRouterToolkit}}),Object.defineProperty(t,"VectorStoreToolkit",{enumerable:!0,get:function(){return a.VectorStoreToolkit}}),Object.defineProperty(t,"ZapierToolKit",{enumerable:!0,get:function(){return a.ZapierToolKit}}),Object.defineProperty(t,"createJsonAgent",{enumerable:!0,get:function(){return a.createJsonAgent}}),Object.defineProperty(t,"createOpenApiAgent",{enumerable:!0,get:function(){return a.createOpenApiAgent}}),Object.defineProperty(t,"createVectorStoreAgent",{enumerable:!0,get:function(){return a.createVectorStoreAgent}}),Object.defineProperty(t,"createVectorStoreRouterAgent",{enumerable:!0,get:function(){return a.createVectorStoreRouterAgent}});var i=r(6657);Object.defineProperty(t,"Toolkit",{enumerable:!0,get:function(){return i.Toolkit}});var s=r(715);Object.defineProperty(t,"ChatAgent",{enumerable:!0,get:function(){return s.ChatAgent}});var o=r(7525);Object.defineProperty(t,"ChatAgentOutputParser",{enumerable:!0,get:function(){return o.ChatAgentOutputParser}});var l=r(140);Object.defineProperty(t,"ChatConversationalAgent",{enumerable:!0,get:function(){return l.ChatConversationalAgent}});var c=r(1385);Object.defineProperty(t,"ChatConversationalAgentOutputParser",{enumerable:!0,get:function(){return c.ChatConversationalAgentOutputParser}}),Object.defineProperty(t,"ChatConversationalAgentOutputParserWithRetries",{enumerable:!0,get:function(){return c.ChatConversationalAgentOutputParserWithRetries}});var u=r(3314);Object.defineProperty(t,"AgentExecutor",{enumerable:!0,get:function(){return u.AgentExecutor}});var d=r(7135);Object.defineProperty(t,"initializeAgentExecutor",{enumerable:!0,get:function(){return d.initializeAgentExecutor}}),Object.defineProperty(t,"initializeAgentExecutorWithOptions",{enumerable:!0,get:function(){return d.initializeAgentExecutorWithOptions}});var p=r(1950);Object.defineProperty(t,"ZeroShotAgent",{enumerable:!0,get:function(){return p.ZeroShotAgent}});var h=r(7717);Object.defineProperty(t,"ZeroShotAgentOutputParser",{enumerable:!0,get:function(){return h.ZeroShotAgentOutputParser}});var m=r(4214);Object.defineProperty(t,"AgentActionOutputParser",{enumerable:!0,get:function(){return m.AgentActionOutputParser}});var f=r(57);Object.defineProperty(t,"StructuredChatAgent",{enumerable:!0,get:function(){return f.StructuredChatAgent}});var g=r(8095);Object.defineProperty(t,"StructuredChatOutputParser",{enumerable:!0,get:function(){return g.StructuredChatOutputParser}}),Object.defineProperty(t,"StructuredChatOutputParserWithRetries",{enumerable:!0,get:function(){return g.StructuredChatOutputParserWithRetries}});var b=r(7024);Object.defineProperty(t,"OpenAIAgent",{enumerable:!0,get:function(){return b.OpenAIAgent}})},7135:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeAgentExecutorWithOptions=t.initializeAgentExecutor=void 0;const n=r(6291),a=r(715),i=r(140),s=r(57),o=r(3314),l=r(1950),c=r(7024);t.initializeAgentExecutor=async(e,t,r,n,s)=>{const c=n,u=s;switch(r??"zero-shot-react-description"){case"zero-shot-react-description":return o.AgentExecutor.fromAgentAndTools({agent:l.ZeroShotAgent.fromLLMAndTools(t,e),tools:e,returnIntermediateSteps:!0,verbose:c,callbackManager:u});case"chat-zero-shot-react-description":return o.AgentExecutor.fromAgentAndTools({agent:a.ChatAgent.fromLLMAndTools(t,e),tools:e,returnIntermediateSteps:!0,verbose:c,callbackManager:u});case"chat-conversational-react-description":return o.AgentExecutor.fromAgentAndTools({agent:i.ChatConversationalAgent.fromLLMAndTools(t,e),tools:e,verbose:c,callbackManager:u});default:throw new Error("Unknown agent type")}},t.initializeAgentExecutorWithOptions=async function(e,t,r={agentType:"base_chat_model"===t._modelType()?"chat-zero-shot-react-description":"zero-shot-react-description"}){switch(r.agentType){case"zero-shot-react-description":{const{agentArgs:n,tags:a,...i}=r;return o.AgentExecutor.fromAgentAndTools({tags:[...a??[],"zero-shot-react-description"],agent:l.ZeroShotAgent.fromLLMAndTools(t,e,n),tools:e,...i})}case"chat-zero-shot-react-description":{const{agentArgs:n,tags:i,...s}=r;return o.AgentExecutor.fromAgentAndTools({tags:[...i??[],"chat-zero-shot-react-description"],agent:a.ChatAgent.fromLLMAndTools(t,e,n),tools:e,...s})}case"chat-conversational-react-description":{const{agentArgs:a,memory:s,tags:l,...c}=r;return o.AgentExecutor.fromAgentAndTools({tags:[...l??[],"chat-conversational-react-description"],agent:i.ChatConversationalAgent.fromLLMAndTools(t,e,a),tools:e,memory:s??new n.BufferMemory({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...c})}case"structured-chat-zero-shot-react-description":{const{agentArgs:n,memory:a,tags:i,...l}=r;return o.AgentExecutor.fromAgentAndTools({tags:[...i??[],"structured-chat-zero-shot-react-description"],agent:s.StructuredChatAgent.fromLLMAndTools(t,e,n),tools:e,memory:a,...l})}case"openai-functions":{const{agentArgs:a,memory:i,tags:s,...l}=r;return o.AgentExecutor.fromAgentAndTools({tags:[...s??[],"openai-functions"],agent:c.OpenAIAgent.fromLLMAndTools(t,e,a),tools:e,memory:i??new n.BufferMemory({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...l})}default:throw new Error("Unknown agent type")}}},1950:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZeroShotAgent=void 0;const n=r(6448),a=r(4567),i=r(2888),s=r(2128),o=r(7261),l=r(7717),c=r(7901);class u extends s.Agent{constructor(e){const t=e?.outputParser??u.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(e){return new l.ZeroShotAgentOutputParser(e)}static validateTools(e){const t=e.find((e=>!e.description));if(t){const e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw new Error(e)}}static createPrompt(e,t){const{prefix:r=c.PREFIX,suffix:n=c.SUFFIX,inputVariables:s=["input","agent_scratchpad"]}=t??{},o=e.map((e=>`${e.name}: ${e.description}`)).join("\n"),l=e.map((e=>e.name)),u=[r,o,(0,i.renderTemplate)(c.FORMAT_INSTRUCTIONS,"f-string",{tool_names:l}),n].join("\n\n");return new a.PromptTemplate({template:u,inputVariables:s})}static fromLLMAndTools(e,t,r){u.validateTools(t);const a=u.createPrompt(t,r),i=r?.outputParser??u.getDefaultOutputParser(),s=new n.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks??r?.callbackManager});return new u({llmChain:s,allowedTools:t.map((e=>e.name)),outputParser:i})}static async deserialize(e){const{llm:t,tools:r,...n}=e;return(0,o.deserializeHelper)(t,r,n,((e,t,r)=>u.fromLLMAndTools(e,t,{prefix:r.prefix,suffix:r.suffix,inputVariables:r.input_variables})),(e=>new u(e)))}}t.ZeroShotAgent=u},7717:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZeroShotAgentOutputParser=t.FINAL_ANSWER_ACTION=void 0;const n=r(4214),a=r(7901);t.FINAL_ANSWER_ACTION="Final Answer:";class i extends n.AgentActionOutputParser{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=e?.finishToolName||t.FINAL_ANSWER_ACTION}async parse(e){if(e.includes(this.finishToolName)){const t=e.split(this.finishToolName);return{returnValues:{output:t[t.length-1].trim()},log:e}}const t=/Action: ([\s\S]*?)(?:\nAction Input: ([\s\S]*?))?$/.exec(e);if(!t)throw new Error(`Could not parse LLM output: ${e}`);return{tool:t[1].trim(),toolInput:t[2]?t[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:e}}getFormatInstructions(){return a.FORMAT_INSTRUCTIONS}}t.ZeroShotAgentOutputParser=i},7901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUFFIX=t.FORMAT_INSTRUCTIONS=t.PREFIX=void 0,t.PREFIX="Answer the following questions as best you can. You have access to the following tools:",t.FORMAT_INSTRUCTIONS="Use the following format in your response:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question",t.SUFFIX="Begin!\n\nQuestion: {input}\nThought:{agent_scratchpad}"},7024:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIAgent=t._formatIntermediateSteps=void 0;const n=r(4235),a=r(2128),i=r(3680),s=r(9244),o=r(6448),l=r(8711);function c(e){return e.flatMap((({action:e,observation:t})=>function(e,t){return function(e){return void 0!==e.messageLog}(e)&&void 0!==e.messageLog?e.messageLog?.concat(new n.FunctionMessage(t,e.tool)):[new n.AIMessage(e.log)]}(e,t)))}t._formatIntermediateSteps=c;class u extends a.Agent{_agentType(){return"openai-functions"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}constructor(e){super({...e,outputParser:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=e.tools}static createPrompt(e,t){const{prefix:r=i.PREFIX}=t||{};return s.ChatPromptTemplate.fromPromptMessages([s.SystemMessagePromptTemplate.fromTemplate(r),new s.MessagesPlaceholder("chat_history"),s.HumanMessagePromptTemplate.fromTemplate("{input}"),new s.MessagesPlaceholder("agent_scratchpad")])}static fromLLMAndTools(e,t,r){if(u.validateTools(t),"base_chat_model"!==e._modelType()||"openai"!==e._llmType())throw new Error("OpenAIAgent requires an OpenAI chat model");const n=u.createPrompt(t,r),a=new o.LLMChain({prompt:n,llm:e,callbacks:r?.callbacks});return new u({llmChain:a,allowedTools:t.map((e=>e.name)),tools:t})}async constructScratchPad(e){return c(e)}async plan(e,t,r){const n=await this.constructScratchPad(e),a={...t,agent_scratchpad:n};0!==this._stop().length&&(a.stop=this._stop());const i=this.llmChain.llm,s={...a},o={tools:this.tools};for(const e of this.llmChain.llm.callKeys)e in t&&(o[e]=t[e],delete s[e]);const c=await this.llmChain.prompt.formatPromptValue(s);return function(e){if(!e.additional_kwargs.function_call)return{returnValues:{output:e.content},log:e.content};{const t=e.additional_kwargs.function_call;try{const r=t.arguments?JSON.parse(t.arguments):{};return{tool:t.name,toolInput:r,log:`Invoking "${t.name}" with ${t.arguments??"{}"}\n${e.content}`,messageLog:[e]}}catch(e){throw new l.OutputParserException(`Failed to parse function arguments from chat model response. Text: "${t.arguments}". ${e}`)}}}(await i.predictMessages(c.toChatMessages(),o,r))}}t.OpenAIAgent=u},3680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUFFIX=t.PREFIX=void 0,t.PREFIX="You are a helpful AI assistant.",t.SUFFIX=""},57:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StructuredChatAgent=void 0;const n=r(8841),a=r(6448),i=r(4567),s=r(9244),o=r(2128),l=r(8095),c=r(1417);class u extends o.Agent{constructor(e){const t=e?.outputParser??u.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]})}_agentType(){return"structured-chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const t=e.find((e=>!e.description));if(t){const e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw new Error(e)}}static getDefaultOutputParser(e){return e?.llm?l.StructuredChatOutputParserWithRetries.fromLLM(e.llm,{toolNames:e.toolNames}):new l.StructuredChatOutputParserWithRetries({toolNames:e?.toolNames})}async constructScratchPad(e){const t=await super.constructScratchPad(e);return t?`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):\n${t}`:t}static createToolSchemasString(e){return e.map((e=>`${e.name}: ${e.description}, args: ${JSON.stringify((0,n.zodToJsonSchema)(e.schema).properties)}`)).join("\n")}static createPrompt(e,t){const{prefix:r=c.PREFIX,suffix:n=c.SUFFIX,inputVariables:a=["input","agent_scratchpad"],memoryPrompts:o=[]}=t??{},l=[r,c.FORMAT_INSTRUCTIONS,n].join("\n\n"),d=[new s.SystemMessagePromptTemplate(new i.PromptTemplate({template:l,inputVariables:a,partialVariables:{tool_schemas:u.createToolSchemasString(e),tool_names:e.map((e=>e.name)).join(", ")}})),...o,new s.HumanMessagePromptTemplate(new i.PromptTemplate({template:"{input}\n\n{agent_scratchpad}",inputVariables:a}))];return s.ChatPromptTemplate.fromPromptMessages(d)}static fromLLMAndTools(e,t,r){u.validateTools(t);const n=u.createPrompt(t,r),i=r?.outputParser??u.getDefaultOutputParser({llm:e,toolNames:t.map((e=>e.name))}),s=new a.LLMChain({prompt:n,llm:e,callbacks:r?.callbacks});return new u({llmChain:s,outputParser:i,allowedTools:t.map((e=>e.name))})}}t.StructuredChatAgent=u},8095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StructuredChatOutputParserWithRetries=t.StructuredChatOutputParser=void 0;const n=r(4214),a=r(1417),i=r(7546),s=r(8711),o=r(9734);class l extends n.AgentActionOutputParser{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){try{const t=/```(?:json)?(.*)(```)/gs.exec(e);if(null===t)throw new s.OutputParserException('Could not parse an action. The agent action must be within a markdown code block, and "action" must be a provided tool or "Final Answer"');const r=JSON.parse(t[1].trim()),{action:n,action_input:a}=r;return"Final Answer"===n?{returnValues:{output:a},log:e}:{tool:n,toolInput:a||{},log:e}}catch(t){throw new s.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`)}}getFormatInstructions(){return(0,o.renderTemplate)(a.AGENT_ACTION_FORMAT_INSTRUCTIONS,"f-string",{tool_names:this.toolNames.join(", ")})}}t.StructuredChatOutputParser=l;class c extends n.AgentActionOutputParser{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=e?.baseParser??new l({toolNames:this.toolNames}),this.outputFixingParser=e?.outputFixingParser}async parse(e,t){return void 0!==this.outputFixingParser?this.outputFixingParser.parse(e,t):this.baseParser.parse(e)}getFormatInstructions(){return(0,o.renderTemplate)(a.FORMAT_INSTRUCTIONS,"f-string",{tool_names:this.toolNames.join(", ")})}static fromLLM(e,t){const r=t.baseParser??new l({toolNames:t.toolNames??[]}),n=i.OutputFixingParser.fromLLM(e,r);return new c({baseParser:r,outputFixingParser:n,toolNames:t.toolNames})}}t.StructuredChatOutputParserWithRetries=c},1417:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUFFIX=t.FORMAT_INSTRUCTIONS=t.AGENT_ACTION_FORMAT_INSTRUCTIONS=t.PREFIX=void 0,t.PREFIX="Answer the following questions truthfully and as best you can.",t.AGENT_ACTION_FORMAT_INSTRUCTIONS='Output a JSON markdown code snippet containing a valid JSON blob (denoted below by $JSON_BLOB).\nThis $JSON_BLOB must have a "action" key (with the name of the tool to use) and an "action_input" key (tool input).\n\nValid "action" values: "Final Answer" (which you must use when giving your final response to the user), or one of [{tool_names}].\n\nThe $JSON_BLOB must be valid, parseable JSON and only contain a SINGLE action. Here is an example of an acceptable output:\n\n```json\n{{\n  "action": $TOOL_NAME,\n  "action_input": $INPUT\n}}\n```\n\nRemember to include the surrounding markdown code snippet delimiters (begin with "```" json and close with "```")!\n',t.FORMAT_INSTRUCTIONS=`You have access to the following tools.\nYou must format your inputs to these tools to match their "JSON schema" definitions below.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nHere are the JSON Schema instances for the tools you have access to:\n\n{tool_schemas}\n\nThe way you use the tools is as follows:\n\n------------------------\n\n${t.AGENT_ACTION_FORMAT_INSTRUCTIONS}\n\nIf you are using a tool, "action_input" must adhere to the tool's input schema, given above.\n\n------------------------\n\nALWAYS use the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction:\n\`\`\`json\n$JSON_BLOB\n\`\`\`\nObservation: the result of the action\n... (this Thought/Action/Observation can repeat N times)\nThought: I now know the final answer\nAction:\n\`\`\`json\n{{\n  "action": "Final Answer",\n  "action_input": "Final response to human"\n}}\n\`\`\``,t.SUFFIX="Begin! Reminder to ALWAYS use the above format, and to use tools if appropriate."},6657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Toolkit=void 0,t.Toolkit=class{}},4907:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createConversationalRetrievalAgent=void 0;const n=r(1955),a=r(7135),i=r(4138);t.createConversationalRetrievalAgent=async function(e,t,r){const{rememberIntermediateSteps:s=!0,memoryKey:o="chat_history",outputKey:l="output",prefix:c,verbose:u}=r??{};let d;return d=s?new i.OpenAIAgentTokenBufferMemory({memoryKey:o,llm:e,outputKey:l}):new n.ConversationSummaryBufferMemory({memoryKey:o,llm:e,maxTokenLimit:12e3,returnMessages:!0,outputKey:l}),await(0,a.initializeAgentExecutorWithOptions)(t,e,{agentType:"openai-functions",memory:d,verbose:u,returnIntermediateSteps:s,agentArgs:{prefix:c??"Do your best to answer the questions. Feel free to use any tools available to look up relevant information, only if necessary."}})}},4138:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIAgentTokenBufferMemory=void 0;const n=r(9292),a=r(9741),i=r(7024);class s extends a.BaseChatMemory{constructor(e){super(e),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:12e3}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"intermediateStepsKey",{enumerable:!0,configurable:!0,writable:!0,value:"intermediateSteps"}),this.humanPrefix=e.humanPrefix??this.humanPrefix,this.aiPrefix=e.aiPrefix??this.aiPrefix,this.llm=e.llm,this.memoryKey=e.memoryKey??this.memoryKey,this.maxTokenLimit=e.maxTokenLimit??this.maxTokenLimit,this.returnMessages=e.returnMessages??this.returnMessages,this.outputKey=e.outputKey??this.outputKey,this.intermediateStepsKey=e.intermediateStepsKey??this.intermediateStepsKey}get memoryKeys(){return[this.memoryKey]}async getMessages(){return this.chatHistory.getMessages()}async loadMemoryVariables(e){const t=await this.getMessages();if(this.returnMessages)return{[this.memoryKey]:t};{const e=(0,n.getBufferString)(t,this.humanPrefix,this.aiPrefix);return{[this.memoryKey]:e}}}async saveContext(e,t){const r=(0,n.getInputValue)(e,this.inputKey),a=(0,n.getOutputValue)(t,this.outputKey);await this.chatHistory.addUserMessage(r);const s=(0,i._formatIntermediateSteps)(t[this.intermediateStepsKey]);for(const e of s)await this.chatHistory.addMessage(e);await this.chatHistory.addAIChatMessage(a);const o=await this.chatHistory.getMessages();let l=await this.llm.getNumTokensFromMessages(o);if(l.totalCount>this.maxTokenLimit){const e=[];for(;l.totalCount>this.maxTokenLimit;){const t=o.pop();if(!t){console.warn(`Could not prune enough messages from chat history to stay under ${this.maxTokenLimit} tokens.`);break}e.push(t),l=await this.llm.getNumTokensFromMessages(o)}await this.chatHistory.clear();for(const t of e)await this.chatHistory.addMessage(t)}}}t.OpenAIAgentTokenBufferMemory=s},1398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRetrieverTool=void 0;const n=r(3654);t.createRetrieverTool=function(e,t){return new n.DynamicTool({...t,func:async(t,r)=>(await e.getRelevantDocuments(t,r?.getChild("retriever"))).map((e=>e.pageContent)).join("\n")})}},8042:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIAgentTokenBufferMemory=t.createConversationalRetrievalAgent=t.createRetrieverTool=t.ZapierToolKit=t.createVectorStoreRouterAgent=t.createVectorStoreAgent=t.VectorStoreRouterToolkit=t.VectorStoreToolkit=t.createOpenApiAgent=t.OpenApiToolkit=t.RequestsToolkit=t.createJsonAgent=t.JsonToolkit=void 0;var n=r(9090);Object.defineProperty(t,"JsonToolkit",{enumerable:!0,get:function(){return n.JsonToolkit}}),Object.defineProperty(t,"createJsonAgent",{enumerable:!0,get:function(){return n.createJsonAgent}});var a=r(6477);Object.defineProperty(t,"RequestsToolkit",{enumerable:!0,get:function(){return a.RequestsToolkit}}),Object.defineProperty(t,"OpenApiToolkit",{enumerable:!0,get:function(){return a.OpenApiToolkit}}),Object.defineProperty(t,"createOpenApiAgent",{enumerable:!0,get:function(){return a.createOpenApiAgent}});var i=r(43);Object.defineProperty(t,"VectorStoreToolkit",{enumerable:!0,get:function(){return i.VectorStoreToolkit}}),Object.defineProperty(t,"VectorStoreRouterToolkit",{enumerable:!0,get:function(){return i.VectorStoreRouterToolkit}}),Object.defineProperty(t,"createVectorStoreAgent",{enumerable:!0,get:function(){return i.createVectorStoreAgent}}),Object.defineProperty(t,"createVectorStoreRouterAgent",{enumerable:!0,get:function(){return i.createVectorStoreRouterAgent}});var s=r(8100);Object.defineProperty(t,"ZapierToolKit",{enumerable:!0,get:function(){return s.ZapierToolKit}});var o=r(1398);Object.defineProperty(t,"createRetrieverTool",{enumerable:!0,get:function(){return o.createRetrieverTool}});var l=r(4907);Object.defineProperty(t,"createConversationalRetrievalAgent",{enumerable:!0,get:function(){return l.createConversationalRetrievalAgent}});var c=r(4138);Object.defineProperty(t,"OpenAIAgentTokenBufferMemory",{enumerable:!0,get:function(){return c.OpenAIAgentTokenBufferMemory}})},9090:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJsonAgent=t.JsonToolkit=void 0;const n=r(2835),a=r(2870),i=r(6448),s=r(1950),o=r(6657),l=r(3314);class c extends o.Toolkit{constructor(e){super(),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=[new n.JsonListKeysTool(e),new n.JsonGetValueTool(e)]}}t.JsonToolkit=c,t.createJsonAgent=function(e,t,r){const{prefix:n=a.JSON_PREFIX,suffix:o=a.JSON_SUFFIX,inputVariables:c=["input","agent_scratchpad"]}=r??{},{tools:u}=t,d=s.ZeroShotAgent.createPrompt(u,{prefix:n,suffix:o,inputVariables:c}),p=new i.LLMChain({prompt:d,llm:e}),h=new s.ZeroShotAgent({llmChain:p,allowedTools:u.map((e=>e.name))});return l.AgentExecutor.fromAgentAndTools({agent:h,tools:u,returnIntermediateSteps:!0})}},2870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSON_SUFFIX=t.JSON_PREFIX=void 0,t.JSON_PREFIX="You are an agent designed to interact with JSON.\nYour goal is to return a final answer by interacting with the JSON.\nYou have access to the following tools which help you learn more about the JSON you are interacting with.\nOnly use the below tools. Only use the information returned by the below tools to construct your final answer.\nDo not make up any information that is not contained in the JSON.\nYour input to the tools should be in the form of in json pointer syntax (e.g. /key1/0/key2).\nYou must escape a slash in a key with a ~1, and escape a tilde with a ~0.\nFor example, to access the key /foo, you would use /~1foo\nYou should only use keys that you know for a fact exist. You must validate that a key exists by seeing it previously when calling 'json_list_keys'.\nIf you have not seen a key in one of those responses, you cannot use it.\nYou should only add one key at a time to the path. You cannot add multiple keys at once.\nIf you encounter a null or undefined value, go back to the previous key, look at the available keys, and try again.\n\nIf the question does not seem to be related to the JSON, just return \"I don't know\" as the answer.\nAlways begin your interaction with the 'json_list_keys' with an empty string as the input to see what keys exist in the JSON.\n\nNote that sometimes the value at a given path is large. In this case, you will get an error \"Value is a large dictionary, should explore its keys directly\".\nIn this case, you should ALWAYS follow up by using the 'json_list_keys' tool to see what keys exist at that path.\nDo not simply refer the user to the JSON or a section of the JSON, as this is not a valid answer. Keep digging until you find the answer and explicitly return it.",t.JSON_SUFFIX="Begin!\"\n\nQuestion: {input}\nThought: I should look at the keys that exist to see what I can query. I should use the 'json_list_keys' tool with an empty string as the input.\n{agent_scratchpad}"},6477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOpenApiAgent=t.OpenApiToolkit=t.RequestsToolkit=void 0;const n=r(3654),a=r(3314),i=r(4116),s=r(6448),o=r(1950),l=r(6657),c=r(7636),u=r(9090);class d extends l.Toolkit{constructor(e){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=[new c.RequestsGetTool(e),new c.RequestsPostTool(e)]}}t.RequestsToolkit=d,t.OpenApiToolkit=class extends d{constructor(e,t,r){super(r);const a=(0,u.createJsonAgent)(t,new u.JsonToolkit(e));this.tools=[...this.tools,new n.DynamicTool({name:"json_explorer",func:async e=>(await a.call({input:e})).output,description:i.JSON_EXPLORER_DESCRIPTION})]}},t.createOpenApiAgent=function(e,t,r){const{prefix:n=i.OPENAPI_PREFIX,suffix:l=i.OPENAPI_SUFFIX,inputVariables:c=["input","agent_scratchpad"]}=r??{},{tools:u}=t,d=o.ZeroShotAgent.createPrompt(u,{prefix:n,suffix:l,inputVariables:c}),p=new s.LLMChain({prompt:d,llm:e}),h=u.map((e=>e.name)),m=new o.ZeroShotAgent({llmChain:p,allowedTools:h});return a.AgentExecutor.fromAgentAndTools({agent:m,tools:u,returnIntermediateSteps:!0})}},4116:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSON_EXPLORER_DESCRIPTION=t.OPENAPI_SUFFIX=t.OPENAPI_PREFIX=void 0,t.OPENAPI_PREFIX="You are an agent designed to answer questions by making web requests to an API given the OpenAPI spec.\n\nIf the question does not seem related to the API, return I don't know. Do not make up an answer.\nOnly use information provided by the tools to construct your response.\n\nTo find information in the OpenAPI spec, use the 'json_explorer' tool. The input to this tool is a question about the API.\n\nTake the following steps:\nFirst, find the base URL needed to make the request.\n\nSecond, find the relevant paths needed to answer the question. Take note that, sometimes, you might need to make more than one request to more than one path to answer the question.\n\nThird, find the required parameters needed to make the request. For GET requests, these are usually URL parameters and for POST requests, these are request body parameters.\n\nFourth, make the requests needed to answer the question. Ensure that you are sending the correct parameters to the request by checking which parameters are required. For parameters with a fixed set of values, please use the spec to look at which values are allowed.\n\nUse the exact parameter names as listed in the spec, do not make up any names or abbreviate the names of parameters.\nIf you get a not found error, ensure that you are using a path that actually exists in the spec.",t.OPENAPI_SUFFIX='Begin!"\n\nQuestion: {input}\nThought: I should explore the spec to find the base url for the API.\n{agent_scratchpad}',t.JSON_EXPLORER_DESCRIPTION="\nCan be used to answer questions about the openapi spec for the API. Always use this tool before trying to make a request. \nExample inputs to this tool: \n    'What are the required query parameters for a GET request to the /bar endpoint?'\n    'What are the required parameters in the request body for a POST request to the /foo endpoint?'\nAlways give this tool a specific question."},6504:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VECTOR_ROUTER_PREFIX=t.VECTOR_PREFIX=void 0,t.VECTOR_PREFIX='You are an agent designed to answer questions about sets of documents.\nYou have access to tools for interacting with the documents, and the inputs to the tools are questions.\nSometimes, you will be asked to provide sources for your questions, in which case you should use the appropriate tool to do so.\nIf the question does not seem relevant to any of the tools provided, just return "I don\'t know" as the answer.',t.VECTOR_ROUTER_PREFIX="You are an agent designed to answer questions.\nYou have access to tools for interacting with different sources, and the inputs to the tools are questions.\nYour main task is to decide which of the tools is relevant for answering question at hand.\nFor complex questions, you can break the question down into sub questions and use tools to answers the sub questions."},43:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVectorStoreRouterAgent=t.createVectorStoreAgent=t.VectorStoreRouterToolkit=t.VectorStoreToolkit=void 0;const n=r(7696),a=r(6657),i=r(1950),s=r(6504),o=r(7901),l=r(6448),c=r(3314);class u extends a.Toolkit{constructor(e,t){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=n.VectorStoreQATool.getDescription(e.name,e.description);this.llm=t,this.tools=[new n.VectorStoreQATool(e.name,r,{vectorStore:e.vectorStore,llm:this.llm})]}}t.VectorStoreToolkit=u;class d extends a.Toolkit{constructor(e,t){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vectorStoreInfos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=t,this.vectorStoreInfos=e,this.tools=e.map((e=>{const t=n.VectorStoreQATool.getDescription(e.name,e.description);return new n.VectorStoreQATool(e.name,t,{vectorStore:e.vectorStore,llm:this.llm})}))}}t.VectorStoreRouterToolkit=d,t.createVectorStoreAgent=function(e,t,r){const{prefix:n=s.VECTOR_PREFIX,suffix:a=o.SUFFIX,inputVariables:u=["input","agent_scratchpad"]}=r??{},{tools:d}=t,p=i.ZeroShotAgent.createPrompt(d,{prefix:n,suffix:a,inputVariables:u}),h=new l.LLMChain({prompt:p,llm:e}),m=new i.ZeroShotAgent({llmChain:h,allowedTools:d.map((e=>e.name))});return c.AgentExecutor.fromAgentAndTools({agent:m,tools:d,returnIntermediateSteps:!0})},t.createVectorStoreRouterAgent=function(e,t,r){const{prefix:n=s.VECTOR_ROUTER_PREFIX,suffix:a=o.SUFFIX,inputVariables:u=["input","agent_scratchpad"]}=r??{},{tools:d}=t,p=i.ZeroShotAgent.createPrompt(d,{prefix:n,suffix:a,inputVariables:u}),h=new l.LLMChain({prompt:p,llm:e}),m=new i.ZeroShotAgent({llmChain:h,allowedTools:d.map((e=>e.name))});return c.AgentExecutor.fromAgentAndTools({agent:m,tools:d,returnIntermediateSteps:!0})}},8100:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZapierToolKit=void 0;const n=r(6657),a=r(2681);class i extends n.Toolkit{constructor(){super(...arguments),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:[]})}static async fromZapierNLAWrapper(e){const t=new i,r=await e.listActions();for(const n of r){const r=new a.ZapierNLARunAction(e,n.id,n.description,n.params);t.tools.push(r)}return t}}t.ZapierToolKit=i},4214:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentActionOutputParser=void 0;const n=r(8711);class a extends n.BaseOutputParser{}t.AgentActionOutputParser=a},9790:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateMaxTokens=t.getModelContextSize=t.getEmbeddingContextSize=t.getModelNameForTiktoken=void 0;const n=r(5367);t.getModelNameForTiktoken=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,t.getEmbeddingContextSize=e=>"text-embedding-ada-002"===e?8191:2046,t.getModelContextSize=e=>{switch((0,t.getModelNameForTiktoken)(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}},t.calculateMaxTokens=async({prompt:e,modelName:r})=>{let a;try{a=(await(0,n.encodingForModel)(r)).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),a=Math.ceil(e.length/4)}return(0,t.getModelContextSize)(r)-a}},8281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateMaxTokens=t.BaseLanguageModel=t.BaseLangChain=void 0;const n=r(104),a=r(9790),i=r(5367),s=r(6547),o=r(8860),l=r(9244);class c extends s.Runnable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}t.BaseLangChain=c,t.BaseLanguageModel=class extends c{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new n.AsyncCaller(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await(0,i.encodingForModel)("modelName"in this?(0,a.getModelNameForTiktoken)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return"string"==typeof e?new o.StringPromptValue(e):Array.isArray(e)?new l.ChatPromptValue(e):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:n,...a}=e;if(n&&"base_chat_model"!==n)throw new Error(`Cannot load LLM with model ${n}`);const i={openai:(await Promise.resolve().then(r.bind(r,5019))).ChatOpenAI}[t];if(void 0===i)throw new Error(`Cannot load LLM with type ${t}`);return new i(a)}};var u=r(9790);Object.defineProperty(t,"calculateMaxTokens",{enumerable:!0,get:function(){return u.calculateMaxTokens}})},7527:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCallbackHandler=void 0;const s=i(r(7429)),o=r(2053);class l{}class c extends l{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!==process.env?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return o.Serializable.prototype.toJSON.call(this)}toJSONNotImplemented(){return o.Serializable.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends c{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:s.v4()}),Object.assign(this,e)}}}}t.BaseCallbackHandler=c},2327:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleCallbackHandler=void 0;const a=n(r(4880)),i=r(1269);function s(e,t){return`${e.open}${t}${e.close}`}function o(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function l(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:c}=a.default;class u extends i.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const n=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?s(a.default.bold,n):n})).join(" > ");return s(c.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[chain/start]")} [${t}] Entering Chain run with input: ${o(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[chain/end]")} [${t}] [${l(e)}] Exiting Chain run with output: ${o(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[chain/error]")} [${t}] [${l(e)}] Chain run errored with error: ${o(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${s(c.green,"[llm/start]")} [${t}] Entering LLM run with input: ${o(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[llm/end]")} [${t}] [${l(e)}] Exiting LLM run with output: ${o(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[llm/error]")} [${t}] [${l(e)}] LLM run errored with error: ${o(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[tool/end]")} [${t}] [${l(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[tool/error]")} [${t}] [${l(e)}] Tool run errored with error: ${o(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${o(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[retriever/end]")} [${t}] [${l(e)}] Exiting Retriever run with output: ${o(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[retriever/error]")} [${t}] [${l(e)}] Retriever run errored with error: ${o(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${s(c.blue,"[agent/action]")} [${r}] Agent selected action: ${o(t.actions[t.actions.length-1],"[action]")}`)}}t.ConsoleCallbackHandler=u},6862:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTracingV2CallbackHandler=t.getTracingCallbackHandler=void 0;const n=r(5890),a=r(3868);t.getTracingCallbackHandler=async function(e){const t=new a.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t},t.getTracingV2CallbackHandler=async function(){return new n.LangChainTracer}},1269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTracer=void 0;const n=r(7527);class a extends n.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(void 0!==e.parent_run_id){const t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c=s?{...a,metadata:s}:a,u={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:{prompts:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:c??{},tags:i||[]};this._startTrace(u),await(this.onLLMStart?.(u))}async handleChatModelStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c=s?{...a,metadata:s}:a,u={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:{messages:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:c??{},tags:i||[]};this._startTrace(u),await(this.onLLMStart?.(u))}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await(this.onLLMEnd?.(r)),await this._endTrace(r)}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onLLMError?.(r)),await this._endTrace(r)}async handleChainStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:t,execution_order:o,child_execution_order:o,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(c),await(this.onChainStart?.(c))}async handleChainEnd(e,t){const r=this.runMap.get(t);if(!r)throw new Error("No chain run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await(this.onChainEnd?.(r)),await this._endTrace(r)}async handleChainError(e,t){const r=this.runMap.get(t);if(!r)throw new Error("No chain run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onChainError?.(r)),await this._endTrace(r)}async handleToolStart(e,t,r,n,a,i){const s=this._getExecutionOrder(n),o=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:{input:t},execution_order:s,child_execution_order:s,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(l),await(this.onToolStart?.(l))}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:r.end_time}),await(this.onToolEnd?.(r)),await this._endTrace(r)}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onToolError?.(r)),await this._endTrace(r)}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const n=r;n.actions=n.actions||[],n.actions.push(e),n.events.push({name:"agent_action",time:Date.now(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:Date.now(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}async handleRetrieverStart(e,t,r,n,a,i){const s=this._getExecutionOrder(n),o=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:{query:t},execution_order:s,child_execution_order:s,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(l),await(this.onRetrieverStart?.(l))}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:r.end_time}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r)}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onRetrieverError?.(r)),await this._endTrace(r)}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:Date.now(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r){const n=this.runMap.get(r);n&&"llm"===n?.run_type&&(n.events.push({name:"new_token",time:Date.now(),kwargs:{token:e,idx:t}}),await(this.onLLMNewToken?.(n)))}}t.BaseTracer=a},5890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracer=void 0;const n=r(4547),a=r(9200),i=r(1269);class s extends i.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??(0,a.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,a.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new n.Client({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,a.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}t.LangChainTracer=s},3868:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracerV1=void 0;const n=r(9292),a=r(9200),i=r(1269);class s extends i.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=(0,a.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){const t=this.session??await this.loadDefaultSession(),r=e.serialized;let a;if("llm"===e.run_type){const i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map((e=>(0,n.getBufferString)(e)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:i,response:e.outputs}}else if("chain"===e.run_type){const n=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:n.filter((e=>"llm"===e.type)),child_chain_runs:n.filter((e=>"chain"===e.type)),child_tool_runs:n.filter((e=>"tool"===e.type))}}else{if("tool"!==e.run_type)throw new Error(`Unknown run type: ${e.run_type}`);{const n=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(r),child_llm_runs:n.filter((e=>"llm"===e.type)),child_chain_runs:n.filter((e=>"chain"===e.type)),child_tool_runs:n.filter((e=>"tool"===e.type))}}}return a}async persistRun(e){let t,r;r=void 0!==e.run_type?await this.convertV2RunToRun(e):e,t="llm"===r.type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;const n=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});n.ok||console.error(`Failed to persist run: ${n.status} ${n.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const n=await t.json();return 0===n.length?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=n,this.session=r,r)}}t.LangChainTracerV1=s},6659:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.traceAsGroup=t.TraceGroup=t.CallbackManager=t.CallbackManagerForToolRun=t.CallbackManagerForChainRun=t.CallbackManagerForLLMRun=t.CallbackManagerForRetrieverRun=t.BaseCallbackManager=t.parseCallbackConfigArg=void 0;const n=r(7429),a=r(7527),i=r(2327),s=r(6862),o=r(9292),l=r(9200),c=r(5890),u=r(8715);t.parseCallbackConfigArg=function(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}};class d{setHandler(e){return this.setHandlers([e])}}t.BaseCallbackManager=d;class p{constructor(e,t,r,n,a,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class h extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForRetrieverRun=h;class m extends p{async handleLLMNewToken(e,t={prompt:0,completion:0}){await Promise.all(this.handlers.map((r=>(0,u.consumeCallback)((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForLLMRun=m;class f extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForChainRun=f;class g extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForToolRun=g;class b extends d{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map((async t=>{const r=(0,n.v4)();return await Promise.all(this.handlers.map((n=>(0,u.consumeCallback)((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new m(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r=void 0,a=void 0,i=void 0){return Promise.all(t.map((async t=>{const r=(0,n.v4)();return await Promise.all(this.handlers.map((n=>(0,u.consumeCallback)((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata));else if(n.handleLLMStart){const a=(0,o.getBufferString)(t);await(n.handleLLMStart?.(e,[a],r,this._parentRunId,i,this.tags,this.metadata))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new m(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=(0,n.v4)(),a=void 0){return await Promise.all(this.handlers.map((n=>(0,u.consumeCallback)((async()=>{if(!n.ignoreChain)try{await(n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`)}}),n.awaitHandlers)))),new f(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.v4)()){return await Promise.all(this.handlers.map((n=>(0,u.consumeCallback)((async()=>{if(!n.ignoreAgent)try{await(n.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleToolStart: ${e}`)}}),n.awaitHandlers)))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.v4)(),a=void 0){return await Promise.all(this.handlers.map((n=>(0,u.consumeCallback)((async()=>{if(!n.ignoreRetriever)try{await(n.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleRetrieverStart: ${e}`)}}),n.awaitHandlers)))),new h(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new b(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const n of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===n.name))||r.addHandler(n,t);return r}static fromHandlers(e){class t extends a.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.v4)()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,n,a,o,c){let u;(e||t)&&(Array.isArray(e)||!e?(u=new b,u.setHandlers(e?.map(y)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(y):t?.handlers,!1));const d=(0,l.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||c?.verbose,p=(0,l.getEnvironmentVariable)("LANGCHAIN_TRACING_V2")??!1,h=p||((0,l.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(d||h){if(u||(u=new b),d&&!u.handlers.some((e=>e.name===i.ConsoleCallbackHandler.prototype.name))){const e=new i.ConsoleCallbackHandler;u.addHandler(e,!0)}if(h&&!u.handlers.some((e=>"langchain_tracer"===e.name)))if(p)u.addHandler(await(0,s.getTracingV2CallbackHandler)(),!0);else{const e=(0,l.getEnvironmentVariable)("LANGCHAIN_PROJECT")&&(0,l.getEnvironmentVariable)("LANGCHAIN_SESSION");u.addHandler(await(0,s.getTracingCallbackHandler)(e),!0)}}return(r||n)&&u&&(u.addTags(r??[]),u.addTags(n??[],!1)),(a||o)&&u&&(u.addMetadata(a??{}),u.addMetadata(o??{},!1)),u}}function y(e){return"name"in e?e:a.BaseCallbackHandler.fromMethods(e)}t.CallbackManager=b;class v{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t){const r=new c.LangChainTracer(t),n=await b.configure([r]),a=await(n?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},{}));if(!a)throw new Error("Failed to create run group callback manager.");return a}async start(){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,this.options)),this.runManager.getChild()}async end(){this.runManager&&(await this.runManager.handleChainEnd({}),this.runManager=void 0)}}t.TraceGroup=v,t.traceAsGroup=async function(e,t,...r){const n=new v(e.name,e),a=await n.start();try{return await t(a,...r)}finally{await n.end()}}},8715:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.awaitAllCallbacks=t.consumeCallback=void 0;const a=n(r(5860));let i;t.consumeCallback=async function(e,t){!0===t?await e():(void 0===i&&(i=new("default"in a.default?a.default.default:a.default)({autoStart:!0,concurrency:1})),i.add(e))},t.awaitAllCallbacks=function(){return void 0!==i?i.onIdle():Promise.resolve()}},9717:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChain=void 0;const n=r(4235),a=r(6659),i=r(8281);class s extends i.BaseLangChain{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(1!==arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:r}),this.memory=e;else{const{memory:t,callbackManager:r,...n}=e;super({...n,callbacks:r??n.callbacks}),this.memory=t}}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter((e=>!this.memory?.memoryKeys.includes(e)??!0));if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const n=r.length?{[r[0]]:e}:{},a=await this.call(n,t),i=Object.keys(a);if(1===i.length)return a[i[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[e,n]of Object.entries(r))t[e]=n}return t}async call(e,t,r){const i=await this._formatValues(e),s=(0,a.parseCallbackConfigArg)(t),o=await a.CallbackManager.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),l=await(o?.handleChainStart(this.toJSON(),i));let c;try{c=await(e.signal?Promise.race([this._call(i,l),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this._call(i,l))}catch(e){throw await(l?.handleChainError(e)),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),c),await(l?.handleChainEnd(c)),Object.defineProperty(c,n.RUN_KEY,{value:l?{runId:l?.runId}:void 0,configurable:!0}),c}async apply(e,t){return Promise.all(e.map((async(e,r)=>this.call(e,t?.[r]))))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:t}=await Promise.resolve().then(r.bind(r,3995));return t.deserialize(e)}case"sequential_chain":{const{SequentialChain:t}=await Promise.resolve().then(r.bind(r,3685));return t.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:t}=await Promise.resolve().then(r.bind(r,3685));return t.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:n}=await Promise.resolve().then(r.bind(r,858));return n.deserialize(e,t)}case"api_chain":{const{APIChain:t}=await Promise.resolve().then(r.bind(r,2702));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}t.BaseChain=s},6056:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefineDocumentsChain=t.MapReduceDocumentsChain=t.StuffDocumentsChain=void 0;const n=r(9717),a=r(6448),i=r(4567);class s extends n.BaseChain{get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter((e=>e!==this.documentVariableName))}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,n=t.map((({pageContent:e})=>e)).join("\n\n");return{...r,[this.documentVariableName]:n}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t?.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new s({llmChain:await a.LLMChain.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}t.StuffDocumentsChain=s;class o extends n.BaseChain{get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...n}=e;let a=r,i=[];for(let e=0;e<this.maxIterations;e+=1){const r=a.map((e=>({[this.documentVariableName]:e.pageContent,...n})));if(0!==e||!this.ensureMapStep){const e=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:a,...n}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(e)<this.maxTokens)break}const s=await this.llmChain.apply(r,t?Array.from({length:r.length},((e,r)=>t.getChild(`map_${r+1}`))):void 0),{outputKey:o}=this.llmChain;this.returnIntermediateSteps&&(i=i.concat(s.map((e=>e[o])))),a=s.map((e=>({pageContent:e[o],metadata:{}})))}const s={[this.combineDocumentChain.inputKey]:a,...n},o=await this.combineDocumentChain.call(s,t?.getChild("combine_documents"));return this.returnIntermediateSteps?{...o,intermediateSteps:i}:o}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new o({llmChain:await a.LLMChain.deserialize(e.llm_chain),combineDocumentChain:await s.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}t.MapReduceDocumentsChain=o;class l extends n.BaseChain{get defaultDocumentPrompt(){return new i.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter((e=>e!==this.documentVariableName&&e!==this.initialResponseName))}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},n={};return this.documentPrompt.inputVariables.forEach((e=>{n[e]=r[e]})),{[this.documentVariableName]:await this.documentPrompt.format({...n}),...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},n={};this.documentPrompt.inputVariables.forEach((e=>{n[e]=r[e]}));const a={[this.documentVariableName]:await this.documentPrompt.format({...n})};return{[this.initialResponseName]:t,...a}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...n}=e,a=r,i=await this._constructInitialInputs(a[0],n);let s=await this.llmChain.predict({...i},t?.getChild("answer"));const o=[s];for(let e=1;e<a.length;e+=1){const r={...await this._constructRefineInputs(a[e],s),...n};s=await this.refineLLMChain.predict({...r},t?.getChild("refine")),o.push(s)}return{[this.outputKey]:s}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new l({llmChain:await a.LLMChain.deserialize(t),refineLLMChain:await a.LLMChain.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}t.RefineDocumentsChain=l},6448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LLMChain=void 0;const n=r(9717),a=r(8860),i=r(8281),s=r(4275);class o extends n.BaseChain{get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new s.NoOpOutputParser,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let n;return n=this.outputParser?await this.outputParser.parseResultWithPrompt(e,t,r?.getChild()):e[0].text,n}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},n={...this.llmKwargs};for(const t of this.llm.callKeys)t in e&&(n[t]=e[t],delete r[t]);const a=await this.prompt.formatPromptValue(r),{generations:i}=await this.llm.generatePrompt([a],n,t?.getChild());return{[this.outputKey]:await this._getFinalOutput(i[0],a,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new o({llm:await i.BaseLanguageModel.deserialize(t),prompt:await a.BasePromptTemplate.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}t.LLMChain=o},1297:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createExtractionChainFromZod=t.createExtractionChain=void 0;const n=r(8841),a=r(4567),i=r(777),s=r(6448);function o(e,t){const r=function(e){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:{type:"object",properties:{info:{type:"array",items:{type:e.type,properties:e.properties,required:e.required}}},required:["info"]}}]}(e),n=a.PromptTemplate.fromTemplate("Extract and save the relevant entities mentioned in the following passage together with their properties.\n\nPassage:\n{input}\n"),o=new i.JsonKeyOutputFunctionsParser({attrName:"info"});return new s.LLMChain({llm:t,prompt:n,llmKwargs:{functions:r},outputParser:o,tags:["openai_functions","extraction"]})}t.createExtractionChain=o,t.createExtractionChainFromZod=function(e,t){return o((0,n.zodToJsonSchema)(e),t)}},3357:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStructuredOutputChainFromZod=t.createStructuredOutputChain=t.createOpenAPIChain=t.createTaggingChainFromZod=t.createTaggingChain=t.createExtractionChainFromZod=t.createExtractionChain=void 0;var n=r(1297);Object.defineProperty(t,"createExtractionChain",{enumerable:!0,get:function(){return n.createExtractionChain}}),Object.defineProperty(t,"createExtractionChainFromZod",{enumerable:!0,get:function(){return n.createExtractionChainFromZod}});var a=r(3955);Object.defineProperty(t,"createTaggingChain",{enumerable:!0,get:function(){return a.createTaggingChain}}),Object.defineProperty(t,"createTaggingChainFromZod",{enumerable:!0,get:function(){return a.createTaggingChainFromZod}});var i=r(7894);Object.defineProperty(t,"createOpenAPIChain",{enumerable:!0,get:function(){return i.createOpenAPIChain}});var s=r(4737);Object.defineProperty(t,"createStructuredOutputChain",{enumerable:!0,get:function(){return s.createStructuredOutputChain}}),Object.defineProperty(t,"createStructuredOutputChainFromZod",{enumerable:!0,get:function(){return s.createStructuredOutputChainFromZod}})},7894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOpenAPIChain=void 0;const n=r(2867),a=r(9717),i=r(6448),s=r(3484),o=r(9244),l=r(4376),c=r(777);function u(e,t){return e.reduce(((e,r)=>{let n;if(r.schema)n=t.getSchema(r.schema),e.properties[r.name]=d(n,t);else{if(!r.content)return e;{const a=Object.values(r.content)[0].schema;if(a&&(n=t.getSchema(a)),!n)return e;void 0===n.description&&(n.description=r.description??""),e.properties[r.name]=d(n,t)}}return r.required&&Array.isArray(e.required)&&e.required.push(r.name),e}),{type:"object",properties:{},required:[],additionalProperties:{}})}function d(e,t){return"object"!==e.type&&"array"!==e.type?{type:e.type??"string"}:Object.keys(e.properties??{}).reduce(((r,n)=>{if(!e.properties)return r;const a=t.getSchema(e.properties[n]);return void 0===a.type||(r.properties[n]={type:a.type,description:a.description},a.required&&void 0!==r.required&&r.required.push(n)),r}),{type:"object",properties:{},required:[],additionalProperties:{}})}class p extends a.BaseChain{constructor(e){super(),Object.defineProperty(this,"requestMethod",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"function"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"response"}),this.requestMethod=e.requestMethod}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}_chainType(){return"simple_request_chain"}async _call(e,t){const r=e[this.inputKey],n=r.name,a=r.arguments,i=await this.requestMethod(n,a);return{[this.outputKey]:i}}}t.createOpenAPIChain=async function(e,t={}){let r;if("string"==typeof e)try{r=await n.OpenAPISpec.fromURL(e)}catch(t){try{r=n.OpenAPISpec.fromString(e)}catch(t){throw new Error(`Unable to parse spec from source ${e}.`)}}else r=n.OpenAPISpec.fromObject(e);const{openAIFunctions:a,defaultExecutionMethod:h}=function(e){if(!e.document.paths)return{openAIFunctions:[]};const t=[],r={};for(const a of Object.keys(e.document.paths)){const i=e.getParametersForPath(a);for(const s of e.getMethodsForPath(a)){const o=e.getOperation(a,s);if(!o)return{openAIFunctions:[]};const l=i.concat(e.getParametersForOperation(o)).reduce(((e,t)=>(e[t.in]||(e[t.in]=[]),e[t.in].push(t),e)),{}),c={query:"params",header:"headers",cookie:"cookies",path:"path_params"},p={};for(const t of Object.keys(c))l[t]&&(p[c[t]]=u(l[t],e));const h=e.getRequestBodyForOperation(o);if(void 0!==h?.content){const t={};for(const[r,n]of Object.entries(h.content))if(void 0!==n.schema){const a=e.getSchema(n.schema);t[r]=d(a,e)}const r=Object.keys(t);1===r.length?p.data=t[r[0]]:r.length>1&&(p.data={anyOf:Object.values(t)})}const m={name:n.OpenAPISpec.getCleanedOperationId(o,a,s),description:o.description??o.summary??"",parameters:{type:"object",properties:p,required:Object.keys(p)}};t.push(m);const f=(e.baseUrl??"").endsWith("/")?(e.baseUrl??"").slice(0,-1):e.baseUrl??"";r[m.name]={method:s,url:f+a}}}return{openAIFunctions:t,defaultExecutionMethod:async(e,t,n)=>{const{headers:a,params:i,...s}=n??{},{method:o,url:l}=r[e],c=t.params??{},u=Object.keys(c).reduce(((e,t)=>(""!==c[t]&&null!==c[t]&&void 0!==c[t]&&(e[t]=c[t]),e)),{}),d=new URLSearchParams({...u,...i}).toString(),p=function(e,t){const r=[...e.matchAll(/{(.*?)}/g)].map((e=>e[1])),n={};for(const e of r){const r=e.replace(/^\.;/,"").replace(/\*$/,""),a=t[r];let i;if(Array.isArray(a))if(e.startsWith(".")){const t=e.endsWith("*")?".":",";i=`.${a.join(t)}`}else if(e.startsWith(",")){const t=e.endsWith("*")?`${r}=`:",";i=`${r}=${a.join(t)}`}else i=a.join(",");else if("object"==typeof a){const t=e.endsWith("*")?"=":",",r=Object.entries(a).map((([e,r])=>e+t+r));let n;e.startsWith(".")?(n=".",i="."):e.startsWith(";")?(n=";",i=";"):(n=",",i=""),i+=r.join(n)}else i=e.startsWith(".")?`.${a}`:e.startsWith(";")?`;${r}=${a}`:a;n[e]=i}let a=e;for(const[e,t]of Object.entries(n))a=a.replace(`{${e}}`,t);return a}(l,t.path_params)+(d.length?`?${d}`:""),h={};let m;if(void 0!==t.data){let e="text/plain";"string"!=typeof t.data?("object"==typeof t.data&&(e="application/json"),m=JSON.stringify(t.data)):m=t.data,h["content-type"]=e}const f=await fetch(p,{...t,method:o,headers:{...h,...t.headers,...a},body:m,...s});let g;return g=f.status<200||f.status>299?`${f.status}: ${f.statusText} for ${e} called with ${JSON.stringify(d)}`:await f.text(),g}}}(r);if(void 0===h)throw new Error("Could not parse any valid operations from the provided spec.");const{llm:m=new s.ChatOpenAI({modelName:"gpt-3.5-turbo-0613"}),prompt:f=o.ChatPromptTemplate.fromPromptMessages([o.HumanMessagePromptTemplate.fromTemplate("Use the provided API's to respond to this user query:\n\n{query}")]),requestChain:g=new p({requestMethod:async(e,r)=>h(e,r,{headers:t.headers,params:t.params})}),llmChainInputs:b={},verbose:y,...v}=t,w=new i.LLMChain({llm:m,prompt:f,outputParser:new c.JsonOutputFunctionsParser({argsOnly:!1}),outputKey:"function",llmKwargs:{functions:a},...b});return new l.SequentialChain({chains:[w,g],outputVariables:["response"],inputVariables:w.inputKeys,verbose:y,...v})}},4737:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStructuredOutputChainFromZod=t.createStructuredOutputChain=t.FunctionCallStructuredOutputParser=void 0;const n=r(8841),a=r(2408),i=r(6448),s=r(3484),o=r(8711),l=r(777);class c extends o.BaseLLMOutputParser{constructor(e){super(),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chains","openai_functions"]}),Object.defineProperty(this,"functionOutputParser",{enumerable:!0,configurable:!0,writable:!0,value:new l.OutputFunctionsParser}),Object.defineProperty(this,"jsonSchemaValidator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.jsonSchemaValidator=new a.Validator(e,"7")}async parseResult(e){const t=await this.functionOutputParser.parseResult(e),r=JSON.parse(t,((e,t)=>{if(null!==t)return t})),n=this.jsonSchemaValidator.validate(r);if(n.valid)return r;throw new o.OutputParserException(`Failed to parse. Text: "${t}". Error: ${JSON.stringify(n.errors)}`,t)}}function u(e){const{outputSchema:t,llm:r=new s.ChatOpenAI({modelName:"gpt-3.5-turbo-0613",temperature:0}),outputKey:n="output",llmKwargs:a={},...o}=e,l="output_formatter";return new i.LLMChain({llm:r,llmKwargs:{...a,functions:[{name:l,description:"Output formatter. Should always be used to format your response to the user.",parameters:t}],function_call:{name:l}},outputKey:n,outputParser:new c(t),...o})}t.FunctionCallStructuredOutputParser=c,t.createStructuredOutputChain=u,t.createStructuredOutputChainFromZod=function(e,t){return u({...t,outputSchema:(0,n.zodToJsonSchema)(e)})}},3955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTaggingChainFromZod=t.createTaggingChain=void 0;const n=r(8841),a=r(4567),i=r(777),s=r(6448),o="Extract the desired information from the following passage.\n\nPassage:\n{input}\n";function l(e,t,r={}){const{prompt:n=a.PromptTemplate.fromTemplate(o),...l}=r,c=function(e){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:e}]}(e),u=new i.JsonOutputFunctionsParser;return new s.LLMChain({llm:t,prompt:n,llmKwargs:{functions:c},outputParser:u,tags:["openai_functions","tagging"],...l})}t.createTaggingChain=l,t.createTaggingChainFromZod=function(e,t,r){return l((0,n.zodToJsonSchema)(e),t,r)}},9645:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadQARefineChain=t.loadQAMapReduceChain=t.loadQAStuffChain=t.loadQAChain=void 0;const n=r(6448),a=r(6056),i=r(4364),s=r(1603),o=r(6623);function l(e,t={}){const{prompt:r=i.QA_PROMPT_SELECTOR.getPrompt(e),verbose:s}=t,o=new n.LLMChain({prompt:r,llm:e,verbose:s});return new a.StuffDocumentsChain({llmChain:o,verbose:s})}function c(e,t={}){const{combineMapPrompt:r=s.COMBINE_QA_PROMPT_SELECTOR.getPrompt(e),combinePrompt:i=s.COMBINE_PROMPT_SELECTOR.getPrompt(e),verbose:o,returnIntermediateSteps:l}=t,c=new n.LLMChain({prompt:r,llm:e,verbose:o}),u=new n.LLMChain({prompt:i,llm:e,verbose:o}),d=new a.StuffDocumentsChain({llmChain:u,documentVariableName:"summaries",verbose:o});return new a.MapReduceDocumentsChain({llmChain:c,combineDocumentChain:d,returnIntermediateSteps:l,verbose:o})}function u(e,t={}){const{questionPrompt:r=o.QUESTION_PROMPT_SELECTOR.getPrompt(e),refinePrompt:i=o.REFINE_PROMPT_SELECTOR.getPrompt(e),verbose:s}=t,l=new n.LLMChain({prompt:r,llm:e,verbose:s}),c=new n.LLMChain({prompt:i,llm:e,verbose:s});return new a.RefineDocumentsChain({llmChain:l,refineLLMChain:c,verbose:s})}t.loadQAChain=(e,t={type:"stuff"})=>{const{type:r}=t;if("stuff"===r)return l(e,t);if("map_reduce"===r)return c(e,t);if("refine"===r)return u(e,t);throw new Error(`Invalid _type: ${r}`)},t.loadQAStuffChain=l,t.loadQAMapReduceChain=c,t.loadQARefineChain=u},1603:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMBINE_PROMPT_SELECTOR=t.COMBINE_PROMPT=t.COMBINE_QA_PROMPT_SELECTOR=t.DEFAULT_COMBINE_QA_PROMPT=void 0;const n=r(4567),a=r(9244),i=r(1678);t.DEFAULT_COMBINE_QA_PROMPT=n.PromptTemplate.fromTemplate("Use the following portion of a long document to see if any of the text is relevant to answer the question. \nReturn any relevant text verbatim.\n{context}\nQuestion: {question}\nRelevant text, if any:");const s=[a.SystemMessagePromptTemplate.fromTemplate("Use the following portion of a long document to see if any of the text is relevant to answer the question. \nReturn any relevant text verbatim.\n----------------\n{context}"),a.HumanMessagePromptTemplate.fromTemplate("{question}")],o=a.ChatPromptTemplate.fromPromptMessages(s);t.COMBINE_QA_PROMPT_SELECTOR=new i.ConditionalPromptSelector(t.DEFAULT_COMBINE_QA_PROMPT,[[i.isChatModel,o]]),t.COMBINE_PROMPT=n.PromptTemplate.fromTemplate("Given the following extracted parts of a long document and a question, create a final answer. \nIf you don't know the answer, just say that you don't know. Don't try to make up an answer.\n\nQUESTION: Which state/country's law governs the interpretation of the contract?\n=========\nContent: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.\n\nContent: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.\n\n11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.\n\n11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.\n\n11.9 No Third-Party Beneficiaries.\n\nContent: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,\n=========\nFINAL ANSWER: This Agreement is governed by English law.\n\nQUESTION: What did the president say about Michael Jackson?\n=========\nContent: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  \n\nLast year COVID-19 kept us apart. This year we are finally together again. \n\nTonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. \n\nWith a duty to one another to the American people to the Constitution. \n\nAnd with an unwavering resolve that freedom will always triumph over tyranny. \n\nSix days ago, Russia’s Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. \n\nHe thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. \n\nHe met the Ukrainian people. \n\nFrom President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. \n\nGroups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.\n\nContent: And we won’t stop. \n\nWe have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. \n\nLet’s use this moment to reset. Let’s stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  \n\nLet’s stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  \n\nWe can’t change how divided we’ve been. But we can change how we move forward—on COVID-19 and other issues we must face together. \n\nI recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. \n\nThey were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. \n\nOfficer Mora was 27 years old. \n\nOfficer Rivera was 22. \n\nBoth Dominican Americans who’d grown up on the same streets they later chose to patrol as police officers. \n\nI spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.\n\nContent: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  \n\nTo all Americans, I will be honest with you, as I’ve always promised. A Russian dictator, invading a foreign country, has costs around the world. \n\nAnd I’m taking robust action to make sure the pain of our sanctions  is targeted at Russia’s economy. And I will use every tool at our disposal to protect American businesses and consumers. \n\nTonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  \n\nAmerica will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  \n\nThese steps will help blunt gas prices here at home. And I know the news about what’s happening can seem alarming. \n\nBut I want you to know that we are going to be okay.\n\nContent: More support for patients and families. \n\nTo get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. \n\nIt’s based on DARPA—the Defense Department project that led to the Internet, GPS, and so much more.  \n\nARPA-H will have a singular purpose—to drive breakthroughs in cancer, Alzheimer’s, diabetes, and more. \n\nA unity agenda for the nation. \n\nWe can do this. \n\nMy fellow Americans—tonight , we have gathered in a sacred space—the citadel of our democracy. \n\nIn this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. \n\nWe have fought for freedom, expanded liberty, defeated totalitarianism and terror. \n\nAnd built the strongest, freest, and most prosperous nation the world has ever known. \n\nNow is the hour. \n\nOur moment of responsibility. \n\nOur test of resolve and conscience, of history itself. \n\nIt is in this moment that our character is formed. Our purpose is found. Our future is forged. \n\nWell I know this nation.\n=========\nFINAL ANSWER: The president did not mention Michael Jackson.\n\nQUESTION: {question}\n=========\n{summaries}\n=========\nFINAL ANSWER:");const l=[a.SystemMessagePromptTemplate.fromTemplate("Given the following extracted parts of a long document and a question, create a final answer. \nIf you don't know the answer, just say that you don't know. Don't try to make up an answer.\n----------------\n{summaries}"),a.HumanMessagePromptTemplate.fromTemplate("{question}")],c=a.ChatPromptTemplate.fromPromptMessages(l);t.COMBINE_PROMPT_SELECTOR=new i.ConditionalPromptSelector(t.COMBINE_PROMPT,[[i.isChatModel,c]])},6623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUESTION_PROMPT_SELECTOR=t.CHAT_QUESTION_PROMPT=t.DEFAULT_TEXT_QA_PROMPT=t.DEFAULT_TEXT_QA_PROMPT_TMPL=t.REFINE_PROMPT_SELECTOR=t.CHAT_REFINE_PROMPT=t.DEFAULT_REFINE_PROMPT=t.DEFAULT_REFINE_PROMPT_TMPL=void 0;const n=r(9734),a=r(1678);t.DEFAULT_REFINE_PROMPT_TMPL="The original question is as follows: {question}\nWe have provided an existing answer: {existing_answer}\nWe have the opportunity to refine the existing answer\n(only if needed) with some more context below.\n------------\n{context}\n------------\nGiven the new context, refine the original answer to better answer the question. \nIf the context isn't useful, return the original answer.",t.DEFAULT_REFINE_PROMPT=new n.PromptTemplate({inputVariables:["question","existing_answer","context"],template:t.DEFAULT_REFINE_PROMPT_TMPL});const i=[n.HumanMessagePromptTemplate.fromTemplate("{question}"),n.AIMessagePromptTemplate.fromTemplate("{existing_answer}"),n.HumanMessagePromptTemplate.fromTemplate("The original question is as follows: {question}\nWe have provided an existing answer: {existing_answer}\nWe have the opportunity to refine the existing answer\n(only if needed) with some more context below.\n------------\n{context}\n------------\nGiven the new context, refine the original answer to better answer the question. \nIf the context isn't useful, return the original answer.")];t.CHAT_REFINE_PROMPT=n.ChatPromptTemplate.fromPromptMessages(i),t.REFINE_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_REFINE_PROMPT,[[a.isChatModel,t.CHAT_REFINE_PROMPT]]),t.DEFAULT_TEXT_QA_PROMPT_TMPL="Context information is below. \n---------------------\n{context}\n---------------------\nGiven the context information and not prior knowledge, answer the question: {question}",t.DEFAULT_TEXT_QA_PROMPT=new n.PromptTemplate({inputVariables:["context","question"],template:t.DEFAULT_TEXT_QA_PROMPT_TMPL});const s=[n.SystemMessagePromptTemplate.fromTemplate("Context information is below. \n---------------------\n{context}\n---------------------\nGiven the context information and not prior knowledge, answer any questions"),n.HumanMessagePromptTemplate.fromTemplate("{question}")];t.CHAT_QUESTION_PROMPT=n.ChatPromptTemplate.fromPromptMessages(s),t.QUESTION_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_TEXT_QA_PROMPT,[[a.isChatModel,t.CHAT_QUESTION_PROMPT]])},4364:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QA_PROMPT_SELECTOR=t.DEFAULT_QA_PROMPT=void 0;const n=r(4567),a=r(9244),i=r(1678);t.DEFAULT_QA_PROMPT=new n.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]});const s=[a.SystemMessagePromptTemplate.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),a.HumanMessagePromptTemplate.fromTemplate("{question}")],o=a.ChatPromptTemplate.fromPromptMessages(s);t.QA_PROMPT_SELECTOR=new i.ConditionalPromptSelector(t.DEFAULT_QA_PROMPT,[[i.isChatModel,o]])},4376:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleSequentialChain=t.SequentialChain=void 0;const n=r(9717),a=r(8114);function i(e){return Array.from(e).map((e=>`"${e}"`)).join(", ")}class s extends n.BaseChain{get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){if(0===this.chains.length)throw new Error("Sequential chain must have at least one chain.");const e=this.memory?.memoryKeys??[],t=new Set(this.inputKeys),r=new Set(e),n=(0,a.intersection)(t,r);if(n.size>0)throw new Error(`The following keys: ${i(n)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const s=(0,a.union)(t,r);for(const e of this.chains){let t=(0,a.difference)(new Set(e.inputKeys),s);if(e.memory&&(t=(0,a.difference)(t,new Set(e.memory.memoryKeys))),t.size>0)throw new Error(`Missing variables for chain "${e._chainType()}": ${i(t)}. Only got the following variables: ${i(s)}.`);const r=new Set(e.outputKeys),n=(0,a.intersection)(s,r);if(n.size>0)throw new Error(`The following output variables for chain "${e._chainType()}" are overlapping: ${i(n)}. This can lead to unexpected behaviour.`);for(const e of r)s.add(e)}if(0===this.outputVariables.length)if(this.returnAll){const e=(0,a.difference)(s,t);this.outputVariables=Array.from(e)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const e=(0,a.difference)(new Set(this.outputVariables),new Set(s));if(e.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${i(e)}.`)}}async _call(e,t){let r={};const n=e;let a=0;for(const e of this.chains){a+=1,r=await e.call(n,t?.getChild(`step_${a}`));for(const e of Object.keys(r))n[e]=r[e]}const i={};for(const e of this.outputVariables)i[e]=n[e];return i}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],r=e.input_variables,a=e.output_variables,i=e.chains;for(const e of i){const r=await n.BaseChain.deserialize(e);t.push(r)}return new s({chains:t,inputVariables:r,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}t.SequentialChain=s;class o extends n.BaseChain{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(1!==e.inputKeys.filter((t=>!e.memory?.memoryKeys.includes(t)??!0)).length)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(1!==e.outputKeys.length)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],n=0;for(const a of this.chains)n+=1,r=(await a.call({[a.inputKeys[0]]:r,signal:e.signal},t?.getChild(`step_${n}`)))[a.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await(t?.handleText(r));return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],r=e.chains;for(const e of r){const r=await n.BaseChain.deserialize(e);t.push(r)}return new o({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}t.SimpleSequentialChain=o},5664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorDBQAChain=void 0;const n=r(9717),a=r(9645);class i extends n.BaseChain{get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const r=e[this.inputKey],n=await this.vectorstore.similaritySearch(r,this.k,e.filter,t?.getChild("vectorstore")),a={question:r,input_documents:n},i=await this.combineDocumentsChain.call(a,t?.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:n}:i}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:r}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new i({combineDocumentsChain:await n.BaseChain.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){return new this({vectorstore:t,combineDocumentsChain:(0,a.loadQAStuffChain)(e),...r})}}t.VectorDBQAChain=i},1646:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleChatModel=t.BaseChatModel=t.createChatMessageChunkEncoderStream=void 0;const n=r(4235),a=r(8281),i=r(6659);t.createChatMessageChunkEncoderStream=function(){const e=new TextEncoder;return new TransformStream({transform(t,r){r.enqueue(e.encode(t.content))}})};class s extends a.BaseLanguageModel{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=s._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===s.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=s._convertInputToPromptValue(e).toChatMessages(),[n,a]=this._separateRunnableConfigFromCallOptions(t),o=await i.CallbackManager.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this?.invocationParams(a)},c=await(o?.handleChatModelStart(this.toJSON(),[r],void 0,void 0,l));let u;try{for await(const e of this._streamResponseChunks(r,a,c?.[0]))yield e.message,u=u?u.concat(e):e}catch(e){throw await Promise.all((c??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((c??[]).map((e=>e?.handleLLMEnd({generations:[[u]]}))))}}async generate(e,t,r){let a;a=Array.isArray(t)?{stop:t}:t;const[s,o]=this._separateRunnableConfigFromCallOptions(a),l=await i.CallbackManager.configure(s.callbacks??r,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this?.invocationParams(a)},u=await(l?.handleChatModelStart(this.toJSON(),e,void 0,void 0,c)),d=await Promise.allSettled(e.map(((e,t)=>this._generate(e,{...o,promptIndex:t},u?.[t])))),p=[],h=[];await Promise.all(d.map((async(e,t)=>{if("fulfilled"===e.status){const r=e.value;return p[t]=r.generations,h[t]=r.llmOutput,u?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}return await(u?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const m={generations:p,llmOutput:h.length?this._combineLLMOutput?.(...h):void 0};return Object.defineProperty(m,n.RUN_KEY,{value:u?{runIds:u?.map((e=>e.runId))}:void 0,configurable:!0}),m}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const n=e.map((e=>e.toChatMessages()));return this.generate(n,t,r)}async call(e,t,r){return(await this.generate([e],t,r)).generations[0][0].message}async callPrompt(e,t,r){const n=e.toChatMessages();return this.call(n,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const a=new n.HumanMessage(e);return(await this.call([a],t,r)).content}}t.BaseChatModel=s,t.SimpleChatModel=class extends s{async _generate(e,t,r){const a=await this._call(e,t,r),i=new n.AIMessage(a);return{generations:[{text:i.content,message:i}]}}}},3484:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromptLayerChatOpenAI=t.ChatOpenAI=void 0;const a=r(6485),i=r(9200),s=n(r(2725)),o=r(1646),l=r(4235),c=r(9790),u=r(6045),d=r(2152),p=r(5545),h=r(8065);function m(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":if(!l.ChatMessage.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function f(e){switch(e.role){case"user":return new l.HumanMessage(e.content||"");case"assistant":return new l.AIMessage(e.content||"",{function_call:e.function_call});case"system":return new l.SystemMessage(e.content||"");default:return new l.ChatMessage(e.content||"",e.role??"unknown")}}function g(e,t){const r=e.role??t,n=e.content??"";let a;return a=e.function_call?{function_call:e.function_call}:{},"user"===r?new l.HumanMessageChunk({content:n}):"assistant"===r?new l.AIMessageChunk({content:n,additional_kwargs:a}):"system"===r?new l.SystemMessageChunk({content:n}):"function"===r?new l.FunctionMessageChunk({content:n,additional_kwargs:a,name:e.name}):new l.ChatMessageChunk({content:n,role:r})}class b extends o.BaseChatModel{get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,i.getEnvironmentVariable)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,i.getEnvironmentVariable)("AZURE_OPENAI_BASE_PATH"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:this.openAIApiKey,...t,...e?.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,stream:this.streaming,functions:e?.functions??(e?.tools?e?.tools.map(d.formatToOpenAIFunction):void 0),function_call:e?.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){const n=e.map((e=>({role:m(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call}))),a={...this.invocationParams(t),messages:n,stream:!0};let i="assistant";const s=this.startStream(a,t);for await(const e of s){const t=JSON.parse(e),n=t.choices?.[0];if(!n)continue;const{delta:a}=n,s=g(a,i);i=a.role??i;const o=new l.ChatGenerationChunk({message:s,text:s.content});yield o,r?.handleLLMNewToken(o.text??"")}}startStream(e,t){let r=!1;const n=new TransformStream,a=n.writable.getWriter(),i=(0,h.readableStreamToAsyncIterable)(n.readable);let o;return this.completionWithRetry(e,{...t,adapter:s.default,responseType:"stream",onmessage:e=>{if(!r)if("[DONE]"===e.data?.trim?.())r=!0,a.close();else{const t=JSON.parse(e.data);if(t.error)throw r=!0,t.error;a.write(e.data)}}}).catch((e=>{r||(o=e,r=!0,a.close())})),{async next(){const e=await i.next();if(o)throw o;return e},[Symbol.asyncIterator](){return this}}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const n={},a=this.invocationParams(t),i=e.map((e=>({role:m(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call}))),o=a.stream?await new Promise(((e,n)=>{let o,l=!1,c=!1;this.completionWithRetry({...a,messages:i},{signal:t?.signal,...t?.options,adapter:s.default,responseType:"stream",onmessage:a=>{if("[DONE]"===a.data?.trim?.()){if(c||l)return;c=!0,e(o)}else{const i=JSON.parse(a.data);if(!i.id)return;if(i?.error){if(l)return;return l=!0,void n(i.error)}const s=i;o||(o={id:s.id,object:s.object,created:s.created,model:s.model,choices:[]});for(const e of s.choices??[])if(null!=e){let n=o.choices.find((t=>t.index===e.index));n||(n={index:e.index,finish_reason:e.finish_reason??void 0},o.choices[e.index]=n),n.message||(n.message={role:e.delta?.role,content:""}),e.delta.function_call&&!n.message.function_call&&(n.message.function_call={name:"",arguments:""}),n.message.content+=e.delta?.content??"",n.message.function_call&&(n.message.function_call.name+=e.delta?.function_call?.name??"",n.message.function_call.arguments+=e.delta?.function_call?.arguments??""),r?.handleLLMNewToken(e.delta?.content??"",{prompt:t.promptIndex??0,completion:e.index})}c||l||!s.choices?.every((e=>null!=e.finish_reason))||(c=!0,e(o))}}}).catch((e=>{l||(l=!0,n(e))}))})):await this.completionWithRetry({...a,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:l,prompt_tokens:c,total_tokens:u}=o.usage??{};l&&(n.completionTokens=(n.completionTokens??0)+l),c&&(n.promptTokens=(n.promptTokens??0)+c),u&&(n.totalTokens=(n.totalTokens??0)+u);const d=[];for(const e of o.choices){const t=e.message?.content??"";d.push({text:t,message:f(e.message??{role:"assistant"})})}return{generations:d,llmOutput:{tokenUsage:n}}}async getNumTokensFromMessages(e){let t=0,r=0,n=0;"gpt-3.5-turbo"===(0,c.getModelNameForTiktoken)(this.modelName)?(r=4,n=-1):(0,c.getModelNameForTiktoken)(this.modelName).startsWith("gpt-4")&&(r=3,n=1);const a=await Promise.all(e.map((async e=>{const a=await this.getNumTokens(e.content),i=await this.getNumTokens(m(e)),s=void 0!==e.name?n+await this.getNumTokens(e.name):0,o=a+r+i+s;return t+=o,o})));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){if(!this.client){const e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,basePath:this.clientConfig.basePath},t=(0,p.getEndpoint)(e),r=new a.Configuration({...this.clientConfig,basePath:t,baseOptions:{timeout:this.timeout,...this.clientConfig.baseOptions}});this.client=new a.OpenAIApi(r)}const r={adapter:(0,i.isNode)()?void 0:s.default,...this.clientConfig.baseOptions,...t};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.params={"api-version":this.azureOpenAIApiVersion,...r.params}),this.caller.call(this.client.createChatCompletion.bind(this.client),e,r).then((e=>e.data))}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}t.ChatOpenAI=b,t.PromptLayerChatOpenAI=class extends b{constructor(e){super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=e?.promptLayerApiKey??("undefined"!=typeof process?process.env?.PROMPTLAYER_API_KEY:void 0),this.plTags=e?.plTags??[],this.returnPromptLayerId=e?.returnPromptLayerId??!1}async _generate(e,t,r){const n=Date.now();let a;a=Array.isArray(t)?{stop:t}:t?.timeout&&!t.signal?{...t,signal:AbortSignal.timeout(t.timeout)}:t??{};const i=await super._generate(e,a,r),s=Date.now(),o=(e,t)=>{const r={...this.invocationParams(),model:this.modelName};if(t?.stop&&Object.keys(r).includes("stop"))throw new Error("`stop` found in both the input and default params.");return e.map((e=>(e=>{let t;if("human"===e._getType())t={role:"user",content:e.content};else if("ai"===e._getType())t={role:"assistant",content:e.content};else if("function"===e._getType())t={role:"assistant",content:e.content};else if("system"===e._getType())t={role:"system",content:e.content};else{if("generic"!==e._getType())throw new Error(`Got unknown type ${e}`);t={role:e.role,content:e.content}}return t})(e)))};for(let t=0;t<i.generations.length;t+=1){const r=i.generations[t],l=o(e,a);let c;const d=[{content:r.text,role:m(r.message)}],p=await(0,u.promptLayerTrackRequest)(this.caller,"langchain.PromptLayerChatOpenAI",l,this._identifyingParams(),this.plTags,d,n,s,this.promptLayerApiKey);!0===this.returnPromptLayerId&&(!0===p.success&&(c=p.request_id),r.generationInfo&&"object"==typeof r.generationInfo||(r.generationInfo={}),r.generationInfo.promptLayerRequestId=c)}return i}}},2614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Document=void 0,t.Document=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}},8051:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mapKeys=t.keyFromJson=t.keyToJson=void 0;const a=n(r(2466)),i=n(r(3204));t.keyToJson=function(e,t){return t?.[e]||(0,a.default)(e)},t.keyFromJson=function(e,t){return t?.[e]||(0,i.default)(e)},t.mapKeys=function(e,t,r){const n={};for(const a in e)Object.hasOwn(e,a)&&(n[t(a,r)]=e[a]);return n}},2053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Serializable=void 0;const n=r(8051);function a(e){return Array.isArray(e)?[...e]:{...e}}function i(e,t){const r=a(e);for(const[e,n]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let s=r;for(const e of i.reverse()){if(void 0===s[e])break;s[e]=a(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[n]})}return r}class s{get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof s||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(t,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));for(const e in t)e in this&&void 0!==this[e]&&(r[e]=this[e]||r[e]);return{lc:1,type:"constructor",id:[...this.lc_namespace,this.constructor.name],kwargs:(0,n.mapKeys)(Object.keys(t).length?i(r,t):r,n.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:[...this.lc_namespace,this.constructor.name]}}}t.Serializable=s},9292:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPromptInputKey=t.getBufferString=t.getOutputValue=t.getInputValue=t.BaseMemory=void 0,t.BaseMemory=class{};const r=(e,t)=>{if(void 0!==t)return e[t];const r=Object.keys(e);return 1===r.length?e[r[0]]:void 0};t.getInputValue=(e,t)=>{const n=r(e,t);if(!n){const t=Object.keys(e);throw new Error(`input values have ${t.length} keys, you must specify an input key or pass only 1 key as input`)}return n},t.getOutputValue=(e,t)=>{const n=r(e,t);if(!n){const t=Object.keys(e);throw new Error(`output values have ${t.length} keys, you must specify an output key or pass only 1 key as output`)}return n},t.getBufferString=function(e,t="Human",r="AI"){const n=[];for(const a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=r;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else{if("generic"!==a._getType())throw new Error(`Got unsupported message type: ${a}`);e=a.role}const i=a.name?`${a.name}, `:"";n.push(`${e}: ${i}${a.content}`)}return n.join("\n")},t.getPromptInputKey=function(e,t){const r=Object.keys(e).filter((e=>!t.includes(e)&&"stop"!==e));if(1!==r.length)throw new Error(`One input key expected, but got ${r.length}`);return r[0]}},6291:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferMemory=void 0;const n=r(9292),a=r(9741);class i extends a.BaseChatMemory{constructor(e){super({chatHistory:e?.chatHistory,returnMessages:e?.returnMessages??!1,inputKey:e?.inputKey,outputKey:e?.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=e?.humanPrefix??this.humanPrefix,this.aiPrefix=e?.aiPrefix??this.aiPrefix,this.memoryKey=e?.memoryKey??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const t=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:t}:{[this.memoryKey]:(0,n.getBufferString)(t,this.humanPrefix,this.aiPrefix)}}}t.BufferMemory=i},9741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChatMemory=void 0;const n=r(9292),a=r(8210);class i extends n.BaseMemory{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=e?.chatHistory??new a.ChatMessageHistory,this.returnMessages=e?.returnMessages??this.returnMessages,this.inputKey=e?.inputKey??this.inputKey,this.outputKey=e?.outputKey??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage((0,n.getInputValue)(e,this.inputKey)),await this.chatHistory.addAIChatMessage((0,n.getOutputValue)(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}t.BaseChatMemory=i},5004:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENTITY_SUMMARIZATION_PROMPT=t._DEFAULT_ENTITY_SUMMARIZATION_TEMPLATE=t.ENTITY_EXTRACTION_PROMPT=t._DEFAULT_ENTITY_EXTRACTION_TEMPLATE=t.ENTITY_MEMORY_CONVERSATION_TEMPLATE=t._DEFAULT_ENTITY_MEMORY_CONVERSATION_TEMPLATE=t.SUMMARY_PROMPT=void 0;const n=r(4567);t.SUMMARY_PROMPT=new n.PromptTemplate({inputVariables:["summary","new_lines"],template:"Progressively summarize the lines of conversation provided, adding onto the previous summary returning a new summary.\n\nEXAMPLE\nCurrent summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good.\n\nNew lines of conversation:\nHuman: Why do you think artificial intelligence is a force for good?\nAI: Because artificial intelligence will help humans reach their full potential.\n\nNew summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good because it will help humans reach their full potential.\nEND OF EXAMPLE\n\nCurrent summary:\n{summary}\n\nNew lines of conversation:\n{new_lines}\n\nNew summary:"}),t._DEFAULT_ENTITY_MEMORY_CONVERSATION_TEMPLATE="You are an assistant to a human, powered by a large language model trained by OpenAI.\n\nYou are designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, you are able to generate human-like text based on the input you receive, allowing you to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.\n\nYou are constantly learning and improving, and your capabilities are constantly evolving. You are able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. You have access to some personalized information provided by the human in the Context section below. Additionally, you are able to generate your own text based on the input you receive, allowing you to engage in discussions and provide explanations and descriptions on a wide range of topics.\n\nOverall, you are a powerful tool that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether the human needs help with a specific question or just wants to have a conversation about a particular topic, you are here to assist.\n\nContext:\n{entities}\n\nCurrent conversation:\n{history}\nLast line:\nHuman: {input}\nYou:",t.ENTITY_MEMORY_CONVERSATION_TEMPLATE=new n.PromptTemplate({inputVariables:["entities","history","input"],template:t._DEFAULT_ENTITY_MEMORY_CONVERSATION_TEMPLATE}),t._DEFAULT_ENTITY_EXTRACTION_TEMPLATE='You are an AI assistant reading the transcript of a conversation between an AI and a human. Extract all of the proper nouns from the last line of conversation. As a guideline, a proper noun is generally capitalized. You should definitely extract all names and places.\n\nThe conversation history is provided just in case of a coreference (e.g. "What do you know about him" where "him" is defined in a previous line) -- ignore items mentioned there that are not in the last line.\n\nReturn the output as a single comma-separated list, or NONE if there is nothing of note to return (e.g. the user is just issuing a greeting or having a simple conversation).\n\nEXAMPLE\nConversation history:\nPerson #1: my name is Jacob. how\'s it going today?\nAI: "It\'s going great! How about you?"\nPerson #1: good! busy working on Langchain. lots to do.\nAI: "That sounds like a lot of work! What kind of things are you doing to make Langchain better?"\nLast line:\nPerson #1: i\'m trying to improve Langchain\'s interfaces, the UX, its integrations with various products the user might want ... a lot of stuff.\nOutput: Jacob,Langchain\nEND OF EXAMPLE\n\nEXAMPLE\nConversation history:\nPerson #1: how\'s it going today?\nAI: "It\'s going great! How about you?"\nPerson #1: good! busy working on Langchain. lots to do.\nAI: "That sounds like a lot of work! What kind of things are you doing to make Langchain better?"\nLast line:\nPerson #1: i\'m trying to improve Langchain\'s interfaces, the UX, its integrations with various products the user might want ... a lot of stuff. I\'m working with Person #2.\nOutput: Langchain, Person #2\nEND OF EXAMPLE\n\nConversation history (for reference only):\n{history}\nLast line of conversation (for extraction):\nHuman: {input}\n\nOutput:',t.ENTITY_EXTRACTION_PROMPT=new n.PromptTemplate({inputVariables:["history","input"],template:t._DEFAULT_ENTITY_EXTRACTION_TEMPLATE}),t._DEFAULT_ENTITY_SUMMARIZATION_TEMPLATE='You are an AI assistant helping a human keep track of facts about relevant people, places, and concepts in their life. Update and add to the summary of the provided entity in the "Entity" section based on the last line of your conversation with the human. If you are writing the summary for the first time, return a single sentence.\nThe update should only include facts that are relayed in the last line of conversation about the provided entity, and should only contain facts about the provided entity.\n\nIf there is no new information about the provided entity or the information is not worth noting (not an important or relevant fact to remember long-term), output the exact string "UNCHANGED" below.\n\nFull conversation history (for context):\n{history}\n\nEntity to summarize:\n{entity}\n\nExisting summary of {entity}:\n{summary}\n\nLast line of conversation:\nHuman: {input}\nUpdated summary (or the exact string "UNCHANGED" if there is no new information about {entity} above):',t.ENTITY_SUMMARIZATION_PROMPT=new n.PromptTemplate({inputVariables:["entity","summary","history","input"],template:t._DEFAULT_ENTITY_SUMMARIZATION_TEMPLATE})},1628:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationSummaryMemory=t.BaseConversationSummaryMemory=void 0;const n=r(6448),a=r(4235),i=r(9292),s=r(9741),o=r(5004);class l extends s.BaseChatMemory{constructor(e){const{returnMessages:t,inputKey:r,outputKey:n,chatHistory:i,humanPrefix:s,aiPrefix:l,llm:c,prompt:u,summaryChatMessageClass:d}=e;super({returnMessages:t,inputKey:r,outputKey:n,chatHistory:i}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:o.SUMMARY_PROMPT}),Object.defineProperty(this,"summaryChatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:a.SystemMessage}),this.memoryKey=e?.memoryKey??this.memoryKey,this.humanPrefix=s??this.humanPrefix,this.aiPrefix=l??this.aiPrefix,this.llm=c,this.prompt=u??this.prompt,this.summaryChatMessageClass=d??this.summaryChatMessageClass}async predictNewSummary(e,t){const r=(0,i.getBufferString)(e,this.humanPrefix,this.aiPrefix),a=new n.LLMChain({llm:this.llm,prompt:this.prompt});return await a.predict({summary:t,new_lines:r})}}t.BaseConversationSummaryMemory=l,t.ConversationSummaryMemory=class extends l{constructor(e){super(e),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:""})}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){return this.returnMessages?{[this.memoryKey]:[new this.summaryChatMessageClass(this.buffer)]}:{[this.memoryKey]:this.buffer}}async saveContext(e,t){await super.saveContext(e,t);const r=await this.chatHistory.getMessages();this.buffer=await this.predictNewSummary(r.slice(-2),this.buffer)}async clear(){await super.clear(),this.buffer=""}}},1955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationSummaryBufferMemory=void 0;const n=r(9292),a=r(1628);class i extends a.BaseConversationSummaryMemory{constructor(e){super(e),Object.defineProperty(this,"movingSummaryBuffer",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:2e3}),this.maxTokenLimit=e?.maxTokenLimit??this.maxTokenLimit}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){let t,r=await this.chatHistory.getMessages();return this.movingSummaryBuffer&&(r=[new this.summaryChatMessageClass(this.movingSummaryBuffer),...r]),t=this.returnMessages?r:(0,n.getBufferString)(r,this.humanPrefix,this.aiPrefix),{[this.memoryKey]:t}}async saveContext(e,t){await super.saveContext(e,t),await this.prune()}async prune(){let e=await this.chatHistory.getMessages();this.movingSummaryBuffer&&(e=[new this.summaryChatMessageClass(this.movingSummaryBuffer),...e]);let t=await this.llm.getNumTokens((0,n.getBufferString)(e,this.humanPrefix,this.aiPrefix));if(t>this.maxTokenLimit){const r=[];for(;t>this.maxTokenLimit;){const a=e.shift();a&&(r.push(a),t=await this.llm.getNumTokens((0,n.getBufferString)(e,this.humanPrefix,this.aiPrefix)))}this.movingSummaryBuffer=await this.predictNewSummary(r,this.movingSummaryBuffer)}}async clear(){await super.clear(),this.movingSummaryBuffer=""}}t.ConversationSummaryBufferMemory=i},7546:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutputFixingParser=void 0;const n=r(8711),a=r(6448),i=r(6618);class s extends n.BaseOutputParser{static fromLLM(e,t,r){const n=r?.prompt??i.NAIVE_FIX_PROMPT,o=new a.LLMChain({llm:e,prompt:n});return new s({parser:t,retryChain:o})}constructor({parser:e,retryChain:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","fix"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.parser=e,this.retryChain=t}async parse(e,t){try{return await this.parser.parse(e,t)}catch(r){if(r instanceof n.OutputParserException){const n=(await this.retryChain.call({instructions:this.parser.getFormatInstructions(),completion:e,error:r},t))[this.retryChain.outputKey];return this.parser.parse(n)}throw r}}getFormatInstructions(){return this.parser.getFormatInstructions()}}t.OutputFixingParser=s},4275:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoOpOutputParser=void 0;const n=r(8711);class a extends n.BaseOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}t.NoOpOutputParser=a},777:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonKeyOutputFunctionsParser=t.JsonOutputFunctionsParser=t.OutputFunctionsParser=void 0;const n=r(8711);class a extends n.BaseLLMOutputParser{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chains","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=e?.argsOnly??this.argsOnly}async parseResult(e){if("message"in e[0]){const t=e[0].message.additional_kwargs.function_call;if(!t)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!t.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?t.arguments:JSON.stringify(t)}throw new Error(`No message in generations ${JSON.stringify(e)}`)}}t.OutputFunctionsParser=a;class i extends n.BaseLLMOutputParser{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chains","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=e?.argsOnly??this.argsOnly,this.outputParser=new a(e)}async parseResult(e){const t=await this.outputParser.parseResult(e);if(!t)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);const r=JSON.parse(t);return this.argsOnly||(r.arguments=JSON.parse(r.arguments)),r}}t.JsonOutputFunctionsParser=i;class s extends n.BaseLLMOutputParser{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chains","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new i}),Object.defineProperty(this,"attrName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.attrName=e.attrName}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}}t.JsonKeyOutputFunctionsParser=s},6618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAIVE_FIX_PROMPT=t.NAIVE_FIX_TEMPLATE=void 0;const n=r(4567);t.NAIVE_FIX_TEMPLATE="Instructions:\n--------------\n{instructions}\n--------------\nCompletion:\n--------------\n{completion}\n--------------\n\nAbove, the Completion did not satisfy the constraints given in the Instructions.\nError:\n--------------\n{error}\n--------------\n\nPlease try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:",t.NAIVE_FIX_PROMPT=n.PromptTemplate.fromTemplate(t.NAIVE_FIX_TEMPLATE)},8860:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExampleSelector=t.BaseStringPromptTemplate=t.BasePromptTemplate=t.StringPromptValue=void 0;const n=r(4235),a=r(2053),i=r(6547);class s extends n.BasePromptValue{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.HumanMessage(this.value)]}}t.StringPromptValue=s;class o extends i.Runnable{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:{}});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[e,n]of Object.entries(t))r[e]="string"==typeof n?n:await n();return{...r,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,6430));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,6430));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,2832));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}t.BasePromptTemplate=o,t.BaseStringPromptTemplate=class extends o{async formatPromptValue(e){const t=await this.format(e);return new s(t)}};class l extends a.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","selectors"]})}}t.BaseExampleSelector=l},9244:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPromptTemplate=t.SystemMessagePromptTemplate=t.AIMessagePromptTemplate=t.HumanMessagePromptTemplate=t.ChatMessagePromptTemplate=t.BaseChatPromptTemplate=t.BaseMessageStringPromptTemplate=t.MessagesPlaceholder=t.ChatPromptValue=t.BaseMessagePromptTemplate=void 0;const n=r(4235),a=r(2053),i=r(8860),s=r(4567);class o extends a.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}}t.BaseMessagePromptTemplate=o;class l extends n.BasePromptValue{constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}t.ChatPromptValue=l,t.MessagesPlaceholder=class extends o{constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName}get inputVariables(){return[this.variableName]}formatMessages(e){return Promise.resolve(e[this.variableName])}};class c extends o{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}t.BaseMessageStringPromptTemplate=c;class u extends i.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new l(t)}}t.BaseChatPromptTemplate=u,t.ChatMessagePromptTemplate=class extends c{async format(e){return new n.ChatMessage(await this.prompt.format(e),this.role)}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}static fromTemplate(e,t){return new this(s.PromptTemplate.fromTemplate(e),t)}},t.HumanMessagePromptTemplate=class extends c{async format(e){return new n.HumanMessage(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}},t.AIMessagePromptTemplate=class extends c{async format(e){return new n.AIMessage(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}},t.SystemMessagePromptTemplate=class extends c{async format(e){return new n.SystemMessage(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}};class d extends u{get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)for(const r of t.inputVariables)e.add(r);const t=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),r=new Set([...t].filter((t=>!e.has(t))));if(r.size>0)throw new Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);const n=new Set([...e].filter((e=>!t.has(e))));if(n.size>0)throw new Error(`Input variables \`${[...n]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const e of this.promptMessages){const n=e.inputVariables.reduce(((e,r)=>{if(!(r in t))throw new Error(`Missing value for input variable \`${r}\``);return e[r]=t[r],e}),{}),a=await e.formatMessages(n);r=r.concat(a)}return r}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new d(t)}static fromPromptMessages(e){const t=e.reduce(((e,t)=>e.concat(t instanceof d?t.promptMessages:[t])),[]),r=e.reduce(((e,t)=>t instanceof d?Object.assign(e,t.partialVariables):e),Object.create(null)),n=new Set;for(const e of t)for(const t of e.inputVariables)t in r||n.add(t);return new d({inputVariables:[...n],promptMessages:t,partialVariables:r})}}t.ChatPromptTemplate=d},2784:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FewShotPromptTemplate=void 0;const n=r(8860),a=r(2888),i=r(4567);class s extends n.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new s(t)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),n=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...n,this.suffix].join(this.exampleSeparator);return(0,a.renderTemplate)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await i.PromptTemplate.deserialize(t);let n;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return n=e.examples,new s({inputVariables:e.input_variables,examplePrompt:r,examples:n,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}t.FewShotPromptTemplate=s},9734:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePromptTemplate=t.checkValidTemplate=t.renderTemplate=t.parseTemplate=t.BaseChatPromptTemplate=t.MessagesPlaceholder=t.ChatMessagePromptTemplate=t.SystemMessagePromptTemplate=t.AIMessagePromptTemplate=t.HumanMessagePromptTemplate=t.ChatPromptTemplate=t.FewShotPromptTemplate=t.SemanticSimilarityExampleSelector=t.LengthBasedExampleSelector=t.isLLM=t.isChatModel=t.ConditionalPromptSelector=t.BasePromptSelector=t.PromptTemplate=t.BaseStringPromptTemplate=t.StringPromptValue=t.BasePromptTemplate=t.BaseExampleSelector=void 0;var n=r(8860);Object.defineProperty(t,"BaseExampleSelector",{enumerable:!0,get:function(){return n.BaseExampleSelector}}),Object.defineProperty(t,"BasePromptTemplate",{enumerable:!0,get:function(){return n.BasePromptTemplate}}),Object.defineProperty(t,"StringPromptValue",{enumerable:!0,get:function(){return n.StringPromptValue}}),Object.defineProperty(t,"BaseStringPromptTemplate",{enumerable:!0,get:function(){return n.BaseStringPromptTemplate}});var a=r(4567);Object.defineProperty(t,"PromptTemplate",{enumerable:!0,get:function(){return a.PromptTemplate}});var i=r(1678);Object.defineProperty(t,"BasePromptSelector",{enumerable:!0,get:function(){return i.BasePromptSelector}}),Object.defineProperty(t,"ConditionalPromptSelector",{enumerable:!0,get:function(){return i.ConditionalPromptSelector}}),Object.defineProperty(t,"isChatModel",{enumerable:!0,get:function(){return i.isChatModel}}),Object.defineProperty(t,"isLLM",{enumerable:!0,get:function(){return i.isLLM}});var s=r(6101);Object.defineProperty(t,"LengthBasedExampleSelector",{enumerable:!0,get:function(){return s.LengthBasedExampleSelector}});var o=r(4448);Object.defineProperty(t,"SemanticSimilarityExampleSelector",{enumerable:!0,get:function(){return o.SemanticSimilarityExampleSelector}});var l=r(2784);Object.defineProperty(t,"FewShotPromptTemplate",{enumerable:!0,get:function(){return l.FewShotPromptTemplate}});var c=r(9244);Object.defineProperty(t,"ChatPromptTemplate",{enumerable:!0,get:function(){return c.ChatPromptTemplate}}),Object.defineProperty(t,"HumanMessagePromptTemplate",{enumerable:!0,get:function(){return c.HumanMessagePromptTemplate}}),Object.defineProperty(t,"AIMessagePromptTemplate",{enumerable:!0,get:function(){return c.AIMessagePromptTemplate}}),Object.defineProperty(t,"SystemMessagePromptTemplate",{enumerable:!0,get:function(){return c.SystemMessagePromptTemplate}}),Object.defineProperty(t,"ChatMessagePromptTemplate",{enumerable:!0,get:function(){return c.ChatMessagePromptTemplate}}),Object.defineProperty(t,"MessagesPlaceholder",{enumerable:!0,get:function(){return c.MessagesPlaceholder}}),Object.defineProperty(t,"BaseChatPromptTemplate",{enumerable:!0,get:function(){return c.BaseChatPromptTemplate}});var u=r(2888);Object.defineProperty(t,"parseTemplate",{enumerable:!0,get:function(){return u.parseTemplate}}),Object.defineProperty(t,"renderTemplate",{enumerable:!0,get:function(){return u.renderTemplate}}),Object.defineProperty(t,"checkValidTemplate",{enumerable:!0,get:function(){return u.checkValidTemplate}});var d=r(4103);Object.defineProperty(t,"PipelinePromptTemplate",{enumerable:!0,get:function(){return d.PipelinePromptTemplate}})},4103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePromptTemplate=void 0;const n=r(8860),a=r(9244);class i extends n.BasePromptTemplate{constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){const e=this.pipelinePrompts.map((e=>e.name)),t=this.pipelinePrompts.map((t=>t.prompt.inputVariables.filter((t=>!e.includes(t))))).flat();return[...new Set(t)]}static extractRequiredInputValues(e,t){return t.reduce(((t,r)=>(t[r]=e[r],t)),{})}async formatPipelinePrompts(e){const t=await this.mergePartialAndUserVariables(e);for(const{name:e,prompt:r}of this.pipelinePrompts){const n=i.extractRequiredInputValues(t,r.inputVariables);r instanceof a.ChatPromptTemplate?t[e]=await r.formatMessages(n):t[e]=await r.format(n)}return i.extractRequiredInputValues(t,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new i(t)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}}t.PipelinePromptTemplate=i},4567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromptTemplate=void 0;const n=r(8860),a=r(2888);class i extends n.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,a.renderTemplate)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,n="\n\n",a=""){const s=[a,...e,t].join(n);return new i({inputVariables:r,template:s})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){const n=new Set;return(0,a.parseTemplate)(e,t).forEach((e=>{"variable"===e.type&&n.add(e.name)})),new i({inputVariables:[...n],templateFormat:t,template:e,...r})}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new i(t)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}t.PromptTemplate=i},6101:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LengthBasedExampleSelector=void 0;const n=r(8860);function a(e){return e.split(/\n| /).length}class i extends n.BaseExampleSelector{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??a}async addExample(e){this.examples.push(e);const t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;const{examples:r,examplePrompt:n}=t;return(await Promise.all(r.map((e=>n.format(e))))).map((e=>this.getTextLength(e)))}async selectExamples(e){const t=Object.values(e).join(" ");let r=this.maxLength-this.getTextLength(t),n=0;const a=[];for(;r>0&&n<this.examples.length;){const e=r-this.exampleTextLengths[n];if(e<0)break;a.push(this.examples[n]),r=e,n+=1}return a}static async fromExamples(e,t){const r=new i(t);return await Promise.all(e.map((e=>r.addExample(e)))),r}}t.LengthBasedExampleSelector=i},4448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticSimilarityExampleSelector=void 0;const n=r(2614),a=r(8860);function i(e){return Object.keys(e).sort().map((t=>e[t]))}class s extends a.BaseExampleSelector{constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??4,this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys}async addExample(e){const t=i((this.inputKeys??Object.keys(e)).reduce(((t,r)=>({...t,[r]:e[r]})),{})).join(" ");await this.vectorStore.addDocuments([new n.Document({pageContent:t,metadata:{example:e}})])}async selectExamples(e){const t=i((this.inputKeys??Object.keys(e)).reduce(((t,r)=>({...t,[r]:e[r]})),{})).join(" "),r=(await this.vectorStore.similaritySearch(t,this.k)).map((e=>e.metadata));return this.exampleKeys?r.map((e=>this.exampleKeys.reduce(((t,r)=>({...t,[r]:e[r]})),{}))):r}static async fromExamples(e,t,r,n={}){const a=n.inputKeys??null,o=e.map((e=>i(a?a.reduce(((t,r)=>({...t,[r]:e[r]})),{}):e).join(" "))),l=await r.fromTexts(o,e,t,n);return new s({vectorStore:l,k:n.k??4,exampleKeys:n.exampleKeys,inputKeys:n.inputKeys})}}t.SemanticSimilarityExampleSelector=s},1678:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isChatModel=t.isLLM=t.ConditionalPromptSelector=t.BasePromptSelector=void 0;class r{async getPromptAsync(e,t){return this.getPrompt(e).partial(t?.partialVariables??{})}}t.BasePromptSelector=r,t.ConditionalPromptSelector=class extends r{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}},t.isLLM=function(e){return"base_llm"===e._modelType()},t.isChatModel=function(e){return"base_chat_model"===e._modelType()}},2888:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidTemplate=t.parseTemplate=t.renderTemplate=t.DEFAULT_PARSER_MAPPING=t.DEFAULT_FORMATTER_MAPPING=t.interpolateFString=t.parseFString=void 0,t.parseFString=e=>{const t=e.split(""),r=[],n=(e,r)=>{for(let n=r;n<t.length;n+=1)if(e.includes(t[n]))return n;return-1};let a=0;for(;a<t.length;)if("{"===t[a]&&a+1<t.length&&"{"===t[a+1])r.push({type:"literal",text:"{"}),a+=2;else if("}"===t[a]&&a+1<t.length&&"}"===t[a+1])r.push({type:"literal",text:"}"}),a+=2;else if("{"===t[a]){const e=n("}",a);if(e<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(a+1,e).join("")}),a=e+1}else{if("}"===t[a])throw new Error("Single '}' in template.");{const e=n("{}",a),i=(e<0?t.slice(a):t.slice(a,e)).join("");r.push({type:"literal",text:i}),a=e<0?t.length:e}}return r},t.interpolateFString=(e,r)=>(0,t.parseFString)(e).reduce(((e,t)=>{if("variable"===t.type){if(t.name in r)return e+r[t.name];throw new Error(`Missing value for input ${t.name}`)}return e+t.text}),""),t.DEFAULT_FORMATTER_MAPPING={"f-string":t.interpolateFString,jinja2:(e,t)=>""},t.DEFAULT_PARSER_MAPPING={"f-string":t.parseFString,jinja2:e=>[]},t.renderTemplate=(e,r,n)=>t.DEFAULT_FORMATTER_MAPPING[r](e,n),t.parseTemplate=(e,r)=>t.DEFAULT_PARSER_MAPPING[r](e),t.checkValidTemplate=(e,r,n)=>{if(!(r in t.DEFAULT_FORMATTER_MAPPING)){const e=Object.keys(t.DEFAULT_FORMATTER_MAPPING);throw new Error(`Invalid template format. Got \`${r}\`;\n                         should be one of ${e}`)}try{const a=n.reduce(((e,t)=>(e[t]="foo",e)),{});(0,t.renderTemplate)(e,r,a)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},4235:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Docstore=t.BaseEntityStore=t.BaseFileStore=t.BaseCache=t.BaseListChatMessageHistory=t.BaseChatMessageHistory=t.BasePromptValue=t.ChatGenerationChunk=t.ChatMessageChunk=t.ChatMessage=t.FunctionMessageChunk=t.FunctionMessage=t.SystemChatMessage=t.AIChatMessage=t.HumanChatMessage=t.BaseChatMessage=t.SystemMessageChunk=t.SystemMessage=t.AIMessageChunk=t.AIMessage=t.HumanMessageChunk=t.HumanMessage=t.BaseMessageChunk=t.BaseMessage=t.GenerationChunk=t.RUN_KEY=void 0;const n=r(2053);t.RUN_KEY="__run";class a{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new a({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}t.GenerationChunk=a;class i extends n.Serializable{get text(){return this.content}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}t.BaseMessage=i;class s extends i{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[e,n]of Object.entries(t))if(void 0===r[e])r[e]=n;else{if(typeof r[e]!=typeof n)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e])r[e]=r[e]+n;else{if(Array.isArray(r[e])||"object"!=typeof r[e])throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);r[e]=this._mergeAdditionalKwargs(r[e],n)}}return r}}t.BaseMessageChunk=s;class o extends i{_getType(){return"human"}}t.HumanMessage=o;class l extends s{_getType(){return"human"}concat(e){return new l({content:this.content+e.content,additional_kwargs:l._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.HumanMessageChunk=l;class c extends i{_getType(){return"ai"}}t.AIMessage=c;class u extends s{_getType(){return"ai"}concat(e){return new u({content:this.content+e.content,additional_kwargs:u._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.AIMessageChunk=u;class d extends i{_getType(){return"system"}}t.SystemMessage=d;class p extends s{_getType(){return"system"}concat(e){return new p({content:this.content+e.content,additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.SystemMessageChunk=p,t.BaseChatMessage=i,t.HumanChatMessage=o,t.AIChatMessage=c,t.SystemChatMessage=d,t.FunctionMessage=class extends i{constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}};class h extends s{_getType(){return"function"}concat(e){return new h({content:this.content+e.content,additional_kwargs:h._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}t.FunctionMessageChunk=h,t.ChatMessage=class extends i{constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}};class m extends s{constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new m({content:this.content+e.content,additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}t.ChatMessageChunk=m;class f extends a{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new f({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}t.ChatGenerationChunk=f;class g extends n.Serializable{}t.BasePromptValue=g;class b extends n.Serializable{}t.BaseChatMessageHistory=b;class y extends n.Serializable{addUserMessage(e){return this.addMessage(new o(e))}addAIChatMessage(e){return this.addMessage(new c(e))}}t.BaseListChatMessageHistory=y,t.BaseCache=class{};class v extends n.Serializable{}t.BaseFileStore=v;class w extends n.Serializable{}t.BaseEntityStore=w,t.Docstore=class{}},8711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutputParserException=t.BytesOutputParser=t.StringOutputParser=t.BaseTransformOutputParser=t.BaseOutputParser=t.BaseLLMOutputParser=void 0;const n=r(6547);class a extends n.Runnable{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async e=>this.parseResult([{text:e}])),e,{...t,runType:"parser"}):this._callWithConfig((async e=>this.parseResult([{message:e,text:e.content}])),e,{...t,runType:"parser"})}}t.BaseLLMOutputParser=a;class i extends a{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}t.BaseOutputParser=i;class s extends i{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:t.content}])}async*transform(e,t){yield*this._streamWithConfig(this._transform(e),{...t,runType:"parser"})}}t.BaseTransformOutputParser=s,t.StringOutputParser=class extends s{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}},t.BytesOutputParser=class extends s{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}};class o extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}t.OutputParserException=o},6547:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RouterRunnable=t.RunnableBinding=t.RunnablePassthrough=t.RunnableLambda=t.RunnableMap=t.RunnableSequence=t.Runnable=void 0;const n=r(6659),a=r(2053),i=r(8065);function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class o extends a.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new p({bound:this,kwargs:e})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},(()=>e))}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),a=r?.maxConcurrency&&r.maxConcurrency>0?r?.maxConcurrency:e.length,i=[];for(let t=0;t<e.length;t+=a){const r=e.slice(t,t+a).map(((e,t)=>this.invoke(e,n[t]))),s=await Promise.all(r);i.push(s)}return i.flat()}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return i.IterableReadableStream.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const a=await n.CallbackManager.configure(r?.callbacks,void 0,r?.tags,void 0,r?.metadata),i=await(a?.handleChainStart(this.toJSON(),s(t,"input"),void 0,r?.runType));let o;try{o=await e.bind(this)(t)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(s(o,"output"))),o}async*_streamWithConfig(e,t){const r=await n.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s("<streamed value>","input"),void 0,t?.runType));let i,o=!0;try{for await(const t of e)if(yield t,o)if(void 0===i)i=t;else try{i=i.concat(t)}catch(e){i=void 0,o=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(s(i,"output")))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new l({first:this,last:d(e)})}static isRunnable(e){return e.lc_runnable}}t.Runnable=o;class l extends o{constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await n.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s(e,"input")));let i,o=e;try{for(const e of[this.first,...this.middle])o=await e.invoke(o,this._patchConfig(t,a?.getChild()));i=await this.last.invoke(o,this._patchConfig(t,a?.getChild()))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(s(i,"output"))),i}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map((e=>n.CallbackManager.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),o=await Promise.all(i.map(((t,r)=>t?.handleChainStart(this.toJSON(),s(e[r],"input")))));let l,c=e;try{for(let e=0;e<[this.first,...this.middle].length;e+=1){const t=this.steps[e];c=await t.batch(c,o.map((t=>this._patchConfig(a[e],t?.getChild())),r))}l=await this.last.batch(c,o.map((e=>this._patchConfig(a[this.steps.length-1],e?.getChild())),r))}catch(e){throw await Promise.all(o.map((t=>t?.handleChainError(e)))),e}return await Promise.all(o.map(((e,t)=>e?.handleChainEnd(s(l[t],"output"))))),l}async*_streamIterator(e,t){const r=await n.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s(e,"input")));let i=e;const o=[this.first,...this.middle,this.last],l=o.length-[...o].reverse().findIndex((e=>"function"!=typeof e.transform))-1;try{for(const e of o.slice(0,l))i=await e.invoke(i,this._patchConfig(t,a?.getChild()))}catch(e){throw await(a?.handleChainError(e)),e}let c,u=!0;try{let e=await o[l]._streamIterator(i,this._patchConfig(t,a?.getChild()));for(const r of o.slice(l+1))e=await r.transform(e,this._patchConfig(t,a?.getChild()));for await(const t of e)if(yield t,u)if(void 0===c)c=t;else try{c=c.concat(t)}catch(e){c=void 0,u=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(s(c,"output")))}pipe(e){return l.isRunnableSequence(e)?new l({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new l({first:this.first,middle:[...this.middle,this.last],last:d(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&o.isRunnable(e)}static from([e,...t]){return new l({first:d(e),middle:t.slice(0,-1).map(d),last:d(t[t.length-1])})}}t.RunnableSequence=l;class c extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=d(r)}async invoke(e,t){const r=await n.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),{input:e})),i={};try{for(const[r,n]of Object.entries(this.steps)){const s=await n.invoke(e,this._patchConfig(t,a?.getChild()));i[r]=s}}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(i)),i}}t.RunnableMap=c;class u extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async invoke(e,t){return this._callWithConfig((async e=>this.func(e)),e,t)}}function d(e){if("function"==typeof e)return new u({func:e});if(o.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,n]of Object.entries(e))t[r]=d(n);return new c({steps:t})}}t.RunnableLambda=u,t.RunnablePassthrough=class extends o{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>Promise.resolve(e)),e,t)}};class p extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs}bind(e){return new p({bound:this.bound,kwargs:{...this.kwargs,...e}})}async invoke(e,t){return this.bound.invoke(e,{...t,...this.kwargs})}async batch(e,t,r){const n=Array.isArray(t)?t.map((e=>({...e,...this.kwargs}))):{...t,...this.kwargs};return this.bound.batch(e,n,r)}async stream(e,t){return this.bound.stream(e,{...t,...this.kwargs})}}t.RunnableBinding=p,t.RouterRunnable=class extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","langchain"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,t){const{key:r,input:n}=e,a=this.runnables[r];if(void 0===a)throw new Error(`No runnable associated with key "${r}".`);return a.invoke(n,t)}async batch(e,t,r){const n=e.map((e=>e.key)),a=e.map((e=>e.input));if(void 0!==n.find((e=>void 0===this.runnables[e])))throw new Error("One or more keys do not have a corresponding runnable.");const i=n.map((e=>this.runnables[e])),s=this._getOptionsList(t??{},e.length),o=r?.maxConcurrency&&r.maxConcurrency>0?r?.maxConcurrency:e.length,l=[];for(let e=0;e<a.length;e+=o){const t=a.slice(e,e+o).map(((e,t)=>i[t].invoke(e,s[t]))),r=await Promise.all(t);l.push(r)}return l.flat()}async stream(e,t){const{key:r,input:n}=e,a=this.runnables[r];if(void 0===a)throw new Error(`No runnable associated with key "${r}".`);return a.stream(n,t)}}},8210:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessageHistory=void 0;const n=r(4235);class a extends n.BaseListChatMessageHistory{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}t.ChatMessageHistory=a},8061:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFTTTWebhook=void 0;const n=r(5667);class a extends n.Tool{constructor(e,t,r){super(...arguments),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=e,this.name=t,this.description=r}async _call(e){const t=JSON.stringify({this:e}),r=await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:t});if(!r.ok)throw new Error(`HTTP error ${r.status}`);return await r.text()}}t.IFTTTWebhook=a},1370:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AIPluginTool=void 0;const n=r(5667);class a extends n.Tool{get name(){return this._name}get description(){return this._description}constructor(e){super(e),Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiSpec",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._name=e.name,this._description=e.description,this.apiSpec=e.apiSpec}async _call(e){return this.apiSpec}static async fromPluginUrl(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch plugin from ${e} with status ${t.status}`);const r=await t.json(),n=await fetch(r.api.url);if(!n.ok)throw new Error(`Failed to fetch API spec from ${r.api.url} with status ${n.status}`);const i=await n.text();return new a({name:r.name_for_model,description:`Call this tool to get the OpenAPI spec (and usage guide) for interacting with the ${r.name_for_human} API. You should only call this ONCE! What is the ${r.name_for_human} API useful for? ${r.description_for_human}`,apiSpec:`Usage Guide: ${r.description_for_model}\n\nOpenAPI Spec in JSON or YAML format:\n${i}`})}}t.AIPluginTool=a},5667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tool=t.StructuredTool=void 0;const n=r(8754),a=r(6659),i=r(8281);class s extends i.BaseLangChain{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,t)}async call(e,t,r){const n=await this.schema.parseAsync(e),i=(0,a.parseCallbackConfigArg)(t),s=await a.CallbackManager.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(s?.handleToolStart(this.toJSON(),"string"==typeof n?n:JSON.stringify(n)));let l;try{l=await this._call(n,o)}catch(e){throw await(o?.handleToolError(e)),e}return await(o?.handleToolEnd(l)),l}}t.StructuredTool=s,t.Tool=class extends s{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:n.z.object({input:n.z.string().optional()}).transform((e=>e.input))})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}}},1596:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BingSerpAPI=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{toJSON(){return this.toJSONNotImplemented()}constructor(e=(0,n.getEnvironmentVariable)("BingApiKey"),t={}){if(super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"bing-search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a search engine. useful for when you need to answer questions about current events. input should be a search query."}),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!e)throw new Error("BingSerpAPI API key not set. You can set it as BingApiKey in your .env file.");this.key=e,this.params=t}async _call(e){const t={"Ocp-Apim-Subscription-Key":this.key},r={q:e,textDecorations:"true",textFormat:"HTML"},n=new URL("https://api.bing.microsoft.com/v7.0/search");Object.entries(r).forEach((([e,t])=>{n.searchParams.append(e,t)}));const a=await fetch(n,{headers:t});if(!a.ok)throw new Error(`HTTP error ${a.status}`);const i=(await a.json()).webPages.value;return 0===i.length?"No good results found.":i.map((e=>e.snippet)).join(" ")}}t.BingSerpAPI=i},2081:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BraveSearch=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{constructor(e={apiKey:(0,n.getEnvironmentVariable)("BRAVE_SEARCH_API_KEY")}){if(super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"brave-search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a search engine. useful for when you need to answer questions about current events. input should be a search query."}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!e.apiKey)throw new Error('Brave API key not set. Please pass it in or set it as an environment variable named "BRAVE_SEARCH_API_KEY".');this.apiKey=e.apiKey}async _call(e){const t={"X-Subscription-Token":this.apiKey,Accept:"application/json"},r=new URL(`https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(e)}`),n=await fetch(r,{headers:t});if(!n.ok)throw new Error(`HTTP error ${n.status}`);const a=await n.json(),i=a.web?.results,s=Array.isArray(i)?i.map((e=>({title:e.title,link:e.url,snippet:e.description}))):[];return JSON.stringify(s)}}t.BraveSearch=i},4215:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChainTool=void 0;const n=r(3654);class a extends n.DynamicTool{constructor({chain:e,...t}){super({...t,func:async(t,r)=>e.run(t,r?.getChild())}),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chain=e}}t.ChainTool=a},2152:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatToOpenAIFunction=void 0;const n=r(8841);t.formatToOpenAIFunction=function(e){return{name:e.name,description:e.description,parameters:(0,n.zodToJsonSchema)(e.schema)}}},8988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DadJokeAPI=void 0;const n=r(5667);class a extends n.Tool{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dadjoke"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a dad joke generator. get a dad joke about a specific topic. input should be a search term."})}async _call(e){const t=`https://icanhazdadjoke.com/search?term=${e}`,r=await fetch(t,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`HTTP error ${r.status}`);const n=(await r.json()).results;return 0===n.length?`No dad jokes found about ${e}`:n[Math.floor(Math.random()*n.length)].joke}}t.DadJokeAPI=a},4906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataForSeoAPISearch=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{constructor(e={}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dataforseo-api-wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A robust Google Search API provided by DataForSeo. This tool is handy when you need information about trending topics or current events."}),Object.defineProperty(this,"apiLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiPassword",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultParams",{enumerable:!0,configurable:!0,writable:!0,value:{location_name:"United States",language_code:"en",depth:10,se_name:"google",se_type:"organic"}}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"jsonResultTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jsonResultFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useJsonOutput",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=e.apiLogin??(0,n.getEnvironmentVariable)("DATAFORSEO_LOGIN"),r=e.apiPassword??(0,n.getEnvironmentVariable)("DATAFORSEO_PASSWORD"),a=e.params??{};if(!t||!r)throw new Error("DataForSEO login or password not set. You can set it as DATAFORSEO_LOGIN and DATAFORSEO_PASSWORD in your .env file, or pass it to DataForSeoAPISearch.");this.params={...this.defaultParams,...a},this.apiLogin=t,this.apiPassword=r,this.jsonResultTypes=e.jsonResultTypes,this.jsonResultFields=e.jsonResultFields,this.useJsonOutput=e.useJsonOutput??!1,this.topCount=e.topCount}async _call(e){return this.useJsonOutput?JSON.stringify(await this.results(e)):this.processResponse(await this.getResponseJson(e))}async results(e){const t=await this.getResponseJson(e);return this.filterResults(t,this.jsonResultTypes)}prepareRequest(e){if(void 0===this.apiLogin||void 0===this.apiPassword)throw new Error("api_login or api_password is not provided");const t={Authorization:`Basic ${Buffer.from(`${this.apiLogin}:${this.apiPassword}`,"utf-8").toString("base64")}`,"Content-Type":"application/json"},r={...this.params};r.keyword??=e;const n=[r];return{url:`https://api.dataforseo.com/v3/serp/${r.se_name}/${r.se_type}/live/advanced`,headers:t,data:JSON.stringify(n)}}async getResponseJson(e){const t=this.prepareRequest(e),r=await fetch(t.url,{method:"POST",headers:t.headers,body:t.data});if(!r.ok)throw new Error(`Got ${r.status} error from DataForSEO: ${r.statusText}`);const n=await r.json();return this.checkResponse(n)}checkResponse(e){if(2e4!==e.status_code)throw new Error(`Got error from DataForSEO SERP API: ${e.status_message}`);for(const t of e.tasks)if(2e4!==t.status_code)throw new Error(`Got error from DataForSEO SERP API: ${t.status_message}`);return e}filterResults(e,t){const r=[];for(const n of e.tasks||[])for(const e of n.result||[])for(const n of e.items||[]){if(void 0===t||0===t.length||t.includes(n.type)){const e=this.cleanupUnnecessaryItems(n);0!==Object.keys(e).length&&r.push(e)}if(void 0!==this.topCount&&r.length>=this.topCount)break}return r}cleanupUnnecessaryItems(e){if(Array.isArray(e))return e.map((e=>this.cleanupUnnecessaryItems(e)));const t=["xpath","position","rectangle"];return"object"==typeof e&&null!==e?Object.keys(e).reduce(((r,n)=>(void 0!==this.jsonResultFields&&!this.jsonResultFields.includes(n)||t.includes(n)||("object"==typeof e[n]&&null!==e[n]?r[n]=this.cleanupUnnecessaryItems(e[n]):r[n]=e[n]),r)),{}):e}processResponse(e){let t="No good search result found";for(const r of e.tasks||[])for(const e of r.result||[]){const{item_types:r}=e,n=e.items||[];if(r.includes("answer_box")?t=n.find((e=>"answer_box"===e.type)).text:r.includes("knowledge_graph")?t=n.find((e=>"knowledge_graph"===e.type)).description:r.includes("featured_snippet")?t=n.find((e=>"featured_snippet"===e.type)).description:r.includes("shopping")?t=n.find((e=>"shopping"===e.type)).price:r.includes("organic")&&(t=n.find((e=>"organic"===e.type)).description),t)break}return t}}t.DataForSeoAPISearch=i},3654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicStructuredTool=t.DynamicTool=void 0;const n=r(5667);class a extends n.Tool{constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async _call(e,t){return this.func(e,t)}}t.DynamicTool=a;class i extends n.StructuredTool{constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}_call(e,t){return this.func(e,t)}}t.DynamicStructuredTool=i},7535:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WriteFileTool=t.ReadFileTool=void 0;const n=r(8754),a=r(5667);class i extends a.StructuredTool{constructor({store:e}){super(...arguments),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:n.z.object({file_path:n.z.string().describe("name of file")})}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"read_file"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Read file from disk"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=e}async _call({file_path:e}){return await this.store.readFile(e)}}t.ReadFileTool=i;class s extends a.StructuredTool{constructor({store:e,...t}){super(t),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:n.z.object({file_path:n.z.string().describe("name of file"),text:n.z.string().describe("text to write to file")})}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"write_file"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Write file from disk"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=e}async _call({file_path:e,text:t}){return await this.store.writeFile(e,t),"File written to successfully."}}t.WriteFileTool=s},2592:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleCustomSearch=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}constructor(e={apiKey:(0,n.getEnvironmentVariable)("GOOGLE_API_KEY"),googleCSEId:(0,n.getEnvironmentVariable)("GOOGLE_CSE_ID")}){if(super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"google-custom-search"}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"googleCSEId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a custom search engine. useful for when you need to answer questions about current events. input should be a search query. outputs a JSON array of results."}),!e.apiKey)throw new Error('Google API key not set. You can set it as "GOOGLE_API_KEY" in your environment variables.');if(!e.googleCSEId)throw new Error('Google custom search engine id not set. You can set it as "GOOGLE_CSE_ID" in your environment variables.');this.apiKey=e.apiKey,this.googleCSEId=e.googleCSEId}async _call(e){const t=await fetch(`https://www.googleapis.com/customsearch/v1?key=${this.apiKey}&cx=${this.googleCSEId}&q=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`Got ${t.status} error from Google custom search: ${t.statusText}`);const r=await t.json(),n=r?.items?.map((e=>({title:e.title,link:e.link,snippet:e.snippet})))??[];return JSON.stringify(n)}}t.GoogleCustomSearch=i},556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearxngSearch=t.DataForSeoAPISearch=t.WikipediaQueryRun=t.BraveSearch=t.WriteFileTool=t.ReadFileTool=t.AIPluginTool=t.GoogleCustomSearch=t.Serper=t.ZapierNLAWrapper=t.ZapierNLARunAction=t.VectorStoreQATool=t.RequestsPostTool=t.RequestsGetTool=t.JsonGetValueTool=t.JsonListKeysTool=t.JsonSpec=t.ChainTool=t.IFTTTWebhook=t.DynamicStructuredTool=t.DynamicTool=t.StructuredTool=t.Tool=t.BingSerpAPI=t.DadJokeAPI=t.SerpAPI=void 0;var n=r(5053);Object.defineProperty(t,"SerpAPI",{enumerable:!0,get:function(){return n.SerpAPI}});var a=r(8988);Object.defineProperty(t,"DadJokeAPI",{enumerable:!0,get:function(){return a.DadJokeAPI}});var i=r(1596);Object.defineProperty(t,"BingSerpAPI",{enumerable:!0,get:function(){return i.BingSerpAPI}});var s=r(5667);Object.defineProperty(t,"Tool",{enumerable:!0,get:function(){return s.Tool}}),Object.defineProperty(t,"StructuredTool",{enumerable:!0,get:function(){return s.StructuredTool}});var o=r(3654);Object.defineProperty(t,"DynamicTool",{enumerable:!0,get:function(){return o.DynamicTool}}),Object.defineProperty(t,"DynamicStructuredTool",{enumerable:!0,get:function(){return o.DynamicStructuredTool}});var l=r(8061);Object.defineProperty(t,"IFTTTWebhook",{enumerable:!0,get:function(){return l.IFTTTWebhook}});var c=r(4215);Object.defineProperty(t,"ChainTool",{enumerable:!0,get:function(){return c.ChainTool}});var u=r(2835);Object.defineProperty(t,"JsonSpec",{enumerable:!0,get:function(){return u.JsonSpec}}),Object.defineProperty(t,"JsonListKeysTool",{enumerable:!0,get:function(){return u.JsonListKeysTool}}),Object.defineProperty(t,"JsonGetValueTool",{enumerable:!0,get:function(){return u.JsonGetValueTool}});var d=r(7636);Object.defineProperty(t,"RequestsGetTool",{enumerable:!0,get:function(){return d.RequestsGetTool}}),Object.defineProperty(t,"RequestsPostTool",{enumerable:!0,get:function(){return d.RequestsPostTool}});var p=r(7696);Object.defineProperty(t,"VectorStoreQATool",{enumerable:!0,get:function(){return p.VectorStoreQATool}});var h=r(2681);Object.defineProperty(t,"ZapierNLARunAction",{enumerable:!0,get:function(){return h.ZapierNLARunAction}}),Object.defineProperty(t,"ZapierNLAWrapper",{enumerable:!0,get:function(){return h.ZapierNLAWrapper}});var m=r(1156);Object.defineProperty(t,"Serper",{enumerable:!0,get:function(){return m.Serper}});var f=r(2592);Object.defineProperty(t,"GoogleCustomSearch",{enumerable:!0,get:function(){return f.GoogleCustomSearch}});var g=r(1370);Object.defineProperty(t,"AIPluginTool",{enumerable:!0,get:function(){return g.AIPluginTool}});var b=r(7535);Object.defineProperty(t,"ReadFileTool",{enumerable:!0,get:function(){return b.ReadFileTool}}),Object.defineProperty(t,"WriteFileTool",{enumerable:!0,get:function(){return b.WriteFileTool}});var y=r(2081);Object.defineProperty(t,"BraveSearch",{enumerable:!0,get:function(){return y.BraveSearch}});var v=r(6192);Object.defineProperty(t,"WikipediaQueryRun",{enumerable:!0,get:function(){return v.WikipediaQueryRun}});var w=r(4906);Object.defineProperty(t,"DataForSeoAPISearch",{enumerable:!0,get:function(){return w.DataForSeoAPISearch}});var _=r(4693);Object.defineProperty(t,"SearxngSearch",{enumerable:!0,get:function(){return _.SearxngSearch}})},2835:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonGetValueTool=t.JsonListKeysTool=t.JsonSpec=void 0;const a=n(r(9038)),i=r(5667),s=r(2053);class o extends s.Serializable{constructor(e,t=4e3){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","tools","json"]}),Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxValueLength",{enumerable:!0,configurable:!0,writable:!0,value:4e3}),this.obj=e,this.maxValueLength=t}getKeys(e){const t=a.default.compile(e).get(this.obj);if("object"==typeof t&&!Array.isArray(t)&&null!==t)return Object.keys(t).map((e=>e.replaceAll("~","~0").replaceAll("/","~1"))).join(", ");throw new Error(`Value at ${e} is not a dictionary, get the value directly instead.`)}getValue(e){const t=a.default.compile(e).get(this.obj);if(null==t)throw new Error(`Value at ${e} is null or undefined.`);const r="object"==typeof t?JSON.stringify(t):t.toString();return"object"==typeof t&&!Array.isArray(t)&&r.length>this.maxValueLength?"Value is a large dictionary, should explore its keys directly.":r.length>this.maxValueLength?`${r.slice(0,this.maxValueLength)}...`:r}}t.JsonSpec=o;class l extends i.Tool{constructor(e){"jsonSpec"in e||(e={jsonSpec:e}),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"json_list_keys"}),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Can be used to list all keys at a given path. \n    Before calling this you should be SURE that the path to this exists.\n    The input is a text representation of the path to the json as json pointer syntax (e.g. /key1/0/key2)."}),this.jsonSpec=e.jsonSpec}async _call(e){try{return this.jsonSpec.getKeys(e)}catch(e){return`${e}`}}}t.JsonListKeysTool=l;class c extends i.Tool{constructor(e){super(),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"json_get_value"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Can be used to see value in string format at a given path.\n    Before calling this you should be SURE that the path to this exists.\n    The input is a text representation of the path to the json as json pointer syntax (e.g. /key1/0/key2)."})}async _call(e){try{return this.jsonSpec.getValue(e)}catch(e){return`${e}`}}}t.JsonGetValueTool=c},7636:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestsPostTool=t.RequestsGetTool=void 0;const n=r(5667);class a extends n.Tool{constructor(e={},{maxOutputLength:t}={}){super(...arguments),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"requests_get"}),Object.defineProperty(this,"maxOutputLength",{enumerable:!0,configurable:!0,writable:!0,value:2e3}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:'A portal to the internet. Use this when you need to get specific content from a website. \n  Input should be a url string (i.e. "https://www.google.com"). The output will be the text response of the GET request.'}),this.maxOutputLength=t??this.maxOutputLength}async _call(e){const t=await fetch(e,{headers:this.headers});return(await t.text()).slice(0,this.maxOutputLength)}}t.RequestsGetTool=a;class i extends n.Tool{constructor(e={},{maxOutputLength:t}={}){super(...arguments),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"requests_post"}),Object.defineProperty(this,"maxOutputLength",{enumerable:!0,configurable:!0,writable:!0,value:1/0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:'Use this when you want to POST to a website.\n  Input should be a json string with two keys: "url" and "data".\n  The value of "url" should be a string, and the value of "data" should be a dictionary of \n  key-value pairs you want to POST to the url as a JSON body.\n  Be careful to always use double quotes for strings in the json string\n  The output will be the text response of the POST request.'}),this.maxOutputLength=t??this.maxOutputLength}async _call(e){try{const{url:t,data:r}=JSON.parse(e),n=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});return(await n.text()).slice(0,this.maxOutputLength)}catch(e){return`${e}`}}}t.RequestsPostTool=i},4693:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearxngSearch=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{get lc_secrets(){return{apiBase:"SEARXNG_API_BASE"}}constructor({apiBase:e,params:t,headers:r}){if(super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"searxng-search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A meta search engine. Useful for when you need to answer questions about current events. Input should be a search query. Output is a JSON array of the query results"}),Object.defineProperty(this,"apiBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:{numResults:10,pageNumber:1,format:"json",imageProxy:!0,safesearch:0}}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiBase=(0,n.getEnvironmentVariable)("SEARXNG_API_BASE")||e,this.headers={"content-type":"application/json",...r},!this.apiBase)throw new Error('SEARXNG_API_BASE not set. You can set it as "SEARXNG_API_BASE" in your environment variables.');t&&(this.params={...this.params,...t})}buildUrl(e,t,r){const n=Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,t.toString()]));return`${r}/${e}?${new URLSearchParams(n)}`}async _call(e){const t={q:e,...this.params},r=this.buildUrl("search",t,this.apiBase),n=await fetch(r,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(5e3)});if(!n.ok)throw new Error(n.statusText);const a=await n.json();if(a.results.length||a.answers.length||a.infoboxes.length||a.suggestions.length){if(a.results.length){const e=[];return a.results.forEach((t=>{e.push(JSON.stringify({title:t.title||"",link:t.url||"",snippet:t.content||""}))})),e.slice(0,this.params?.numResults).toString()}if(a.answers.length)return a.answers[0];if(a.infoboxes.length)return a.infoboxes[0]?.content.replaceAll(/<[^>]+>/gi,"");if(a.suggestions.length){let e="Suggestions: ";return a.suggestions.forEach((t=>{e+=`${t}, `})),e}return"No good results found."}return"No good results found."}}t.SearxngSearch=i},5053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerpAPI=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{toJSON(){return this.toJSONNotImplemented()}constructor(e=(0,n.getEnvironmentVariable)("SERPAPI_API_KEY"),t={},r="https://serpapi.com"){if(super(...arguments),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a search engine. useful for when you need to answer questions about current events. input should be a search query."}),!e)throw new Error("SerpAPI API key not set. You can set it as SERPAPI_API_KEY in your .env file, or pass it to SerpAPI.");this.key=e,this.params=t,this.baseUrl=r}buildUrl(e,t,r){const n=Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,`${t}`]));return`${r}/${e}?${new URLSearchParams(n)}`}async _call(e){const{timeout:t,...r}=this.params,n=await fetch(this.buildUrl("search",{...r,api_key:this.key,q:e},this.baseUrl),{signal:t?AbortSignal.timeout(t):void 0}),a=await n.json();if(a.error)throw new Error(`Got error from serpAPI: ${a.error}`);return a.answer_box?.answer?a.answer_box.answer:a.answer_box?.snippet?a.answer_box.snippet:a.answer_box?.snippet_highlighted_words?a.answer_box.snippet_highlighted_words[0]:a.sports_results?.game_spotlight?a.sports_results.game_spotlight:a.knowledge_graph?.description?a.knowledge_graph.description:a.organic_results?.[0]?.snippet?a.organic_results[0].snippet:"No good search result found"}}t.SerpAPI=i},1156:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Serper=void 0;const n=r(9200),a=r(5667);class i extends a.Tool{toJSON(){return this.toJSONNotImplemented()}constructor(e=(0,n.getEnvironmentVariable)("SERPER_API_KEY"),t={}){if(super(),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"a search engine. useful for when you need to answer questions about current events. input should be a search query."}),!e)throw new Error("Serper API key not set. You can set it as SERPER_API_KEY in your .env file, or pass it to Serper.");this.key=e,this.params=t}async _call(e){const t={method:"POST",headers:{"X-API-KEY":this.key,"Content-Type":"application/json"},body:JSON.stringify({q:e,...this.params})},r=await fetch("https://google.serper.dev/search",t);if(!r.ok)throw new Error(`Got ${r.status} error from serper: ${r.statusText}`);const n=await r.json();return n.answerBox?.answer?n.answerBox.answer:n.answerBox?.snippet?n.answerBox.snippet:n.answerBox?.snippet_highlighted_words?n.answerBox.snippet_highlighted_words[0]:n.sportsResults?.game_spotlight?n.sportsResults.game_spotlight:n.knowledgeGraph?.description?n.knowledgeGraph.description:n.organic?.[0]?.snippet?n.organic[0].snippet:"No good search result found"}}t.Serper=i},7696:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStoreQATool=void 0;const n=r(5664),a=r(5667);class i extends a.Tool{constructor(e,t,r){super(...arguments),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e,this.description=t,this.vectorStore=r.vectorStore,this.llm=r.llm,this.chain=n.VectorDBQAChain.fromLLM(this.llm,this.vectorStore)}static getDescription(e,t){return`Useful for when you need to answer questions about ${e}. Whenever you need information about ${t} you should ALWAYS use this. Input should be a fully formed question.`}async _call(e){return this.chain.run(e)}}t.VectorStoreQATool=i},6192:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WikipediaQueryRun=void 0;const n=r(5667);class a extends n.Tool{constructor(e={}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"wikipedia-api"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A tool for interacting with and fetching data from the Wikipedia API."}),Object.defineProperty(this,"topKResults",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"maxDocContentLength",{enumerable:!0,configurable:!0,writable:!0,value:4e3}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"https://en.wikipedia.org/w/api.php"}),this.topKResults=e.topKResults??this.topKResults,this.maxDocContentLength=e.maxDocContentLength??this.maxDocContentLength,this.baseUrl=e.baseUrl??this.baseUrl}async _call(e){const t=await this._fetchSearchResults(e),r=[];for(let e=0;e<Math.min(this.topKResults,t.query.search.length);e+=1){const n=t.query.search[e].title,a=await this._fetchPage(n,!0);if(a){const e=`Page: ${n}\nSummary: ${a.extract}`;r.push(e)}}return 0===r.length?"No good Wikipedia Search Result was found":r.join("\n\n").slice(0,this.maxDocContentLength)}async content(e,t=!0){try{return(await this._fetchPage(e,t)).extract}catch(t){throw new Error(`Failed to fetch content for page "${e}": ${t}`)}}buildUrl(e){const t=Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,`${t}`])),r=new URLSearchParams(t);return`${this.baseUrl}?${r}`}async _fetchSearchResults(e){const t=new URLSearchParams({action:"query",list:"search",srsearch:e,format:"json"}),r=await fetch(`${this.baseUrl}?${t.toString()}`);if(!r.ok)throw new Error("Network response was not ok");return await r.json()}async _fetchPage(e,t){const r=new URLSearchParams({action:"query",prop:"extracts",explaintext:"true",redirects:t?"1":"0",format:"json",titles:e}),n=await fetch(`${this.baseUrl}?${r.toString()}`);if(!n.ok)throw new Error("Network response was not ok");const a=await n.json(),{pages:i}=a.query;return i[Object.keys(i)[0]]}}t.WikipediaQueryRun=a},2681:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZapierNLARunAction=t.ZapierNLAWrapper=void 0;const n=r(5667),a=r(2888),i=r(104),s=r(9200),o=r(2053);class l extends o.Serializable{get lc_secrets(){return{apiKey:"ZAPIER_NLA_API_KEY"}}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","tools","zapier"]}),Object.defineProperty(this,"zapierNlaApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zapierNlaOAuthAccessToken",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zapierNlaApiBase",{enumerable:!0,configurable:!0,writable:!0,value:"https://nla.zapier.com/api/v1/"}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=e?.oauthAccessToken,r=e?.apiKey,n=t??(0,s.getEnvironmentVariable)("ZAPIER_NLA_OAUTH_ACCESS_TOKEN"),a=r??(0,s.getEnvironmentVariable)("ZAPIER_NLA_API_KEY");if(!a&&!n)throw new Error("Neither ZAPIER_NLA_OAUTH_ACCESS_TOKEN or ZAPIER_NLA_API_KEY are set");n?this.zapierNlaOAuthAccessToken=n:this.zapierNlaApiKey=a,this.caller=new i.AsyncCaller("string"==typeof e?{}:e??{})}_getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json"};return this.zapierNlaOAuthAccessToken?e.Authorization=`Bearer ${this.zapierNlaOAuthAccessToken}`:e["x-api-key"]=this.zapierNlaApiKey,e}async _getActionRequest(e,t,r){const n=r??{};n.instructions=t;const a=this._getHeaders(),i=await this.caller.call(fetch,`${this.zapierNlaApiBase}exposed/${e}/execute/`,{method:"POST",headers:a,body:JSON.stringify(n)});if(!i.ok)throw new Error(`Failed to execute action ${e} with instructions ${t}`);const s=await i.json();if("error"===s.status)throw new Error(`Error from Zapier: ${s.error}`);return s}async runAction(e,t,r){const n=await this._getActionRequest(e,t,r);return"error"===n.status?n.error:n.result}async previewAction(e,t,r){const n=r??{};return n.preview_only=!0,(await this._getActionRequest(e,t,n)).input_params}async listActions(){const e=this._getHeaders(),t=await this.caller.call(fetch,`${this.zapierNlaApiBase}exposed/`,{method:"GET",headers:e});if(!t.ok){if(401===t.status){if(this.zapierNlaOAuthAccessToken)throw new Error("A 401 Unauthorized error was returned. Check that your access token is correct and doesn't need to be refreshed.");throw new Error("A 401 Unauthorized error was returned. Check that your API Key is correct.")}throw new Error("Failed to list actions")}return(await t.json()).results}async runAsString(e,t,r){const n=await this.runAction(e,t,r);return JSON.stringify(n)}async previewAsString(e,t,r){const n=await this.previewAction(e,t,r);return JSON.stringify(n)}async listActionsAsString(){const e=await this.listActions();return JSON.stringify(e)}}t.ZapierNLAWrapper=l;class c extends n.Tool{constructor(e,t,r,n,i){super(),Object.defineProperty(this,"apiWrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"actionId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiWrapper=e,this.actionId=t,this.params=i,this.name=r;const s={...n};delete s.instructions;const o=JSON.stringify(Object.keys(s));this.description=(0,a.renderTemplate)("A wrapper around Zapier NLA actions. The input to this tool is a natural language instruction, for example \"get the latest email from my bank\" or \"send a slack message to the #general channel\". Each tool will have params associated with it that are specified as a list. You MUST take into account the params when creating the instruction. For example, if the params are ['Message_Text', 'Channel'], your instruction should be something like 'send a slack message to the #general channel with the text hello world'. Another example: if the params are ['Calendar', 'Search_Term'], your instruction should be something like 'find the meeting in my personal calendar at 3pm'. Do not make up params, they will be explicitly specified in the tool description. If you do not have enough information to fill in the params, just say 'not enough information provided in the instruction, missing <param>'. If you get a none or null response, STOP EXECUTION, do not try to another tool! This tool specifically used for: {zapier_description}, and has params: {params}","f-string",{zapier_description:r,params:o})}async _call(e){return this.apiWrapper.runAsString(this.actionId,e,this.params)}}t.ZapierNLARunAction=c},2408:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(9476),t)},3913:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepCompareStrict=void 0,t.deepCompareStrict=function e(t,r){const n=typeof t;if(n!==typeof r)return!1;if(Array.isArray(t)){if(!Array.isArray(r))return!1;const n=t.length;if(n!==r.length)return!1;for(let a=0;a<n;a++)if(!e(t[a],r[a]))return!1;return!0}if("object"===n){if(!t||!r)return t===r;const n=Object.keys(t),a=Object.keys(r);if(n.length!==a.length)return!1;for(const a of n)if(!e(t[a],r[a]))return!1;return!0}return t===r}},8135:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dereference=t.initialBaseURI=t.ignoredKeyword=t.schemaMapKeyword=t.schemaArrayKeyword=t.schemaKeyword=void 0;const n=r(2709);t.schemaKeyword={additionalItems:!0,unevaluatedItems:!0,items:!0,contains:!0,additionalProperties:!0,unevaluatedProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},t.schemaArrayKeyword={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},t.schemaMapKeyword={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},t.ignoredKeyword={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},t.initialBaseURI="undefined"!=typeof self&&self.location?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker"),t.dereference=function e(r,a=Object.create(null),i=t.initialBaseURI,s=""){if(r&&"object"==typeof r&&!Array.isArray(r)){const t=r.$id||r.id;if(t){const n=new URL(t,i.href);n.hash.length>1?a[n.href]=r:(n.hash="",""===s?i=n:e(r,a,i))}}else if(!0!==r&&!1!==r)return a;const o=i.href+(s?"#"+s:"");if(void 0!==a[o])throw new Error(`Duplicate schema URI "${o}".`);if(a[o]=r,!0===r||!1===r)return a;if(void 0===r.__absolute_uri__&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:o}),r.$ref&&void 0===r.__absolute_ref__){const e=new URL(r.$ref,i.href);e.hash=e.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:e.href})}if(r.$recursiveRef&&void 0===r.__absolute_recursive_ref__){const e=new URL(r.$recursiveRef,i.href);e.hash=e.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:e.href})}r.$anchor&&(a[new URL("#"+r.$anchor,i.href).href]=r);for(let o in r){if(t.ignoredKeyword[o])continue;const l=`${s}/${(0,n.encodePointer)(o)}`,c=r[o];if(Array.isArray(c)){if(t.schemaArrayKeyword[o]){const t=c.length;for(let r=0;r<t;r++)e(c[r],a,i,`${l}/${r}`)}}else if(t.schemaMapKeyword[o])for(let t in c)e(c[t],a,i,`${l}/${(0,n.encodePointer)(t)}`);else e(c,a,i,l)}return a}},178:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fastFormat=t.fullFormat=void 0;const r=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n=[0,31,28,31,30,31,30,31,31,30,31,30,31],a=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,i=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,l=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,c=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,u=/^(?:\/(?:[^~/]|~0|~1)*)*$/,d=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,p=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,h=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,m=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,f=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,g=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,b=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,y=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i;function v(e){return e.test.bind(e)}function w(e){const t=e.match(r);if(!t)return!1;const a=+t[1],i=+t[2],s=+t[3];return i>=1&&i<=12&&s>=1&&s<=(2==i&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(a)?29:n[i])}function _(e,t){const r=t.match(a);if(!r)return!1;const n=+r[1],i=+r[2],s=+r[3],o=!!r[5];return(n<=23&&i<=59&&s<=59||23==n&&59==i&&60==s)&&(!e||o)}t.fullFormat={date:w,time:_.bind(void 0,!1),"date-time":function(e){const t=e.split(P);return 2==t.length&&w(t[0])&&_(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return O.test(e)&&T.test(e)},"uri-reference":v(s),"uri-template":v(o),url:v(l),email:e=>{if('"'===e[0])return!1;const[t,r,...n]=e.split("@");return!(!t||!r||0!==n.length||t.length>64||r.length>253)&&"."!==t[0]&&!t.endsWith(".")&&!t.includes("..")&&!(!/^[a-z0-9.-]+$/i.test(r)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t))&&r.split(".").every((e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e)))},hostname:v(i),ipv4:v(b),ipv6:v(y),regex:function(e){if(A.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}},uuid:v(c),"json-pointer":v(u),"json-pointer-uri-fragment":v(d),"relative-json-pointer":v(p)},t.fastFormat={...t.fullFormat,date:v(h),time:v(m),"date-time":v(f),"uri-reference":v(g)};const P=/t|\s/i,O=/\/|:/,T=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,A=/[^\\]\\Z/},9476:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3913),t),a(r(8135),t),a(r(178),t),a(r(2709),t),a(r(921),t),a(r(3222),t),a(r(407),t),a(r(3714),t)},2709:(e,t)=>{"use strict";function r(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0}),t.escapePointer=t.encodePointer=void 0,t.encodePointer=function(e){return encodeURI(r(e))},t.escapePointer=r},921:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ucs2length=void 0,t.ucs2length=function(e){let t,r=0,n=e.length,a=0;for(;a<n;)r++,t=e.charCodeAt(a++),t>=55296&&t<=56319&&a<n&&(t=e.charCodeAt(a),56320==(64512&t)&&a++);return r}},407:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validate=void 0;const n=r(3913),a=r(8135),i=r(178),s=r(2709),o=r(3222);t.validate=function e(t,r,l="2019-09",c=(0,a.dereference)(r),u=!0,d=null,p="#",h="#",m=Object.create(null)){if(!0===r)return{valid:!0,errors:[]};if(!1===r)return{valid:!1,errors:[{instanceLocation:p,keyword:"false",keywordLocation:p,error:"False boolean schema."}]};const f=typeof t;let g;switch(f){case"boolean":case"number":case"string":g=f;break;case"object":g=null===t?"null":Array.isArray(t)?"array":"object";break;default:throw new Error(`Instances of "${f}" type are not supported.`)}const{$ref:b,$recursiveRef:y,$recursiveAnchor:v,type:w,const:_,enum:P,required:O,not:T,anyOf:A,allOf:x,oneOf:j,if:E,then:S,else:C,format:I,properties:k,patternProperties:M,additionalProperties:N,unevaluatedProperties:L,minProperties:R,maxProperties:$,propertyNames:D,dependentRequired:F,dependentSchemas:U,dependencies:V,prefixItems:K,items:z,additionalItems:Z,unevaluatedItems:B,contains:q,minContains:H,maxContains:J,minItems:W,maxItems:G,uniqueItems:Y,minimum:X,maximum:Q,exclusiveMinimum:ee,exclusiveMaximum:te,multipleOf:re,minLength:ne,maxLength:ae,pattern:ie,__absolute_ref__:se,__absolute_recursive_ref__:oe}=r,le=[];if(!0===v&&null===d&&(d=r),"#"===y){const n=null===d?c[oe]:d,a=`${h}/$recursiveRef`,i=e(t,null===d?r:d,l,c,u,n,p,a,m);i.valid||le.push({instanceLocation:p,keyword:"$recursiveRef",keywordLocation:a,error:"A subschema had errors."},...i.errors)}if(void 0!==b){const r=c[se||b];if(void 0===r){let e=`Unresolved $ref "${b}".`;throw se&&se!==b&&(e+=`  Absolute URI "${se}".`),e+=`\nKnown schemas:\n- ${Object.keys(c).join("\n- ")}`,new Error(e)}const n=`${h}/$ref`,a=e(t,r,l,c,u,d,p,n,m);if(a.valid||le.push({instanceLocation:p,keyword:"$ref",keywordLocation:n,error:"A subschema had errors."},...a.errors),"4"===l||"7"===l)return{valid:0===le.length,errors:le}}if(Array.isArray(w)){let e=w.length,r=!1;for(let n=0;n<e;n++)if(g===w[n]||"integer"===w[n]&&"number"===g&&t%1==0&&t==t){r=!0;break}r||le.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${w.join('", "')}".`})}else"integer"===w?("number"!==g||t%1||t!=t)&&le.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${w}".`}):void 0!==w&&g!==w&&le.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${w}".`});if(void 0!==_&&("object"===g||"array"===g?(0,n.deepCompareStrict)(t,_)||le.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(_)}.`}):t!==_&&le.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(_)}.`})),void 0!==P&&("object"===g||"array"===g?P.some((e=>(0,n.deepCompareStrict)(t,e)))||le.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(P)}.`}):P.some((e=>t===e))||le.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(P)}.`})),void 0!==T){const r=`${h}/not`;e(t,T,l,c,u,d,p,r).valid&&le.push({instanceLocation:p,keyword:"not",keywordLocation:r,error:'Instance matched "not" schema.'})}let ce=[];if(void 0!==A){const r=`${h}/anyOf`,n=le.length;let a=!1;for(let n=0;n<A.length;n++){const i=A[n],s=Object.create(m),o=e(t,i,l,c,u,!0===v?d:null,p,`${r}/${n}`,s);le.push(...o.errors),a=a||o.valid,o.valid&&ce.push(s)}a?le.length=n:le.splice(n,0,{instanceLocation:p,keyword:"anyOf",keywordLocation:r,error:"Instance does not match any subschemas."})}if(void 0!==x){const r=`${h}/allOf`,n=le.length;let a=!0;for(let n=0;n<x.length;n++){const i=x[n],s=Object.create(m),o=e(t,i,l,c,u,!0===v?d:null,p,`${r}/${n}`,s);le.push(...o.errors),a=a&&o.valid,o.valid&&ce.push(s)}a?le.length=n:le.splice(n,0,{instanceLocation:p,keyword:"allOf",keywordLocation:r,error:"Instance does not match every subschema."})}if(void 0!==j){const r=`${h}/oneOf`,n=le.length,a=j.filter(((n,a)=>{const i=Object.create(m),s=e(t,n,l,c,u,!0===v?d:null,p,`${r}/${a}`,i);return le.push(...s.errors),s.valid&&ce.push(i),s.valid})).length;1===a?le.length=n:le.splice(n,0,{instanceLocation:p,keyword:"oneOf",keywordLocation:r,error:`Instance does not match exactly one subschema (${a} matches).`})}if("object"!==g&&"array"!==g||Object.assign(m,...ce),void 0!==E){const r=`${h}/if`;if(e(t,E,l,c,u,d,p,r,m).valid){if(void 0!==S){const n=e(t,S,l,c,u,d,p,`${h}/then`,m);n.valid||le.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "then" schema.'},...n.errors)}}else if(void 0!==C){const n=e(t,C,l,c,u,d,p,`${h}/else`,m);n.valid||le.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "else" schema.'},...n.errors)}}if("object"===g){if(void 0!==O)for(const e of O)e in t||le.push({instanceLocation:p,keyword:"required",keywordLocation:`${h}/required`,error:`Instance does not have required property "${e}".`});const r=Object.keys(t);if(void 0!==R&&r.length<R&&le.push({instanceLocation:p,keyword:"minProperties",keywordLocation:`${h}/minProperties`,error:`Instance does not have at least ${R} properties.`}),void 0!==$&&r.length>$&&le.push({instanceLocation:p,keyword:"maxProperties",keywordLocation:`${h}/maxProperties`,error:`Instance does not have at least ${$} properties.`}),void 0!==D){const r=`${h}/propertyNames`;for(const n in t){const t=`${p}/${(0,s.encodePointer)(n)}`,a=e(n,D,l,c,u,d,t,r);a.valid||le.push({instanceLocation:p,keyword:"propertyNames",keywordLocation:r,error:`Property name "${n}" does not match schema.`},...a.errors)}}if(void 0!==F){const e=`${h}/dependantRequired`;for(const r in F)if(r in t){const n=F[r];for(const a of n)a in t||le.push({instanceLocation:p,keyword:"dependentRequired",keywordLocation:e,error:`Instance has "${r}" but does not have "${a}".`})}}if(void 0!==U)for(const r in U){const n=`${h}/dependentSchemas`;if(r in t){const a=e(t,U[r],l,c,u,d,p,`${n}/${(0,s.encodePointer)(r)}`,m);a.valid||le.push({instanceLocation:p,keyword:"dependentSchemas",keywordLocation:n,error:`Instance has "${r}" but does not match dependant schema.`},...a.errors)}}if(void 0!==V){const r=`${h}/dependencies`;for(const n in V)if(n in t){const a=V[n];if(Array.isArray(a))for(const e of a)e in t||le.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not have "${e}".`});else{const i=e(t,a,l,c,u,d,p,`${r}/${(0,s.encodePointer)(n)}`);i.valid||le.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not match dependant schema.`},...i.errors)}}}const n=Object.create(null);let a=!1;if(void 0!==k){const r=`${h}/properties`;for(const i in k){if(!(i in t))continue;const o=`${p}/${(0,s.encodePointer)(i)}`,h=e(t[i],k[i],l,c,u,d,o,`${r}/${(0,s.encodePointer)(i)}`);if(h.valid)m[i]=n[i]=!0;else if(a=u,le.push({instanceLocation:p,keyword:"properties",keywordLocation:r,error:`Property "${i}" does not match schema.`},...h.errors),a)break}}if(!a&&void 0!==M){const r=`${h}/patternProperties`;for(const i in M){const o=new RegExp(i),h=M[i];for(const f in t){if(!o.test(f))continue;const g=`${p}/${(0,s.encodePointer)(f)}`,b=e(t[f],h,l,c,u,d,g,`${r}/${(0,s.encodePointer)(i)}`);b.valid?m[f]=n[f]=!0:(a=u,le.push({instanceLocation:p,keyword:"patternProperties",keywordLocation:r,error:`Property "${f}" matches pattern "${i}" but does not match associated schema.`},...b.errors))}}}if(a||void 0===N){if(!a&&void 0!==L){const r=`${h}/unevaluatedProperties`;for(const n in t)if(!m[n]){const a=`${p}/${(0,s.encodePointer)(n)}`,i=e(t[n],L,l,c,u,d,a,r);i.valid?m[n]=!0:le.push({instanceLocation:p,keyword:"unevaluatedProperties",keywordLocation:r,error:`Property "${n}" does not match unevaluated properties schema.`},...i.errors)}}}else{const r=`${h}/additionalProperties`;for(const i in t){if(n[i])continue;const o=`${p}/${(0,s.encodePointer)(i)}`,h=e(t[i],N,l,c,u,d,o,r);h.valid?m[i]=!0:(a=u,le.push({instanceLocation:p,keyword:"additionalProperties",keywordLocation:r,error:`Property "${i}" does not match additional properties schema.`},...h.errors))}}}else if("array"===g){void 0!==G&&t.length>G&&le.push({instanceLocation:p,keyword:"maxItems",keywordLocation:`${h}/maxItems`,error:`Array has too many items (${t.length} > ${G}).`}),void 0!==W&&t.length<W&&le.push({instanceLocation:p,keyword:"minItems",keywordLocation:`${h}/minItems`,error:`Array has too few items (${t.length} < ${W}).`});const r=t.length;let a=0,i=!1;if(void 0!==K){const n=`${h}/prefixItems`,s=Math.min(K.length,r);for(;a<s;a++){const r=e(t[a],K[a],l,c,u,d,`${p}/${a}`,`${n}/${a}`);if(m[a]=!0,!r.valid&&(i=u,le.push({instanceLocation:p,keyword:"prefixItems",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}}if(void 0!==z){const n=`${h}/items`;if(Array.isArray(z)){const s=Math.min(z.length,r);for(;a<s;a++){const r=e(t[a],z[a],l,c,u,d,`${p}/${a}`,`${n}/${a}`);if(m[a]=!0,!r.valid&&(i=u,le.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}}else for(;a<r;a++){const r=e(t[a],z,l,c,u,d,`${p}/${a}`,n);if(m[a]=!0,!r.valid&&(i=u,le.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}if(!i&&void 0!==Z){const n=`${h}/additionalItems`;for(;a<r;a++){const r=e(t[a],Z,l,c,u,d,`${p}/${a}`,n);m[a]=!0,r.valid||(i=u,le.push({instanceLocation:p,keyword:"additionalItems",keywordLocation:n,error:"Items did not match additional items schema."},...r.errors))}}}if(void 0!==q)if(0===r&&void 0===H)le.push({instanceLocation:p,keyword:"contains",keywordLocation:`${h}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==H&&r<H)le.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array has less items (${r}) than minContains (${H}).`});else{const n=`${h}/contains`,a=le.length;let i=0;for(let a=0;a<r;a++){const r=e(t[a],q,l,c,u,d,`${p}/${a}`,n);r.valid?(m[a]=!0,i++):le.push(...r.errors)}i>=(H||0)&&(le.length=a),void 0===H&&void 0===J&&0===i?le.splice(a,0,{instanceLocation:p,keyword:"contains",keywordLocation:n,error:"Array does not contain item matching schema."}):void 0!==H&&i<H?le.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array must contain at least ${H} items matching schema. Only ${i} items were found.`}):void 0!==J&&i>J&&le.push({instanceLocation:p,keyword:"maxContains",keywordLocation:`${h}/maxContains`,error:`Array may contain at most ${J} items matching schema. ${i} items were found.`})}if(!i&&void 0!==B){const n=`${h}/unevaluatedItems`;for(;a<r;a++){if(m[a])continue;const r=e(t[a],B,l,c,u,d,`${p}/${a}`,n);m[a]=!0,r.valid||le.push({instanceLocation:p,keyword:"unevaluatedItems",keywordLocation:n,error:"Items did not match unevaluated items schema."},...r.errors)}}if(Y)for(let e=0;e<r;e++){const a=t[e],i="object"==typeof a&&null!==a;for(let s=0;s<r;s++){if(e===s)continue;const r=t[s];(a===r||i&&"object"==typeof r&&null!==r&&(0,n.deepCompareStrict)(a,r))&&(le.push({instanceLocation:p,keyword:"uniqueItems",keywordLocation:`${h}/uniqueItems`,error:`Duplicate items at indexes ${e} and ${s}.`}),e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER)}}}else if("number"===g){if("4"===l?(void 0!==X&&(!0===ee&&t<=X||t<X)&&le.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${ee?"or equal to ":""} ${X}.`}),void 0!==Q&&(!0===te&&t>=Q||t>Q)&&le.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${te?"or equal to ":""} ${Q}.`})):(void 0!==X&&t<X&&le.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${X}.`}),void 0!==Q&&t>Q&&le.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${Q}.`}),void 0!==ee&&t<=ee&&le.push({instanceLocation:p,keyword:"exclusiveMinimum",keywordLocation:`${h}/exclusiveMinimum`,error:`${t} is less than ${ee}.`}),void 0!==te&&t>=te&&le.push({instanceLocation:p,keyword:"exclusiveMaximum",keywordLocation:`${h}/exclusiveMaximum`,error:`${t} is greater than or equal to ${te}.`})),void 0!==re){const e=t%re;Math.abs(0-e)>=1.1920929e-7&&Math.abs(re-e)>=1.1920929e-7&&le.push({instanceLocation:p,keyword:"multipleOf",keywordLocation:`${h}/multipleOf`,error:`${t} is not a multiple of ${re}.`})}}else if("string"===g){const e=void 0===ne&&void 0===ae?0:(0,o.ucs2length)(t);void 0!==ne&&e<ne&&le.push({instanceLocation:p,keyword:"minLength",keywordLocation:`${h}/minLength`,error:`String is too short (${e} < ${ne}).`}),void 0!==ae&&e>ae&&le.push({instanceLocation:p,keyword:"maxLength",keywordLocation:`${h}/maxLength`,error:`String is too long (${e} > ${ae}).`}),void 0===ie||new RegExp(ie).test(t)||le.push({instanceLocation:p,keyword:"pattern",keywordLocation:`${h}/pattern`,error:"String does not match pattern."}),void 0!==I&&i.fastFormat[I]&&!i.fastFormat[I](t)&&le.push({instanceLocation:p,keyword:"format",keywordLocation:`${h}/format`,error:`String does not match format "${I}".`})}return{valid:0===le.length,errors:le}}},3714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=void 0;const n=r(8135),a=r(407);t.Validator=class{constructor(e,t="2019-09",r=!0){Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"draft",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"shortCircuit",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"lookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lookup=(0,n.dereference)(e)}validate(e){return(0,a.validate)(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),(0,n.dereference)(e,this.lookup)}}},104:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const a=n(r(2693)),i=n(r(5860)),s=[400,401,403,404,405,406,407,408,409];t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in i.default?i.default.default:i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>(0,a.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&s.includes(+t))throw e;const r=e?.response?.data;if("insufficient_quota"===r?.error?.code){const e=new Error(r?.error?.message);throw e.name="InsufficientQuotaError",e}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},2725:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(9669)),i=r(3659);function s(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function o(e){return Array.isArray(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}function c(e,t,r,n,i){return a.default.AxiosError&&"function"==typeof a.default.AxiosError?new a.default.AxiosError(e,a.default.AxiosError[r],t,n,i):function(e,t,r,n,a){return e.config=t,r&&(e.code=r),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}(new Error(e),t,r,n,i)}t.default=async function(e){const t=function(e){const t=new Headers(e.headers);if(e.auth){const r=e.auth.username||"",n=e.auth.password?decodeURI(encodeURIComponent(e.auth.password)):"";t.set("Authorization",`Basic ${btoa(`${r}:${n}`)}`)}const r=e.method.toUpperCase(),n={headers:t,method:r};"GET"!==r&&"HEAD"!==r&&(n.body=e.data,function(e){return"[object FormData]"===toString.call(e)}(n.body)&&("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document&&t.delete("Content-Type")),"string"==typeof n.body&&(n.body=(new TextEncoder).encode(n.body)),e.mode&&(n.mode=e.mode),e.cache&&(n.cache=e.cache),e.integrity&&(n.integrity=e.integrity),e.redirect&&(n.redirect=e.redirect),e.referrer&&(n.referrer=e.referrer),e.timeout&&e.timeout>0&&(n.signal=AbortSignal.timeout(e.timeout)),e.signal&&(n.signal=e.signal),function(e){return void 0===e}(e.withCredentials)||(n.credentials=e.withCredentials?"include":"omit"),"stream"===e.responseType&&n.headers.set("Accept",i.EventStreamContentType);const a=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(function(e){return"[object URLSearchParams]"===toString.call(e)}(t))n=t.toString();else{var a=[];l(t,(function(e,t){null!=e&&(o(e)?t=`${t}[]`:e=[e],l(e,(function(e){!function(e){return"[object Date]"===toString.call(e)}(e)?function(e){return null!==e&&"object"==typeof e}(e)&&(e=JSON.stringify(e)):e=e.toISOString(),a.push(`${s(t)}=${s(e)}`)})))})),n=a.join("&")}if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}((c=e.baseURL,u=e.url,c&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(u)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(c,u):u),e.params,e.paramsSerializer);var c,u;return new Request(a,n)}(e),r=await async function(e,t){let r;try{r=await fetch(e)}catch(r){return r&&"AbortError"===r.name?c("Request aborted",t,"ECONNABORTED",e):r&&"TimeoutError"===r.name?c("Request timeout",t,"ECONNABORTED",e):c("Network Error",t,"ERR_NETWORK",e)}const n={};r.headers.forEach(((e,t)=>{n[t]=e}));const a={ok:r.ok,status:r.status,statusText:r.statusText,headers:n,config:t,request:e};if(r.status>=200&&204!==r.status)if("stream"===t.responseType){const e=r.headers.get("content-type");if(!e?.startsWith(i.EventStreamContentType)){if(r.status>=400)return e?.startsWith("application/json")?(a.data=await r.json(),a):(a.data=await r.text(),a);throw new Error(`Expected content-type to be ${i.EventStreamContentType}, Actual: ${e}`)}await(0,i.getBytes)(r.body,(0,i.getLines)((0,i.getMessages)(t.onmessage)))}else switch(t.responseType){case"arraybuffer":a.data=await r.arrayBuffer();break;case"blob":a.data=await r.blob();break;case"json":a.data=await r.json();break;case"formData":a.data=await r.formData();break;default:a.data=await r.text()}return a}(t,e);return new Promise(((t,n)=>{r instanceof Error?n(r):"[object Function]"===Object.prototype.toString.call(e.settle)?e.settle(t,n,r):function(e,t,r){const{validateStatus:n}=r.config;r.status&&n&&!n(r.status)?t(c(`Request failed with status code ${r.status} and body ${"string"==typeof r.data?r.data:function(e){try{return JSON.stringify(e)}catch(t){return e}}(r.data)}`,r.config,null,r.request,r)):e(r)}(t,n,r)}))}},5545:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEndpoint=void 0,t.getEndpoint=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:a,basePath:i}=e;if(n&&a&&t)return`${a}/${t}`;if(n){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return i}},9200:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironmentVariable=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0,t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>{let e;return e=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",e},t.getRuntimeEnvironment=async function(){if(void 0===r){const e=(0,t.getEnv)();r={library:"langchain-js",runtime:e}}return r},t.getEnvironmentVariable=function(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},3659:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMessages=t.getLines=t.getBytes=t.EventStreamContentType=void 0,t.EventStreamContentType="text/event-stream",t.getBytes=async function(e,t){const r=e.getReader();for(;;){const e=await r.read();if(e.done){t(new Uint8Array,!0);break}t(e.value)}},t.getLines=function(e){let t,r,n,a=!1;return function(i,s){if(s)return void e(i,0,!0);void 0===t?(t=i,r=0,n=-1):t=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(t,i);const o=t.length;let l=0;for(;r<o;){a&&(10===t[r]&&(l=++r),a=!1);let i=-1;for(;r<o&&-1===i;++r)switch(t[r]){case 58:-1===n&&(n=r-l);break;case 13:a=!0;case 10:i=r}if(-1===i)break;e(t.subarray(l,i),n),l=r,n=-1}l===o?t=void 0:0!==l&&(t=t.subarray(l),r-=l)}},t.getMessages=function(e,t,r){let n={data:"",event:"",id:"",retry:void 0};const a=new TextDecoder;return function(i,s,o){if(o)(function(e){return""===e.data&&""===e.event&&""===e.id&&void 0===e.retry})(n)||(e?.(n),n={data:"",event:"",id:"",retry:void 0});else if(0===i.length)e?.(n),n={data:"",event:"",id:"",retry:void 0};else if(s>0){const e=a.decode(i.subarray(0,s)),o=s+(32===i[s+1]?2:1),l=a.decode(i.subarray(o));switch(e){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":t?.(n.id=l);break;case"retry":{const e=parseInt(l,10);Number.isNaN(e)||r?.(n.retry=e);break}}}}}},2867:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAPISpec=void 0;const s=i(r(3320));class o{constructor(e){Object.defineProperty(this,"document",{enumerable:!0,configurable:!0,writable:!0,value:e})}get baseUrl(){return this.document.servers?this.document.servers[0].url:void 0}getPathsStrict(){if(!this.document.paths)throw new Error("No paths found in spec");return this.document.paths}getParametersStrict(){if(!this.document.components?.parameters)throw new Error("No parameters found in spec");return this.document.components.parameters}getSchemasStrict(){if(!this.document.components?.schemas)throw new Error("No schemas found in spec.");return this.document.components.schemas}getRequestBodiesStrict(){if(!this.document.components?.requestBodies)throw new Error("No request body found in spec.");return this.document.components.requestBodies}getPathStrict(e){const t=this.getPathsStrict()[e];if(void 0===t)throw new Error(`No path found for "${e}".`);return t}getReferencedParameter(e){const t=e.$ref.split("/"),r=t[t.length-1];if(void 0===this.getParametersStrict()[r])throw new Error(`No parameter found for "${r}".`);return this.getParametersStrict()[r]}getRootReferencedParameter(e){let t=this.getReferencedParameter(e);for(;void 0!==t.$ref;)t=this.getReferencedParameter(t);return t}getReferencedSchema(e){const t=e.$ref.split("/"),r=t[t.length-1],n=this.getSchemasStrict()[r];if(void 0===n)throw new Error(`No schema found for "${r}".`);return n}getSchema(e){return void 0!==e.$ref?this.getReferencedSchema(e):e}getRootReferencedSchema(e){let t=this.getReferencedSchema(e);for(;void 0!==t.$ref;)t=this.getReferencedSchema(t);return t}getReferencedRequestBody(e){const t=e.$ref.split("/"),r=t[t.length-1],n=this.getRequestBodiesStrict();if(void 0===n[r])throw new Error(`No request body found for "${r}"`);return n[r]}getRootReferencedRequestBody(e){let t=this.getReferencedRequestBody(e);for(;void 0!==t.$ref;)t=this.getReferencedRequestBody(t);return t}getMethodsForPath(e){const t=this.getPathStrict(e);return["get","put","post","delete","options","head","patch","trace"].filter((e=>void 0!==t[e]))}getParametersForPath(e){const t=this.getPathStrict(e);return void 0===t.parameters?[]:t.parameters.map((e=>void 0!==e.$ref?this.getRootReferencedParameter(e):e))}getOperation(e,t){const r=this.getPathStrict(e);if(void 0===r[t])throw new Error(`No ${t} method found for "path".`);return r[t]}getParametersForOperation(e){return void 0===e.parameters?[]:e.parameters.map((e=>void 0!==e.$ref?this.getRootReferencedParameter(e):e))}getRequestBodyForOperation(e){const{requestBody:t}=e;return void 0!==t?.$ref?this.getRootReferencedRequestBody(t):t}static getCleanedOperationId(e,t,r){let{operationId:n}=e;if(void 0===n){const e=t.replace(/[^a-zA-Z0-9]/,"_");n=`${e.startsWith("/")?e.slice(1):e}_${r}`}return n.replace("-","_").replace(".","_").replace("/","_")}static alertUnsupportedSpec(e){const t="This may result in degraded performance. Convert your OpenAPI spec to 3.1.0 for better support.",r=e.swagger,n=e.openapi;if(void 0!==n&&"3.1.0"!==n)console.warn(`Attempting to load an OpenAPI ${n} spec. ${t}`);else{if(void 0===r)throw new Error(`Attempting to load an unsupported spec:\n\n${JSON.stringify(e,null,2)}.`);console.warn(`Attempting to load a Swagger ${r} spec. ${t}`)}}static fromObject(e){return o.alertUnsupportedSpec(e),new o(e)}static fromString(e){let t;try{t=JSON.parse(e)}catch(r){t=s.load(e)}return o.fromObject(t)}static async fromURL(e){const t=await fetch(e),r=await t.text();return o.fromString(r)}}t.OpenAPISpec=o},6045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promptLayerTrackRequest=void 0,t.promptLayerTrackRequest=async(e,t,r,n,a,i,s,o,l)=>(await e.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:t,provider:"langchain",args:r,kwargs:n,tags:a,request_response:i,request_start_time:Math.floor(s/1e3),request_end_time:Math.floor(o/1e3),api_key:l})})).json()},8114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.difference=t.union=t.intersection=void 0,t.intersection=function(e,t){const r=new Set;for(const n of t)e.has(n)&&r.add(n);return r},t.union=function(e,t){const r=new Set(e);for(const e of t)r.add(e);return r},t.difference=function(e,t){const r=new Set(e);for(const e of t)r.delete(e);return r}},8065:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IterableReadableStream=t.readableStreamToAsyncIterable=void 0,t.readableStreamToAsyncIterable=function(e,t=!1){if(e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();const r=e.getReader();return{async next(){try{const e=await r.read();return e.done&&r.releaseLock(),e}catch(e){throw r.releaseLock(),e}},async return(){if(t)r.releaseLock();else{const e=r.cancel();r.releaseLock(),await e}return{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}};class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new r({start:e=>function r(){return t.read().then((({done:t,value:n})=>{if(!t)return e.enqueue(n),r();e.close()}))}()})}static fromAsyncGenerator(e){return new r({async pull(t){const{value:r,done:n}=await e.next();n?t.close():r&&t.enqueue(r)}})}}t.IterableReadableStream=r},5367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodingForModel=t.getEncoding=void 0;const n=r(7121),a=r(104),i={},s=new a.AsyncCaller({});async function o(e,t){return e in i||(i[e]=s.fetch(`https://tiktoken.pages.dev/js/${e}.json`,{signal:t?.signal}).then((e=>e.json())).catch((t=>{throw delete i[e],t}))),new n.Tiktoken(await i[e],t?.extendedSpecialTokens)}t.getEncoding=o,t.encodingForModel=async function(e,t){return o((0,n.getEncodingNameForModel)(e),t)}},6815:(e,t,r)=>{e.exports=r(556)},8192:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const s=i(r(7429)),o=r(2166),l=r(2209),c=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},u=async(e,t)=>{const r=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};function d(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}class p{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=p.getDefaultClientConfig();this.apiUrl=d(e.apiUrl??t.apiUrl)??"",this.apiKey=d(e.apiKey??t.apiKey),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new o.AsyncCaller(e.callerOptions??{})}static getDefaultClientConfig(){const e=(0,l.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,l.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e}}validateApiKeyIfHosted(){if(!c(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return c(this.apiUrl)?"http://localhost":this.apiUrl.split(".",1)[0].includes("dev")?"https://dev.smith.langchain.com":"https://smith.langchain.com"}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const r=t?.toString()??"",n=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);return a.json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(n));const a=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const s=await i.json();if(0===s.length)break;if(yield s,s.length<n)break;r+=s.length}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},n=await(0,l.getRuntimeEnvironment)(),a=e.project_name;delete e.project_name;const i={session_name:a,...e,extra:{...e.extra,runtime:{...n,...r.runtime}}},s=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await u(s,"create run")}async updateRun(e,t){const r={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await u(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e}){const t=await this.readRun(e);if(t.app_path)return`${this.getHostUrl()}${t.app_path}`}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},n={};t.sort(((e,t)=>e.execution_order-t.execution_order));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),n[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(n[t].child_runs=r[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:n,datasetId:a,startTime:i,endTime:s,executionOrder:o,runType:l,error:c,id:u,limit:d,offset:p,query:h,filter:m,orderBy:f}){const g=new URLSearchParams;let b=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");b=(await this.readProject({projectName:t})).id}if(b&&g.append("session",b),r&&g.append("parent_run",r),n&&g.append("reference_example",n),a&&g.append("dataset",a),i&&g.append("start_time",i.toISOString()),s&&g.append("end_time",s.toISOString()),o&&g.append("execution_order",o.toString()),l&&g.append("run_type",l),void 0!==c&&g.append("error",c.toString()),void 0!==u)for(const e of u)g.append("id",e);void 0!==d&&g.append("limit",d.toString()),void 0!==p&&g.append("offset",p.toString()),void 0!==h&&g.append("query",h),void 0!==m&&g.append("filter",m),void 0!==f&&f.map((e=>g.append("order_by",e)));for await(const e of this._getPaginated("/runs",g))yield*e}async deleteRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await u(t,"delete run")}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||s.v4()},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),a=await n.json();if(null===a||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await u(t,"unshare run")}async readRunSharedLink(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async createProject({projectName:e,projectExtra:t,upsert:r}){const n=r?"?upsert=true":"",a=`${this.apiUrl}/sessions${n}`,i={name:e};void 0!==t&&(i.extra=t);const s=await this.caller.call(fetch,a,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)}),o=await s.json();if(!s.ok)throw new Error(`Failed to create session ${e}: ${s.status} ${s.statusText}`);return o}async readProject({projectId:e,projectName:t}){let r="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}const a=await this._get(r,n);let i;if(Array.isArray(a)){if(0===a.length)throw new Error(`Project[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async*listProjects(){for await(const e of this._getPaginated("/sessions"))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e;const n=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await u(n,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:n,description:a,dataType:i,name:s}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach((e=>{l.append("input_keys",e)})),n.forEach((e=>{l.append("output_keys",e)})),a&&l.append("description",a),i&&l.append("data_type",i),s&&l.append("name",s);const c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok){const e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:r}={}){const n={name:e,description:t};r&&(n.data_type=r);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok){const t=await a.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${a.status} ${a.statusText}`)}return await a.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");n.append("name",t)}const a=await this._get(r,n);let i;if(Array.isArray(a)){if(0===a.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:n,datasetNameContains:a}={}){const i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)i.append("id",e);void 0!==n&&i.append("name",n),void 0!==a&&i.append("name_contains",a);for await(const e of this._getPaginated("/datasets",i))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",n=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(n=(await this.readDataset({datasetName:t})).id),void 0===n)throw new Error("Must provide datasetName or datasetId");r+=`/${n}`;const a=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to delete ${r}: ${a.status} ${a.statusText}`);await a.json()}async createExample(e,t,{datasetId:r,datasetName:n,createdAt:a}){let i=r;if(void 0===i&&void 0===n)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:n})).id);const s={dataset_id:i,inputs:e,outputs:t,created_at:(a||new Date).toISOString()},o=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!o.ok)throw new Error(`Failed to create example: ${o.status} ${o.statusText}`);return await o.json()}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let n;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)n=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");n=(await this.readDataset({datasetName:t})).id}const a=new URLSearchParams({dataset:n});if(void 0!==r)for(const e of r)a.append("id",e);for await(const e of this._getPaginated("/examples",a))yield*e}async deleteExample(e){const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:n}={loadChildRuns:!1}){let a,i;if("string"==typeof e)a=await this.readRun(e,{loadChildRuns:n});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);a=e}null!==a.reference_example_id&&void 0!==a.reference_example_id&&(i=await this.readExample(a.reference_example_id));const s=await t.evaluateRun(a,i);let o=r??{};return s.evaluatorInfo&&(o={...o,...s.evaluatorInfo}),await this.createFeedback(a.id,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,feedbackSourceType:"MODEL"})}async createFeedback(e,t,{score:r,value:n,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="API"}){let c;if("API"===l)c={type:"api",metadata:o??{}};else{if("MODEL"!==l)throw new Error(`Unknown feedback source type ${l}`);c={type:"model",metadata:o??{}}}const u={id:s.v4(),run_id:e,key:t,score:r,value:n,correction:a,comment:i,feedback_source:c},d=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!d.ok)throw new Error(`Failed to create feedback for run ${e}: ${d.status} ${d.statusText}`);return await d.json()}async updateFeedback(e,{score:t,value:r,correction:n,comment:a}){const i={};return null!=t&&(i.score=t),null!=r&&(i.value=r),null!=n&&(i.correction=n),null!=a&&(i.comment=a),(await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e}={}){const t=new URLSearchParams;e&&t.append("run",e.join(","));for await(const e of this._getPaginated("/feedback",t))yield*e}}t.Client=p},2034:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RunTree=t.Client=void 0;var n=r(8192);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return n.Client}});var a=r(930);Object.defineProperty(t,"RunTree",{enumerable:!0,get:function(){return a.RunTree}})},930:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RunTree=void 0;const s=i(r(7429)),o=r(2209),l=r(8192);class c{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=c.getDefaultConfig();Object.assign(this,{...t,...e})}static getDefaultConfig(){return{id:s.v4(),project_name:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,o.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],execution_order:1,child_execution_order:1,api_url:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{},client:new l.Client({})}}async createChild(e){const t=new c({...e,parent_run:this,project_name:this.project_name,client:this.client,execution_order:this.child_execution_order+1,child_execution_order:this.child_execution_order+1});return this.child_runs.push(t),t}async end(e,t,r=Date.now()){this.outputs=e,this.error=t,this.end_time=r,this.parent_run&&(this.parent_run.child_execution_order=Math.max(this.parent_run.child_execution_order,this.child_execution_order))}async _convertToCreate(e,t=!0){const r=e.extra??{};r.runtime||(r.runtime={});const n=await(0,o.getRuntimeEnvironment)();for(const[e,t]of Object.entries(n))r.runtime[e]||(r.runtime[e]=t);let a,i;return t?(i=e.parent_run?.id,a=[]):(a=await Promise.all(e.child_runs.map((e=>this._convertToCreate(e,t)))),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:r,execution_order:e.execution_order,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i}}async postRun(e=!0){const t=await this._convertToCreate(this,e);await this.client.createRun(t)}async patchRun(){const e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events};await this.client.updateRun(this.id,e)}}t.RunTree=c},2166:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const a=n(r(2693)),i=n(r(5860)),s=[400,401,403,404,405,406,407,408,409];t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in i.default?i.default.default:i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>(0,a.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&s.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},2209:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.setEnvironmentVariable=t.getEnvironmentVariable=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0,t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>{let e;return e=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",e},t.getRuntimeEnvironment=async function(){if(void 0===r){const e=(0,t.getEnv)();r={library:"langsmith",runtime:e}}return r},t.getEnvironmentVariable=function(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}},t.setEnvironmentVariable=function(e,t){"undefined"!=typeof process&&(process.env[e]=t)}},4547:(e,t,r)=>{e.exports=r(2034)},4363:(e,t,r)=>{"use strict";r.d(t,{ZeroShotAgent:()=>b});var n=r(3995),a=r(6430),i=r(5738),s=r(2385);class o extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class l extends s.i{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw new Error("Not implemented")}returnStoppedResponse(e,t,r,n){if("force"===e)return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw new Error(`Invalid stopping method: ${e}`)}async prepareForOutput(e,t){return{}}}class c extends l{_agentActionType(){return"single"}}class u extends c{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter((e=>"agent_scratchpad"!==e))}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this._allowedTools=e.allowedTools,this.outputParser=e.outputParser}static getDefaultOutputParser(e){throw new Error("Not implemented")}static createPrompt(e,t){throw new Error("Not implemented")}static fromLLMAndTools(e,t,r){throw new Error("Not implemented")}static validateTools(e){}_stop(){return[`\n${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}async constructScratchPad(e){return e.reduce(((e,{action:t,observation:r})=>e+[t.log,`${this.observationPrefix()}${r}`,this.llmPrefix()].join("\n")),"")}async _plan(e,t,r,n){const a=await this.constructScratchPad(e),i={...t,agent_scratchpad:r?`${a}${r}`:a};0!==this._stop().length&&(i.stop=this._stop());const s=await this.llmChain.predict(i,n);if(!this.outputParser)throw new Error("Output parser not set");return this.outputParser.parse(s,n)}plan(e,t,r){return this._plan(e,t,void 0,r)}async returnStoppedResponse(e,t,r,n){if("force"===e)return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if("generate"===e)try{const e=await this._plan(t,r,"\n\nI now need to return a final answer based on the previous steps:",n);return"returnValues"in e?e:{returnValues:{output:e.log},log:e.log}}catch(e){if(!(e instanceof o))throw e;return{returnValues:{output:e.output},log:e.output}}throw new Error(`Invalid stopping method: ${e}`)}static async deserialize(e){if("zero-shot-react-description"===e._type){const{ZeroShotAgent:t}=await Promise.resolve().then(r.bind(r,4363));return t.deserialize(e)}throw new Error("Unknown agent type")}}var d=r(8869);class p extends d.bI{}const h="Answer the following questions as best you can. You have access to the following tools:",m="Use the following format in your response:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question",f="Begin!\n\nQuestion: {input}\nThought:{agent_scratchpad}";class g extends p{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=e?.finishToolName||"Final Answer:"}async parse(e){if(e.includes(this.finishToolName)){const t=e.split(this.finishToolName);return{returnValues:{output:t[t.length-1].trim()},log:e}}const t=/Action: ([\s\S]*?)(?:\nAction Input: ([\s\S]*?))?$/.exec(e);if(!t)throw new Error(`Could not parse LLM output: ${e}`);return{tool:t[1].trim(),toolInput:t[2]?t[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:e}}getFormatInstructions(){return m}}class b extends u{constructor(e){const t=e?.outputParser??b.getDefaultOutputParser();super({...e,outputParser:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(e){return new g(e)}static validateTools(e){const t=e.find((e=>!e.description));if(t){const e=`Got a tool ${t.name} without a description. This agent requires descriptions for all tools.`;throw new Error(e)}}static createPrompt(e,t){const{prefix:r=h,suffix:n=f,inputVariables:s=["input","agent_scratchpad"]}=t??{},o=e.map((e=>`${e.name}: ${e.description}`)).join("\n"),l=e.map((e=>e.name)),c=[r,o,(0,i.SM)(m,"f-string",{tool_names:l}),n].join("\n\n");return new a.PromptTemplate({template:c,inputVariables:s})}static fromLLMAndTools(e,t,r){b.validateTools(t);const a=b.createPrompt(t,r),i=r?.outputParser??b.getDefaultOutputParser(),s=new n.LLMChain({prompt:a,llm:e,callbacks:r?.callbacks??r?.callbackManager});return new b({llmChain:s,allowedTools:t.map((e=>e.name)),outputParser:i})}static async deserialize(e){const{llm:t,tools:r,...a}=e;return(async(e,t,r,a,i)=>{if(r.load_from_llm_and_tools){if(!e)throw new Error("Loading from llm and tools, llm must be provided.");if(!t)throw new Error("Loading from llm and tools, tools must be provided.");return((e,t,r)=>b.fromLLMAndTools(e,t,{prefix:r.prefix,suffix:r.suffix,inputVariables:r.input_variables}))(e,t,r)}if(!r.llm_chain)throw new Error("Loading from constructor, llm_chain must be provided.");const s=await n.LLMChain.deserialize(r.llm_chain);return o={...r,llmChain:s},new b(o);var o})(t,r,a)}}},1023:(e,t,r)=>{"use strict";r.d(t,{_i:()=>n}),r(8186);const n=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e},8610:(e,t,r)=>{"use strict";r.d(t,{BD:()=>c,qV:()=>u});var n=r(803),a=r(1023),i=r(8186),s=r(0),o=r(5962),l=r(2587);class c extends s.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class u extends c{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new n.L(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await(0,i.b)("modelName"in this?(0,a._i)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return"string"==typeof e?new o.nw(e):Array.isArray(e)?new l.GU(e):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:n,...a}=e;if(n&&"base_chat_model"!==n)throw new Error(`Cannot load LLM with model ${n}`);const i={openai:(await Promise.resolve().then(r.bind(r,5019))).ChatOpenAI}[t];if(void 0===i)throw new Error(`Cannot load LLM with type ${t}`);return new i(a)}}},1345:(e,t,r)=>{"use strict";r.d(t,{Ye:()=>z,QH:()=>R});const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a;const i=new Uint8Array(16);function s(){if(!a&&(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(i)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));const l=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();const a=(e=e||{}).random||(e.rng||s)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(a)};var c=r(2385);class u{}class d extends u{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!==process.env?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return c.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return c.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends d{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:l()}),Object.assign(this,e)}}}}var p=r(4880);class h extends d{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(void 0!==e.parent_run_id){const t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c=s?{...a,metadata:s}:a,u={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:{prompts:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:c??{},tags:i||[]};this._startTrace(u),await(this.onLLMStart?.(u))}async handleChatModelStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c=s?{...a,metadata:s}:a,u={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:{messages:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:c??{},tags:i||[]};this._startTrace(u),await(this.onLLMStart?.(u))}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await(this.onLLMEnd?.(r)),await this._endTrace(r)}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onLLMError?.(r)),await this._endTrace(r)}async handleChainStart(e,t,r,n,a,i,s){const o=this._getExecutionOrder(n),l=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:l}],inputs:t,execution_order:o,child_execution_order:o,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(c),await(this.onChainStart?.(c))}async handleChainEnd(e,t){const r=this.runMap.get(t);if(!r)throw new Error("No chain run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await(this.onChainEnd?.(r)),await this._endTrace(r)}async handleChainError(e,t){const r=this.runMap.get(t);if(!r)throw new Error("No chain run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onChainError?.(r)),await this._endTrace(r)}async handleToolStart(e,t,r,n,a,i){const s=this._getExecutionOrder(n),o=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:{input:t},execution_order:s,child_execution_order:s,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(l),await(this.onToolStart?.(l))}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:r.end_time}),await(this.onToolEnd?.(r)),await this._endTrace(r)}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onToolError?.(r)),await this._endTrace(r)}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const n=r;n.actions=n.actions||[],n.actions.push(e),n.events.push({name:"agent_action",time:Date.now(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:Date.now(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}async handleRetrieverStart(e,t,r,n,a,i){const s=this._getExecutionOrder(n),o=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:n,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:{query:t},execution_order:s,child_execution_order:s,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};this._startTrace(l),await(this.onRetrieverStart?.(l))}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:r.end_time}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r)}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await(this.onRetrieverError?.(r)),await this._endTrace(r)}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:Date.now(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r){const n=this.runMap.get(r);n&&"llm"===n?.run_type&&(n.events.push({name:"new_token",time:Date.now(),kwargs:{token:e,idx:t}}),await(this.onLLMNewToken?.(n)))}}function m(e,t){return`${e.open}${t}${e.close}`}function f(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function g(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:b}=p;class y extends h{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const n=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?m(p.bold,n):n})).join(" > ");return m(b.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.green,"[chain/start]")} [${t}] Entering Chain run with input: ${f(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.cyan,"[chain/end]")} [${t}] [${g(e)}] Exiting Chain run with output: ${f(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.red,"[chain/error]")} [${t}] [${g(e)}] Chain run errored with error: ${f(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${m(b.green,"[llm/start]")} [${t}] Entering LLM run with input: ${f(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.cyan,"[llm/end]")} [${t}] [${g(e)}] Exiting LLM run with output: ${f(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.red,"[llm/error]")} [${t}] [${g(e)}] LLM run errored with error: ${f(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.cyan,"[tool/end]")} [${t}] [${g(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.red,"[tool/error]")} [${t}] [${g(e)}] Tool run errored with error: ${f(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${f(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.cyan,"[retriever/end]")} [${t}] [${g(e)}] Exiting Retriever run with output: ${f(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${m(b.red,"[retriever/error]")} [${t}] [${g(e)}] Retriever run errored with error: ${f(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${m(b.blue,"[agent/action]")} [${r}] Agent selected action: ${f(t.actions[t.actions.length-1],"[action]")}`)}}var v=r(2693),w=r(5860);const _=[400,401,403,404,405,406,407,408,409];class P{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t=w.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>v((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&_.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}const O=()=>"undefined"!=typeof Deno;let T;function A(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}const x=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},j=async(e,t)=>{const r=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};function E(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}class S{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=S.getDefaultClientConfig();this.apiUrl=E(e.apiUrl??t.apiUrl)??"",this.apiKey=E(e.apiKey??t.apiKey),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new P(e.callerOptions??{})}static getDefaultClientConfig(){const e=A("LANGCHAIN_API_KEY");return{apiUrl:A("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e}}validateApiKeyIfHosted(){if(!x(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return x(this.apiUrl)?"http://localhost":this.apiUrl.split(".",1)[0].includes("dev")?"https://dev.smith.langchain.com":"https://smith.langchain.com"}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const r=t?.toString()??"",n=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);return a.json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(n));const a=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const s=await i.json();if(0===s.length)break;if(yield s,s.length<n)break;r+=s.length}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},n=await async function(){if(void 0===T){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||O()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":O()?"deno":"other":"node",e})();T={library:"langsmith",runtime:e}}return T}(),a=e.project_name;delete e.project_name;const i={session_name:a,...e,extra:{...e.extra,runtime:{...n,...r.runtime}}},s=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await j(s,"create run")}async updateRun(e,t){const r={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await j(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e}){const t=await this.readRun(e);if(t.app_path)return`${this.getHostUrl()}${t.app_path}`}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},n={};t.sort(((e,t)=>e.execution_order-t.execution_order));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),n[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(n[t].child_runs=r[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:n,datasetId:a,startTime:i,endTime:s,executionOrder:o,runType:l,error:c,id:u,limit:d,offset:p,query:h,filter:m,orderBy:f}){const g=new URLSearchParams;let b=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");b=(await this.readProject({projectName:t})).id}if(b&&g.append("session",b),r&&g.append("parent_run",r),n&&g.append("reference_example",n),a&&g.append("dataset",a),i&&g.append("start_time",i.toISOString()),s&&g.append("end_time",s.toISOString()),o&&g.append("execution_order",o.toString()),l&&g.append("run_type",l),void 0!==c&&g.append("error",c.toString()),void 0!==u)for(const e of u)g.append("id",e);void 0!==d&&g.append("limit",d.toString()),void 0!==p&&g.append("offset",p.toString()),void 0!==h&&g.append("query",h),void 0!==m&&g.append("filter",m),void 0!==f&&f.map((e=>g.append("order_by",e)));for await(const e of this._getPaginated("/runs",g))yield*e}async deleteRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"delete run")}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||l()},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),a=await n.json();if(null===a||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"unshare run")}async readRunSharedLink(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async createProject({projectName:e,projectExtra:t,upsert:r}){const n=r?"?upsert=true":"",a=`${this.apiUrl}/sessions${n}`,i={name:e};void 0!==t&&(i.extra=t);const s=await this.caller.call(fetch,a,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)}),o=await s.json();if(!s.ok)throw new Error(`Failed to create session ${e}: ${s.status} ${s.statusText}`);return o}async readProject({projectId:e,projectName:t}){let r="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}const a=await this._get(r,n);let i;if(Array.isArray(a)){if(0===a.length)throw new Error(`Project[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async*listProjects(){for await(const e of this._getPaginated("/sessions"))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e;const n=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(n,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:n,description:a,dataType:i,name:s}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach((e=>{l.append("input_keys",e)})),n.forEach((e=>{l.append("output_keys",e)})),a&&l.append("description",a),i&&l.append("data_type",i),s&&l.append("name",s);const c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok){const e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:r}={}){const n={name:e,description:t};r&&(n.data_type=r);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok){const t=await a.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${a.status} ${a.statusText}`)}return await a.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");n.append("name",t)}const a=await this._get(r,n);let i;if(Array.isArray(a)){if(0===a.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:n,datasetNameContains:a}={}){const i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)i.append("id",e);void 0!==n&&i.append("name",n),void 0!==a&&i.append("name_contains",a);for await(const e of this._getPaginated("/datasets",i))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",n=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(n=(await this.readDataset({datasetName:t})).id),void 0===n)throw new Error("Must provide datasetName or datasetId");r+=`/${n}`;const a=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to delete ${r}: ${a.status} ${a.statusText}`);await a.json()}async createExample(e,t,{datasetId:r,datasetName:n,createdAt:a}){let i=r;if(void 0===i&&void 0===n)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:n})).id);const s={dataset_id:i,inputs:e,outputs:t,created_at:(a||new Date).toISOString()},o=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!o.ok)throw new Error(`Failed to create example: ${o.status} ${o.statusText}`);return await o.json()}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let n;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)n=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");n=(await this.readDataset({datasetName:t})).id}const a=new URLSearchParams({dataset:n});if(void 0!==r)for(const e of r)a.append("id",e);for await(const e of this._getPaginated("/examples",a))yield*e}async deleteExample(e){const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:n}={loadChildRuns:!1}){let a,i;if("string"==typeof e)a=await this.readRun(e,{loadChildRuns:n});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);a=e}null!==a.reference_example_id&&void 0!==a.reference_example_id&&(i=await this.readExample(a.reference_example_id));const s=await t.evaluateRun(a,i);let o=r??{};return s.evaluatorInfo&&(o={...o,...s.evaluatorInfo}),await this.createFeedback(a.id,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,feedbackSourceType:"MODEL"})}async createFeedback(e,t,{score:r,value:n,correction:a,comment:i,sourceInfo:s,feedbackSourceType:o="API"}){let c;if("API"===o)c={type:"api",metadata:s??{}};else{if("MODEL"!==o)throw new Error(`Unknown feedback source type ${o}`);c={type:"model",metadata:s??{}}}const u={id:l(),run_id:e,key:t,score:r,value:n,correction:a,comment:i,feedback_source:c},d=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!d.ok)throw new Error(`Failed to create feedback for run ${e}: ${d.status} ${d.statusText}`);return await d.json()}async updateFeedback(e,{score:t,value:r,correction:n,comment:a}){const i={};return null!=t&&(i.score=t),null!=r&&(i.value=r),null!=n&&(i.correction=n),null!=a&&(i.comment=a),(await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e}={}){const t=new URLSearchParams;e&&t.append("run",e.join(","));for await(const e of this._getPaginated("/feedback",t))yield*e}}var C=r(5606);class I extends h{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:n}=e;this.projectName=r??(0,C.lS)("LANGCHAIN_PROJECT")??(0,C.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=n??new S({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,C.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}function k(e,t="Human",r="AI"){const n=[];for(const a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=r;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else{if("generic"!==a._getType())throw new Error(`Got unsupported message type: ${a}`);e=a.role}const i=a.name?`${a.name}, `:"";n.push(`${e}: ${i}${a.content}`)}return n.join("\n")}class M extends h{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,C.lS)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=(0,C.lS)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){const t=this.session??await this.loadDefaultSession(),r=e.serialized;let n;if("llm"===e.run_type){const a=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map((e=>k(e)));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:a,response:e.outputs}}else if("chain"===e.run_type){const a=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter((e=>"llm"===e.type)),child_chain_runs:a.filter((e=>"chain"===e.type)),child_tool_runs:a.filter((e=>"tool"===e.type))}}else{if("tool"!==e.run_type)throw new Error(`Unknown run type: ${e.run_type}`);{const a=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(r),child_llm_runs:a.filter((e=>"llm"===e.type)),child_chain_runs:a.filter((e=>"chain"===e.type)),child_tool_runs:a.filter((e=>"tool"===e.type))}}}return n}async persistRun(e){let t,r;r=void 0!==e.run_type?await this.convertV2RunToRun(e):e,t="llm"===r.type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;const n=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});n.ok||console.error(`Failed to persist run: ${n.status} ${n.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const n=await t.json();return 0===n.length?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=n,this.session=r,r)}}let N;async function L(e,t){!0===t?await e():(void 0===N&&(N=new(0,w.default)({autoStart:!0,concurrency:1})),N.add(e))}function R(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class ${setHandler(e){return this.setHandlers([e])}}class D{constructor(e,t,r,n,a,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>L((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class F extends D{getChild(e){const t=new z(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class U extends D{async handleLLMNewToken(e,t={prompt:0,completion:0}){await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class V extends D{getChild(e){const t=new z(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class K extends D{getChild(e){const t=new z(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class z extends ${constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,n=void 0,a=void 0){return Promise.all(t.map((async t=>{const r=l();return await Promise.all(this.handlers.map((n=>L((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new U(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r=void 0,n=void 0,a=void 0){return Promise.all(t.map((async t=>{const r=l();return await Promise.all(this.handlers.map((n=>L((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata));else if(n.handleLLMStart){const i=k(t);await(n.handleLLMStart?.(e,[i],r,this._parentRunId,a,this.tags,this.metadata))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new U(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=l(),n=void 0){return await Promise.all(this.handlers.map((a=>L((async()=>{if(!a.ignoreChain)try{await(a.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleChainStart: ${e}`)}}),a.awaitHandlers)))),new V(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=l()){return await Promise.all(this.handlers.map((n=>L((async()=>{if(!n.ignoreAgent)try{await(n.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleToolStart: ${e}`)}}),n.awaitHandlers)))),new K(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=l(),n=void 0){return await Promise.all(this.handlers.map((n=>L((async()=>{if(!n.ignoreRetriever)try{await(n.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleRetrieverStart: ${e}`)}}),n.awaitHandlers)))),new F(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new z(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const n of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===n.name))||r.addHandler(n,t);return r}static fromHandlers(e){const t=new this;return t.addHandler(new class extends d{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:l()}),Object.assign(this,e)}}),t}static async configure(e,t,r,n,a,i,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new z,o.setHandlers(e?.map(Z)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(Z):t?.handlers,!1));const l=(0,C.lS)("LANGCHAIN_VERBOSE")||s?.verbose,c=(0,C.lS)("LANGCHAIN_TRACING_V2")??!1,u=c||((0,C.lS)("LANGCHAIN_TRACING")??!1);if(l||u){if(o||(o=new z),l&&!o.handlers.some((e=>e.name===y.prototype.name))){const e=new y;o.addHandler(e,!0)}if(u&&!o.handlers.some((e=>"langchain_tracer"===e.name)))if(c)o.addHandler(await async function(){return new I}(),!0);else{const e=(0,C.lS)("LANGCHAIN_PROJECT")&&(0,C.lS)("LANGCHAIN_SESSION");o.addHandler(await async function(e){const t=new M;return e?await t.loadSession(e):await t.loadDefaultSession(),t}(e),!0)}}return(r||n)&&o&&(o.addTags(r??[]),o.addTags(n??[],!1)),(a||i)&&o&&(o.addMetadata(a??{}),o.addMetadata(i??{},!1)),o}}function Z(e){return"name"in e?e:d.fromMethods(e)}},2702:(e,t,r)=>{"use strict";r.d(t,{APIChain:()=>u});var n=r(5641),a=r(3995),i=r(6430);const s="You are given the below API Documentation:\n{api_docs}\nUsing this documentation, generate the full API url to call for answering the user question.\nYou should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.\n\nQuestion:{question}\nAPI url:",o=new i.PromptTemplate({inputVariables:["api_docs","question"],template:s}),l=`${s} {api_url}\n\nHere is the response from the API:\n\n{api_response}\n\nSummarize this response to answer the original question.\n\nSummary:`,c=new i.PromptTemplate({inputVariables:["api_docs","question","api_url","api_response"],template:l});class u extends n.l{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){const r=e[this.inputKey],n=await this.apiRequestChain.predict({question:r,api_docs:this.apiDocs},t?.getChild("request")),a=await fetch(n,{headers:this.headers}),i=await a.text(),s=await this.apiAnswerChain.predict({question:r,api_docs:this.apiDocs,api_url:n,api_response:i},t?.getChild("response"));return{[this.outputKey]:s}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:t,api_answer_chain:r,api_docs:n}=e;if(!t)throw new Error("LLMChain must have api_request_chain");if(!r)throw new Error("LLMChain must have api_answer_chain");if(!n)throw new Error("LLMChain must have api_docs");return new u({apiAnswerChain:await a.LLMChain.deserialize(r),apiRequestChain:await a.LLMChain.deserialize(t),apiDocs:n})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,r={}){const{apiUrlPrompt:n=o,apiResponsePrompt:i=c}=r,s=new a.LLMChain({prompt:n,llm:e});return new this({apiAnswerChain:new a.LLMChain({prompt:i,llm:e}),apiRequestChain:s,apiDocs:t,...r})}}},5641:(e,t,r)=>{"use strict";r.d(t,{l:()=>s});var n=r(6134),a=r(1345),i=r(8610);class s extends i.BD{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(1!==arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:r}),this.memory=e;else{const{memory:t,callbackManager:r,...n}=e;super({...n,callbacks:r??n.callbacks}),this.memory=t}}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter((e=>!this.memory?.memoryKeys.includes(e)??!0));if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const n=r.length?{[r[0]]:e}:{},a=await this.call(n,t),i=Object.keys(a);if(1===i.length)return a[i[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory){const r=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[e,n]of Object.entries(r))t[e]=n}return t}async call(e,t,r){const i=await this._formatValues(e),s=(0,a.QH)(t),o=await a.Ye.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),l=await(o?.handleChainStart(this.toJSON(),i));let c;try{c=await(e.signal?Promise.race([this._call(i,l),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this._call(i,l))}catch(e){throw await(l?.handleChainError(e)),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),c),await(l?.handleChainEnd(c)),Object.defineProperty(c,n.WH,{value:l?{runId:l?.runId}:void 0,configurable:!0}),c}async apply(e,t){return Promise.all(e.map((async(e,r)=>this.call(e,t?.[r]))))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:t}=await Promise.resolve().then(r.bind(r,3995));return t.deserialize(e)}case"sequential_chain":{const{SequentialChain:t}=await Promise.resolve().then(r.bind(r,3685));return t.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:t}=await Promise.resolve().then(r.bind(r,3685));return t.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:t}=await Promise.resolve().then(r.bind(r,6090));return t.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:n}=await Promise.resolve().then(r.bind(r,858));return n.deserialize(e,t)}case"api_chain":{const{APIChain:t}=await Promise.resolve().then(r.bind(r,2702));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}},6090:(e,t,r)=>{"use strict";r.d(t,{MapReduceDocumentsChain:()=>o,RefineDocumentsChain:()=>l,StuffDocumentsChain:()=>s});var n=r(5641),a=r(3995),i=r(6430);class s extends n.l{get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter((e=>e!==this.documentVariableName))}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,n=t.map((({pageContent:e})=>e)).join("\n\n");return{...r,[this.documentVariableName]:n}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t?.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new s({llmChain:await a.LLMChain.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class o extends n.l{get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...n}=e;let a=r,i=[];for(let e=0;e<this.maxIterations;e+=1){const r=a.map((e=>({[this.documentVariableName]:e.pageContent,...n})));if(0!==e||!this.ensureMapStep){const e=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:a,...n}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(e)<this.maxTokens)break}const s=await this.llmChain.apply(r,t?Array.from({length:r.length},((e,r)=>t.getChild(`map_${r+1}`))):void 0),{outputKey:o}=this.llmChain;this.returnIntermediateSteps&&(i=i.concat(s.map((e=>e[o])))),a=s.map((e=>({pageContent:e[o],metadata:{}})))}const s={[this.combineDocumentChain.inputKey]:a,...n},o=await this.combineDocumentChain.call(s,t?.getChild("combine_documents"));return this.returnIntermediateSteps?{...o,intermediateSteps:i}:o}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new o({llmChain:await a.LLMChain.deserialize(e.llm_chain),combineDocumentChain:await s.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class l extends n.l{get defaultDocumentPrompt(){return new i.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter((e=>e!==this.documentVariableName&&e!==this.initialResponseName))}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},n={};return this.documentPrompt.inputVariables.forEach((e=>{n[e]=r[e]})),{[this.documentVariableName]:await this.documentPrompt.format({...n}),...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},n={};this.documentPrompt.inputVariables.forEach((e=>{n[e]=r[e]}));const a={[this.documentVariableName]:await this.documentPrompt.format({...n})};return{[this.initialResponseName]:t,...a}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...n}=e,a=r,i=await this._constructInitialInputs(a[0],n);let s=await this.llmChain.predict({...i},t?.getChild("answer"));const o=[s];for(let e=1;e<a.length;e+=1){const r={...await this._constructRefineInputs(a[e],s),...n};s=await this.refineLLMChain.predict({...r},t?.getChild("refine")),o.push(s)}return{[this.outputKey]:s}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new l({llmChain:await a.LLMChain.deserialize(t),refineLLMChain:await a.LLMChain.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},3995:(e,t,r)=>{"use strict";r.d(t,{LLMChain:()=>l});var n=r(5641),a=r(5962),i=r(8610),s=r(8869);class o extends s.bI{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class l extends n.l{get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new o,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let n;return n=this.outputParser?await this.outputParser.parseResultWithPrompt(e,t,r?.getChild()):e[0].text,n}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},n={...this.llmKwargs};for(const t of this.llm.callKeys)t in e&&(n[t]=e[t],delete r[t]);const a=await this.prompt.formatPromptValue(r),{generations:i}=await this.llm.generatePrompt([a],n,t?.getChild());return{[this.outputKey]:await this._getFinalOutput(i[0],a,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new l({llm:await i.qV.deserialize(t),prompt:await a.dy.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}},3685:(e,t,r)=>{"use strict";r.d(t,{SequentialChain:()=>o,SimpleSequentialChain:()=>l});var n=r(5641);function a(e,t){const r=new Set;for(const n of t)e.has(n)&&r.add(n);return r}function i(e,t){const r=new Set(e);for(const e of t)r.delete(e);return r}function s(e){return Array.from(e).map((e=>`"${e}"`)).join(", ")}class o extends n.l{get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){if(0===this.chains.length)throw new Error("Sequential chain must have at least one chain.");const e=this.memory?.memoryKeys??[],t=new Set(this.inputKeys),r=new Set(e),n=a(t,r);if(n.size>0)throw new Error(`The following keys: ${s(n)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const o=function(e,t){const r=new Set(e);for(const e of t)r.add(e);return r}(t,r);for(const e of this.chains){let t=i(new Set(e.inputKeys),o);if(e.memory&&(t=i(t,new Set(e.memory.memoryKeys))),t.size>0)throw new Error(`Missing variables for chain "${e._chainType()}": ${s(t)}. Only got the following variables: ${s(o)}.`);const r=new Set(e.outputKeys),n=a(o,r);if(n.size>0)throw new Error(`The following output variables for chain "${e._chainType()}" are overlapping: ${s(n)}. This can lead to unexpected behaviour.`);for(const e of r)o.add(e)}if(0===this.outputVariables.length)if(this.returnAll){const e=i(o,t);this.outputVariables=Array.from(e)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const e=i(new Set(this.outputVariables),new Set(o));if(e.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${s(e)}.`)}}async _call(e,t){let r={};const n=e;let a=0;for(const e of this.chains){a+=1,r=await e.call(n,t?.getChild(`step_${a}`));for(const e of Object.keys(r))n[e]=r[e]}const i={};for(const e of this.outputVariables)i[e]=n[e];return i}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],r=e.input_variables,a=e.output_variables,i=e.chains;for(const e of i){const r=await n.l.deserialize(e);t.push(r)}return new o({chains:t,inputVariables:r,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class l extends n.l{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(1!==e.inputKeys.filter((t=>!e.memory?.memoryKeys.includes(t)??!0)).length)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(1!==e.outputKeys.length)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],n=0;for(const a of this.chains)n+=1,r=(await a.call({[a.inputKeys[0]]:r,signal:e.signal},t?.getChild(`step_${n}`)))[a.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await(t?.handleText(r));return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],r=e.chains;for(const e of r){const r=await n.l.deserialize(e);t.push(r)}return new l({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}},858:(e,t,r)=>{"use strict";r.d(t,{VectorDBQAChain:()=>m});var n=r(5641),a=r(3995),i=r(6090),s=r(6430),o=r(2587);class l{async getPromptAsync(e,t){return this.getPrompt(e).partial(t?.partialVariables??{})}}class c extends l{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}const u=new s.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),d=[o.ov.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),o.kq.fromTemplate("{question}")],p=new c(u,[[function(e){return"base_chat_model"===e._modelType()},o.ks.fromPromptMessages(d)]]);function h(e,t={}){const{prompt:r=p.getPrompt(e),verbose:n}=t,s=new a.LLMChain({prompt:r,llm:e,verbose:n});return new i.StuffDocumentsChain({llmChain:s,verbose:n})}r(5962),r(2832),r(5738);class m extends n.l{get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const r=e[this.inputKey],n=await this.vectorstore.similaritySearch(r,this.k,e.filter,t?.getChild("vectorstore")),a={question:r,input_documents:n},i=await this.combineDocumentsChain.call(a,t?.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:n}:i}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:r}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new m({combineDocumentsChain:await n.l.deserialize(e.combine_documents_chain),k:e.k,vectorstore:r})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,r){return new this({vectorstore:t,combineDocumentsChain:h(e),...r})}}},5019:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ChatOpenAI:()=>T,PromptLayerChatOpenAI:()=>A});var n=r(6485),a=r(5606),i=r(9669);const s="text/event-stream";function o(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function l(e){return Array.isArray(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),l(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}async function u(e){const t=function(e){const t=new Headers(e.headers);if(e.auth){const r=e.auth.username||"",n=e.auth.password?decodeURI(encodeURIComponent(e.auth.password)):"";t.set("Authorization",`Basic ${btoa(`${r}:${n}`)}`)}const r=e.method.toUpperCase(),n={headers:t,method:r};"GET"!==r&&"HEAD"!==r&&(n.body=e.data,function(e){return"[object FormData]"===toString.call(e)}(n.body)&&("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document&&t.delete("Content-Type")),"string"==typeof n.body&&(n.body=(new TextEncoder).encode(n.body)),e.mode&&(n.mode=e.mode),e.cache&&(n.cache=e.cache),e.integrity&&(n.integrity=e.integrity),e.redirect&&(n.redirect=e.redirect),e.referrer&&(n.referrer=e.referrer),e.timeout&&e.timeout>0&&(n.signal=AbortSignal.timeout(e.timeout)),e.signal&&(n.signal=e.signal),function(e){return void 0===e}(e.withCredentials)||(n.credentials=e.withCredentials?"include":"omit"),"stream"===e.responseType&&n.headers.set("Accept",s);const a=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(function(e){return"[object URLSearchParams]"===toString.call(e)}(t))n=t.toString();else{var a=[];c(t,(function(e,t){null!=e&&(l(e)?t=`${t}[]`:e=[e],c(e,(function(e){!function(e){return"[object Date]"===toString.call(e)}(e)?function(e){return null!==e&&"object"==typeof e}(e)&&(e=JSON.stringify(e)):e=e.toISOString(),a.push(`${o(t)}=${o(e)}`)})))})),n=a.join("&")}if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}((i=e.baseURL,u=e.url,i&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(u)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(i,u):u),e.params,e.paramsSerializer);var i,u;return new Request(a,n)}(e),r=await async function(e,t){let r;try{r=await fetch(e)}catch(r){return r&&"AbortError"===r.name?d("Request aborted",t,"ECONNABORTED",e):r&&"TimeoutError"===r.name?d("Request timeout",t,"ECONNABORTED",e):d("Network Error",t,"ERR_NETWORK",e)}const n={};r.headers.forEach(((e,t)=>{n[t]=e}));const a={ok:r.ok,status:r.status,statusText:r.statusText,headers:n,config:t,request:e};if(r.status>=200&&204!==r.status)if("stream"===t.responseType){const e=r.headers.get("content-type");if(!e?.startsWith(s)){if(r.status>=400)return e?.startsWith("application/json")?(a.data=await r.json(),a):(a.data=await r.text(),a);throw new Error(`Expected content-type to be ${s}, Actual: ${e}`)}await async function(e,t){const r=e.getReader();for(;;){const e=await r.read();if(e.done){t(new Uint8Array,!0);break}t(e.value)}}(r.body,function(e){let t,r,n,a=!1;return function(i,s){if(s)return void e(i,0,!0);void 0===t?(t=i,r=0,n=-1):t=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(t,i);const o=t.length;let l=0;for(;r<o;){a&&(10===t[r]&&(l=++r),a=!1);let i=-1;for(;r<o&&-1===i;++r)switch(t[r]){case 58:-1===n&&(n=r-l);break;case 13:a=!0;case 10:i=r}if(-1===i)break;e(t.subarray(l,i),n),l=r,n=-1}l===o?t=void 0:0!==l&&(t=t.subarray(l),r-=l)}}(function(e,t,r){let n={data:"",event:"",id:"",retry:void 0};const a=new TextDecoder;return function(i,s,o){if(o)(function(e){return""===e.data&&""===e.event&&""===e.id&&void 0===e.retry})(n)||(e?.(n),n={data:"",event:"",id:"",retry:void 0});else if(0===i.length)e?.(n),n={data:"",event:"",id:"",retry:void 0};else if(s>0){const e=a.decode(i.subarray(0,s)),o=s+(32===i[s+1]?2:1),l=a.decode(i.subarray(o));switch(e){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":t?.(n.id=l);break;case"retry":{const e=parseInt(l,10);Number.isNaN(e)||r?.(n.retry=e);break}}}}}(t.onmessage)))}else switch(t.responseType){case"arraybuffer":a.data=await r.arrayBuffer();break;case"blob":a.data=await r.blob();break;case"json":a.data=await r.json();break;case"formData":a.data=await r.formData();break;default:a.data=await r.text()}return a}(t,e);return new Promise(((t,n)=>{r instanceof Error?n(r):"[object Function]"===Object.prototype.toString.call(e.settle)?e.settle(t,n,r):function(e,t,r){const{validateStatus:n}=r.config;r.status&&n&&!n(r.status)?t(d(`Request failed with status code ${r.status} and body ${"string"==typeof r.data?r.data:function(e){try{return JSON.stringify(e)}catch(t){return e}}(r.data)}`,r.config,null,r.request,r)):e(r)}(t,n,r)}))}function d(e,t,r,n,a){return i.AxiosError&&"function"==typeof i.AxiosError?new i.AxiosError(e,i.AxiosError[r],t,n,a):function(e,t,r,n,a){return e.config=t,r&&(e.code=r),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}(new Error(e),t,r,n,a)}var p=r(6134),h=r(8610),m=r(1345);class f extends h.qV{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=f._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===f.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=f._convertInputToPromptValue(e).toChatMessages(),[n,a]=this._separateRunnableConfigFromCallOptions(t),i=await m.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s={options:a,invocation_params:this?.invocationParams(a)},o=await(i?.handleChatModelStart(this.toJSON(),[r],void 0,void 0,s));let l;try{for await(const e of this._streamResponseChunks(r,a,o?.[0]))yield e.message,l=l?l.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[l]]}))))}}async generate(e,t,r){let n;n=Array.isArray(t)?{stop:t}:t;const[a,i]=this._separateRunnableConfigFromCallOptions(n),s=await m.Ye.configure(a.callbacks??r,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this?.invocationParams(n)},l=await(s?.handleChatModelStart(this.toJSON(),e,void 0,void 0,o)),c=await Promise.allSettled(e.map(((e,t)=>this._generate(e,{...i,promptIndex:t},l?.[t])))),u=[],d=[];await Promise.all(c.map((async(e,t)=>{if("fulfilled"===e.status){const r=e.value;return u[t]=r.generations,d[t]=r.llmOutput,l?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}return await(l?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const h={generations:u,llmOutput:d.length?this._combineLLMOutput?.(...d):void 0};return Object.defineProperty(h,p.WH,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),h}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const n=e.map((e=>e.toChatMessages()));return this.generate(n,t,r)}async call(e,t,r){return(await this.generate([e],t,r)).generations[0][0].message}async callPrompt(e,t,r){const n=e.toChatMessages();return this.call(n,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const n=new p.xk(e);return(await this.call([n],t,r)).content}}var g=r(1023);const b=async(e,t,r,n,a,i,s,o,l)=>(await e.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:t,provider:"langchain",args:r,kwargs:n,tags:a,request_response:i,request_start_time:Math.floor(s/1e3),request_end_time:Math.floor(o/1e3),api_key:l})})).json();var y=r(8841);function v(e){return{name:e.name,description:e.description,parameters:(0,y.zodToJsonSchema)(e.schema)}}var w=r(1858);function _(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":if(!p.J.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function P(e){switch(e.role){case"user":return new p.xk(e.content||"");case"assistant":return new p.gY(e.content||"",{function_call:e.function_call});case"system":return new p.jN(e.content||"");default:return new p.J(e.content||"",e.role??"unknown")}}function O(e,t){const r=e.role??t,n=e.content??"";let a;return a=e.function_call?{function_call:e.function_call}:{},"user"===r?new p.ro({content:n}):"assistant"===r?new p.GC({content:n,additional_kwargs:a}):"system"===r?new p.xq({content:n}):"function"===r?new p.Cr({content:n,additional_kwargs:a,name:e.name}):new p.HD({content:n,role:r})}class T extends f{get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,a.lS)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,a.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,a.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,a.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,a.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,a.lS)("AZURE_OPENAI_BASE_PATH"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:this.openAIApiKey,...t,...e?.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,stream:this.streaming,functions:e?.functions??(e?.tools?e?.tools.map(v):void 0),function_call:e?.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){const n=e.map((e=>({role:_(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call}))),a={...this.invocationParams(t),messages:n,stream:!0};let i="assistant";const s=this.startStream(a,t);for await(const e of s){const t=JSON.parse(e),n=t.choices?.[0];if(!n)continue;const{delta:a}=n,s=O(a,i);i=a.role??i;const o=new p.Ls({message:s,text:s.content});yield o,r?.handleLLMNewToken(o.text??"")}}startStream(e,t){let r=!1;const n=new TransformStream,a=n.writable.getWriter(),i=(0,w.H)(n.readable);let s;return this.completionWithRetry(e,{...t,adapter:u,responseType:"stream",onmessage:e=>{if(!r)if("[DONE]"===e.data?.trim?.())r=!0,a.close();else{const t=JSON.parse(e.data);if(t.error)throw r=!0,t.error;a.write(e.data)}}}).catch((e=>{r||(s=e,r=!0,a.close())})),{async next(){const e=await i.next();if(s)throw s;return e},[Symbol.asyncIterator](){return this}}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const n={},a=this.invocationParams(t),i=e.map((e=>({role:_(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call}))),s=a.stream?await new Promise(((e,n)=>{let s,o=!1,l=!1;this.completionWithRetry({...a,messages:i},{signal:t?.signal,...t?.options,adapter:u,responseType:"stream",onmessage:a=>{if("[DONE]"===a.data?.trim?.()){if(l||o)return;l=!0,e(s)}else{const i=JSON.parse(a.data);if(!i.id)return;if(i?.error){if(o)return;return o=!0,void n(i.error)}const c=i;s||(s={id:c.id,object:c.object,created:c.created,model:c.model,choices:[]});for(const e of c.choices??[])if(null!=e){let n=s.choices.find((t=>t.index===e.index));n||(n={index:e.index,finish_reason:e.finish_reason??void 0},s.choices[e.index]=n),n.message||(n.message={role:e.delta?.role,content:""}),e.delta.function_call&&!n.message.function_call&&(n.message.function_call={name:"",arguments:""}),n.message.content+=e.delta?.content??"",n.message.function_call&&(n.message.function_call.name+=e.delta?.function_call?.name??"",n.message.function_call.arguments+=e.delta?.function_call?.arguments??""),r?.handleLLMNewToken(e.delta?.content??"",{prompt:t.promptIndex??0,completion:e.index})}l||o||!c.choices?.every((e=>null!=e.finish_reason))||(l=!0,e(s))}}}).catch((e=>{o||(o=!0,n(e))}))})):await this.completionWithRetry({...a,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:o,prompt_tokens:l,total_tokens:c}=s.usage??{};o&&(n.completionTokens=(n.completionTokens??0)+o),l&&(n.promptTokens=(n.promptTokens??0)+l),c&&(n.totalTokens=(n.totalTokens??0)+c);const d=[];for(const e of s.choices){const t=e.message?.content??"";d.push({text:t,message:P(e.message??{role:"assistant"})})}return{generations:d,llmOutput:{tokenUsage:n}}}async getNumTokensFromMessages(e){let t=0,r=0,n=0;"gpt-3.5-turbo"===(0,g._i)(this.modelName)?(r=4,n=-1):(0,g._i)(this.modelName).startsWith("gpt-4")&&(r=3,n=1);const a=await Promise.all(e.map((async e=>{const a=await this.getNumTokens(e.content),i=await this.getNumTokens(_(e)),s=void 0!==e.name?n+await this.getNumTokens(e.name):0,o=a+r+i+s;return t+=o,o})));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){if(!this.client){const e=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:a,basePath:i}=e;if(n&&a&&t)return`${a}/${t}`;if(n){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return i}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,basePath:this.clientConfig.basePath}),t=new n.Configuration({...this.clientConfig,basePath:e,baseOptions:{timeout:this.timeout,...this.clientConfig.baseOptions}});this.client=new n.OpenAIApi(t)}const r={adapter:(0,a.UG)()?void 0:u,...this.clientConfig.baseOptions,...t};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.params={"api-version":this.azureOpenAIApiVersion,...r.params}),this.caller.call(this.client.createChatCompletion.bind(this.client),e,r).then((e=>e.data))}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}class A extends T{constructor(e){super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=e?.promptLayerApiKey??("undefined"!=typeof process?process.env?.PROMPTLAYER_API_KEY:void 0),this.plTags=e?.plTags??[],this.returnPromptLayerId=e?.returnPromptLayerId??!1}async _generate(e,t,r){const n=Date.now();let a;a=Array.isArray(t)?{stop:t}:t?.timeout&&!t.signal?{...t,signal:AbortSignal.timeout(t.timeout)}:t??{};const i=await super._generate(e,a,r),s=Date.now(),o=(e,t)=>{const r={...this.invocationParams(),model:this.modelName};if(t?.stop&&Object.keys(r).includes("stop"))throw new Error("`stop` found in both the input and default params.");return e.map((e=>(e=>{let t;if("human"===e._getType())t={role:"user",content:e.content};else if("ai"===e._getType())t={role:"assistant",content:e.content};else if("function"===e._getType())t={role:"assistant",content:e.content};else if("system"===e._getType())t={role:"system",content:e.content};else{if("generic"!==e._getType())throw new Error(`Got unknown type ${e}`);t={role:e.role,content:e.content}}return t})(e)))};for(let t=0;t<i.generations.length;t+=1){const r=i.generations[t],l=o(e,a);let c;const u=[{content:r.text,role:_(r.message)}],d=await b(this.caller,"langchain.PromptLayerChatOpenAI",l,this._identifyingParams(),this.plTags,u,n,s,this.promptLayerApiKey);!0===this.returnPromptLayerId&&(!0===d.success&&(c=d.request_id),r.generationInfo&&"object"==typeof r.generationInfo||(r.generationInfo={}),r.generationInfo.promptLayerRequestId=c)}return i}}},2385:(e,t,r)=>{"use strict";r.d(t,{i:()=>l});var n=r(2466);function a(e,t){return t?.[e]||n(e)}function i(e,t,r){const n={};for(const a in e)Object.hasOwn(e,a)&&(n[t(a,r)]=e[a]);return n}function s(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const r=s(e);for(const[e,n]of Object.entries(t)){const[t,...a]=e.split(".").reverse();let i=r;for(const e of a.reverse()){if(void 0===i[e])break;i[e]=s(i[e]),i=i[e]}void 0!==i[t]&&(i[t]={lc:1,type:"secret",id:[n]})}return r}r(3204);class l{get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof l||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(t,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));for(const e in t)e in this&&void 0!==this[e]&&(r[e]=this[e]||r[e]);return{lc:1,type:"constructor",id:[...this.lc_namespace,this.constructor.name],kwargs:i(Object.keys(t).length?o(r,t):r,a,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:[...this.lc_namespace,this.constructor.name]}}}},5962:(e,t,r)=>{"use strict";r.d(t,{Al:()=>o,dy:()=>s,nw:()=>i});var n=r(6134),a=(r(2385),r(0));class i extends n.MJ{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.xk(this.value)]}}class s extends a.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:{}});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[e,n]of Object.entries(t))r[e]="string"==typeof n?n:await n();return{...r,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,6430));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,6430));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,2832));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class o extends s{async formatPromptValue(e){const t=await this.format(e);return new i(t)}}},2587:(e,t,r)=>{"use strict";r.d(t,{GU:()=>l,gc:()=>p,kq:()=>d,ks:()=>m,ov:()=>h});var n=r(6134),a=r(2385),i=r(5962),s=r(6430);class o extends a.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}}class l extends n.MJ{constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class c extends o{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class u extends i.dy{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new l(t)}}class d extends c{async format(e){return new n.xk(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class p extends c{async format(e){return new n.gY(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class h extends c{async format(e){return new n.jN(await this.prompt.format(e))}static fromTemplate(e){return new this(s.PromptTemplate.fromTemplate(e))}}class m extends u{get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)for(const r of t.inputVariables)e.add(r);const t=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),r=new Set([...t].filter((t=>!e.has(t))));if(r.size>0)throw new Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);const n=new Set([...e].filter((e=>!t.has(e))));if(n.size>0)throw new Error(`Input variables \`${[...n]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const e of this.promptMessages){const n=e.inputVariables.reduce(((e,r)=>{if(!(r in t))throw new Error(`Missing value for input variable \`${r}\``);return e[r]=t[r],e}),{}),a=await e.formatMessages(n);r=r.concat(a)}return r}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new m(t)}static fromPromptMessages(e){const t=e.reduce(((e,t)=>e.concat(t instanceof m?t.promptMessages:[t])),[]),r=e.reduce(((e,t)=>t instanceof m?Object.assign(e,t.partialVariables):e),Object.create(null)),n=new Set;for(const e of t)for(const t of e.inputVariables)t in r||n.add(t);return new m({inputVariables:[...n],promptMessages:t,partialVariables:r})}}},2832:(e,t,r)=>{"use strict";r.d(t,{FewShotPromptTemplate:()=>s});var n=r(5962),a=r(5738),i=r(6430);class s extends n.Al{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new s(t)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),n=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...n,this.suffix].join(this.exampleSeparator);return(0,a.SM)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await i.PromptTemplate.deserialize(t);let n;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return n=e.examples,new s({inputVariables:e.input_variables,examplePrompt:r,examples:n,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}},6430:(e,t,r)=>{"use strict";r.d(t,{PromptTemplate:()=>i});var n=r(5962),a=r(5738);class i extends n.Al{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,a.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,n="\n\n",a=""){const s=[a,...e,t].join(n);return new i({inputVariables:r,template:s})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){const n=new Set;return(0,a.$M)(e,t).forEach((e=>{"variable"===e.type&&n.add(e.name)})),new i({inputVariables:[...n],templateFormat:t,template:e,...r})}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new i(t)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},5738:(e,t,r)=>{"use strict";r.d(t,{$M:()=>o,SM:()=>s,af:()=>l});const n=e=>{const t=e.split(""),r=[],n=(e,r)=>{for(let n=r;n<t.length;n+=1)if(e.includes(t[n]))return n;return-1};let a=0;for(;a<t.length;)if("{"===t[a]&&a+1<t.length&&"{"===t[a+1])r.push({type:"literal",text:"{"}),a+=2;else if("}"===t[a]&&a+1<t.length&&"}"===t[a+1])r.push({type:"literal",text:"}"}),a+=2;else if("{"===t[a]){const e=n("}",a);if(e<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(a+1,e).join("")}),a=e+1}else{if("}"===t[a])throw new Error("Single '}' in template.");{const e=n("{}",a),i=(e<0?t.slice(a):t.slice(a,e)).join("");r.push({type:"literal",text:i}),a=e<0?t.length:e}}return r},a={"f-string":(e,t)=>n(e).reduce(((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw new Error(`Missing value for input ${r.name}`)}return e+r.text}),""),jinja2:(e,t)=>""},i={"f-string":n,jinja2:e=>[]},s=(e,t,r)=>a[t](e,r),o=(e,t)=>i[t](e),l=(e,t,r)=>{if(!(t in a)){const e=Object.keys(a);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${e}`)}try{const n=r.reduce(((e,t)=>(e[t]="foo",e)),{});s(e,t,n)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},6134:(e,t,r)=>{"use strict";r.d(t,{Cr:()=>m,GC:()=>d,HD:()=>g,J:()=>f,Ls:()=>b,MJ:()=>y,WH:()=>a,gY:()=>u,jN:()=>p,ro:()=>c,xk:()=>l,xq:()=>h});var n=r(2385);const a="__run";class i{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class s extends n.i{get text(){return this.content}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class o extends s{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[e,n]of Object.entries(t))if(void 0===r[e])r[e]=n;else{if(typeof r[e]!=typeof n)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e])r[e]=r[e]+n;else{if(Array.isArray(r[e])||"object"!=typeof r[e])throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);r[e]=this._mergeAdditionalKwargs(r[e],n)}}return r}}class l extends s{_getType(){return"human"}}class c extends o{_getType(){return"human"}concat(e){return new c({content:this.content+e.content,additional_kwargs:c._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class u extends s{_getType(){return"ai"}}class d extends o{_getType(){return"ai"}concat(e){return new d({content:this.content+e.content,additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class p extends s{_getType(){return"system"}}class h extends o{_getType(){return"system"}concat(e){return new h({content:this.content+e.content,additional_kwargs:h._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class m extends o{_getType(){return"function"}concat(e){return new m({content:this.content+e.content,additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class f extends s{constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}class g extends o{constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new g({content:this.content+e.content,additional_kwargs:g._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class b extends i{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new b({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class y extends n.i{}},8869:(e,t,r)=>{"use strict";r.d(t,{bI:()=>i});var n=r(0);class a extends n.eq{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async e=>this.parseResult([{text:e}])),e,{...t,runType:"parser"}):this._callWithConfig((async e=>this.parseResult([{message:e,text:e.content}])),e,{...t,runType:"parser"})}}class i extends a{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}},0:(e,t,r)=>{"use strict";r.d(t,{eq:()=>o});var n=r(1345),a=r(2385),i=r(1858);function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class o extends a.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new p({bound:this,kwargs:e})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},(()=>e))}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),a=r?.maxConcurrency&&r.maxConcurrency>0?r?.maxConcurrency:e.length,i=[];for(let t=0;t<e.length;t+=a){const r=e.slice(t,t+a).map(((e,t)=>this.invoke(e,n[t]))),s=await Promise.all(r);i.push(s)}return i.flat()}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return i.Q.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const a=await n.Ye.configure(r?.callbacks,void 0,r?.tags,void 0,r?.metadata),i=await(a?.handleChainStart(this.toJSON(),s(t,"input"),void 0,r?.runType));let o;try{o=await e.bind(this)(t)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(s(o,"output"))),o}async*_streamWithConfig(e,t){const r=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s("<streamed value>","input"),void 0,t?.runType));let i,o=!0;try{for await(const t of e)if(yield t,o)if(void 0===i)i=t;else try{i=i.concat(t)}catch(e){i=void 0,o=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(s(i,"output")))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new l({first:this,last:d(e)})}static isRunnable(e){return e.lc_runnable}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s(e,"input")));let i,o=e;try{for(const e of[this.first,...this.middle])o=await e.invoke(o,this._patchConfig(t,a?.getChild()));i=await this.last.invoke(o,this._patchConfig(t,a?.getChild()))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(s(i,"output"))),i}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map((e=>n.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),o=await Promise.all(i.map(((t,r)=>t?.handleChainStart(this.toJSON(),s(e[r],"input")))));let l,c=e;try{for(let e=0;e<[this.first,...this.middle].length;e+=1){const t=this.steps[e];c=await t.batch(c,o.map((t=>this._patchConfig(a[e],t?.getChild())),r))}l=await this.last.batch(c,o.map((e=>this._patchConfig(a[this.steps.length-1],e?.getChild())),r))}catch(e){throw await Promise.all(o.map((t=>t?.handleChainError(e)))),e}return await Promise.all(o.map(((e,t)=>e?.handleChainEnd(s(l[t],"output"))))),l}async*_streamIterator(e,t){const r=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),s(e,"input")));let i=e;const o=[this.first,...this.middle,this.last],l=o.length-[...o].reverse().findIndex((e=>"function"!=typeof e.transform))-1;try{for(const e of o.slice(0,l))i=await e.invoke(i,this._patchConfig(t,a?.getChild()))}catch(e){throw await(a?.handleChainError(e)),e}let c,u=!0;try{let e=await o[l]._streamIterator(i,this._patchConfig(t,a?.getChild()));for(const r of o.slice(l+1))e=await r.transform(e,this._patchConfig(t,a?.getChild()));for await(const t of e)if(yield t,u)if(void 0===c)c=t;else try{c=c.concat(t)}catch(e){c=void 0,u=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(s(c,"output")))}pipe(e){return l.isRunnableSequence(e)?new l({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new l({first:this.first,middle:[...this.middle,this.last],last:d(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&o.isRunnable(e)}static from([e,...t]){return new l({first:d(e),middle:t.slice(0,-1).map(d),last:d(t[t.length-1])})}}class c extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=d(r)}async invoke(e,t){const r=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),{input:e})),i={};try{for(const[r,n]of Object.entries(this.steps)){const s=await n.invoke(e,this._patchConfig(t,a?.getChild()));i[r]=s}}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(i)),i}}class u extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async invoke(e,t){return this._callWithConfig((async e=>this.func(e)),e,t)}}function d(e){if("function"==typeof e)return new u({func:e});if(o.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,n]of Object.entries(e))t[r]=d(n);return new c({steps:t})}}class p extends o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs}bind(e){return new p({bound:this.bound,kwargs:{...this.kwargs,...e}})}async invoke(e,t){return this.bound.invoke(e,{...t,...this.kwargs})}async batch(e,t,r){const n=Array.isArray(t)?t.map((e=>({...e,...this.kwargs}))):{...t,...this.kwargs};return this.bound.batch(e,n,r)}async stream(e,t){return this.bound.stream(e,{...t,...this.kwargs})}}},803:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});var n=r(2693),a=r(5860);const i=[400,401,403,404,405,406,407,408,409];class s{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t=a.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>n((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&i.includes(+t))throw e;const r=e?.response?.data;if("insufficient_quota"===r?.error?.code){const e=new Error(r?.error?.message);throw e.name="InsufficientQuotaError",e}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},5606:(e,t,r)=>{"use strict";r.d(t,{UG:()=>a,lS:()=>l,sA:()=>o});const n=()=>"undefined"!=typeof Deno,a=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!n(),i=()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":a()?"node":"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":n()?"deno":"other",e};let s;async function o(){if(void 0===s){const e=i();s={library:"langchain-js",runtime:e}}return s}function l(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},1858:(e,t,r)=>{"use strict";function n(e,t=!1){if(e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();const r=e.getReader();return{async next(){try{const e=await r.read();return e.done&&r.releaseLock(),e}catch(e){throw r.releaseLock(),e}},async return(){if(t)r.releaseLock();else{const e=r.cancel();r.releaseLock(),await e}return{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}r.d(t,{H:()=>n,Q:()=>a});class a extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new a({start:e=>function r(){return t.read().then((({done:t,value:n})=>{if(!t)return e.enqueue(n),r();e.close()}))}()})}static fromAsyncGenerator(e){return new a({async pull(t){const{value:r,done:n}=await e.next();n?t.close():r&&t.enqueue(r)}})}}},8186:(e,t,r)=>{"use strict";r.d(t,{b:()=>p});var n=Object.defineProperty,a=r(9742);function i(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){const i=e.slice(r[a].start,r[a+1].end),s=t.get(i.join(","));null!=s&&(null==n||s<n[0])&&(n=[s,a])}if(null==n)break;{const e=n[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var s,o=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,n,...a]=t.split(" "),i=Number.parseInt(n,10);return a.forEach(((t,r)=>e[t]=i+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=a.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const n=new RegExp(this.patStr,"ug"),a=o.specialTokenRegex(Object.keys(this.specialTokens)),s=[],l=new Set("all"===t?Object.keys(this.specialTokens):t),c=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!l.has(e))):r);if(c.size>0){const t=o.specialTokenRegex([...c]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let u=0;for(;;){let t=null,r=u;for(;a.lastIndex=r,t=a.exec(e),null!=t&&!l.has(t[0]);)r=t.index+1;const o=t?.index??e.length;for(const t of e.substring(u,o).matchAll(n)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?s.push(...i(e,this.rankMap)):s.push(r)}if(null==t)break;let c=this.specialTokens[t[0]];s.push(c),u=t.index+t[0].length}return s}decode(e){const t=[];let r=0;for(let n=0;n<e.length;++n){const a=e[n],i=this.textMap.get(a)??this.inverseSpecialTokens[a];null!=i&&(t.push(i),r+=i.length)}const n=new Uint8Array(r);let a=0;for(const e of t)n.set(e,a),a+=e.length;return this.textDecoder.decode(n)}},l=o;((e,t,r)=>{t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(l,"symbol"!=typeof(s="specialTokenRegex")?s+"":s,(e=>new RegExp(e.map((e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|"),"g")));var c=r(803);const u={},d=new c.L({});async function p(e,t){return async function(e,t){return e in u||(u[e]=d.fetch(`https://tiktoken.pages.dev/js/${e}.json`,{signal:t?.signal}).then((e=>e.json())).catch((t=>{throw delete u[e],t}))),new l(await u[e],t?.extendedSpecialTokens)}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}(e),t)}},2811:e=>{"use strict";e.exports=JSON.parse('{"name":"openai","version":"3.3.0","description":"Node.js library for the OpenAI API","repository":{"type":"git","url":"git@github.com:openai/openai-node.git"},"keywords":["openai","open","ai","gpt-3","gpt3"],"author":"OpenAI","license":"MIT","main":"./dist/index.js","types":"./dist/index.d.ts","scripts":{"build":"tsc --outDir dist/"},"dependencies":{"axios":"^0.26.0","form-data":"^4.0.0"},"devDependencies":{"@types/node":"^12.11.5","typescript":"^3.6.4"}}')},7737:e=>{"use strict";e.exports=JSON.parse('{"components":{"examples":{},"headers":{},"parameters":{},"requestBodies":{},"responses":{},"schemas":{"Record_string.string-or-undefined_":{"properties":{},"type":"object","description":"Construct a type with a set of properties K of type T"},"JsonEL":{"description":"JsonEL: a tree structure that represents simplified structure of XML. A JsonEL object corresponds to an XML element. Please see the [documentation for JsonEL](https://yamachig.github.io/Lawtext/technical/intermediate-data/) for detail.","properties":{"tag":{"type":"string"},"attr":{"$ref":"#/components/schemas/Record_string.string-or-undefined_"},"children":{"items":{"anyOf":[{"$ref":"#/components/schemas/JsonEL"},{"type":"string"}]},"type":"array"}},"required":["tag","attr","children"],"type":"object","additionalProperties":false},"Articles":{"properties":{"ApplData":{"properties":{"ImageData":{"type":"string","description":"Image files referenced in `LawContents`. Compressed as Zip and encoded in Base64."},"AppdxTableTitleLists":{"properties":{"AppdxTableTitle":{"items":{"type":"string"},"type":"array"}},"required":["AppdxTableTitle"],"type":"object","description":"List of titles of AppdxTables if multiple results are detected."},"LawContents":{"anyOf":[{"type":"string"},{"items":{"$ref":"#/components/schemas/JsonEL"},"type":"array"}],"description":"Contents in [Japanese Standard Law XML format](https://elaws.e-gov.go.jp/file/XMLSchemaForJapaneseLaw_v3.xsd). If `jsonel=true` is specified, the XML is converted to JSON which complies with [JsonEL](https://yamachig.github.io/Lawtext/technical/intermediate-data/)."},"AppdxTable":{"type":"string","description":"AppdxTable (\\"別表\\") specified in the request."},"Paragraph":{"type":"string","description":"Paragraph (\\"項\\") specified in the request."},"Article":{"type":"string","description":"Article (\\"条\\") specified in the request."},"LawNum":{"type":"string","description":"LawNum (\\"法令番号\\") specified in the request."},"LawId":{"type":"string","description":"LawID (\\"法令ID\\") specified in the request."}},"required":["ImageData","LawContents","AppdxTable","Paragraph","Article","LawNum","LawId"],"type":"object","description":"Result data when `Result.Code` is \\"0\\"."},"Result":{"properties":{"Message":{"type":"string","description":"Error message when `Code` is \\"1\\"."},"Code":{"type":"string","enum":["0","1","2"],"description":"Whether an error occurred or not.\\r\\n* \\"0\\" - Success with a single result.\\r\\n* \\"1\\" - Error\\r\\n* \\"2\\" - Success with multiple results."}},"required":["Message","Code"],"type":"object"}},"required":["Result"],"type":"object"},"LawData":{"properties":{"ApplData":{"properties":{"ImageData":{"type":"string","description":"Image files referenced in `LawFullText`. Compressed as Zip and encoded in Base64."},"LawFullText":{"anyOf":[{"type":"string"},{"items":{"$ref":"#/components/schemas/JsonEL"},"type":"array"}],"description":"Full text in [Japanese Standard Law XML format](https://elaws.e-gov.go.jp/file/XMLSchemaForJapaneseLaw_v3.xsd). If `jsonel=true` is specified, the XML is converted to JSON which complies with [JsonEL](https://yamachig.github.io/Lawtext/technical/intermediate-data/)."},"LawNum":{"type":"string","description":"LawNum (\\"法令番号\\") specified in the request."},"LawId":{"type":"string","description":"LawID (\\"法令ID\\") specified in the request."}},"required":["ImageData","LawFullText","LawNum","LawId"],"type":"object","description":"Result data when `Result.Code` is \\"0\\"."},"Result":{"properties":{"Message":{"type":"string","description":"Error message when `Code` is \\"1\\"."},"Code":{"type":"string","enum":["0","1"],"description":"Whether an error occurred or not.\\r\\n* \\"0\\" - Success\\r\\n* \\"1\\" - Error"}},"required":["Message","Code"],"type":"object"}},"required":["Result"],"type":"object"},"LawLists":{"properties":{"ApplData":{"properties":{"LawNameListInfo":{"items":{"properties":{"PromulgationDate":{"type":"string","description":"Promulgation date (\\"公布日\\") in `YYYYMMDD`"},"LawNo":{"type":"string","description":"LawNum (\\"法令番号\\")"},"LawName":{"type":"string","description":"Law name (\\"法令名\\")"},"LawId":{"type":"string","description":"Law ID (\\"法令ID\\")"}},"required":["PromulgationDate","LawNo","LawName","LawId"],"type":"object"},"type":"array"},"Category":{"type":"string","enum":["1","2","3","4"],"description":"Type of laws specified in the request:\\r\\n* `1` - All of below\\r\\n* `2` - Constitution and Acts\\r\\n* `3` - Cabinet orders\\r\\n* `4` - Ministerial ordinances and Rules"}},"required":["LawNameListInfo","Category"],"type":"object","description":"Result data when `Result.Code` is \\"0\\"."},"Result":{"properties":{"Message":{"type":"string","description":"Error message when `Code` is \\"1\\"."},"Code":{"type":"string","enum":["0","1"],"description":"Whether an error occurred or not.\\r\\n* \\"0\\" - Success\\r\\n* \\"1\\" - Error"}},"required":["Message","Code"],"type":"object"}},"required":["Result"],"type":"object"},"UpdateLawLists":{"properties":{"ApplData":{"properties":{"LawNameListInfo":{"items":{"properties":{"AuthFlg":{"type":"string","enum":["0","1"]},"EnforcementFlg":{"type":"string","enum":["0","1"]},"LawUrl":{"type":"string"},"EnforcementComment":{"type":"string"},"EnforcementDate":{"type":"string"},"AmendPromulgationDate":{"type":"string"},"AmendNo":{"type":"string"},"AmendName":{"type":"string"},"OldLawName":{"type":"string"},"LawNameKana":{"type":"string"},"LawTypeName":{"type":"string"},"PromulgationDate":{"type":"string","description":"Promulgation date (\\"公布日\\") in `YYYYMMDD`"},"LawNo":{"type":"string","description":"LawNum (\\"法令番号\\")"},"LawName":{"type":"string","description":"Law name (\\"法令名\\")"},"LawId":{"type":"string","description":"Law ID (\\"法令ID\\")"}},"required":["AuthFlg","EnforcementFlg","LawUrl","EnforcementComment","EnforcementDate","AmendPromulgationDate","AmendNo","AmendName","OldLawName","LawNameKana","LawTypeName","PromulgationDate","LawNo","LawName","LawId"],"type":"object"},"type":"array"},"Date":{"type":"string","description":"The date specified in the request:"}},"required":["LawNameListInfo","Date"],"type":"object","description":"Result data when `Result.Code` is \\"0\\"."},"Result":{"properties":{"Message":{"type":"string","description":"Error message when `Code` is \\"1\\"."},"Code":{"type":"string","enum":["0","1"],"description":"Whether an error occurred or not.\\r\\n* \\"0\\" - Success\\r\\n* \\"1\\" - Error"}},"required":["Message","Code"],"type":"object"}},"required":["Result"],"type":"object"}},"securitySchemes":{}},"info":{"title":"elaws-openapi-proxy","version":"0.1.0","description":"An OpenAPI proxy for e-LAWS API (the official API for Japanese laws data).","contact":{"name":"yamachi"}},"openapi":"3.0.0","paths":{"/articles":{"get":{"operationId":"GetArticles","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Articles"},"examples":{"Success with Standard Law XML":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"LawId":"...","LawNum":"...","Article":"...","Paragraph":"...","AppdxTable":"...","LawContents":"<...>...</...>","ImageData":"...[Base64]..."}}},"Success with JsonEL (jsonel=true)":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"LawId":"...","LawNum":"...","Article":"...","Paragraph":"...","AppdxTable":"...","LawContents":[{"tag":"Article","attr":{},"children":[{"tag":"ArticleCaption","attr":{},"children":["..."]}]}],"ImageData":"...[Base64]..."}}},"Error":{"value":{"Result":{"Code":"1","Message":"An error occurred."}}}}}}}},"summary":"Retrieve a part of a law. You can retrieve such as Article (\\"条\\"), Paragraph (\\"項\\"), and AppdxTable (\\"別表\\"). Note: If your law identifier contains non-ASCII characters, please use `lawNum`, not `lawId`.","tags":["e-LAWS API Proxy"],"security":[],"parameters":[{"description":"LawID (\\"法令ID\\", e.g. \\"405AC0000000088\\") of a law to retrieve. A LawID only contains ASCII characters. Examples: \\"405AC0000000088\\", \\"428M60000008031\\", \\"325AC0000000131\\".","in":"query","name":"lawId","required":false,"schema":{"type":"string"},"examples":{"Example 1":{"value":"405AC0000000088"},"Example 2":{"value":"428M60000008031"},"Example 3":{"value":"325AC0000000131"}}},{"description":"LawNum (\\"法令番号\\", e.g. \\"平成五年法律第八十八号\\") of law to retrieve. Examples: \\"平成五年法律第八十八号\\", \\"平成二十八年総務省令第三十一号\\", \\"昭和二十五年法律第百三十一号\\".","in":"query","name":"lawNum","required":false,"schema":{"type":"string"}},{"description":"Article (\\"条\\") to retrieve. Examples: \\"第一条\\", \\"第十三条\\", \\"第百三条の四\\".","in":"query","name":"article","required":false,"schema":{"type":"string"},"examples":{"Example 1":{"value":"第一条"},"Example 2":{"value":"第十三条"},"Example 3":{"value":"第百三条の四"}}},{"description":"Paragraph (\\"項\\") to retrieve.","in":"query","name":"paragraph","required":false,"schema":{"type":"string"}},{"description":"AppdxTable (\\"別表\\") to retrieve.","in":"query","name":"appdxTable","required":false,"schema":{"type":"string"}},{"description":"If set as `true`, then the XML in `ApplData.LawContents` is converted to JSON which complies with [JsonEL](https://yamachig.github.io/Lawtext/technical/intermediate-data/).","in":"query","name":"jsonel","required":false,"schema":{"type":"boolean"}}]}},"/lawdata/{lawid_or_lawnum}":{"get":{"operationId":"GetLawData","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LawData"},"examples":{"Success with Standard Law XML":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"LawId":"...","LawNum":"...","LawFullText":"<Law>...</Law>","ImageData":"...[Base64]..."}}},"Success with JsonEL (jsonel=true)":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"LawId":"...","LawNum":"...","LawFullText":[{"tag":"Law","attr":{},"children":[{"tag":"LawNum","attr":{},"children":["..."]}]}],"ImageData":"...[Base64]..."}}},"Error":{"value":{"Result":{"Code":"1","Message":"An error occurred."}}}}}}}},"summary":"Retrieve the whole text of a law. If you need only a part of a law, consider using the `/articles` (\\"GetArticles\\") endpoint instead.","tags":["e-LAWS API Proxy"],"security":[],"parameters":[{"description":"LawID (\\"法令ID\\", e.g. \\"405AC0000000088\\") or LawNum (\\"法令番号\\", e.g. \\"平成五年法律第八十八号\\") of law to retrieve.","in":"path","name":"lawid_or_lawnum","required":true,"schema":{"type":"string"},"examples":{"Example 1":{"value":"405AC0000000088"},"Example 2":{"value":"平成五年法律第八十八号"}}},{"description":"If set as `true`, then the XML in `ApplData.LawFullText` is converted to JSON which complies with [JsonEL](https://yamachig.github.io/Lawtext/technical/intermediate-data/).","in":"query","name":"jsonel","required":false,"schema":{"type":"boolean"}}]}},"/lawlists/{type}":{"get":{"operationId":"GetLawLists","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LawLists"},"examples":{"Success":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"Category":"2","LawNameListInfo":[{"LawId":"...","LawName":"...","LawNo":"...","PromulgationDate":"..."}]}}},"Error":{"value":{"Result":{"Code":"1","Message":"An error occurred."}}}}}}}},"summary":"Retrieve a list of laws.","tags":["e-LAWS API Proxy"],"security":[],"parameters":[{"description":"Type of laws to retrieve:\\r\\n* `1` - All of below\\r\\n* `2` - Constitution and Acts\\r\\n* `3` - Cabinet orders\\r\\n* `4` - Ministerial ordinances and Rules","in":"path","name":"type","required":true,"schema":{"type":"string","enum":["1","2","3","4"]},"example":"2"}]}},"/updatelawlists/{date}":{"get":{"operationId":"GetUpdateLawLists","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateLawLists"},"examples":{"Success":{"value":{"Result":{"Code":"0","Message":""},"ApplData":{"Date":"20230303","LawNameListInfo":[{"LawId":"...","LawName":"...","LawNo":"...","PromulgationDate":"...","LawTypeName":"...","LawNameKana":"...","OldLawName":"...","AmendName":"...","AmendNo":"...","AmendPromulgationDate":"...","EnforcementDate":"...","EnforcementComment":"...","LawUrl":"...","EnforcementFlg":"0","AuthFlg":"0"}]}}},"Error":{"value":{"Result":{"Code":"1","Message":"An error occurred."}}}}}}}},"summary":"Retrieve a list of laws updated at a specified date.","tags":["e-LAWS API Proxy"],"security":[],"parameters":[{"description":"Date of update to retrieve.","in":"path","name":"date","required":true,"schema":{"type":"string"},"example":"20230303"}]}}},"servers":[{"url":"/api/1"}]}')}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n={};return(()=>{"use strict";var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.createAgentExecutor=void 0;var t=r(2749);Object.defineProperty(e,"createAgentExecutor",{enumerable:!0,get:function(){return t.createAgentExecutor}})})(),n})()));</script></head>
<body>
<div style="text-align: right;">
<small><a href="https://github.com/yamachig/elaws-openapi-proxy" target="_blank" rel="noopener noreferrer">GitHub</a></small>
</div>
<h3>To use: Press Ctrl+Shift+J to open the console.</h3>
</body>
</html>
